//--------------------Sonic 1 / Sonic 2 C Ledge Left Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 52: TYPE_CLEDGELEFT

// Function declarations
#function CLedgeLeft_DebugDraw
#function CLedgeLeft_DebugSpawn



//Unknown Variables
#array CLedgeLeft_array0:(32,32,32,32,32,32,32,32,32)
#static 48:staticVar0xEAAF
#static 32:staticVar0xEAB0
#static 32:staticVar0xEAB1
#static 32:staticVar0xEAB2
#static 32:staticVar0xEAB3
#static 32:staticVar0xEAB4
#static 32:staticVar0xEAB5
#static 32:staticVar0xEAB6
#static 32:staticVar0xEAB7
#static 33:staticVar0xEAB8
#static 33:staticVar0xEAB9
#static 34:staticVar0xEABA
#static 34:staticVar0xEABB
#static 35:staticVar0xEABC
#static 35:staticVar0xEABD
#static 36:staticVar0xEABE
#static 36:staticVar0xEABF
#static 37:staticVar0xEAC0
#static 37:staticVar0xEAC1
#static 38:staticVar0xEAC2
#static 38:staticVar0xEAC3
#static 39:staticVar0xEAC4
#static 39:staticVar0xEAC5
#static 40:staticVar0xEAC6
#static 40:staticVar0xEAC7
#static 41:staticVar0xEAC8
#static 41:staticVar0xEAC9
#static 42:staticVar0xEACA
#static 42:staticVar0xEACB
#static 43:staticVar0xEACC
#static 43:staticVar0xEACD
#static 44:staticVar0xEACE
#static 44:staticVar0xEACF
#static 45:staticVar0xEAD0
#static 45:staticVar0xEAD1
#static 46:staticVar0xEAD2
#static 46:staticVar0xEAD3
#static 47:staticVar0xEAD4
#static 47:staticVar0xEAD5
#static 48:staticVar0xEAD6
#static 48:staticVar0xEAD7
#static 48:staticVar0xEAD8
#static 48:staticVar0xEAD9
#static 48:staticVar0xEADA
#static 48:staticVar0xEADB
#static 48:staticVar0xEADC
#static 48:staticVar0xEADD
#static 48:staticVar0xEADE
#static 48:staticVar0xEADF

function CLedgeLeft_DebugDraw
	DrawSprite(0)
endfunction


function CLedgeLeft_DebugSpawn
	CreateTempObject(TypeName[CLedgeLeft],0,Object.XPos,Object.YPos)
endfunction


sub ObjectMain
	switch Object.State
	case 1
		if Object.Value0<10
			Object.Value0++
		else
			Object.Frame=1
			TempValue0=0
			TempValue3=Object.YPos
			TempValue3-=0x380000
			TempValue4=10
			while TempValue0<6
				TempValue1=0
				TempValue2=Object.XPos
				TempValue2-=0x280000
				while TempValue1<6
					CreateTempObject(TypeName[CLedgeLeft],Object.Frame,TempValue2,TempValue3)
					Object[TempObjectPos].State=4
					Object[TempObjectPos].Value1=TempValue4
					Object.Frame++
					TempValue1++
					TempValue2+=0x100000
					TempValue4+=4
				loop
				TempValue4-=26
				TempValue0++
				TempValue3+=0x100000
			loop
			PlaySfx(SFXName[LedgeBreakL],0)
			SetSfxAttributes(SFXName[LedgeBreakL],-1,-100)
			PlaySfx(SFXName[LedgeBreakR],0)
			SetSfxAttributes(SFXName[LedgeBreakR],-1,100)
			Object.Value0=0
			Object.State++
		endif
		break
	case 2
		if Object.Value0<20
			Object.Value0++
		else
			Object.Value0=0
			Object.State++
			ResetObjectEntity(Object.EntityNo,TypeName[BlankObject],0,Object.XPos,Object.YPos)
		endif
		break
	case 4
		if Object.Value0<Object.Value1
			Object.Value0++
		else
			Object.Value0=0
			Object.State++
		endif
		break
	case 5
		Object.YPos+=Object.YVelocity
		Object.YVelocity+=0x4000
		if Object.OutOfBounds==1
			Object.Type=TypeName[BlankObject]
		endif
		break

	endswitch
	if Object.State<3
		foreach TypeGroup[256],PlayerObjectPos
			if Object[PlayerObjectPos].YVelocity>=0
				TempValue0=Object[PlayerObjectPos].XPos
				TempValue0-=Object.XPos
				TempValue0>>=17
				TempValue0+=24
				if TempValue0<0
					TempValue0=0
				endif
				if TempValue0>47
					TempValue0=47
				endif
				TempValue2=47
				TempValue2-=TempValue0
				GetArrayValue(TempValue1,TempValue2,CLedgeLeft_array0)
				TempValue1-=84
				TempValue0=TempValue1
				TempValue0+=32
				PlayerObjectCollision(C_PLATFORM,Object.EntityNo,-48,TempValue1,48,TempValue0,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
				if CheckResult==1
					Object[PlayerObjectPos].YPos+=0x40000
					if Object.State==0
						Object.State=1
					endif
				endif
			endif
		floop
	endif
endsub


sub ObjectDraw
	switch Object.State
	case 0
	case 1
		DrawSprite(0)
		break
	case 4
	case 5
		DrawSprite(Object.PropertyValue)
		break

	endswitch
endsub


sub ObjectStartup
	LoadSpriteSheet("GHZ/Objects.gif")
	SpriteFrame(-48,-64,96,96,1,51)
	TempValue0=51
	while TempValue0<147
		TempValue1=1
		while TempValue1<97
			SpriteFrame(-8,-8,16,16,TempValue1,TempValue0)
			TempValue1+=16
		loop
		TempValue0+=16
	loop
	SetArrayValue(TypeName[CLedge Left],DebugMode_DebugItemCount,DebugMode_DebugTypeList)
	SetArrayValue(CLedgeLeft_DebugDraw,DebugMode_DebugItemCount,DebugMode_DebugDrawList)
	SetArrayValue(CLedgeLeft_DebugSpawn,DebugMode_DebugItemCount,DebugMode_DebugSpawnList)
	DebugMode_DebugItemCount++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
