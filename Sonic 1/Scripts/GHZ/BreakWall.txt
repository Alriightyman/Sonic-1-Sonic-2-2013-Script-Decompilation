//--------------------Sonic 1 / Sonic 2 Breakable Wall Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 51: TYPE_BREAKABLEWALL

// Function declarations
#function BreakableWall_DebugDraw
#function BreakableWall_DebugSpawn

#static 0:BreakableWall_staticVar34


function BreakableWall_DebugDraw
	TempValue0=Object[0].Value17
	TempValue0-=BreakableWall_staticVar34
	DrawSprite(TempValue0)
endfunction


function BreakableWall_DebugSpawn
	TempValue0=Object[0].Value17
	TempValue0-=BreakableWall_staticVar34
	CreateTempObject(TypeName[BreakableWall],TempValue0,Object.XPos,Object.YPos)
	Object[TempObjectPos].DrawOrder=4
endfunction


sub ObjectMain
	if Object.PropertyValue>2
		Object.XPos+=Object.XVelocity
		Object.YPos+=Object.YVelocity
		Object.YVelocity+=0x7000
		if Object.OutOfBounds==1
			Object.Type=TypeName[BlankObject]
		endif
	else
		foreach TypeGroup[256],PlayerObjectPos
			CheckResult=0
			if Object[PlayerObjectPos].State==PlayerObject_HandleRoll
				if Object[PlayerObjectPos].Speed>0x47FFF
					CheckResult=1
				endif
				if Object[PlayerObjectPos].Speed<-0x47FFF
					CheckResult=1
				endif
			endif
			if Stage.PlayerListPos==2
				CheckResult=1
			endif
			if PlayerObject_staticVar3==1
				CheckResult=1
			endif
			if CheckResult==1
				PlayerObjectCollision(C_TOUCH,Object.EntityNo,-17,-32,17,32,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
				if CheckResult==1
					Object.Type=TypeName[BlankObject]
					PlaySfx(SFXName[BlockBreak],0)
					TempValue0=Object.PropertyValue
					TempValue0<<=1
					TempValue0+=3
					TempValue1=TempValue0
					TempValue1++
					TempValue2=Object.XPos
					TempValue2-=0x80000
					TempValue3=Object.XPos
					TempValue3+=0x80000
					TempValue4=Object.YPos
					TempValue4-=0x180000
					if Object[PlayerObjectPos].XPos<Object.XPos
						CreateTempObject(TypeName[BreakableWall],TempValue0,TempValue2,TempValue4)
						Object[TempObjectPos].XVelocity=-0x60000
						Object[TempObjectPos].YVelocity=-0x60000
						Object[TempObjectPos].DrawOrder=4
						CreateTempObject(TypeName[BreakableWall],TempValue1,TempValue3,TempValue4)
						Object[TempObjectPos].XVelocity=-0x40000
						Object[TempObjectPos].YVelocity=-0x50000
						Object[TempObjectPos].DrawOrder=4
						TempValue4+=0x100000
						CreateTempObject(TypeName[BreakableWall],TempValue0,TempValue2,TempValue4)
						Object[TempObjectPos].XVelocity=-0x80000
						Object[TempObjectPos].YVelocity=-0x20000
						Object[TempObjectPos].DrawOrder=4
						CreateTempObject(TypeName[BreakableWall],TempValue1,TempValue3,TempValue4)
						Object[TempObjectPos].XVelocity=-0x60000
						Object[TempObjectPos].YVelocity=-0x10000
						Object[TempObjectPos].DrawOrder=4
						TempValue4+=0x100000
						CreateTempObject(TypeName[BreakableWall],TempValue0,TempValue2,TempValue4)
						Object[TempObjectPos].XVelocity=-0x80000
						Object[TempObjectPos].YVelocity=0x20000
						Object[TempObjectPos].DrawOrder=4
						CreateTempObject(TypeName[BreakableWall],TempValue1,TempValue3,TempValue4)
						Object[TempObjectPos].XVelocity=-0x60000
						Object[TempObjectPos].YVelocity=0x10000
						Object[TempObjectPos].DrawOrder=4
						TempValue4+=0x100000
						CreateTempObject(TypeName[BreakableWall],TempValue0,TempValue2,TempValue4)
						Object[TempObjectPos].XVelocity=-0x60000
						Object[TempObjectPos].YVelocity=0x60000
						Object[TempObjectPos].DrawOrder=4
						CreateTempObject(TypeName[BreakableWall],TempValue1,TempValue3,TempValue4)
						Object[TempObjectPos].XVelocity=-0x40000
						Object[TempObjectPos].YVelocity=0x50000
						Object[TempObjectPos].DrawOrder=4
					else
						CreateTempObject(TypeName[BreakableWall],TempValue0,TempValue2,TempValue4)
						Object[TempObjectPos].XVelocity=0x40000
						Object[TempObjectPos].YVelocity=-0x50000
						Object[TempObjectPos].DrawOrder=4
						CreateTempObject(TypeName[BreakableWall],TempValue1,TempValue3,TempValue4)
						Object[TempObjectPos].XVelocity=0x60000
						Object[TempObjectPos].YVelocity=-0x60000
						Object[TempObjectPos].DrawOrder=4
						TempValue4+=0x100000
						CreateTempObject(TypeName[BreakableWall],TempValue0,TempValue2,TempValue4)
						Object[TempObjectPos].XVelocity=0x60000
						Object[TempObjectPos].YVelocity=-0x10000
						Object[TempObjectPos].DrawOrder=4
						CreateTempObject(TypeName[BreakableWall],TempValue1,TempValue3,TempValue4)
						Object[TempObjectPos].XVelocity=0x80000
						Object[TempObjectPos].YVelocity=-0x20000
						Object[TempObjectPos].DrawOrder=4
						TempValue4+=0x100000
						CreateTempObject(TypeName[BreakableWall],TempValue0,TempValue2,TempValue4)
						Object[TempObjectPos].XVelocity=0x60000
						Object[TempObjectPos].YVelocity=0x10000
						Object[TempObjectPos].DrawOrder=4
						CreateTempObject(TypeName[BreakableWall],TempValue1,TempValue3,TempValue4)
						Object[TempObjectPos].XVelocity=0x80000
						Object[TempObjectPos].YVelocity=0x20000
						Object[TempObjectPos].DrawOrder=4
						TempValue4+=0x100000
						CreateTempObject(TypeName[BreakableWall],TempValue0,TempValue2,TempValue4)
						Object[TempObjectPos].XVelocity=0x40000
						Object[TempObjectPos].YVelocity=0x50000
						Object[TempObjectPos].DrawOrder=4
						CreateTempObject(TypeName[BreakableWall],TempValue1,TempValue3,TempValue4)
						Object[TempObjectPos].XVelocity=0x60000
						Object[TempObjectPos].YVelocity=0x60000
						Object[TempObjectPos].DrawOrder=4
					endif
					if Object[PlayerObjectPos].Animation==ANI_GLIDING
						Object[PlayerObjectPos].Animation=ANI_GLIDING_DROP
						Object[PlayerObjectPos].State=PlayerObject_KnuxGlideDrop
						if Object[PlayerObjectPos].Direction==FLIP_X
							FlipSign(Object[PlayerObjectPos].Speed)
						endif
					endif
				endif
			else
				PlayerObjectCollision(C_BOX,Object.EntityNo,-16,-32,16,32,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			endif
		floop
	endif
endsub


sub ObjectDraw
	DrawSprite(Object.PropertyValue)
endsub


sub ObjectStartup
	LoadSpriteSheet("GHZ/Objects.gif")
	foreach TypeName[BreakableWall],ArrayPos0
		Object[ArrayPos0].DrawOrder=4
	floop
	SpriteFrame(-16,-32,32,64,191,146)
	SpriteFrame(-16,-32,32,64,207,146)
	SpriteFrame(-16,-32,32,64,223,146)
	SpriteFrame(-8,-8,16,16,191,146)
	SpriteFrame(-8,-8,16,16,207,146)
	SpriteFrame(-8,-8,16,16,207,146)
	SpriteFrame(-8,-8,16,16,223,146)
	SpriteFrame(-8,-8,16,16,223,146)
	SpriteFrame(-8,-8,16,16,239,146)
	TempValue0=0
	BreakableWall_staticVar34=DebugMode_DebugItemCount
	while TempValue0<3
		SetArrayValue(TypeName[Breakable Wall],DebugMode_DebugItemCount,DebugMode_DebugTypeList)
		SetArrayValue(BreakableWall_DebugDraw,DebugMode_DebugItemCount,DebugMode_DebugDrawList)
		SetArrayValue(BreakableWall_DebugSpawn,DebugMode_DebugItemCount,DebugMode_DebugSpawnList)
		DebugMode_DebugItemCount++
		TempValue0++
	loop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
