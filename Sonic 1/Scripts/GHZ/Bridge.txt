//--------------------Sonic 1 / Sonic 2 Bridge Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 44: TYPE_BRIDGE

// Function declarations
#function Bridge_DebugDraw
#function Bridge_DebugSpawn

#static 0:Bridge_staticVar32


function Bridge_DebugDraw
	TempValue0=Object[0].Value17
	TempValue0-=Bridge_staticVar32
	TempValue2=TempValue0
	TempValue0<<=19
	FlipSign(TempValue0)
	TempValue0+=Object.XPos
	TempValue0+=0x80000
	TempValue1=0
	while TempValue1<TempValue2
		DrawSpriteXY(0,TempValue0,Object.YPos)
		TempValue0+=0x100000
		TempValue1++
	loop
	if TempValue1==0
		DrawSprite(0)
	endif
endfunction


function Bridge_DebugSpawn
	TempValue0=Object[0].Value17
	TempValue0-=Bridge_staticVar32
	CreateTempObject(TypeName[Bridge],TempValue0,Object.XPos,Object.YPos)
	Object[TempObjectPos].Value6=TempValue0
	Object[TempObjectPos].Value6<<=19
	Object[TempObjectPos].Value7=Object[TempObjectPos].Value6
	FlipSign(Object[TempObjectPos].Value6)
	Object[TempObjectPos].Value6+=Object[TempObjectPos].XPos
	Object[TempObjectPos].Value7+=Object[TempObjectPos].XPos
	Object[TempObjectPos].Value5=-1
endfunction


sub ObjectMain
	if Object.Value0>0
		if Object.Value1<128
			Object.Value1+=8
		endif
	else
		if Object.Value1>0
			Object.Value1-=8
			Object.Value5=-1
		else
			Object.Value3=0
		endif
	endif
	Object.Value4=Object.Value3
	Object.Value4*=Object.Value1
	Object.Value4>>=7
	Object.Value0=0
	foreach TypeGroup[256],PlayerObjectPos
		if Object[PlayerObjectPos].XPos>Object.Value6
			if Object[PlayerObjectPos].XPos<Object.Value7
				if PlayerObjectPos==Object.Value5
					Object.Value2=Object[PlayerObjectPos].XPos
					Object.Value2-=Object.Value6
					TempValue0=Object.Value2
					TempValue0>>=8
					TempValue1=Object.Value7
					TempValue1-=Object.Value6
					TempValue2=TempValue1
					TempValue2>>=16
					TempValue0/=TempValue2
					Sin(Object.Value3,TempValue0)
					TempValue1>>=13
					Object.Value3*=TempValue1
					TempValue0=Object.YPos
					TempValue0-=0x300000
					if Object[PlayerObjectPos].YPos>TempValue0
						if Object[PlayerObjectPos].YVelocity>=0
							TempValue2=Object[PlayerObjectPos].CollisionBottom
							FlipSign(TempValue2)
							TempValue2<<=16
							TempValue2+=Object.Value4
							TempValue2-=0x80000
							Object.Value0++
							Object[PlayerObjectPos].YPos=Object.YPos
							Object[PlayerObjectPos].YPos+=TempValue2
							Object[PlayerObjectPos].Gravity=GRAVITY_GROUND
							Object[PlayerObjectPos].YVelocity=0
							Object[PlayerObjectPos].Flailing0=1
							Object[PlayerObjectPos].Flailing1=1
							Object[PlayerObjectPos].Flailing2=1
						else
							Object.Value5=-2
						endif
					endif
				else
					if Object[PlayerObjectPos].YVelocity>=0
						TempValue0=Object[PlayerObjectPos].XPos
						TempValue0-=Object.Value6
						if TempValue0>Object.Value2
							TempValue0=Object.Value7
							TempValue0-=Object[PlayerObjectPos].XPos
							TempValue3=Object.Value7
							TempValue3-=Object.Value6
							TempValue3-=Object.Value2
							TempValue1=TempValue0
							TempValue1<<=7
							TempValue1/=TempValue3
						else
							TempValue1=TempValue0
							TempValue1<<=7
							TempValue1/=Object.Value2
						endif
						Sin(TempValue2,TempValue1)
						TempValue2*=Object.Value4
						TempValue2>>=9
						TempValue2-=0x80000
						if Object[PlayerObjectPos].YVelocity<0x8000
							TempValue3=TempValue2
							TempValue3>>=16
							TempValue4=TempValue3
							TempValue3-=8
						else
							TempValue3=TempValue2
							TempValue3>>=16
							TempValue4=TempValue3
							TempValue4+=8
						endif
						PlayerObjectCollision(C_TOUCH,Object.EntityNo,-0x400,TempValue3,0x400,TempValue4,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
						if CheckResult==1
							Object.Value0++
							Object[PlayerObjectPos].YPos=Object[PlayerObjectPos].CollisionBottom
							FlipSign(Object[PlayerObjectPos].YPos)
							Object[PlayerObjectPos].YPos<<=16
							Object[PlayerObjectPos].YPos+=Object.YPos
							Object[PlayerObjectPos].YPos+=TempValue2
							Object[PlayerObjectPos].Flailing0=1
							Object[PlayerObjectPos].Flailing1=1
							Object[PlayerObjectPos].Flailing2=1
							if PlayerObjectPos==0
								if Object.Value5<4
									if Object.Value5>0
										Object.Value2=Object[PlayerObjectPos].XPos
										Object.Value2-=Object.Value6
										TempValue0=Object.Value2
										TempValue0>>=8
										TempValue1=Object.Value7
										TempValue1-=Object.Value6
										TempValue2=TempValue1
										TempValue2>>=16
										TempValue0/=TempValue2
										Sin(Object.Value3,TempValue0)
										TempValue1>>=13
										Object.Value3*=TempValue1
										Object.Value4=Object.Value3
										Object.Value4*=Object.Value1
										Object.Value4>>=7
									endif
									Object.Value5=0
									if Object[PlayerObjectPos].YVelocity<256
										Object.Value1=128
									endif
								endif
							else
								if Object.Value5==-1
									Object.Value5=PlayerObjectPos
									if Object[PlayerObjectPos].YVelocity<256
										Object.Value1=128
									endif
								endif
								if Object.Value5==-2
									Object.Value5=PlayerObjectPos
								endif
							endif
							Object[PlayerObjectPos].Gravity=GRAVITY_GROUND
							Object[PlayerObjectPos].YVelocity=0
						endif
					endif
				endif
			else
				if PlayerObjectPos==Object.Value5
					Object.Value5=-2
					Object.Value1=32
				endif
			endif
		else
			if PlayerObjectPos==Object.Value5
				Object.Value5=-2
				Object.Value1=32
			endif
		endif
	floop
endsub


sub ObjectDraw
	TempValue0=0
	TempValue1=Object.Value6
	TempValue1+=0x80000
	TempValue4=0x80000
	TempValue5=Object.Value2
	TempValue5>>=20
	while TempValue0<TempValue5
		TempValue3=TempValue4
		TempValue3<<=7
		TempValue3/=Object.Value2
		Sin(TempValue2,TempValue3)
		TempValue2*=Object.Value4
		TempValue2>>=9
		TempValue2+=Object.YPos
		DrawSpriteXY(0,TempValue1,TempValue2)
		TempValue1+=0x100000
		TempValue4+=0x100000
		TempValue0++
	loop
	TempValue2=Object.Value4
	TempValue2+=Object.YPos
	DrawSpriteXY(0,TempValue1,TempValue2)
	TempValue1+=0x100000
	TempValue0++
	TempValue5=Object.Value7
	TempValue5-=Object.Value6
	TempValue5-=Object.Value2
	TempValue1=Object.Value7
	TempValue1-=0x80000
	TempValue4=0x80000
	while TempValue0<Object.PropertyValue
		TempValue3=TempValue4
		TempValue3<<=7
		TempValue3/=TempValue5
		Sin(TempValue2,TempValue3)
		TempValue2*=Object.Value4
		TempValue2>>=9
		TempValue2+=Object.YPos
		DrawSpriteXY(0,TempValue1,TempValue2)
		TempValue1-=0x100000
		TempValue4+=0x100000
		TempValue0++
	loop
endsub


sub ObjectStartup
	LoadSpriteSheet("GHZ/Objects.gif")
	SpriteFrame(-8,-8,16,16,1,1)
	foreach TypeName[Bridge],ArrayPos0
		Object[ArrayPos0].Value6=Object[ArrayPos0].PropertyValue
		Object[ArrayPos0].Value6<<=19
		Object[ArrayPos0].Value7=Object[ArrayPos0].Value6
		FlipSign(Object[ArrayPos0].Value6)
		Object[ArrayPos0].Value6+=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value7+=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value5=-1
	floop
	TempValue0=0
	Bridge_staticVar32=DebugMode_DebugItemCount
	Bridge_staticVar32--
	while TempValue0<16
		SetArrayValue(TypeName[Bridge],DebugMode_DebugItemCount,DebugMode_DebugTypeList)
		SetArrayValue(Bridge_DebugDraw,DebugMode_DebugItemCount,DebugMode_DebugDrawList)
		SetArrayValue(Bridge_DebugSpawn,DebugMode_DebugItemCount,DebugMode_DebugSpawnList)
		DebugMode_DebugItemCount++
		TempValue0++
	loop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
