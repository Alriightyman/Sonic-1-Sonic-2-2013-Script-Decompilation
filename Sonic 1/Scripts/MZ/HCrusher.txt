//--------------------Sonic 1 / Sonic 2 Horiz Crusher Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 70: TYPE_HORIZCRUSHER

// Function declarations
#function HorizCrusher_Function154
#function HorizCrusher_Function155
#function HorizCrusher_Function156

#constant 0:HorizCrusher_constant36


function HorizCrusher_Function154
	TempValue7=Object[0].Value17
	TempValue7-=HorizCrusher_constant36
	TempValue5=Object.XPos
	switch TempValue7
	case 0
		TempValue6=0x380000
		break
	case 1
		TempValue6=0x9F0000
		break
	case 2
		TempValue6=0x500000
		break
	case 3
		TempValue6=0x380000
		break

	endswitch
	if Object.Direction==FLIP_NONE
		FlipSign(TempValue6)
	endif
	TempValue5+=TempValue6
	if TempValue5>Object.XPos
		TempValue0=TempValue5
		TempValue0-=Object.XPos
	else
		TempValue0=Object.XPos
		TempValue0-=TempValue5
	endif
	TempValue0>>=16
	TempValue0+=4
	TempValue1=299
	TempValue1-=TempValue0
	if Object.Direction==FLIP_X
		TempValue2=TempValue0
		TempValue2+=34
		FlipSign(TempValue2)
	else
		TempValue2=16
	endif
	TempValue0+=17
	EditFrame(3,TempValue2,-8,TempValue0,16,TempValue1,388)
	DrawSpriteXY(3,TempValue5,Object.YPos)
	DrawSpriteFX(0,FX_FLIP,Object.XPos,Object.YPos)
	DrawSpriteFX(1,FX_FLIP,TempValue5,Object.YPos)
	DrawSpriteFX(2,FX_FLIP,TempValue5,Object.YPos)
endfunction


function HorizCrusher_Function155
	TempValue7=Object[0].Value17
	TempValue7-=HorizCrusher_constant36
	CreateTempObject(TypeName[HorizCrusher],0,Object.XPos,Object.YPos)
	Object[TempObjectPos].Direction=Object.Direction
	Object[TempObjectPos].Value2=0
	if Object.Direction==FLIP_NONE
		Object[TempObjectPos].Value8=-0x7000
	else
		Object[TempObjectPos].Value8=0x7000
	endif
	Object[TempObjectPos].Value3=Object.XPos
	Object[TempObjectPos].Value4=Object[TempObjectPos].Value3
	switch TempValue7
	case 0
		TempValue6=0x380000
		break
	case 1
		TempValue6=0x9F0000
		break
	case 2
		TempValue6=0x500000
		break
	case 3
		TempValue6=0x380000
		break

	endswitch
	if Object.Direction==FLIP_NONE
		FlipSign(TempValue6)
	endif
	Object[TempObjectPos].Value4+=TempValue6
	if Object[TempObjectPos].Value2==1
		Object[TempObjectPos].XPos=Object[TempObjectPos].Value4
	endif
endfunction


function HorizCrusher_Function156
	CheckResult=0
	TempValue0=Object.YPos
	TempValue0>>=16
	TempValue0-=Screen.CameraYPos
	Absolute(TempValue0)
	if 64<=Screen.CenterY
		TempValue1=Object.Value4
		TempValue1-=Object.Value3
		TempValue1>>=16
		TempValue1+=8
		TempValue1>>=1
		TempValue0=Object.Value3
		TempValue0+=Object.Value4
		TempValue0>>=17
		TempValue0-=12
		TempValue0-=Screen.CameraXPos
		Absolute(TempValue0)
		TempValue0-=TempValue1
		TempValue0-=40
		if TempValue0<=Screen.CenterX
			CheckResult=1
		endif
	endif
endfunction


sub ObjectMain
	if Object.Value2==1
		if Object[+1].PropertyValue==0
			Object.Value7=0
			Object.XVelocity+=Object.Value8
			Object.XPos+=Object.XVelocity
			TempValue0=0
			if Object.Direction==FLIP_NONE
				if Object.XPos<=Object.Value4
					TempValue0=1
				endif
			else
				if Object.XPos>=Object.Value4
					TempValue0=1
				endif
			endif
			if TempValue0==1
				Object.XPos=Object.Value4
				Object.XVelocity=0
			endif
		else
			if Object.Value8>0
				Object.XPos-=0x8000
			else
				Object.XPos+=0x8000
			endif
			TempValue0=0
			if Object.Direction==FLIP_NONE
				if Object.XPos>=Object.Value3
					TempValue0=1
				endif
			else
				if Object.XPos<=Object.Value3
					TempValue0=1
				endif
			endif
			if TempValue0==1
				Object.XPos=Object.Value3
				Object.XVelocity=0
			endif
		endif
	else
		switch Object.State
		case 0
			Object.Value7=0
			Object.XVelocity+=Object.Value8
			Object.XPos+=Object.XVelocity
			TempValue0=0
			if Object.Direction==FLIP_NONE
				if Object.XPos<=Object.Value4
					TempValue0=1
				endif
			else
				if Object.XPos>=Object.Value4
					TempValue0=1
				endif
			endif
			if TempValue0==1
				Object.XPos=Object.Value4
				Object.XVelocity=0
				Object.State++
			endif
			break
		case 1
			Object.Value0++
			if Object.Value0==60
				Object.Value0=0
				if Object.Value8>0
					Object.XVelocity=-0x8000
				else
					Object.XVelocity=0x8000
				endif
				Object.State++
			endif
			break
		case 2
			Object.XPos+=Object.XVelocity
			TempValue0=0
			if Object.Direction==FLIP_NONE
				if Object.XPos>=Object.Value3
					TempValue0=1
				endif
			else
				if Object.XPos<=Object.Value3
					TempValue0=1
				endif
			endif
			if TempValue0==1
				Object.XPos=Object.Value3
				Object.XVelocity=0
				Object.State++
			endif
			break
		case 3
			Object.Value0++
			if Object.Value0==4
				Object.Value0=0
				Object.State=0
			endif
			break

		endswitch
	endif
	Object.Value5=Object.XPos
	Object.Value5&=-0x10000
	Object.Value5-=Object.Value6
	TempValue0=Object.XPos
	Object.XPos=Object.Value6
	TempValue5=Object.Value5
	TempValue5>>=16
	if Object.Direction==FLIP_NONE
		TempValue6=-42
		TempValue6+=TempValue5
		TempValue7=-12
		TempValue7+=TempValue5
	else
		TempValue6=12
		TempValue6+=TempValue5
		TempValue7=42
		TempValue7+=TempValue5
	endif
	foreach TypeGroup[256],PlayerObjectPos
		PlayerObjectCollision(C_BOX,Object.EntityNo,-12,-32,12,32,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
		switch CheckResult
		case 1
			Object[PlayerObjectPos].XPos+=Object.Value5
			break
		case 2
			if Object.Value5<0
				Object[PlayerObjectPos].XPos+=Object.Value5
			endif
			break
		case 3
			if Object.Value5>0
				Object[PlayerObjectPos].XPos+=Object.Value5
			endif
			break
		case 4
			if Object[PlayerObjectPos].Gravity==GRAVITY_GROUND
				CallFunction(PlayerObject_Function51)
			endif
			break

		endswitch
		PlayerObjectCollision(C_TOUCH,Object.EntityNo,TempValue6,-24,TempValue7,24,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
		if CheckResult==1
			CallFunction(PlayerObject_Function46)
		endif
	floop
	Object.XPos=TempValue0
	Object.Value6=Object.XPos
	Object.Value6&=-0x10000
endsub


sub ObjectDraw
	if Object.XPos>Object.Value3
		TempValue0=Object.XPos
		TempValue0-=Object.Value3
	else
		TempValue0=Object.Value3
		TempValue0-=Object.XPos
	endif
	TempValue0>>=16
	TempValue0+=4
	TempValue1=299
	TempValue1-=TempValue0
	if Object.Direction==FLIP_X
		TempValue2=TempValue0
		TempValue2+=34
		FlipSign(TempValue2)
	else
		TempValue2=16
	endif
	TempValue0+=17
	EditFrame(3,TempValue2,-8,TempValue0,16,TempValue1,388)
	DrawSpriteXY(3,Object.Value6,Object.YPos)
	DrawSpriteFX(0,FX_FLIP,Object.Value3,Object.YPos)
	DrawSpriteFX(1,FX_FLIP,Object.Value6,Object.YPos)
	DrawSpriteFX(2,FX_FLIP,Object.Value6,Object.YPos)
endsub


sub ObjectStartup
	LoadSpriteSheet("MZ/Objects.gif")
	SpriteFrame(36,-16,8,32,289,158)
	SpriteFrame(-12,-32,32,64,256,142)
	SpriteFrame(-43,-24,31,48,256,207)
	SpriteFrame(-92,-8,184,16,132,388)
	foreach TypeName[HorizCrusher],ArrayPos0
		Object[ArrayPos0].Value2=Object[ArrayPos0].PropertyValue
		Object[ArrayPos0].Value2>>=7
		GetBit(Object[ArrayPos0].Direction,Object[ArrayPos0].PropertyValue,6)
		Object[ArrayPos0].Value8=-0x7000
		Object[ArrayPos0].State=Object[ArrayPos0].PropertyValue
		Object[ArrayPos0].State&=3
		Object[ArrayPos0].Value3=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value4=Object[ArrayPos0].Value3
		switch Object[ArrayPos0].State
		case 0
			TempValue0=0x380000
			break
		case 1
			TempValue0=0x9F0000
			break
		case 2
			TempValue0=0x500000
			break
		case 3
			TempValue0=0x380000
			break

		endswitch
		if Object[ArrayPos0].Direction==FLIP_NONE
			FlipSign(TempValue0)
		endif
		Object[ArrayPos0].Value4+=TempValue0
		if Object[ArrayPos0].Value2==1
			Object[ArrayPos0].XPos=Object[ArrayPos0].Value4
		endif
	floop
	TempValue0=0
	HorizCrusher_constant36=DebugMode_DebugItemCount
	while TempValue0<4
		SetArrayValue(70,DebugMode_DebugItemCount,DebugMode_DebugTypeList)
		SetArrayValue(154,DebugMode_DebugItemCount,DebugMode_DebugDrawList)
		SetArrayValue(155,DebugMode_DebugItemCount,DebugMode_DebugSpawnList)
		DebugMode_DebugItemCount++
		TempValue0++
	loop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
