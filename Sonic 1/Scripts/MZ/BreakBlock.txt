//--------------------Sonic 1 / Sonic 2 Break Block Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 58: TYPE_BREAKBLOCK

// Function declarations
#function BreakBlock_Function137
#function BreakBlock_Function138



function BreakBlock_Function137
	DrawSprite(0)
endfunction


function BreakBlock_Function138
	CreateTempObject(TypeName[BreakBlock],0,Object.XPos,Object.YPos)
endfunction


sub ObjectMain
	switch Object.State
	case 0
		foreach TypeGroup[256],PlayerObjectPos
			if Object[PlayerObjectPos].Animation==ANI_JUMPING
				PlayerObjectCollision(C_BOX,Object.EntityNo,-16,-16,16,16,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
				if CheckResult==1
					Object[PlayerObjectPos].YVelocity=-0x30000
					Object[PlayerObjectPos].Gravity=GRAVITY_AIR
					CreateTempObject(TypeName[ObjectScore],Object[PlayerObjectPos].Value19,Object.XPos,Object.YPos)
					Object[TempObjectPos].DrawOrder=4
					CreateTempObject(TypeName[BreakBlock],0,Object.XPos,Object.YPos)
					Object[TempObjectPos].iXPos-=8
					Object[TempObjectPos].iYPos-=8
					Object[TempObjectPos].XVelocity=-0x20000
					Object[TempObjectPos].YVelocity=-0x20000
					Object[TempObjectPos].State=1
					Object[TempObjectPos].DrawOrder=5
					CreateTempObject(TypeName[BreakBlock],0,Object.XPos,Object.YPos)
					Object[TempObjectPos].iXPos+=8
					Object[TempObjectPos].iYPos-=8
					Object[TempObjectPos].XVelocity=0x20000
					Object[TempObjectPos].YVelocity=-0x20000
					Object[TempObjectPos].State=1
					Object[TempObjectPos].DrawOrder=5
					CreateTempObject(TypeName[BreakBlock],0,Object.XPos,Object.YPos)
					Object[TempObjectPos].iXPos-=8
					Object[TempObjectPos].iYPos+=8
					Object[TempObjectPos].XVelocity=-0x10000
					Object[TempObjectPos].YVelocity=-0x10000
					Object[TempObjectPos].State=1
					Object[TempObjectPos].DrawOrder=5
					CreateTempObject(TypeName[BreakBlock],0,Object.XPos,Object.YPos)
					Object[TempObjectPos].iXPos+=8
					Object[TempObjectPos].iYPos+=8
					Object[TempObjectPos].XVelocity=0x10000
					Object[TempObjectPos].YVelocity=-0x10000
					Object[TempObjectPos].State=1
					Object[TempObjectPos].DrawOrder=5
					Object.Type=TypeName[BlankObject]
					switch Object[PlayerObjectPos].Value19
					case 0
						player.score+=100
						break
					case 1
						player.score+=200
						break
					case 2
						player.score+=500
						break
					case 3
					case 4
					case 5
					case 6
					case 7
					case 8
					case 9
					case 10
					case 11
					case 12
					case 13
					case 14
						player.score+=1000
						break
					case 15
						player.score+=0x2710
						if Stage.DebugMode==0
							EngineCallback(SetAchievement,3,100)
						endif
						break

					endswitch
					if Object[PlayerObjectPos].Gravity==GRAVITY_AIR
						if Object[PlayerObjectPos].Value19<15
							Object[PlayerObjectPos].Value19++
						endif
					endif
					PlaySfx(SFXName[BlockBreak],0)
				endif
			else
				PlayerObjectCollision(C_BOX,Object.EntityNo,-16,-16,16,16,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			endif
		floop
		break
	case 1
		Object.XPos+=Object.XVelocity
		Object.YPos+=Object.YVelocity
		Object.YVelocity+=0x3800
		if Object.OutOfBounds==1
			Object.Type=TypeName[BlankObject]
		endif
		break

	endswitch
endsub


sub ObjectDraw
	DrawSprite(Object.State)
endsub


sub ObjectStartup
	LoadSpriteSheet("MZ/Objects.gif")
	SpriteFrame(-16,-16,32,32,317,363)
	SpriteFrame(-8,-8,16,16,317,363)
	SetArrayValue(58,DebugMode_constant23,DebugMode_array12)
	SetArrayValue(137,DebugMode_constant23,DebugMode_array13)
	SetArrayValue(138,DebugMode_constant23,DebugMode_array11)
	DebugMode_constant23++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
