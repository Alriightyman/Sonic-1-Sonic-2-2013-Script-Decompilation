//--------------------Sonic 1 / Sonic 2 MZ Setup Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 39: TYPE_MZSETUP

// Function declarations
#function MZSetup_SpeedUpMusic
#function MZSetup_SlowDownMusic

#array MZSetup_ReplayData0:(0x300000,0x2640000,0,8,8,137,56,1,40,4,8,14,0,18,8,18,56,1,40,7,8,2,0,32,2,13,0,3,48,1,32,8,0,3,8,49,56,1,40,7,8,37,56,1,40,8,8,2,0,18,4,16,0,5,48,1,32,11,8,11,0,7,4,16,0,4,8,6,0,22,8,5,56,1,40,12,8,16,0,17,8,31,0,13,56,1,40,9,0,36,8,2,56,1,40,9,8,36,0,66,48,1,32,8,4,37,0,6,4,17,52,1,36,6,4,68,0,28,2,12,50,1,34,8,2,50,0,32,8,83,56,1,40,8,8,9,0,21,56,1,40,7,8,5,0,98,8,69,0,25,8,21,56,1,40,6,8,4,0,15,4,16,0,4,8,18,56,1,40,7,8,5,0,27,8,23,0,9,48,1,32,6,0,19,8,19,0,20,56,4,40,9,8,4)
#array MZSetup_ReplayData2:(0x300000,0x2680000,0,8,8,41,56,1,40,3,8,80,56,1,40,6,8,7,0,23,8,21,56,1,40,5,8,6,0,15,8,8,0,17,56,1,40,5,8,46,56,1,40,12,8,30,0,9,48,1,32,3,40,3,0,25,4,4,0,7,8,3,56,1,40,7,0,14,4,18,0,5,8,5,56,1,40,9,8,7,0,24,8,17,0,12,8,19,0,3,48,1,32,7,40,4,8,12,0,20,8,17,56,1,40,10,8,98,0,7,4,80,52,1,36,20,4,2,0,14,8,21,56,1,40,10,8,15,56,1,40,7,8,59,0,23,8,6,56,1,40,6,8,56,0,27,8,24,0,17,8,73,56,1,40,8,8,23,0,5,4,25,0,24,4,36,0,77,4,35,52,1,36,7,4,7,0,13,8,19,0,53,4,10,52,1,36,4,4,16,0,14,4,8,0,101,4,4,52,1,36,2,4,32,0,14)
#array MZSetup_ReplayData3:(0x300000,0x2640000,0,22,8,137,56,1,40,7,8,6,0,40,8,9,56,1,40,6,8,18,0,3,4,16,8,5,56,1,40,8,8,22,56,1,40,27,8,32,56,1,40,15,8,9,0,27,48,1,32,10,40,2,8,18,0,21,8,2,56,1,40,14,32,3,0,8,4,16,0,3,8,40,56,1,40,24,8,4,0,18,8,11,56,1,40,13,8,86,56,1,40,5,8,6,56,1,40,20,8,31,56,1,40,6,8,11,0,17,8,29,0,47,48,1,32,14,0,24,4,15,0,16,8,9,0,47,48,1,32,13,40,2,8,8,56,1,40,20,9,3,1,83,9,2,8,91,0,29,48,1,32,13,0,7,48,1,32,15,33,1)
#array MZSetup_ReplayData1:(0xEA00000,0x46C0000,0,23,4,40,0,5,8,31,56,1,40,30,8,24,56,1,40,3,44,2,36,8,4,13,0,15,4,16,0,5,4,22,52,1,36,3,4,4,0,16,4,12,0,42,8,8,0,19,0,8,4,1,0,64)
#array MZSetup_ReplayData4:(0xEA00000,0x46C0000,0,25,4,29,52,1,36,15,4,5,0,18,8,17,56,1,40,10,8,4,56,1,40,43,8,4,0,17,4,4,52,1,36,5,4,3,0,33,4,109,0,34,8,9,0,15,4,5,0,255,0,40,48,1,32,8,0,7,4,12)

function MZSetup_SpeedUpMusic
	CheckEqual(Object[25].Type,TypeName[MusicEvent])
	TempValue0=CheckResult
	CheckEqual(Object[25].PropertyValue,2)
	TempValue0&=CheckResult
	CheckEqual(stage.musicFlag,0)
	TempValue0&=CheckResult
	if TempValue0==0
		switch Music.CurrentTrack
		case 0
			SetMusicTrack("Invincibility_F.ogg",2,0x76E4)
			SwapMusicTrack("Marble_F.ogg",0,0x136B1,0x1F40)
			break
		case 2
			SetMusicTrack("Marble_F.ogg",0,0x136B1)
			SwapMusicTrack("Invincibility_F.ogg",2,0x76E4,0x1F40)
			break
		case 4
			SetMusicTrack("Marble_F.ogg",0,0x136B1)
			SetMusicTrack("Invincibility_F.ogg",2,0x76E4)
			break

		endswitch
	else
		stage.musicFlag=1
	endif
endfunction


function MZSetup_SlowDownMusic
	CheckEqual(Object[25].Type,TypeName[MusicEvent])
	TempValue0=CheckResult
	CheckEqual(Object[25].PropertyValue,2)
	TempValue0&=CheckResult
	CheckEqual(stage.musicFlag,0)
	TempValue0&=CheckResult
	if TempValue0==0
		switch Music.CurrentTrack
		case 0
			SetMusicTrack("Invincibility.ogg",2,0x9A68)
			SwapMusicTrack("Marble.ogg",0,0x18434,0x30D4)
			break
		case 2
			SetMusicTrack("Marble.ogg",0,0x18434)
			SwapMusicTrack("Invincibility.ogg",2,0x9A68,0x30D4)
			break
		case 4
			SetMusicTrack("Marble.ogg",0,0x18434)
			SetMusicTrack("Invincibility.ogg",2,0x9A68)
			break
		endswitch
	else
		stage.musicFlag=2
	endif
endfunction


sub ObjectMain
	Object.Frame=Object.AnimationTimer
	Object.Frame/=20
	Object.AnimationTimer++
	Object.AnimationTimer%=60
	Object.Value2=Object.Frame
	Object.Value2<<=1
	Object.Value2+=440
	Copy16x16Tile(366,Object.Value2)
	Object.Value2++
	Copy16x16Tile(367,Object.Value2)
	switch Object.Frame
	case 0
		Object.Value2=460
		break
	case 1
		Object.Value2=528
		break
	case 2
		Object.Value2=596
		break
	endswitch
	Object.Value3++
	Object.Value3&=511
	Sin(Object.Value1,Object.Value3)
	Object.Value1+=512
	Object.Value1>>=2
	Object.Value1&=31
	if Object.Value1>15
		Object.Value1&=15
		Object.Value1<<=2
		Object.Value2+=Object.Value1
		Copy16x16Tile(363,Object.Value2)
		Object.Value2++
		Copy16x16Tile(362,Object.Value2)
		Object.Value2++
		Copy16x16Tile(365,Object.Value2)
		Object.Value2++
		Copy16x16Tile(364,Object.Value2)
	else
		Object.Value1<<=2
		Object.Value2+=Object.Value1
		Copy16x16Tile(362,Object.Value2)
		Object.Value2++
		Copy16x16Tile(363,Object.Value2)
		Object.Value2++
		Copy16x16Tile(364,Object.Value2)
		Object.Value2++
		Copy16x16Tile(365,Object.Value2)
	endif
	TempValue0=Object.Value4
	TempValue0>>=4
	TempValue0<<=1
	TempValue0+=446
	Copy16x16Tile(360,TempValue0)
	TempValue0++
	Copy16x16Tile(361,TempValue0)
	TempValue0++
	Object.Value4++
	Object.Value4&=63
	foreach TypeGroup[256],PlayerObjectPos
		TempValue1=Object[PlayerObjectPos].XPos
		TempValue1>>=16
		TempValue2=Object[PlayerObjectPos].YPos
		TempValue2>>=16
		TempValue2+=4
		Get16x16TileInfo(TempValue0,TempValue1,TempValue2,TILEINFO_ANGLEB)
		if TempValue0==1
			if Object[PlayerObjectPos].Value37!=3
				CallFunction(PlayerObject_Hit)
			endif
		endif
	floop
endsub


sub ObjectDraw
	if Screen.YOffset>458
		TempValue0=Screen.YOffset
		TempValue0-=458
		TempValue0*=0xC000
		TileLayer[1].ScrollPos=TempValue0
	else
		TileLayer[1].ScrollPos=0
	endif
endsub


sub ObjectStartup
	SetMusicTrack("Marble.ogg",0,0x18434)
	SpeedUpMusic=MZSetup_SpeedUpMusic
	SlowDownMusic=MZSetup_SlowDownMusic
	animalType1=TypeName[Ricky]
	animalType2=TypeName[Rocky]
	Object[10].Type=TypeName[MZSetup]
	Object[10].Priority=PRIORITY_ACTIVE
	Object[10].DrawOrder=0
	switch Stage.ActNo
	case 2
		HParallax[0].ScrollPos=0x1000000
		HParallax[1].ScrollPos=0x2000000
		HParallax[2].ScrollPos=0x2000000
		HParallax[3].ScrollPos=0x2000000
		HParallax[4].ScrollPos=0x2000000
		HParallax[5].ScrollPos=0x2000000
		HParallax[6].ScrollPos=0x2000000
		break
	case 3
		HParallax[0].ScrollPos=0x4000000
		HParallax[1].ScrollPos=0x1000000
		HParallax[2].ScrollPos=0x1000000
		HParallax[3].ScrollPos=0x1000000
		HParallax[4].ScrollPos=0x1000000
		HParallax[5].ScrollPos=0x1000000
		HParallax[6].ScrollPos=0x1000000
		break
	endswitch
	if options.attractMode==1
		switch Stage.PlayerListPos
		case 0
			if credits.screen==0
				PlayerObject_staticVar2=MZSetup_ReplayData0
				PlayerObject_staticVar8=194
				PlayerObject_staticVar7=0x67C
			else
				PlayerObject_staticVar2=MZSetup_ReplayData1
				PlayerObject_staticVar8=56
				PlayerObject_staticVar7=540
			endif
			break
		case 1
			if credits.screen==0
				PlayerObject_staticVar2=MZSetup_ReplayData2
				PlayerObject_staticVar8=206
				PlayerObject_staticVar7=0x708
			else
				PlayerObject_staticVar2=MZSetup_ReplayData1
				PlayerObject_staticVar8=56
				PlayerObject_staticVar7=540
			endif
			break
		case 2
			if credits.screen==0
				PlayerObject_staticVar2=MZSetup_ReplayData3
				PlayerObject_staticVar8=162
				PlayerObject_staticVar7=0x708
			else
				PlayerObject_staticVar2=MZSetup_ReplayData4
				PlayerObject_staticVar8=62
				PlayerObject_staticVar7=540
			endif
			break
		endswitch
		CallFunction(PlayerObject_InitReplay)
	endif
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
