//--------------------Sonic 1 / Sonic 2 ActFinish Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 8: TYPE_ACTFINISH




sub ObjectMain
	switch Object.State
	case 0
		Object.DrawOrder=6
		Object.Priority=PRIORITY_ACTIVE
		Object.XPos=Screen.CenterX
		Object.XPos+=128
		Object.YPos=Screen.CenterX
		Object.Value1=Screen.CenterX
		FlipSign(Object.Value1)
		Object.Value1-=160
		Object.Value2=Screen.CenterX
		FlipSign(Object.Value2)
		Object.Value2-=160
		Object.Value3=Screen.CenterX
		Object.Value3+=128
		Object.Value4=Object.Value3
		Object.Value4+=32
		Object.Scale=Object.Value4
		Object.Scale+=32
		if PlayerObject_staticVar3==1
			PlayerObject_staticVar3=2
		endif
		switch Stage.Minutes
		case 0
			if Stage.Seconds<30
				Object.Value5=0xC350
			else
				if Stage.Seconds<45
					Object.Value5=0x2710
				else
					Object.Value5=0x1388
				endif
			endif
			break
		case 1
			if Stage.Seconds<30
				Object.Value5=0xFA0
			else
				Object.Value5=0xBB8
			endif
			break
		case 2
			Object.Value5=0x7D0
			break
		case 3
			Object.Value5=1000
			break
		case 4
			Object.Value5=500
			break
		case 5
			Object.Value5=100
			break
		case 9
			if Stage.DebugMode==0
				if options.gameMode<2
					if Stage.Seconds==59
						Object.Value5=0x186A0
					endif
				endif
			endif
			break

		endswitch
		Object.Value6=Object[0].Value0
		Object.Value6*=100
		Object.State++
		break
	case 1
		if Object.XPos>0
			Object.XPos-=16
			if Object.XPos<0
				Object.XPos=0
			endif
		endif
		if Object.Value1<0
			Object.Value1+=16
			if Object.Value1>0
				Object.Value1=0
			endif
		else
			Object.State++
		endif
		break
	case 2
		if Object.Value2<0
			Object.Value2+=16
			if Object.Value2>0
				Object.Value2=0
			endif
		else
			Object.State++
		endif
		break
	case 3
		if Object.YPos>0
			Object.YPos-=16
			if Object.YPos<0
				Object.YPos=0
			endif
		else
			Object.State++
		endif
		break
	case 4
		if Object.Value3>0
			Object.Value3-=16
			if Object.Value3<0
				Object.Value3=0
			endif
		endif
		if Object.Value4>0
			Object.Value4-=16
			if Object.Value4<0
				Object.Value4=0
			endif
		endif
		if Object.Scale>0
			Object.Scale-=16
			if Object.Scale<0
				Object.Scale=0
			endif
		else
			Object.State++
		endif
		break
	case 5
		Object.Value0++
		if Object.Value0>299
			Object.Value0=0
			Object.State++
		endif
		break
	case 6
		if Object.Value6>0
			Object.Value6-=100
			player.score+=100
		endif
		if Object.Value5>0
			Object.Value5-=100
			player.score+=100
		endif
		CheckGreater(Object.Value6,0)
		TempValue0=CheckResult
		CheckGreater(Object.Value5,0)
		TempValue0|=CheckResult
		if TempValue0==1
			Object.Value0++
			if Object.Value0==2
				PlaySfx(SFXName[ScoreAdd],0)
				Object.Value0=0
			endif
		else
			Object.State++
			Object.Value0=0
			PlaySfx(SFXName[ScoreTotal],0)
		endif
		break
	case 7
		Object.Value0++
		if Object.Value0==160
			Object.Value0=0
			if options.gameMode!=2
				CheckStageFolder("Zone06")
				TempValue0=CheckResult
				CheckEqual(Stage.ActNo,2)
				TempValue0&=CheckResult
				if TempValue0==1
					Object.State=9
				else
					Object.State++
					if Object[0].Type==TypeName[BlankObject]
						PlaySfx(SFXName[Warp],0)
					endif
				endif
			else
				Object.State++
				if Object[0].Type==TypeName[BlankObject]
					PlaySfx(SFXName[Warp],0)
				endif
			endif
		endif
		break
	case 8
		if Object[0].Type==TypeName[BlankObject]
			Object.Value0+=8
			SetScreenFade(208,255,224,Object.Value0)
			if Object.Value0==0x400
				fadeColor=208
				fadeColor<<=16
				TempValue0=255
				TempValue0<<=8
				fadeColor+=TempValue0
				fadeColor+=224
				Object.Direction=FLIP_NONE
				Object.Value0=0
				lampPostID=0
				Stage.ListPos++
				if options.gameMode==1
					ArrayPos1=options.saveSlot
					ArrayPos1<<=3
					if stage.player2Enabled==1
						SaveRAM[ArrayPos1]=3
					else
						SaveRAM[ArrayPos1]=Stage.PlayerListPos
					endif
					ArrayPos1++
					SaveRAM[ArrayPos1]=player.lives
					ArrayPos1++
					SaveRAM[ArrayPos1]=player.score
					ArrayPos1++
					SaveRAM[ArrayPos1]=player.scoreBonus
					ArrayPos1++
					TempValue0=Stage.ListPos
					TempValue0++
					if TempValue0>SaveRAM[ArrayPos1]
						SaveRAM[ArrayPos1]=TempValue0
						SaveRAM[ArrayPos1]+=128
					endif
					ArrayPos1++
					SaveRAM[ArrayPos1]=specialStage.emeralds
					ArrayPos1++
					SaveRAM[ArrayPos1]=specialStage.listPos
					WriteSaveRAM()
				endif
				specialStage.nextZone=Stage.ListPos
				Stage.ListPos=specialStage.listPos
				Stage.ActiveList=SPECIAL_STAGE
				TempValue0=Engine.TrialMode
				if Stage.ListPos>=Stage.ListSize
					TempValue0=1
				endif
				if TempValue0==0
					LoadStage()
				else
					Stage.ActiveList=PRESENTATION_STAGE
					Stage.ListPos=0
					LoadStage()
				endif
			endif
		else
			Object.Value0+=4
			SetScreenFade(0,0,0,Object.Value0)
			if Object.Value0==384
				fadeColor=0
				Object.Value0=0
				lampPostID=0
				Object.Direction=FLIP_NONE
				Stage.ListPos++
				if options.gameMode==1
					ArrayPos1=options.saveSlot
					ArrayPos1<<=3
					if stage.player2Enabled==1
						SaveRAM[ArrayPos1]=3
					else
						SaveRAM[ArrayPos1]=Stage.PlayerListPos
					endif
					ArrayPos1++
					SaveRAM[ArrayPos1]=player.lives
					ArrayPos1++
					SaveRAM[ArrayPos1]=player.score
					ArrayPos1++
					SaveRAM[ArrayPos1]=player.scoreBonus
					ArrayPos1++
					TempValue0=Stage.ListPos
					TempValue0++
					if TempValue0>SaveRAM[ArrayPos1]
						SaveRAM[ArrayPos1]=TempValue0
					endif
					ArrayPos1++
					SaveRAM[ArrayPos1]=specialStage.emeralds
					ArrayPos1++
					SaveRAM[ArrayPos1]=specialStage.listPos
					WriteSaveRAM()
				endif
				if options.gameMode==2
					timeAttack.result=Stage.Seconds
					timeAttack.result*=100
					TempValue0=Stage.Minutes
					TempValue0*=0x1770
					timeAttack.result+=TempValue0
					timeAttack.result+=Stage.MilliSeconds
					Stage.ListPos--
					EngineCallback(SetLeaderboard,Stage.ListPos,timeAttack.result)
					Engine.State=8
				else
					TempValue0=Engine.TrialMode
					if Stage.ListPos>=Stage.ListSize
						TempValue0=1
					endif
					if TempValue0==0
						LoadStage()
					else
						Stage.ActiveList=PRESENTATION_STAGE
						Stage.ListPos=0
						LoadStage()
					endif
				endif
			endif
		endif
		break
	case 9
		Object.XPos+=32
		Object.YPos+=32
		Object.Value1-=32
		Object.Value0++
		if Object.Value0==8
			Object.Value0=0
			Object.State++
		endif
		break
	case 10
		Object.XPos+=32
		Object.YPos+=32
		Object.Value1-=32
		Object.Value2-=32
		Object.Value0++
		if Object.Value0==8
			Object.Value0=0
			Object.State++
		endif
		break
	case 11
		Object.XPos+=32
		Object.YPos+=32
		Object.Value1-=32
		Object.Value2-=32
		Object.Value3+=32
		if Object.Value3>96
			Object.Value4+=32
			if Object.Value4>96
				Object.Scale+=32
			endif
		endif
		Object.Value0++
		if Object.Value0==35
			Object.Value0=0
			TempValue0=TileLayer[0].XSize
			TempValue0<<=7
			Stage.NewXBoundary2=TempValue0
			foreach TypeGroup[20],ArrayPos0
				Object[ArrayPos0].State=5
			floop
			PlayerObjectPos=0
			while PlayerObjectPos<PlayerObjectCount
				Object[PlayerObjectPos].ObjectInteractions=1
				Object[PlayerObjectPos].ControlMode=0
				Object[PlayerObjectPos].Right=1
				PlayerObjectPos++
			loop
			ResetObjectEntity(Object.EntityNo,TypeName[BlankObject],0,0,0)
			SetMusicTrack("Final.ogg",0,0x14AC8)
			PlayMusic(0)
		endif
		break

	endswitch
endsub


sub ObjectDraw
	SetActivePalette(0,0,Screen.YSize)
	TempValue0=Screen.CenterX
	TempValue0+=16
	TempValue0+=Object.XPos
	DrawSpriteScreenXY(3,TempValue0,56)
	TempValue0=Screen.CenterX
	TempValue0+=3
	TempValue0+=Object.Value1
	DrawSpriteScreenXY(Stage.PlayerListPos,TempValue0,60)
	DrawSpriteScreenXY(4,TempValue0,60)
	TempValue0=Screen.CenterX
	TempValue0-=48
	TempValue0+=Object.Value2
	DrawSpriteScreenXY(5,TempValue0,80)
	TempValue0=Screen.CenterX
	TempValue0+=24
	TempValue0+=Object.YPos
	TempValue1=Stage.ActNo
	TempValue1+=5
	if TempValue1<6
		TempValue1=6
	endif
	if TempValue1>8
		TempValue1=8
	endif
	DrawSpriteScreenXY(TempValue1,TempValue0,82)
	TempValue0=Screen.CenterX
	TempValue0-=79
	TempValue0+=Object.Value3
	DrawSpriteScreenXY(9,TempValue0,117)
	TempValue0+=151
	DrawNumbers(13,TempValue0,117,player.score,6,8,0)
	TempValue0=Screen.CenterX
	TempValue0-=79
	TempValue0+=Object.Value4
	DrawSpriteScreenXY(10,TempValue0,133)
	DrawSpriteScreenXY(12,TempValue0,133)
	TempValue0+=151
	DrawNumbers(13,TempValue0,133,Object.Value5,6,8,0)
	TempValue0=Screen.CenterX
	TempValue0-=79
	TempValue0+=Object.Scale
	DrawSpriteScreenXY(11,TempValue0,149)
	DrawSpriteScreenXY(12,TempValue0,149)
	TempValue0+=151
	DrawNumbers(13,TempValue0,149,Object.Value6,5,8,0)
endsub


sub ObjectStartup
	LoadSpriteSheet("Global/Display.gif")
	SpriteFrame(-70,0,70,16,1,222)
	if options.region==0
		SpriteFrame(-69,0,69,16,72,222)
	else
		SpriteFrame(-69,0,69,16,145,205)
	endif
	SpriteFrame(-93,0,113,16,142,222)
	if Stage.PlayerListPos!=2
		SpriteFrame(0,0,56,56,41,1)
		SpriteFrame(17,0,47,16,1,205)
		SpriteFrame(0,0,95,16,49,205)
		SpriteFrame(0,0,39,24,98,1)
		SpriteFrame(0,0,43,24,138,1)
		SpriteFrame(0,0,43,24,182,1)
	else
		SpriteFrame(20,0,56,56,41,1)
		SpriteFrame(37,0,47,16,1,205)
		SpriteFrame(20,0,95,16,49,205)
		SpriteFrame(20,0,39,24,98,1)
		SpriteFrame(20,0,43,24,138,1)
		SpriteFrame(20,0,43,24,182,1)
	endif
	SpriteFrame(0,-2,44,16,161,26)
	SpriteFrame(0,0,31,11,1,17)
	SpriteFrame(0,0,31,11,1,33)
	SpriteFrame(40,-2,45,16,98,43)
	SpriteFrame(0,0,8,11,1,50)
	SpriteFrame(0,0,8,11,10,50)
	SpriteFrame(0,0,8,11,19,50)
	SpriteFrame(0,0,8,11,28,50)
	SpriteFrame(0,0,8,11,1,62)
	SpriteFrame(0,0,8,11,10,62)
	SpriteFrame(0,0,8,11,19,62)
	SpriteFrame(0,0,8,11,28,62)
	SpriteFrame(0,0,8,11,1,74)
	SpriteFrame(0,0,8,11,10,74)
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
