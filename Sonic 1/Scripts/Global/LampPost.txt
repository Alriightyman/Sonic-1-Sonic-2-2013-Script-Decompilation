//--------------------Sonic 1 / Sonic 2 Lamp Post Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 17: TYPE_LAMPPOST

// Function declarations
#function LampPost_Function85
#function LampPost_Function86



function LampPost_Function85
	DrawSprite(0)
endfunction


function LampPost_Function86
	CreateTempObject(TypeName[LampPost],0,Object.XPos,Object.YPos)
endfunction


sub ObjectMain
	foreach TypeGroup[256],PlayerObjectPos
		if Object.State==0
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-44,8,20,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			if CheckResult==1
				lampPostID=Object.EntityNo
				recMilliSeconds=Stage.MilliSeconds
				recSeconds=Stage.Seconds
				recMinutes=Stage.Minutes
				recWaterState=stage.waterState
				recWaterLevel=Stage.WaterLevel
				Object.State=1
				Object.Value0=384
				if Object.Priority!=PRIORITY_XBOUNDS_DESTROY
					Object.Priority=PRIORITY_ACTIVE
				endif
				PlaySfx(SFXName[LampPost],0)
			endif
		endif
	floop
	if Object.State==1
		Cos(Object.Value1,Object.Value0)
		Object.Value1*=-0x500
		Sin(Object.Value2,Object.Value0)
		Object.Value2*=0x500
		Object.Value1+=Object.XPos
		Object.Value2+=Object.YPos
		Object.Value2-=0x1A0000
		Object.Value0+=32
		if Object.Value0>0x580
			Object.Value0=0
			Object.State=2
			if Object.Priority!=PRIORITY_XBOUNDS_DESTROY
				Object.Priority=PRIORITY_ACTIVE_BOUNDS
			endif
		endif
	endif
endsub


sub ObjectDraw
	switch Object.State
	case 0
		DrawSprite(0)
		break
	case 1
		DrawSprite(1)
		DrawSpriteXY(3,Object.Value1,Object.Value2)
		break
	case 2
		DrawSprite(1)
		Object.Value0++
		if Object.Value0==8
			Object.Value0=0
		endif
		TempValue0=Object.YPos
		TempValue0-=0x240000
		DrawSpriteXY(3,Object.XPos,TempValue0)
		break

	endswitch
endsub


sub ObjectStartup
	LoadSpriteSheet("Global/Items.gif")
	SpriteFrame(-8,-44,16,64,1,137)
	SpriteFrame(-8,-28,16,48,1,153)
	SpriteFrame(-8,-8,16,16,1,137)
	SpriteFrame(-8,-8,16,16,1,236)
	SetArrayValue(17,DebugMode_constant23,DebugMode_array12)
	SetArrayValue(85,DebugMode_constant23,DebugMode_array13)
	SetArrayValue(86,DebugMode_constant23,DebugMode_array11)
	DebugMode_constant23++
	if lampPostID>31
		ArrayPos0=lampPostID
		PlayerObjectPos=0
		while PlayerObjectPos<PlayerObjectCount
			Object[PlayerObjectPos].XPos=Object[ArrayPos0].XPos
			Object[PlayerObjectPos].YPos=Object[ArrayPos0].YPos
			PlayerObjectPos++
		loop
		Screen.CameraXPos=Object[0].iXPos
		Screen.CameraYPos=Object[0].iYPos
		Object[ArrayPos0].State=2
		Stage.MilliSeconds=recMilliSeconds
		Stage.Seconds=recSeconds
		Stage.Minutes=recMinutes
	endif
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
