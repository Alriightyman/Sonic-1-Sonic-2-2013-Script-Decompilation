//--------------------Sonic 1 / Sonic 2 BrokenMonitor Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 14: TYPE_BROKENMONITOR

// Function declarations
#function BrokenMonitor_Function80

#constant 0:BrokenMonitor_constant25


function BrokenMonitor_Function80
endfunction


sub ObjectMain
	switch Object.State
	case 0
		if Object.Value1<0
			Object.Value0+=Object.Value1
			Object.Value1+=0x1800
		else
			Object.Value1=0
		endif
		if Object.Value1==0
			Object.State=1
			Object.InkEffect=INK_ALPHA
			switch Object.PropertyValue
			case 1
				Object[0].Value0+=10
				if ringPan==0
					PlaySfx(SFXName[RingL],0)
					SetSfxAttributes(SFXName[RingL],-1,-100)
					ringPan=1
				else
					PlaySfx(SFXName[RingR],0)
					SetSfxAttributes(SFXName[RingR],-1,100)
					ringPan=0
				endif
				if Object[0].Value0>999
					Object[0].Value0=999
				endif
				if Object[0].Value0>=ringExtraLife
					if options.gameMode!=2
						player.lives++
						PlaySfx(SFXName[Life],0)
						PauseMusic()
						ResetObjectEntity(25,TypeName[MusicEvent],2,0,0)
						Object[25].Priority=PRIORITY_ACTIVE
					endif
					ringExtraLife+=100
					if ringExtraLife>300
						ringExtraLife=1000
					endif
					if Stage.DebugMode==0
						if Object[0].Value0>=200
							EngineCallback(SetAchievement,4,100)
						endif
					endif
				endif
				break
			case 2
				PlaySfx(SFXName[BlueShield],0)
				ArrayPos0=PlayerObjectCount
				PlayerObjectPos=0
				Object[PlayerObjectPos].Value37=1
				if PlayerObject_constant3!=1
					if Object[ArrayPos0].Type!=invincibilityType
						CallFunction(PlayerObject_Function38)
					endif
				endif
				break
			case 3
				if PlayerObject_constant3!=1
					ArrayPos0=PlayerObjectCount
					PlayerObjectPos=0
					ResetObjectEntity(ArrayPos0,invincibilityType,0,Object[PlayerObjectPos].XPos,Object[PlayerObjectPos].YPos)
					Object[ArrayPos0].Priority=PRIORITY_ACTIVE
					Object[PlayerObjectPos].Value7=0x4EC
					PlayMusic(2)
				endif
				break
			case 4
				PlayerObjectPos=0
				if SpeedUpMusic!=0
					if Object[PlayerObjectPos].Value6==0
						CallFunction(SpeedUpMusic)
					endif
				endif
				Object[PlayerObjectPos].Value6=0x528
				CallFunction(PlayerObject_Function42)
				break
			case 5
			case 6
			case 7
				player.lives++
				PlaySfx(SFXName[Life],0)
				PauseMusic()
				ResetObjectEntity(25,TypeName[MusicEvent],2,0,0)
				Object[25].Priority=PRIORITY_ACTIVE
				break
			case 8
				PlayerObjectPos=0
				Object[0].Value0+=50
				if PlayerObject_constant3!=1
					Object.Type=Object[0].Type
					CallFunction(PlayerObject_Function57)
					Object.Type=TypeName[BrokenMonitor]
				else
					if ringPan==0
						PlaySfx(SFXName[RingL],0)
						SetSfxAttributes(SFXName[RingL],-1,-100)
						ringPan=1
					else
						PlaySfx(SFXName[RingR],0)
						SetSfxAttributes(SFXName[RingR],-1,100)
						ringPan=0
					endif
				endif
				if Object[0].Value0>999
					Object[0].Value0=999
				endif
				if Object[0].Value0>=ringExtraLife
					if options.gameMode!=2
						player.lives++
						PlaySfx(SFXName[Life],0)
						PauseMusic()
						ResetObjectEntity(25,TypeName[MusicEvent],2,0,0)
						Object[25].Priority=PRIORITY_ACTIVE
					endif
					ringExtraLife+=100
					if ringExtraLife>300
						ringExtraLife=1000
					endif
				endif
				break
			case 9
				PlaySfx(SFXName[BubbleShield],0)
				ArrayPos0=PlayerObjectCount
				PlayerObjectPos=0
				Object[PlayerObjectPos].Value37=2
				if PlayerObject_constant3!=1
					if Object[ArrayPos0].Type!=invincibilityType
						CallFunction(PlayerObject_Function38)
					endif
				endif
				if Object[PlayerObjectPos].Value4>=3
					Object[PlayerObjectPos].Value3=0
					Object[PlayerObjectPos].Value4=0
					CallFunction(BrokenMonitor_constant25)
				endif
				break
			case 10
				PlaySfx(SFXName[FireShield],0)
				ArrayPos0=PlayerObjectCount
				PlayerObjectPos=0
				Object[PlayerObjectPos].Value37=3
				if PlayerObject_constant3!=1
					if Object[ArrayPos0].Type!=invincibilityType
						CallFunction(PlayerObject_Function38)
					endif
				endif
				break
			case 11
				PlaySfx(SFXName[LightningShield],0)
				ArrayPos0=PlayerObjectCount
				PlayerObjectPos=0
				Object[PlayerObjectPos].Value37=4
				if PlayerObject_constant3!=1
					if Object[ArrayPos0].Type!=invincibilityType
						CallFunction(PlayerObject_Function38)
					endif
				endif
				break
			case 12
				PlayerObjectPos=0
				CallFunction(PlayerObject_Function46)
				break
			case 13
				PlaySfx(SFXName[Catch],0)
				ArrayPos0=PlayerObjectCount
				PlayerObjectPos=0
				Object[PlayerObjectPos].Value37=5
				if PlayerObject_constant3!=1
					if Object[ArrayPos0].Type!=invincibilityType
						CallFunction(PlayerObject_Function38)
					endif
				endif
				break
			case 14
				PlaySfx(SFXName[Spike],0)
				options.spikeBehavior^=1
				break
			case 15
				PlaySfx(SFXName[BlueShield],0)
				options.shieldType++
				options.shieldType&=3
				switch options.shieldType
				case 0
				case 2
					blueShieldType=24
					invincibilityType=31
					break
				case 1
				case 3
					blueShieldType=25
					invincibilityType=32
					break

				endswitch
				ArrayPos0=PlayerObjectCount
				PlayerObjectPos=0
				CallFunction(PlayerObject_Function38)
				break
			case 16
				if specialStage.emeralds>=64
					if specialStage.emeralds==127
						options.superStates=0
						specialStage.emeralds=0
					else
						PlaySfx(SFXName[Transform],0)
						specialStage.emeralds=127
					endif
				else
					PlaySfx(SFXName[Transform],0)
					options.superStates=1
					specialStage.emeralds|=64
				endif
				break

			endswitch
		endif
		break
	case 1
		Object.Value1++
		if Object.Value1==30
			Object.Value1=0
			Object.State=2
			Object.PropertyValue=0
			if Object.Priority!=PRIORITY_XBOUNDS_DESTROY
				Object.Priority=PRIORITY_ACTIVE_BOUNDS
			endif
		else
			if Object.Value1>14
				Object.Alpha-=16
			endif
		endif
		break

	endswitch
endsub


sub ObjectDraw
	DrawSprite(0)
	if Object.PropertyValue>0
		DrawSpriteFX(Object.PropertyValue,FX_INK,Object.XPos,Object.Value0)
	endif
endsub


sub ObjectStartup
	LoadSpriteSheet("Global/Items.gif")
	SpriteFrame(-16,0,32,16,51,166)
	SpriteFrame(-8,-9,16,14,51,16)
	SpriteFrame(-8,-9,16,14,68,16)
	SpriteFrame(-8,-9,16,14,51,31)
	SpriteFrame(-8,-9,16,14,68,31)
	SpriteFrame(-8,-9,16,14,51,46)
	SpriteFrame(-8,-9,16,14,68,46)
	SpriteFrame(-8,-9,16,14,51,61)
	SpriteFrame(-8,-9,16,14,68,61)
	SpriteFrame(-8,-9,16,14,51,91)
	SpriteFrame(-8,-9,16,14,68,76)
	SpriteFrame(-8,-9,16,14,51,76)
	SpriteFrame(-8,-9,16,14,68,91)
	SpriteFrame(-8,-9,16,14,18,100)
	SpriteFrame(-8,-9,16,14,117,26)
	SpriteFrame(-8,-9,16,14,117,41)
	SpriteFrame(-8,-9,16,14,117,56)
	BrokenMonitor_constant25=80
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
