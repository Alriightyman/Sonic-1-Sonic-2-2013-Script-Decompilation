//--------------------Sonic 1 / Sonic 2 Eggman Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 58: TYPE_EGGMAN

// Function declarations
#function Eggman_Function132
#function Eggman_Function133
#function Eggman_Function134


#array Eggman_array31:(2,3,1)
#array Eggman_array32:(0,0,0,0,0,0)

function Eggman_Function132
	Object.Value7--
	if Object.Value7==0
		player.score+=1000
		Object.Value5=0
		Object.Animation=4
		Object.AnimationTimer=0
		Object.State=4
		if Stage.DebugMode==0
			if Object.Value13==0
				EngineCallback(SetAchievement,7,100)
			endif
		endif
	else
		Object.Animation=3
		Object.AnimationTimer=0
		Object.Value8=32
		PlaySfx(SFXName[BossHit],0)
	endif
endfunction


function Eggman_Function133
	ArrayPos0=Object.EntityNo
	TempValue1=Object.Value9
	TempValue1>>=1
	GetArrayValue(TempValue2,TempValue1,Eggman_array31)
	ArrayPos0-=TempValue2
	if Object[ArrayPos0].State==3
		if Object[ArrayPos0].Value12==0
			Object.XPos=TempValue0
			Object[ArrayPos0].State=2
			Object[ArrayPos0].XVelocity=0
			Object[ArrayPos0].YVelocity=0
			Object[ArrayPos0].Value8=Object.XPos
			Object[ArrayPos0].Value9=Object.YPos
			Object[ArrayPos0].Value9+=0x200000
			Object[ArrayPos0].Value0=240
			Object[ArrayPos0].Value10=2
			Object[ArrayPos0].AnimationTimer=44
			Object.Value4=40
			Object.Value5=0
			Object.State++
		endif
	endif
endfunction


function Eggman_Function134
	Sin256(TempValue0,Object.Value2)
	TempValue0<<=10
	Object.YPos+=TempValue0
	Object.Value2+=2
	Object.Value2&=255
endfunction


sub ObjectMain
	switch Object.State
	case 0
		if Object[0].XPos>=Object[3].XPos
			TempValue0=Object[3].iXPos
			TempValue0-=Screen.CenterX
			Stage.NewXBoundary1=TempValue0
			TempValue0=Object[3].iXPos
			TempValue0+=Screen.CenterX
			Stage.NewXBoundary2=TempValue0
			if Screen.YOffset==Object.Value12
				Object.State++
				Object.Priority=PRIORITY_ACTIVE
				ResetObjectEntity(26,TypeName[MusicEvent],0,0,0)
				Object[26].Priority=PRIORITY_ACTIVE
			else
				Object.Value12=Screen.YOffset
			endif
		endif
		break
	case 1
		Object.XPos+=Object.XVelocity
		TempValue0=Object[3].XPos
		TempValue0+=0x800000
		if Object.XPos<TempValue0
			Object.State++
			TempValue1=Screen.CenterX
			TempValue1-=4
			TempValue1<<=8
			TempValue1/=160
			TempValue1*=-512
			Object.XVelocity=TempValue1
		endif
		Object.YPos=Object.Value1
		CallFunction(Eggman_Function134)
		break
	case 2
		Object.XPos+=Object.XVelocity
		if Object.Direction==FLIP_NONE
			if Object.XPos<=Object.Value10
				Object.XPos=Object.Value10
				FlipSign(Object.XVelocity)
				Object.Direction^=FLIP_X
			else
				GetArrayValue(TempValue0,Object.Value9,Eggman_array32)
				if Object.XPos<=TempValue0
					CallFunction(Eggman_Function133)
					Object.Value9--
					if Object.Value9<0
						Object.Value9=1
					endif
				endif
				Object.Value9&=14
			endif
		else
			if Object.XPos>=Object.Value11
				Object.XPos=Object.Value11
				FlipSign(Object.XVelocity)
				Object.Direction^=FLIP_X
			else
				GetArrayValue(TempValue0,Object.Value9,Eggman_array32)
				if Object.XPos>=TempValue0
					CallFunction(Eggman_Function133)
					Object.Value9++
					if Object.Value9>5
						Object.Value9=4
					endif
				endif
				Object.Value9|=1
			endif
		endif
		Object.YPos=Object.Value1
		CallFunction(Eggman_Function134)
		break
	case 3
		Object.Value4--
		if Object.Value4<=0
			Object.Value5=1
			Object.State--
		endif
		break
	case 4
		Object.Value4++
		TempValue0=Object.Value4
		TempValue0&=7
		if TempValue0==4
			Rand(TempValue0,96)
			TempValue0-=48
			TempValue0<<=16
			TempValue0+=Object.XPos
			Rand(TempValue1,48)
			TempValue1-=24
			TempValue1<<=16
			TempValue1+=Object.YPos
			CreateTempObject(TypeName[Explosion],0,TempValue0,TempValue1)
			PlaySfx(SFXName[Explosion],0)
		endif
		if Object.Value4==180
			Object.Animation=5
			Object.AnimationTimer=0
			Object.Value4=0
			Object.Direction=FLIP_X
			ResetObjectEntity(26,TypeName[MusicEvent],1,0,0)
			Object[26].Priority=PRIORITY_ACTIVE
			Object.State++
		endif
		break
	case 5
		Object.YPos+=Object.YVelocity
		Object.YVelocity+=0x1800
		Object.Value4++
		if Object.Value4==38
			Object.YVelocity=0
			Object.Value4=0
			Object.AnimationTimer=0
			Object.State++
		endif
		break
	case 6
		if Object.Value4<48
			Object.YPos+=Object.YVelocity
			Object.YVelocity-=0x800
			Object.Value4++
		else
			Object.Value4=0
			Object.YVelocity=0
			Object.Value1=Object.YPos
			Object.State++
		endif
		break
	case 7
		Object.YPos=Object.Value1
		CallFunction(Eggman_Function134)
		if Object.Value4<8
			Object.Value4++
		else
			Object.Value4=0
			Object.Animation=6
			Object.AnimationTimer=0
			Object.Value5=2
			Object.Value6=0
			Object.Priority=PRIORITY_ACTIVE
			TempValue0=TileLayer[0].XSize
			TempValue0<<=7
			Stage.NewXBoundary2=TempValue0
			Object.State++
		endif
		break
	case 8
		Object.XPos+=0x40000
		Object.Value1-=0x4000
		Object.YPos=Object.Value1
		CallFunction(Eggman_Function134)
		if Object.OutOfBounds==1
			Object.Type=TypeName[BlankObject]
			Object.Priority=PRIORITY_ACTIVE_BOUNDS
		endif
		break

	endswitch
	if Object.Value7!=0
		if Object.Value8>0
			Object.Value8--
		endif
		foreach TypeGroup[256],PlayerObjectPos
			if Object.Value8==0
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_HURT)
				TempValue0=CheckResult
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_DYING)
				TempValue0|=CheckResult
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_DROWNING)
				TempValue0|=CheckResult
				if TempValue0!=0
					if Object.Animation!=2
						Object.Animation=2
						Object.AnimationTimer=0
					endif
				endif
				PlayerObjectCollision(C_TOUCH,Object.EntityNo,-20,-16,20,16,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
				if CheckResult==1
					CallFunction(PlayerObject_CheckHit)
					if CheckResult==1
						Object.Value13=1
						CallFunction(Eggman_Function132)
					endif
				endif
			endif
		floop
		if Object.Value8==0
			foreach TypeGroup[57],ArrayPos0
				if Object[ArrayPos0].State!=3
					TempValue0=Object[ArrayPos0].XPos
					TempValue1=Object[ArrayPos0].YPos
					Object[ArrayPos0].XPos=Object[ArrayPos0].Value8
					Object[ArrayPos0].YPos=Object[ArrayPos0].Value9
					PlayerObjectCollision(C_TOUCH,Object.EntityNo,-20,-16,20,16,ArrayPos0,-7,-7,7,7)
					if CheckResult==1
						CallFunction(Eggman_Function132)
						CreateTempObject(TypeName[SmokePuff],0,Object[ArrayPos0].Value8,Object[ArrayPos0].Value9)
						PlaySfx(SFXName[Explosion],0)
						Object[ArrayPos0].State=3
						Object[ArrayPos0].Value0=0
					endif
					Object[ArrayPos0].XPos=TempValue0
					Object[ArrayPos0].YPos=TempValue1
				endif
			floop
		endif
	endif
	if Object.State<8
		foreach TypeGroup[256],PlayerObjectPos
			TempValue0=Object[PlayerObjectPos].CollisionRight
			TempValue0<<=16
			TempValue0+=Object[PlayerObjectPos].XPos
			TempValue1=Stage.XBoundary2
			TempValue1<<=16
			if TempValue0>TempValue1
				Object[PlayerObjectPos].XVelocity=0
				Object[PlayerObjectPos].Speed=0
				Object[PlayerObjectPos].XPos=TempValue1
				TempValue0=Object[PlayerObjectPos].CollisionRight
				TempValue0<<=16
				Object[PlayerObjectPos].XPos-=TempValue0
			endif
		floop
	endif
endsub


sub ObjectDraw
	switch Object.Animation
	case 1
		TempValue0=Object.AnimationTimer
		TempValue0/=6
		Object.AnimationTimer++
		Object.AnimationTimer%=12
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		DrawSpriteFX(20,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 2
		TempValue0=Object.AnimationTimer
		TempValue0%=10
		TempValue0/=5
		TempValue0+=9
		Object.AnimationTimer++
		if Object.AnimationTimer==50
			Object.AnimationTimer=0
			if Object[0].Animation!=ANI_DYING
				Object.Animation=1
			endif
		endif
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		DrawSpriteFX(20,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 3
		TempValue0=Object.AnimationTimer
		TempValue0&=1
		TempValue0+=2
		TempValue1=TempValue0
		TempValue1+=17
		Object.AnimationTimer++
		if Object.AnimationTimer==30
			Object.AnimationTimer=0
			Object.Animation=1
		endif
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		DrawSpriteFX(TempValue1,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 4
		TempValue0=Object.AnimationTimer
		TempValue0>>=5
		TempValue0+=4
		Object.AnimationTimer++
		Object.AnimationTimer&=63
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		DrawSpriteFX(20,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 5
		DrawSpriteFX(6,FX_FLIP,Object.XPos,Object.YPos)
		DrawSpriteFX(20,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 6
		TempValue0=Object.AnimationTimer
		TempValue0>>=2
		TempValue0+=7
		Object.AnimationTimer++
		Object.AnimationTimer%=7
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		DrawSpriteFX(20,FX_FLIP,Object.XPos,Object.YPos)
		break

	endswitch
	switch Object.Value5
	case 1
		TempValue0=Object.Value6
		TempValue0>>=2
		TempValue0+=11
		Object.Value6++
		Object.Value6&=7
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 2
		TempValue0=Object.Value6
		TempValue0/=3
		TempValue0+=11
		Object.Value6++
		if Object.Value6>21
			Object.Value6=18
		endif
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break

	endswitch
endsub


sub ObjectStartup
	LoadSpriteSheet("Global/Eggman.gif")
	SpriteFrame(-28,-32,64,56,1,1)
	SpriteFrame(-28,-32,64,56,66,1)
	SpriteFrame(-28,-32,64,56,131,1)
	SpriteFrame(-28,-32,64,56,1,58)
	SpriteFrame(-28,-32,64,56,1,1)
	SpriteFrame(-28,-32,64,56,1,58)
	SpriteFrame(-28,-32,64,56,66,58)
	SpriteFrame(-28,-32,64,56,131,58)
	SpriteFrame(-28,-32,64,56,66,1)
	SpriteFrame(-28,-32,64,56,1,115)
	SpriteFrame(-28,-32,64,56,66,115)
	SpriteFrame(34,1,10,9,196,2)
	SpriteFrame(33,0,15,11,196,12)
	SpriteFrame(34,-1,22,14,213,1)
	SpriteFrame(34,-8,32,26,213,16)
	SpriteFrame(34,-1,22,14,213,1)
	SpriteFrame(34,-8,32,26,213,16)
	SpriteFrame(34,1,10,9,196,2)
	SpriteFrame(33,0,15,11,196,12)
	SpriteFrame(-12,17,24,16,213,135)
	SpriteFrame(-12,17,24,16,213,43)
	foreach TypeName[Eggman],ArrayPos0
		if Object[ArrayPos0].Type==TypeName[Eggman]
			Object[ArrayPos0].Priority=PRIORITY_XBOUNDS
			ArrayPos1=ArrayPos0
			ArrayPos1-=3
			Object[ArrayPos0].XPos=Object[ArrayPos1].XPos
			Object[ArrayPos0].XPos+=0xE80000
			Object[ArrayPos0].YPos=Object[ArrayPos1].YPos
			Object[ArrayPos0].YPos-=0xAC0000
			TempValue1=Screen.CenterX
			TempValue0-=4
			TempValue1<<=8
			TempValue1/=160
			TempValue1*=-256
			Object[ArrayPos0].XVelocity=TempValue1
			Object[ArrayPos0].Value9=4
			Object[ArrayPos0].Value0=Object[ArrayPos0].XPos
			Object[ArrayPos0].Value1=Object[ArrayPos0].YPos
			Object[ArrayPos0].Animation=1
			Object[ArrayPos0].Value7=8
			TempValue0=Screen.CenterX
			TempValue0-=160
			TempValue0-=4
			if TempValue0<0
				TempValue0=0
			endif
			TempValue0<<=16
			Object[ArrayPos0].XPos+=TempValue0
			TempValue0+=0x980000
			Object[ArrayPos0].Value10=Object[ArrayPos1].XPos
			Object[ArrayPos0].Value10-=TempValue0
			Object[ArrayPos0].Value11=Object[ArrayPos1].XPos
			Object[ArrayPos0].Value11+=TempValue0
			TempValue0-=0x980000
			TempValue1=Object[ArrayPos1].XPos
			TempValue1-=0x280000
			SetArrayValue(TempValue1,2,Eggman_array32)
			TempValue1+=0x500000
			SetArrayValue(TempValue1,3,Eggman_array32)
			ArrayPos1++
			Object[ArrayPos1].XPos-=TempValue0
			TempValue1=Object[ArrayPos1].XPos
			TempValue1-=0x280000
			SetArrayValue(TempValue1,0,Eggman_array32)
			TempValue1+=0x500000
			SetArrayValue(TempValue1,1,Eggman_array32)
			ArrayPos1++
			Object[ArrayPos1].XPos+=TempValue0
			TempValue1=Object[ArrayPos1].XPos
			TempValue1-=0x280000
			SetArrayValue(TempValue1,4,Eggman_array32)
			TempValue1+=0x500000
			SetArrayValue(TempValue1,5,Eggman_array32)
			Object[ArrayPos0].Value5=1
		endif
	floop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
