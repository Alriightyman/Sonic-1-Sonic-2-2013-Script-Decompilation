//--------------------Sonic 1 / Sonic 2 Rising Platform Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 54: TYPE_RISINGPLATFORM

// Function declarations
#function RisingPlatform_Function119
#function RisingPlatform_Function120
#function RisingPlatform_Function121
#function RisingPlatform_Function122
#function RisingPlatform_Function123
#function RisingPlatform_Function124

#constant 0:RisingPlatform_constant32

#array RisingPlatform_array29:(0,0,0,2,2,2,0,0,0,2,2,2,4,6,8)

//Unknown Variables
#constant 15:constant0xFC30
#constant 0x400000:constant0xFC31
#constant 0x800000:constant0xFC32
#constant 0xD00000:constant0xFC33
#constant 0x400000:constant0xFC34
#constant 0x800000:constant0xFC35
#constant 0xD00000:constant0xFC36
#constant 0x500000:constant0xFC37
#constant 0x900000:constant0xFC38
#constant 0xB00000:constant0xFC39
#constant 0x500000:constant0xFC3A
#constant 0x900000:constant0xFC3B
#constant 0xB00000:constant0xFC3C
#constant 0x800000:constant0xFC3D
#constant 0x800000:constant0xFC3E
#constant 0xC00000:constant0xFC3F

function RisingPlatform_Function119
	DrawSprite(0)
endfunction


function RisingPlatform_Function120
	TempValue0=Object[0].Value17
	TempValue0-=RisingPlatform_constant32
	CreateTempObject(TypeName[RisingPlatform],TempValue0,Object.XPos,Object.YPos)
	if TempValue0<14
		Object[TempObjectPos].Value0=Object[TempObjectPos].XPos
		Object[TempObjectPos].Value1=Object[TempObjectPos].YPos
		Object[TempObjectPos].Value2=Object[TempObjectPos].XPos
		Object[TempObjectPos].Value3=Object[TempObjectPos].YPos
		TempValue0=Object[TempObjectPos].PropertyValue
		TempValue0&=15
		GetArrayValue(Object[TempObjectPos].Value5,TempValue0,RisingPlatform_array28)
		GetArrayValue(Object[TempObjectPos].State,TempValue0,RisingPlatform_array29)
		Object[TempObjectPos].Value6=0
		Object[TempObjectPos].Value7=0
		Object[TempObjectPos].Value8=0
	else
		Object[TempObjectPos].Value0=60
		Object[TempObjectPos].Value1=60
		Object[TempObjectPos].State=9
		Object[TempObjectPos].Priority=PRIORITY_XBOUNDS
	endif
endfunction


function RisingPlatform_Function121
	if Object.Value7==0
		if Object.Value4<0x80000
			Object.Value4+=0x1000
		endif
	else
		if Object.Value4>0x4000
			Object.Value4-=0x1000
		endif
	endif
	if Object.Value6>Object.Value5
		Object.Value7=1
	endif
	Object.Value6+=Object.Value4
	TempValue0=Object.Value5
	TempValue0<<=1
	if Object.Value6>=TempValue0
		Object.Value8=1
		Object.Value6=TempValue0
	endif
endfunction


function RisingPlatform_Function122
	if Object.Value7==0
		if Object.Value4<0x80000
			Object.Value4+=0x1000
		endif
	else
		if Object.Value4>0
			Object.Value4-=0x1000
		endif
	endif
	if Object.Value6>Object.Value5
		Object.Value7=1
	endif
	Object.Value6+=Object.Value4
	if Object.Value4==0
		Object.Value8=1
	endif
endfunction


function RisingPlatform_Function123
	TempValue6=Object.XPos
	TempValue6&=-0x10000
	TempValue0=Object.Value2
	TempValue0&=-0x10000
	TempValue6-=TempValue0
	TempValue7=Object.YPos
	TempValue7&=-0x10000
	TempValue0=Object.Value3
	TempValue0&=-0x10000
	TempValue7-=TempValue0
	foreach TypeGroup[256],PlayerObjectPos
		PlayerObjectCollision(C_PLATFORM,Object.EntityNo,-40,-8,40,8,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
		if CheckResult==1
			Object[PlayerObjectPos].XPos-=TempValue6
			Object[PlayerObjectPos].YPos-=TempValue7
		endif
	floop
	Object.XPos=Object.Value2
	Object.YPos=Object.Value3
endfunction


function RisingPlatform_Function124
	if Object.OutOfBounds==1
		Object.XPos=Object.Value0
		Object.YPos=Object.Value1
		Object.Value2=Object.XPos
		Object.Value3=Object.YPos
		Object.Value6=0
		Object.Value7=0
		Object.Value8=0
		Object.State=10
	endif
endfunction


sub ObjectMain
	switch Object.State
	case 0
	case 2
	case 4
	case 6
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_PLATFORM,Object.EntityNo,-40,-8,40,8,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			if CheckResult==1
				Object.State++
				Object.Priority=PRIORITY_ACTIVE
			endif
		floop
		break
	case 1
		CallFunction(RisingPlatform_Function121)
		Object.Value3=Object.Value6
		FlipSign(Object.Value3)
		Object.Value3+=Object.Value1
		CallFunction(RisingPlatform_Function123)
		CallFunction(RisingPlatform_Function124)
		break
	case 3
		CallFunction(RisingPlatform_Function121)
		Object.Value3=Object.Value6
		Object.Value3+=Object.Value1
		CallFunction(RisingPlatform_Function123)
		CallFunction(RisingPlatform_Function124)
		break
	case 5
		CallFunction(RisingPlatform_Function121)
		Object.Value3=Object.Value6
		Object.Value3>>=1
		FlipSign(Object.Value3)
		Object.Value3+=Object.Value1
		Object.Value2=Object.Value6
		Object.Value2+=Object.Value0
		CallFunction(RisingPlatform_Function123)
		CallFunction(RisingPlatform_Function124)
		break
	case 7
		CallFunction(RisingPlatform_Function121)
		Object.Value3=Object.Value6
		Object.Value3>>=1
		Object.Value3+=Object.Value1
		Object.Value2=Object.Value6
		FlipSign(Object.Value2)
		Object.Value2+=Object.Value0
		CallFunction(RisingPlatform_Function123)
		CallFunction(RisingPlatform_Function124)
		break
	case 8
		CallFunction(RisingPlatform_Function122)
		Object.Value3=Object.Value6
		FlipSign(Object.Value3)
		Object.Value3+=Object.Value1
		CallFunction(RisingPlatform_Function123)
		TempValue0=Object.Value4
		TempValue0>>=8
		if TempValue0>256
			TempValue0=256
		endif
		Object.Alpha=TempValue0
		if Object.Value8==1
			Object.Type=TypeName[BlankObject]
		endif
		break
	case 9
		Object.Value1--
		if Object.Value1<=0
			CreateTempObject(TypeName[RisingPlatform],0,Object.XPos,Object.YPos)
			Object[TempObjectPos].Value0=Object.XPos
			Object[TempObjectPos].Value1=Object.YPos
			Object[TempObjectPos].Value2=Object.XPos
			Object[TempObjectPos].Value3=Object.YPos
			TempValue0=14
			GetArrayValue(Object[TempObjectPos].Value5,TempValue0,RisingPlatform_array28)
			GetArrayValue(Object[TempObjectPos].State,TempValue0,RisingPlatform_array29)
			Object[TempObjectPos].Value6=0
			Object[TempObjectPos].Value7=0
			Object[TempObjectPos].Value8=0
			Object[TempObjectPos].InkEffect=INK_ALPHA
			Object.Value1=Object.Value0
		endif
		break
	case 10
		if Object.OutOfBounds==1
			TempValue0=Object.PropertyValue
			TempValue0&=15
			GetArrayValue(Object.Value5,TempValue0,RisingPlatform_array28)
			GetArrayValue(Object.State,TempValue0,RisingPlatform_array29)
			Object.Priority=PRIORITY_ACTIVE_BOUNDS
		endif
		break

	endswitch
endsub


sub ObjectDraw
	if Object.State==8
		DrawSpriteFX(0,FX_INK,Object.XPos,Object.YPos)
	else
		if Object.State<9
			DrawSprite(0)
		endif
	endif
endsub


sub ObjectStartup
	LoadSpriteSheet("SLZ/Objects.gif")
	SpriteFrame(-40,-8,80,32,84,188)
	foreach TypeName[RisingPlatform],ArrayPos0
		GetBit(TempValue0,Object[ArrayPos0].PropertyValue,7)
		if TempValue0==0
			Object[ArrayPos0].Value0=Object[ArrayPos0].XPos
			Object[ArrayPos0].Value1=Object[ArrayPos0].YPos
			Object[ArrayPos0].Value2=Object[ArrayPos0].XPos
			Object[ArrayPos0].Value3=Object[ArrayPos0].YPos
			TempValue0=Object[ArrayPos0].PropertyValue
			TempValue0&=15
			GetArrayValue(Object[ArrayPos0].Value5,TempValue0,RisingPlatform_array28)
			GetArrayValue(Object[ArrayPos0].State,TempValue0,RisingPlatform_array29)
			Object[ArrayPos0].Value6=0
			Object[ArrayPos0].Value7=0
			Object[ArrayPos0].Value8=0
		else
			Object[ArrayPos0].Value0=Object[ArrayPos0].PropertyValue
			Object[ArrayPos0].Value0&=127
			Object[ArrayPos0].Value0*=6
			Object[ArrayPos0].Value1=Object[ArrayPos0].Value0
			Object[ArrayPos0].State=9
			Object[ArrayPos0].Priority=PRIORITY_XBOUNDS
		endif
	floop
	TempValue0=0
	RisingPlatform_constant32=DebugMode_constant23
	while TempValue0<15
		SetArrayValue(54,DebugMode_constant23,DebugMode_array12)
		SetArrayValue(119,DebugMode_constant23,DebugMode_array13)
		SetArrayValue(120,DebugMode_constant23,DebugMode_array11)
		DebugMode_constant23++
		TempValue0++
	loop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
