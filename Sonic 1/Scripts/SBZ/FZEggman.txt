//--------------------Sonic 1 / Sonic 2 FZ Eggman Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 76: TYPE_FZEGGMAN

// Function declarations
#function FZEggman_Function158


#array FZEggman_array49:(8,4,9,4)
#array FZEggman_array48:(1,2,2,3,3,4,4,1)

function FZEggman_Function158
	CheckEqual(Object[PlayerObjectPos].Animation,ANI_JUMPING)
	TempValue0=CheckResult
	CheckEqual(Object[PlayerObjectPos].Animation,ANI_GLIDING)
	TempValue0|=CheckResult
	CheckEqual(Object[PlayerObjectPos].Animation,ANI_GLIDING_STOP)
	TempValue0|=CheckResult
	if TempValue0==1
		Object[PlayerObjectPos].XVelocity=0x30000
		if Object[PlayerObjectPos].XPos<Object.XPos
			FlipSign(Object[PlayerObjectPos].XVelocity)
		endif
		Object[PlayerObjectPos].Speed=Object[PlayerObjectPos].XVelocity
		if Object[PlayerObjectPos].Animation==ANI_GLIDING
			Object[PlayerObjectPos].Animation=ANI_GLIDING_DROP
			Object[PlayerObjectPos].State=21
		endif
		CheckResult=1
	else
		CheckResult=0
	endif
endfunction


sub ObjectMain
	switch Object.State
	case 0
		TempValue1=Screen.CenterX
		TempValue2=TempValue1
		if TempValue1==160
			TempValue1+=16
		endif
		TempValue0=Object.iXPos
		TempValue0-=TempValue1
		Stage.NewXBoundary1=TempValue0
		TempValue0+=TempValue1
		TempValue0+=TempValue2
		Stage.NewXBoundary2=TempValue0
		TempValue0=Object.EntityNo
		Object[+1].Value0=TempValue0
		Object[+2].Value0=TempValue0
		Object[+3].Value0=TempValue0
		Object[+4].Value0=TempValue0
		Object.Value3=Object.iXPos
		Object.Value3+=656
		Object.Value5=Object.YPos
		Object.Value5-=0x400000
		Object.State++
		break
	case 1
		if Object[0].XPos>=Object.XPos
			Object.XPos=0
			Object.YPos=0
			Object.Value4=1
			Object.State++
		endif
		break
	case 2
		Object.Animation=1
		Rand(TempValue0,8)
		TempValue1=TempValue0
		TempValue1&=1
		TempValue0&=6
		GetArrayValue(TempValue2,TempValue0,FZEggman_array48)
		TempValue0++
		GetArrayValue(TempValue3,TempValue0,FZEggman_array48)
		ArrayPos0=Object.EntityNo
		ArrayPos0+=TempValue2
		Object[ArrayPos0].State=1
		if TempValue1==0
			Object[ArrayPos0].PropertyValue=1
		endif
		ArrayPos0=Object.EntityNo
		ArrayPos0+=TempValue3
		Object[ArrayPos0].State=1
		if TempValue1==1
			Object[ArrayPos0].PropertyValue=1
		endif
		PlaySfx(SFXName[LargeWall],0)
		Object.Value0=160
		Object.State++
		break
	case 3
		Object.Value0--
		if Object.Value0<=0
			if Object.Value2==8
				TempValue1=Screen.CenterX
				TempValue0=Object.Value3
				TempValue0-=TempValue1
				Stage.NewXBoundary1=TempValue0
				TempValue0+=TempValue1
				TempValue0+=TempValue1
				Stage.NewXBoundary2=TempValue0
				Object.XPos=Object[+5].XPos
				Object.XPos+=0x380000
				Object.YPos=Object[+5].YPos
				Object[+7].Value6=Object.Value3
				Object[+7].Value6<<=16
				Object.Direction=FLIP_X
				ArrayPos0=Object.EntityNo
				ArrayPos0+=5
				ResetObjectEntity(ArrayPos0,TypeName[Explosion],0,Object[ArrayPos0].XPos,Object[ArrayPos0].YPos)
				Object.Value4=0
				Object.Animation=4
				Object.State=6
			else
				Object.State++
			endif
		endif
		break
	case 4
		Object[+5].State=1
		Object[+5].Value0=330
		TempValue0=0
		TempValue1=0
		while TempValue0<4
			CreateTempObject(TypeName[PlasmaBall],0,Object[+5].XPos,Object[+5].YPos)
			Object[TempObjectPos].InkEffect=INK_ADD
			Object[TempObjectPos].Alpha=0
			Object[TempObjectPos].Value1=4
			TempValue0++
			Object[TempObjectPos].Value1=TempValue1
			Object[TempObjectPos].Value1+=Object[+5].XPos
			Object[TempObjectPos].Value1-=0x100000
			Rand(TempValue2,32)
			TempValue2-=16
			TempValue2<<=16
			Object[TempObjectPos].Value1+=TempValue2
			TempValue1-=0x4F0000
		loop
		Object.Value0=330
		Object.State++
		break
	case 5
		Object.Value0--
		if Object.Value0<=0
			Object.State=2
		endif
		break
	case 6
		Object.YPos+=Object.YVelocity
		Object.YVelocity+=0x1000
		if Object.YPos>=Object.Value5
			ObjectTileCollision(CMODE_FLOOR,0,28,0)
			if CheckResult==1
				Object.Animation=0
				Object.XVelocity=0x10000
				Object.YVelocity=-0x10000
				Object.Value0=0
				Object.Animation=5
				Object.State++
			endif
		endif
		break
	case 7
		Object.XPos+=Object.XVelocity
		Object.YPos+=Object.YVelocity
		ObjectTileCollision(CMODE_FLOOR,0,28,0)
		if CheckResult==0
			Object.YVelocity+=0x1000
		else
			Object.YVelocity=0
		endif
		TempValue1=0
		foreach TypeGroup[256],PlayerObjectPos
			if Object[PlayerObjectPos].XPos>TempValue1
				TempValue1=Object[PlayerObjectPos].XPos
			endif
		floop
		TempValue0=Object.XPos
		TempValue0-=TempValue1
		if TempValue0<0
			Object.XVelocity=0x50000
		else
			Object.XVelocity=0x40000
			TempValue0-=0x700000
			if TempValue0>=0
				Object.XVelocity-=0x10000
				TempValue0-=0x80000
				if TempValue0>=0
					Object.XVelocity-=0x10000
					TempValue0-=0x80000
					if TempValue0>=0
						Object.XVelocity-=0x8000
						TempValue0-=0x80000
						if TempValue0>=0
							Object.XVelocity-=0x8000
							TempValue0-=0x80000
							if TempValue0>=0
								Object.XVelocity-=0x8000
								TempValue0-=0x380000
								if TempValue0>=0
									Object.XVelocity=0
								endif
							endif
						endif
					endif
				endif
			endif
		endif
		TempValue0=Object[+7].XPos
		TempValue0-=0x300000
		if Object.XPos>=TempValue0
			Object.XVelocity=0x24000
			Object.YVelocity=-0x4C000
			Object.State++
		endif
		break
	case 8
		Object.XPos+=Object.XVelocity
		Object.YPos+=Object.YVelocity
		Object.YVelocity+=0x3400
		if Object.XPos>=Object[+7].XPos
			Object.XPos=Object[+7].XPos
			Object.XVelocity=0
		endif
		if Object.YVelocity>0
			if Object.YPos>=Object[+7].YPos
				Object.YPos=Object[+7].YPos
				Object.YVelocity=0
				Object[+7].State++
				Object.Type=TypeName[BlankObject]
			endif
		endif
		break

	endswitch
	switch Object.Animation
	case 0
		Object.Frame=0
		break
	case 1
		Object.AnimationTimer++
		if Object.AnimationTimer==14
			Object.AnimationTimer=0
		endif
		Object.Frame=Object.AnimationTimer
		Object.Frame/=7
		Object.Frame++
		break
	case 2
		if Object.YVelocity==0
			Object.Frame=3
		else
			Object.Frame=4
		endif
		break
	case 3
		Object.Frame=Object.Value1
		Object.Frame&=1
		Object.Frame+=5
		break
	case 4
		Object.Frame=7
		break
	case 5
		Object.Value0++
		if Object.Value0>=28
			Object.Value0=0
		endif
		TempValue0=Object.Value0
		TempValue0/=7
		GetArrayValue(Object.Frame,TempValue0,FZEggman_array49)
		break

	endswitch
	if Object.Value1!=0
		Object.Value1--
	endif
	if Object.Value4==1
		if Object[0].XPos<Object.XPos
			Object.Direction=FLIP_NONE
		else
			Object.Direction=FLIP_X
		endif
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,-33,-37,33,6,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			if CheckResult==1
				CallFunction(FZEggman_Function158)
				if CheckResult==1
					if Object.Value1==0
						if Object.Value2<8
							Object.Animation=3
							Object.Value1=100
							PlaySfx(SFXName[BossHit],0)
							Object.Value2++
						endif
					endif
				endif
			endif
		floop
	endif
	foreach TypeGroup[256],PlayerObjectPos
		TempValue0=Object[PlayerObjectPos].CollisionRight
		TempValue0<<=16
		TempValue0+=Object[PlayerObjectPos].XPos
		TempValue1=Stage.XBoundary2
		TempValue1<<=16
		if TempValue0>TempValue1
			Object[PlayerObjectPos].XVelocity=0
			Object[PlayerObjectPos].Speed=0
			Object[PlayerObjectPos].XPos=TempValue1
			TempValue0=Object[PlayerObjectPos].CollisionRight
			TempValue0<<=16
			Object[PlayerObjectPos].XPos-=TempValue0
		endif
	floop
endsub


sub ObjectDraw
	if Object.State>=3
		DrawSpriteFX(Object.Frame,FX_FLIP,Object.XPos,Object.YPos)
	endif
endsub


sub ObjectStartup
	LoadSpriteSheet("SBZ/Objects.gif")
	SpriteFrame(-22,-23,38,51,1,209)
	SpriteFrame(-22,-24,38,52,42,208)
	SpriteFrame(-22,-23,38,51,84,209)
	SpriteFrame(-16,-16,46,44,350,165)
	SpriteFrame(-16,-23,46,55,350,210)
	SpriteFrame(-22,-24,42,52,225,266)
	SpriteFrame(-22,-32,42,64,225,319)
	SpriteFrame(-30,-24,60,44,289,165)
	SpriteFrame(-24,-23,54,43,236,221)
	SpriteFrame(-21,-25,51,52,296,213)
	foreach TypeName[FZEggman],ArrayPos0
		Object[ArrayPos0].Priority=PRIORITY_ACTIVE
	floop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
