//--------------------Sonic 1 / Sonic 2 Orbinaut Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 43: TYPE_ORBINAUT

// Function declarations
#function Orbinaut_DebugDraw
#function Orbinaut_DebugSpawn
#function Orbinaut_Function107
#function Orbinaut_Function108
#function Orbinaut_Function109

#static 0:Orbinaut_staticVar32


function Orbinaut_DebugDraw
	TempValue0=Object.Value17
	TempValue0-=Orbinaut_staticVar32
	TempValue0--
	TempValue0^=1
	TempValue0<<=1
	DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
endfunction


function Orbinaut_DebugSpawn
	TempValue0=Object.Value17
	TempValue0-=Orbinaut_staticVar32
	CreateTempObject(TypeName[Orbinaut],TempValue0,Object.XPos,Object.YPos)
	Object[TempObjectPos].Value2=Object[TempObjectPos].XPos
	Object[TempObjectPos].Value1=15
	if Object[TempObjectPos].PropertyValue>1
		Object[TempObjectPos].Value3=0
		Object[TempObjectPos].PropertyValue&=1
		GetBit(TempValue0,Object.Direction,0)
		if TempValue0==0
			Object[TempObjectPos].Direction=FLIP_NONE
			Object[TempObjectPos].XVelocity=-0x4000
		else
			Object[TempObjectPos].Direction=FLIP_X
			Object[TempObjectPos].XVelocity=0x4000
		endif
	else
		Object[TempObjectPos].Value3=1
		Object[TempObjectPos].XVelocity=0
		GetBit(TempValue0,Object.Direction,0)
		if TempValue0==0
			Object[TempObjectPos].Direction=FLIP_NONE
		else
			Object[TempObjectPos].Direction=FLIP_X
		endif
	endif
endfunction


function Orbinaut_Function107
	TempValue0=0
	TempValue7=Object.Angle
	TempValue1=Object.XPos
	TempValue2=Object.YPos
	while TempValue0<4
		GetBit(TempValue6,Object.Value1,TempValue0)
		if TempValue6==1
			Cos256(Object.XPos,TempValue7)
			Object.XPos<<=12
			Object.XPos+=TempValue1
			Sin256(Object.YPos,TempValue7)
			Object.YPos<<=12
			Object.YPos+=TempValue2
			foreach TypeGroup[256],PlayerObjectPos
				PlayerObjectCollision(C_TOUCH,Object.EntityNo,-4,-4,4,4,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
				if CheckResult==1
					CallFunction(PlayerObject_Hit)
				endif
			floop
		endif
		TempValue7+=64
		TempValue7&=255
		TempValue0++
	loop
	Object.XPos=TempValue1
	Object.YPos=TempValue2
	foreach TypeGroup[256],PlayerObjectPos
		PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-8,8,8,PlayerObjectPos,Object[PlayerObjectPos].Value40,Object[PlayerObjectPos].Value38,Object[PlayerObjectPos].Value41,Object[PlayerObjectPos].Value39)
		if CheckResult==1
			CallFunction(PlayerObject_BadnikBreak)
		endif
	floop
endfunction


function Orbinaut_Function108
	foreach TypeGroup[256],PlayerObjectPos
		PlayerObjectCollision(C_TOUCH,Object.EntityNo,-4,-4,4,4,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
		if CheckResult==1
			CallFunction(PlayerObject_Hit)
		endif
	floop
endfunction


function Orbinaut_Function109
	if Object.OutOfBounds==1
		TempValue0=Object.XPos
		Object.XPos=Object.Value2
		if Object.OutOfBounds==1
			Object.XPos=Object.Value2
			Object.Value1=15
			if Object.Value3==0
				if Object.PropertyValue==0
					Object.Direction=FLIP_NONE
					Object.XVelocity=-0x4000
				else
					Object.Direction=FLIP_X
					Object.XVelocity=0x4000
				endif
			else
				if Object.PropertyValue==0
					Object.Direction=FLIP_NONE
				else
					Object.Direction=FLIP_X
				endif
				Object.XVelocity=0
			endif
			Object.Value0=0
			Object.AnimationTimer=0
			Object.Priority=PRIORITY_ACTIVE_BOUNDS
			Object.State=0
			Object.Angle=0
		else
			Object.XPos=TempValue0
		endif
	endif
endfunction


sub ObjectMain
	switch Object.State
	case 0
		Object.Priority=PRIORITY_ACTIVE
		Object.XPos+=Object.XVelocity
		if Object.Direction==FLIP_NONE
			Object.Angle++
		else
			Object.Angle--
		endif
		Object.Angle&=255
		CallFunction(Orbinaut_Function107)
		if Object.Value3==1
			Object.Value6=0x7FFFFFFF
			Object.Value4=0xFFFF
			Object.Value5=0
			foreach TypeGroup[256],PlayerObjectPos
				TempValue0=Object[PlayerObjectPos].YPos
				TempValue0-=Object.YPos
				Absolute(TempValue0)
				if TempValue0<Object.Value6
					Object.Value6=TempValue0
					Object.Value5=PlayerObjectPos
				endif
				if TempValue0<0x400000
					if Object.Value4!=0xFFFF
						ArrayPos0=Object.Value4
						TempValue0=Object[PlayerObjectPos].XPos
						TempValue0-=Object.XPos
						Absolute(TempValue0)
						TempValue1=Object[ArrayPos0].XPos
						TempValue1-=Object.XPos
						Absolute(TempValue1)
						if TempValue0<TempValue1
							Object.Value4=PlayerObjectPos
						endif
					else
						Object.Value4=PlayerObjectPos
					endif
				endif
			floop
			if Object.Value4!=0xFFFF
				ArrayPos0=Object.Value4
				TempValue0=Object.XPos
				TempValue0-=Object[ArrayPos0].XPos
				Absolute(TempValue0)
				if TempValue0<=0x800000
					Object.State=1
					Object.Frame=1
				endif
			else
				ArrayPos0=Object.Value5
			endif
			if Object[ArrayPos0].XPos<Object.XPos
				Object.Direction=FLIP_NONE
			else
				Object.Direction=FLIP_X
			endif
		endif
		CallFunction(Orbinaut_Function109)
		break
	case 1
		if Object.Direction==FLIP_NONE
			Object.Angle++
		else
			Object.Angle--
		endif
		Object.Angle&=255
		TempValue0=0
		TempValue7=Object.Angle
		while TempValue0<4
			if TempValue7==64
				GetBit(TempValue6,Object.Value1,TempValue0)
				if TempValue6==1
					Cos256(TempValue1,TempValue7)
					TempValue1<<=12
					TempValue1+=Object.XPos
					Sin256(TempValue2,TempValue7)
					TempValue2<<=12
					TempValue2+=Object.YPos
					SetBit(Object.Value1,TempValue0,0)
					CreateTempObject(TypeName[Orbinaut],0,TempValue1,TempValue2)
					Object[TempObjectPos].State=3
					if Object.Direction==FLIP_NONE
						Object[TempObjectPos].XVelocity=-0x20000
					else
						Object[TempObjectPos].XVelocity=0x20000
					endif
				endif
			endif
			TempValue7+=64
			TempValue7&=255
			TempValue0++
		loop
		CallFunction(Orbinaut_Function107)
		if Object.Value1==0
			Object.State=2
			if Object.Direction==FLIP_NONE
				Object.XVelocity=-0x4000
			else
				Object.XVelocity=0x4000
			endif
		endif
		if Object.AnimationTimer<16
			Object.AnimationTimer++
		else
			Object.Frame=2
		endif
		CallFunction(Orbinaut_Function109)
		break
	case 2
		Object.XPos+=Object.XVelocity
		CallFunction(Orbinaut_Function107)
		CallFunction(Orbinaut_Function109)
		break
	case 3
		Object.XPos+=Object.XVelocity
		CallFunction(Orbinaut_Function108)
		if Object.OutOfBounds==1
			Object.Type=TypeName[BlankObject]
		endif
		break

	endswitch
endsub


sub ObjectDraw
	switch Object.State
	case 0
	case 1
		TempValue0=0
		TempValue7=Object.Angle
		while TempValue0<4
			GetBit(TempValue6,Object.Value1,TempValue0)
			if TempValue6==1
				Cos256(TempValue1,TempValue7)
				TempValue1<<=12
				TempValue1+=Object.XPos
				Sin256(TempValue2,TempValue7)
				TempValue2<<=12
				TempValue2+=Object.YPos
				DrawSpriteXY(3,TempValue1,TempValue2)
			endif
			TempValue7+=64
			TempValue7&=255
			TempValue0++
		loop
		DrawSpriteFX(Object.Frame,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 2
		DrawSpriteFX(Object.Frame,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 3
		DrawSprite(3)
		break

	endswitch
endsub


sub ObjectStartup
	CheckStageFolder("Zone04")
	if CheckResult==1
		LoadSpriteSheet("LZ/Objects.gif")
		SpriteFrame(-10,-10,20,20,50,105)
		SpriteFrame(-10,-10,20,20,71,105)
		SpriteFrame(-10,-10,20,20,50,154)
		SpriteFrame(-8,-8,16,16,107,1)
	endif
	CheckStageFolder("Zone05")
	if CheckResult==1
		LoadSpriteSheet("SLZ/Objects.gif")
		SpriteFrame(-10,-10,20,20,51,1)
		SpriteFrame(-10,-10,20,20,72,1)
		SpriteFrame(-10,-10,20,20,93,1)
		SpriteFrame(-8,-8,16,16,114,1)
	endif
	CheckStageFolder("Zone06")
	if CheckResult==1
		LoadSpriteSheet("SBZ/Objects.gif")
		SpriteFrame(-10,-10,20,20,1,138)
		SpriteFrame(-10,-10,20,20,22,138)
		SpriteFrame(-10,-10,20,20,43,138)
		SpriteFrame(-8,-8,16,16,64,142)
	endif
	CheckStageFolder("Zone07")
	if CheckResult==1
		LoadSpriteSheet("MBZ/Objects.gif")
		SpriteFrame(-10,-10,20,20,119,114)
		SpriteFrame(-10,-10,20,20,140,114)
		SpriteFrame(-10,-10,20,20,119,135)
		SpriteFrame(-8,-8,16,16,140,135)
	endif
	foreach TypeName[Orbinaut],ArrayPos0
		Object[ArrayPos0].Value2=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value1=15
		if Object[ArrayPos0].PropertyValue>1
			Object[ArrayPos0].Value3=0
			Object[ArrayPos0].PropertyValue&=1
			if Object[ArrayPos0].PropertyValue==0
				Object[ArrayPos0].Direction=FLIP_NONE
				Object[ArrayPos0].XVelocity=-0x4000
			else
				Object[ArrayPos0].Direction=FLIP_X
				Object[ArrayPos0].XVelocity=0x4000
			endif
		else
			Object[ArrayPos0].Value3=1
			Object[ArrayPos0].XVelocity=0
			if Object[ArrayPos0].PropertyValue==0
				Object[ArrayPos0].Direction=FLIP_NONE
			else
				Object[ArrayPos0].Direction=FLIP_X
			endif
		endif
	floop
	TempValue0=0
	Orbinaut_staticVar32=DebugMode_DebugItemCount
	Orbinaut_staticVar32--
	while TempValue0<2
		SetArrayValue(TypeName[Orbinaut],DebugMode_DebugItemCount,DebugMode_DebugTypeList)
		SetArrayValue(Orbinaut_DebugDraw,DebugMode_DebugItemCount,DebugMode_DebugDrawList)
		SetArrayValue(Orbinaut_DebugSpawn,DebugMode_DebugItemCount,DebugMode_DebugSpawnList)
		DebugMode_DebugItemCount++
		TempValue0++
	loop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
