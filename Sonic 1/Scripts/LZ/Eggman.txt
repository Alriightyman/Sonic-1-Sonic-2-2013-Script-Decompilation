//--------------------Sonic 1 / Sonic 2 Eggman Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 71: TYPE_EGGMAN

// Function declarations
#function Eggman_Function163
#function Eggman_Function164


#array Eggman_array36:(0,0,0,0,0,0,0,0,0,0)

function Eggman_Function163
	Sin256(TempValue0,Object.Value3)
	TempValue0<<=10
	Object.YPos+=TempValue0
	Object.Value3+=2
	Object.Value3&=255
endfunction


function Eggman_Function164
	Object.Value0+=Object.XVelocity
	Object.Value1+=Object.YVelocity
	Object.XPos=Object.Value0
	Object.YPos=Object.Value1
endfunction


sub ObjectMain
	switch Object.State
	case 0
		GetArrayValue(TempValue0,0,Eggman_array36)
		foreach TypeGroup[256],PlayerObjectPos
			if Object[PlayerObjectPos].XPos>=TempValue0
				Object.XVelocity=0x6000
				Object.YVelocity=-0x18000
				Object.Value1=Object.YPos
				Object.Value3=0
				Object.State++
				Object.Priority=PRIORITY_ACTIVE
				ResetObjectEntity(26,TypeName[MusicEvent],0,0,0)
				Object[26].Priority=PRIORITY_ACTIVE
			endif
		floop
		CallFunction(Eggman_Function164)
		if Object.State==0
			CallFunction(Eggman_Function163)
		endif
		break
	case 1
		TempValue1=-2
		GetArrayValue(TempValue0,1,Eggman_array36)
		if Object.Value0>=TempValue0
			Object.Value0=TempValue0
			Object.XVelocity=0
			TempValue1++
		endif
		GetArrayValue(TempValue0,2,Eggman_array36)
		if Object.Value1<=TempValue0
			Object.Value1=TempValue0
			Object.YVelocity=0
			TempValue1++
		endif
		if TempValue1==0
			Object.XVelocity=0x14000
			Object.YVelocity=-0x20000
			Object.State++
		endif
		CallFunction(Eggman_Function164)
		break
	case 2
		TempValue1=-2
		GetArrayValue(TempValue0,3,Eggman_array36)
		if Object.Value0>=TempValue0
			Object.Value0=TempValue0
			Object.XVelocity=0
			TempValue1++
		endif
		GetArrayValue(TempValue0,4,Eggman_array36)
		if Object.Value1<=TempValue0
			Object.Value1=TempValue0
			Object.YVelocity=0
			TempValue1++
		endif
		if TempValue1==0
			Object.YVelocity=-0x18000
			Object.State++
		endif
		CallFunction(Eggman_Function164)
		break
	case 3
		GetArrayValue(TempValue0,5,Eggman_array36)
		if Object.Value1<=TempValue0
			Object.Value1=TempValue0
			if Object.Value2==0
				Object.XVelocity=0x14000
				Object.YVelocity--
			else
				Object.XVelocity=0x28000
				Object.YVelocity--
			endif
			Object.Direction=FLIP_X
			Object.Value0=Object.XPos
			Object.State++
			CallFunction(Eggman_Function164)
		else
			Object.Value4+=2
			Object.Value4&=255
			Cos256(TempValue0,Object.Value4)
			if TempValue0>0
				Object.Direction=FLIP_X
			else
				Object.Direction=FLIP_NONE
			endif
			Sin256(Object.XPos,Object.Value4)
			Object.XPos<<=12
			Object.XPos+=Object.Value0
			TempValue0=Object.YVelocity
			TempValue1=0x7FFFFFFF
			foreach TypeGroup[256],PlayerObjectPos
				if Object[PlayerObjectPos].YPos<TempValue1
					TempValue1=Object[PlayerObjectPos].YPos
				endif
			floop
			TempValue1-=Object.Value1
			if TempValue1>=0
				TempValue1-=0x480000
				if TempValue1>=0
					TempValue0>>=1
					TempValue1-=0x280000
					if TempValue1>=0
						TempValue0>>=1
						TempValue1-=0x280000
						if TempValue1>=0
							TempValue0=0
						endif
					endif
				endif
			endif
			if Object.Value2==1
				TempValue0<<=1
			endif
			if TempValue0==0
				Object.YPos=Object.Value1
				CallFunction(Eggman_Function163)
			else
				Object.Value1=Object.YPos
				Object.Value3=0
				Object.Value1+=TempValue0
				Object.YPos=Object.Value1
			endif
		endif
		break
	case 4
		TempValue1=-2
		GetArrayValue(TempValue0,6,Eggman_array36)
		if Object.Value0>=TempValue0
			Object.Value0=TempValue0
			Object.XVelocity=0
			TempValue1++
		endif
		GetArrayValue(TempValue0,7,Eggman_array36)
		if Object.Value1<=TempValue0
			Object.Value1=TempValue0
			Object.YVelocity=0
			TempValue1++
		endif
		if TempValue1==0
			if Object.Value2==0
				Object.Direction=FLIP_NONE
			endif
			Object.Value3=0
			Object.State++
		endif
		CallFunction(Eggman_Function164)
		break
	case 5
		TempValue2=0
		if Object.Value2==0
			GetArrayValue(TempValue0,8,Eggman_array36)
			GetArrayValue(TempValue1,9,Eggman_array36)
			foreach TypeGroup[256],PlayerObjectPos
				if Object[PlayerObjectPos].XPos>=TempValue0
					if Object[PlayerObjectPos].YPos<=TempValue1
						TempValue2=1
						Object.Value5=50
						Object.Animation=4
						Object.AnimationTimer=32
					endif
				endif
			floop
		else
			TempValue2=1
			Object.Value5=1
		endif
		if TempValue2==1
			ResetObjectEntity(26,TypeName[MusicEvent],1,0,0)
			Object[26].Priority=PRIORITY_ACTIVE
			Object.State++
		endif
		CallFunction(Eggman_Function164)
		CallFunction(Eggman_Function163)
		break
	case 6
		Object.Value5--
		if Object.Value5==0
			Object.Value5=0
			Object.XVelocity=0x40000
			Object.YVelocity=-0x4000
			Object.Priority=PRIORITY_ACTIVE
			Object.Animation=6
			Object.AnimationTimer=0
			Object.Value6=2
			Object.Value1=Object.YPos
			Object.State++
			if Stage.DebugMode==0
				if Object.Value10==0
					EngineCallback(SetAchievement,6,100)
				endif
			endif
		else
			if Object.Value5==24
				Object.Animation=1
				Object.AnimationTimer=0
				Object.Direction=FLIP_X
			endif
		endif
		CallFunction(Eggman_Function164)
		if Object.State==6
			CallFunction(Eggman_Function163)
		endif
		break
	case 7
		if Object.OutOfBounds==1
			ResetObjectEntity(Object.EntityNo,TypeName[BlankObject],0,0,0)
			Object.Value2=0
		else
			CallFunction(Eggman_Function164)
		endif
		break

	endswitch
	if Object.Value8!=0
		if Object.Value9>0
			Object.Value9--
		endif
		foreach TypeGroup[256],PlayerObjectPos
			if Object.Value9==0
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_HURT)
				TempValue0=CheckResult
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_DYING)
				TempValue0|=CheckResult
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_DROWNING)
				TempValue0|=CheckResult
				if TempValue0!=0
					if Object.Animation!=2
						Object.Animation=2
						Object.AnimationTimer=0
					endif
					if PlayerObjectPos==0
						Object.Value10=1
					endif
				endif
				PlayerObjectCollision(C_TOUCH,Object.EntityNo,-20,-16,20,16,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
				if CheckResult==1
					CallFunction(PlayerObject_Function44)
					if CheckResult==1
						Object.Value8--
						if Object.Value8==0
							player.score+=1000
							Object.Animation=4
							Object.AnimationTimer=0
							Object.Value2=1
						else
							Object.Animation=3
							Object.AnimationTimer=0
							Object.Value9=32
							PlaySfx(SFXName[BossHit],0)
						endif
					endif
				endif
			endif
		floop
	endif
	if Object.Value2==1
		TempValue0=oscillation
		TempValue0&=7
		if TempValue0==0
			Rand(TempValue0,96)
			TempValue0-=48
			TempValue0<<=16
			TempValue0+=Object.XPos
			Rand(TempValue1,48)
			TempValue1-=24
			TempValue1<<=16
			TempValue1+=Object.YPos
			CreateTempObject(TypeName[Explosion],0,TempValue0,TempValue1)
			PlaySfx(SFXName[Explosion],0)
		endif
	endif
endsub


sub ObjectDraw
	switch Object.Animation
	case 1
		TempValue0=Object.AnimationTimer
		TempValue0/=6
		Object.AnimationTimer++
		Object.AnimationTimer%=12
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 2
		TempValue0=Object.AnimationTimer
		TempValue0%=10
		TempValue0/=5
		TempValue0+=9
		Object.AnimationTimer++
		if Object.AnimationTimer==50
			Object.AnimationTimer=0
			if Object[0].Animation!=ANI_DYING
				Object.Animation=1
			endif
		endif
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 3
		TempValue0=Object.AnimationTimer
		TempValue0&=1
		TempValue0+=2
		Object.AnimationTimer++
		if Object.AnimationTimer==30
			Object.AnimationTimer=0
			Object.Animation=1
		endif
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 4
		TempValue0=Object.AnimationTimer
		TempValue0>>=5
		TempValue0+=4
		Object.AnimationTimer++
		Object.AnimationTimer&=63
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 5
		DrawSpriteFX(6,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 6
		TempValue0=Object.AnimationTimer
		TempValue0>>=2
		TempValue0+=7
		Object.AnimationTimer++
		Object.AnimationTimer%=7
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break

	endswitch
	switch Object.Value6
	case 1
		TempValue0=Object.Value7
		TempValue0>>=2
		TempValue0+=11
		Object.Value7++
		Object.Value7&=7
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 2
		TempValue0=Object.Value7
		TempValue0/=3
		TempValue0+=11
		Object.Value7++
		if Object.Value7>21
			Object.Value7=18
		endif
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break

	endswitch
endsub


sub ObjectStartup
	LoadSpriteSheet("Global/Eggman.gif")
	SpriteFrame(-28,-32,64,56,1,1)
	SpriteFrame(-28,-32,64,56,66,1)
	SpriteFrame(-28,-32,64,56,131,1)
	SpriteFrame(-28,-32,64,56,1,58)
	SpriteFrame(-28,-32,64,56,1,1)
	SpriteFrame(-28,-32,64,56,1,58)
	SpriteFrame(-28,-32,64,56,66,58)
	SpriteFrame(-28,-32,64,56,131,58)
	SpriteFrame(-28,-32,64,56,66,1)
	SpriteFrame(-28,-32,64,56,1,115)
	SpriteFrame(-28,-32,64,56,66,115)
	SpriteFrame(34,1,10,9,196,2)
	SpriteFrame(33,0,15,11,196,12)
	SpriteFrame(34,-1,22,14,213,1)
	SpriteFrame(34,-8,32,26,213,16)
	SpriteFrame(34,-1,22,14,213,1)
	SpriteFrame(34,-8,32,26,213,16)
	SpriteFrame(34,1,10,9,196,2)
	SpriteFrame(33,0,15,11,196,12)
	foreach TypeName[Eggman],ArrayPos0
		TempValue0=-0x700000
		TempValue0+=Object[ArrayPos0].XPos
		SetArrayValue(TempValue0,0,Eggman_array36)
		TempValue0=0x380000
		TempValue0+=Object[ArrayPos0].XPos
		SetArrayValue(TempValue0,1,Eggman_array36)
		TempValue0=-0xC00000
		TempValue0+=Object[ArrayPos0].YPos
		SetArrayValue(TempValue0,2,Eggman_array36)
		TempValue0=0x600000
		TempValue0+=Object[ArrayPos0].XPos
		SetArrayValue(TempValue0,3,Eggman_array36)
		TempValue0=-0x1000000
		TempValue0+=Object[ArrayPos0].YPos
		SetArrayValue(TempValue0,4,Eggman_array36)
		TempValue0=-0x4C00000
		TempValue0+=Object[ArrayPos0].YPos
		SetArrayValue(TempValue0,5,Eggman_array36)
		TempValue0=0x13C0000
		TempValue0+=Object[ArrayPos0].XPos
		SetArrayValue(TempValue0,6,Eggman_array36)
		TempValue0=-0x5000000
		TempValue0+=Object[ArrayPos0].YPos
		SetArrayValue(TempValue0,7,Eggman_array36)
		TempValue0=0xB80000
		TempValue0+=Object[ArrayPos0].XPos
		SetArrayValue(TempValue0,8,Eggman_array36)
		TempValue0=-0x4D00000
		TempValue0+=Object[ArrayPos0].YPos
		SetArrayValue(TempValue0,9,Eggman_array36)
		Object[ArrayPos0].Value0=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value1=Object[ArrayPos0].YPos
		Object[ArrayPos0].Animation=1
		Object[ArrayPos0].Value8=8
	floop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
