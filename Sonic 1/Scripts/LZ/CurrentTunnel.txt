//--------------------Sonic 1 / Sonic 2 Current Tunnel Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 42: TYPE_CURRENTTUNNEL


#static 0:CurrentTunnel_staticVar33


sub ObjectMain
	TempValue6=0
	TempValue7=0
	foreach TypeGroup[256],PlayerObjectPos
		CheckLower(Object[PlayerObjectPos].XPos,Object.Value0)
		TempValue0=CheckResult
		CheckGreater(Object[PlayerObjectPos].XPos,Object.Value1)
		TempValue0|=CheckResult
		CheckLower(Object[PlayerObjectPos].YPos,Object.Value2)
		TempValue0|=CheckResult
		CheckGreater(Object[PlayerObjectPos].YPos,Object.Value3)
		TempValue0|=CheckResult
		if TempValue0==0
			TempValue7=1
			if CurrentTunnel_staticVar33==0
				TempValue6=1
				CheckEqual(Object[PlayerObjectPos].State,PlayerObject_Hurt)
				TempValue0=CheckResult
				CheckEqual(Object[PlayerObjectPos].State,PlayerObject_Knockback)
				TempValue0|=CheckResult
				CheckEqual(Object[PlayerObjectPos].State,PlayerObject_Death)
				TempValue0|=CheckResult
				CheckEqual(Object[PlayerObjectPos].State,PlayerObject_Drown)
				TempValue0|=CheckResult
				CheckEqual(Object[PlayerObjectPos].State,PlayerObject_Clinging)
				TempValue0|=CheckResult
				if TempValue0==0
					Object[PlayerObjectPos].State=PlayerObject_Clinging
					Object[PlayerObjectPos].Animation=ANI_FANROTATE
					Object[PlayerObjectPos].TileCollisions=1
				endif
				if Object[PlayerObjectPos].Animation==ANI_FANROTATE
					if Object[PlayerObjectPos].XVelocity==0
						TempValue1=Object.Value3
						TempValue1-=Object.Value2
						TempValue1>>=1
						TempValue1+=Object.Value2
						if Object[PlayerObjectPos].YPos<TempValue1
							Object[PlayerObjectPos].YPos+=0x40000
						else
							Object[PlayerObjectPos].YPos-=0x40000
						endif
					endif
				endif
			else
				CurrentTunnel_staticVar33--
				if Object[PlayerObjectPos].State==PlayerObject_Clinging
					Object[PlayerObjectPos].State=PlayerObject_HandleAir
					Object[PlayerObjectPos].XVelocity=0x40000
					Object[PlayerObjectPos].Speed=0x40000
				endif
			endif
		else
			if Object[PlayerObjectPos].State==PlayerObject_Clinging
				Object[PlayerObjectPos].State=PlayerObject_HandleAir
				Object[PlayerObjectPos].XVelocity=0x40000
				Object[PlayerObjectPos].Speed=0x40000
			endif
		endif
	floop
	Object.Priority=TempValue6
	if Object.PropertyValue==0
		Object[+1].Priority=TempValue6
	else
		Object[1].Priority=TempValue6
	endif
	if TempValue7==0
		Object.Value4=0
	endif
	if Object.Value4!=0
		Object.Value4--
		if TempValue7==1
			if Object.Value4<=0
				if Object.PropertyValue==0
					TempValue0=Object[+1].Value4
				else
					TempValue0=Object[1].Value4
				endif
				if TempValue0==0
					StopSfx(SFXName[Waterfall])
					PlaySfx(SFXName[WaterfallLoop],0)
					Object.Value4=31
				endif
			endif
		endif
	else
		if TempValue7==1
			if Object.PropertyValue==0
				TempValue0=Object[+1].Value4
			else
				TempValue0=Object[1].Value4
			endif
			if TempValue0==0
				PlaySfx(SFXName[Waterfall],0)
				Object.Value4=31
			endif
		endif
	endif
endsub


sub ObjectStartup
	CurrentTunnel_staticVar33=0
	foreach TypeName[CurrentTunnel],ArrayPos0
		if Object[ArrayPos0].PropertyValue==0
			ArrayPos1=ArrayPos0
			ArrayPos1++
			Object[ArrayPos0].Value0=Object[ArrayPos0].XPos
			Object[ArrayPos0].Value1=Object[ArrayPos1].XPos
			TempValue1=Object[ArrayPos0].YPos
			TempValue2=Object[ArrayPos0].YPos
		else
			ArrayPos1=ArrayPos0
			ArrayPos1--
			Object[ArrayPos0].Value0=Object[ArrayPos1].XPos
			Object[ArrayPos0].Value1=Object[ArrayPos0].XPos
			TempValue1=Object[ArrayPos0].YPos
			TempValue2=Object[ArrayPos0].YPos
		endif
		if TempValue1<TempValue2
			Object[ArrayPos0].Value2=TempValue1
			Object[ArrayPos0].Value3=TempValue2
		else
			Object[ArrayPos0].Value2=TempValue2
			Object[ArrayPos0].Value3=TempValue1
		endif
		Object[ArrayPos0].Value2-=0x600000
		Object[ArrayPos0].Value3+=0x600000
	floop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
