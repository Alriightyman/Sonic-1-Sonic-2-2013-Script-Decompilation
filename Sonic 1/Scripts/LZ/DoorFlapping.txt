//--------------------Sonic 1 / Sonic 2 Flapping Door Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 58: TYPE_FLAPPINGDOOR

// Function declarations
#function FlappingDoor_DebugDraw
#function FlappingDoor_DebugSpawn



function FlappingDoor_DebugDraw
	DrawSpriteFX(0,FX_FLIP,Object.XPos,Object.YPos)
endfunction


function FlappingDoor_DebugSpawn
	CreateTempObject(TypeName[FlappingDoor],0,Object.XPos,Object.YPos)
	Object[TempObjectPos].Direction=Object.Direction
	Object[TempObjectPos].Value1=56
	Object[TempObjectPos].Value0=56
endfunction


sub ObjectMain
	switch Object.Frame
	case 0
		if Object[0].XPos<Object.XPos
			CurrentTunnel_staticVar33=4
		endif
		Object.Value0--
		if Object.Value0==-1
			TempValue0=Screen.CameraXPos
			TempValue0-=Object.iXPos
			TempValue0-=8
			Absolute(TempValue0)
			if TempValue0<=Screen.CenterX
				TempValue0=Screen.CameraYPos
				TempValue0-=Object.iYPos
				TempValue0-=32
				Absolute(TempValue0)
				if TempValue0<=Screen.CenterY
					PlaySfx(SFXName[FlappingDoor],0)
				endif
			endif
		endif
		if Object.Value0==-5
			Object.Value2=0
			Object.Frame=2
		endif
		break
	case 1
		Object.Value0--
		if Object.Value0==-1
			TempValue0=Screen.CameraXPos
			TempValue0-=Object.iXPos
			TempValue0-=8
			Absolute(TempValue0)
			if TempValue0<=Screen.CenterX
				TempValue0=Screen.CameraYPos
				TempValue0-=Object.iYPos
				TempValue0-=32
				Absolute(TempValue0)
				if TempValue0<=Screen.CenterY
					PlaySfx(SFXName[FlappingDoor],0)
				endif
			endif
		endif
		if Object.Value0==-5
			Object.Value2=0
			Object.Frame=2
		endif
		break
	case 2
		Object.Value2++
		if Object.Value2==4
			Object.Value3^=1
			Object.Frame=Object.Value3
			Object.Value0=Object.Value1
		endif
		break

	endswitch
	if Object.Frame==0
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_BOX,Object.EntityNo,-8,-32,8,32,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
		floop
	endif
endsub


sub ObjectDraw
	DrawSpriteFX(Object.Frame,FX_FLIP,Object.XPos,Object.YPos)
endsub


sub ObjectStartup
	LoadSpriteSheet("LZ/Objects.gif")
	SpriteFrame(-8,-32,16,64,1,191)
	SpriteFrame(0,-40,32,80,51,175)
	SpriteFrame(-5,-38,32,76,18,179)
	foreach TypeName[FlappingDoor],ArrayPos0
		Object[ArrayPos0].Value1=Object[ArrayPos0].PropertyValue
		Object[ArrayPos0].Value1*=60
		Object[ArrayPos0].Value1-=4
		Object[ArrayPos0].Value0=Object[ArrayPos0].Value1
	floop
	SetArrayValue(TypeName[FlappingDoor],DebugMode_DebugItemCount,DebugMode_DebugTypeList)
	SetArrayValue(FlappingDoor_DebugDraw,DebugMode_DebugItemCount,DebugMode_DebugDrawList)
	SetArrayValue(FlappingDoor_DebugSpawn,DebugMode_DebugItemCount,DebugMode_DebugSpawnList)
	DebugMode_DebugItemCount++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
