//--------------------Sonic 1 / Sonic 2 Air Bubbler Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 44: TYPE_AIRBUBBLER

// Function declarations
#function AirBubbler_DebugDraw
#function AirBubbler_DebugSpawn



//Unknown Variables
#static 18:staticVar0xF00C
#static 2:staticVar0xF00D
#static 4:staticVar0xF00E
#static 2:staticVar0xF00F
#static 2:staticVar0xF010
#static 2:staticVar0xF011
#static 2:staticVar0xF012
#static 4:staticVar0xF013
#static 2:staticVar0xF014
#static 4:staticVar0xF015
#static 2:staticVar0xF016
#static 2:staticVar0xF017
#static 4:staticVar0xF018
#static 2:staticVar0xF019
#static 4:staticVar0xF01A
#static 2:staticVar0xF01B
#static 2:staticVar0xF01C
#static 4:staticVar0xF01D
#static 2:staticVar0xF01E

function AirBubbler_DebugDraw
	DrawSprite(0)
endfunction


function AirBubbler_DebugSpawn
	CreateTempObject(TypeName[AirBubbler],0,Object.XPos,Object.YPos)
	Object[TempObjectPos].DrawOrder=4
	Object[TempObjectPos].Value4=0
endfunction


sub ObjectMain
	Object.Frame++
	Object.Frame%=48
	if Object.iYPos>Stage.WaterLevel
		TempValue0=Object.iXPos
		TempValue0-=Screen.CameraXPos
		Absolute(TempValue0)
		if TempValue0<Screen.CenterX
			TempValue0=Object.iYPos
			TempValue0-=Screen.CameraYPos
			Absolute(TempValue0)
			if TempValue0<Screen.CenterY
				TempValue1=0
				if Object.Value3==0
					Object.Value0--
					if Object.Value0<0
						SetBit(Object.Value3,0,1)
						Rand(Object.Value2,0xFFFF)
						Object.Value1=Object.Value2
						Object.Value2%=6
						Object.Value1&=12
						Object.Value4--
						if Object.Value4<0
							Object.Value4=Object.PropertyValue
							SetBit(Object.Value3,1,1)
						endif
						TempValue1=1
					endif
				else
					Object.Value0--
					if Object.Value0<0
						TempValue1=1
					endif
				endif
				if TempValue1==1
					Rand(Object.Value0,32)
					Rand(TempValue0,17)
					TempValue0-=8
					TempValue0<<=16
					TempValue0+=Object.XPos
					CreateTempObject(TypeName[AirBubble],2,TempValue0,Object.YPos)
					Object[TempObjectPos].Value1=Object[TempObjectPos].XPos
					Rand(Object[TempObjectPos].Angle,256)
					Object[TempObjectPos].Angle<<=1
					Object[TempObjectPos].DrawOrder=4
					Object[TempObjectPos].YVelocity=-0x8800
					Object[TempObjectPos].Value2=0xFFFF
					TempValue0=Object.Value1
					TempValue0+=Object.Value2
					GetArrayValue(Object[TempObjectPos].PropertyValue,TempValue0,AirBubbler_array27)
					GetBit(TempValue0,Object.Value3,1)
					if TempValue0==1
						Rand(TempValue0,4)
						TempValue1=0
						if TempValue0==0
							GetBit(TempValue0,Object.Value3,2)
							if TempValue0==0
								TempValue1=1
							endif
						endif
						if Object.Value2==0
							GetBit(TempValue0,Object.Value3,2)
							if TempValue0==0
								TempValue1=1
							endif
						endif
						if TempValue1==1
							Object[TempObjectPos].PropertyValue=6
							SetBit(Object.Value3,2,1)
						endif
					endif
					Object.Value2--
					if Object.Value2<0
						Rand(TempValue0,128)
						TempValue0+=128
						Object.Value0+=TempValue0
						Object.Value3=0
					endif
				endif
			endif
		endif
	endif
endsub


sub ObjectDraw
	if Object.iYPos>=Stage.WaterLevel
		TempValue0=Object.Frame
		TempValue0>>=4
		DrawSprite(TempValue0)
	endif
endsub


sub ObjectStartup
	LoadSpriteSheet("LZ/Objects.gif")
	SpriteFrame(-8,-8,16,16,61,51)
	SpriteFrame(-8,-8,16,16,78,51)
	SpriteFrame(-8,-8,16,16,95,51)
	foreach TypeName[AirBubbler],ArrayPos0
		Object[ArrayPos0].DrawOrder=4
		Object[ArrayPos0].Value4=Object[ArrayPos0].PropertyValue
	floop
	SetArrayValue(TypeName[AirBubbler],DebugMode_DebugItemCount,DebugMode_DebugTypeList)
	SetArrayValue(AirBubbler_DebugDraw,DebugMode_DebugItemCount,DebugMode_DebugDrawList)
	SetArrayValue(AirBubbler_DebugSpawn,DebugMode_DebugItemCount,DebugMode_DebugSpawnList)
	DebugMode_DebugItemCount++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
