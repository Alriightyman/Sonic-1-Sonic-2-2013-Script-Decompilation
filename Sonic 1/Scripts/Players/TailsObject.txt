//--------------------Sonic 1 / Sonic 2 TailsObject Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 2: TYPE_TAILSOBJECT

// Function declarations
#function TailsObject_AnimateTail



function TailsObject_AnimateTail
	switch Object.Value13
	case 0
		if Object.Frame==0
			Object.Value12++
			Object.Value12%=40
		endif
		break
	case 1
	case 3
	case 4
		Object.Value12++
		Object.Value12%=40
		break
	case 7
	case 9
	case 10
	case 43
		Object.Value12++
		Object.Value12%=12
		break
	case 17
		Object.Value12++
		Object.Value12%=30
		break
	endswitch
endfunction


sub ObjectMain
	if Stage.DebugMode==1
		CallFunction(PlayerObject_ProcessPlayer)
		CheckEqual(options.attractMode,0)
		TempValue0=CheckResult
		CheckEqual(KeyPress.ButtonB,1)
		TempValue0&=CheckResult
		if TempValue0==1
			Object.Type=TypeName[DebugMode]
			Object.YVelocity=0
			Object.State=PlayerObject_Blank
			Object.Frame=0
			Object.Rotation=0
			Object.ObjectInteractions=0
			Object.DrawOrder=4
			Object.Priority=PRIORITY_ACTIVE
			Object.Value8=0
			Object.Visible=1
			Object.Value2=0
			Object.Value3=0
			Object.Value4=0
			Object.Frame=Object.Value17
			Screen.CameraEnabled=1
			Screen.CameraStyle=0
			StopSfx(SFXName[Flying])
			StopSfx(SFXName[Jump])
			if Stage.State==3
				Stage.State=STAGE_RUNNING
			endif
			if Object[1].Type==TypeName[Player2Object]
				Object[1].Priority=PRIORITY_ACTIVE
			endif
			if Object[+PlayerObjectCount].PropertyValue==3
				Object[+PlayerObjectCount].Type=TypeName[Invincibility]
				Object[+PlayerObjectCount].PropertyValue=0
			endif
		else
			if Object.Gravity==GRAVITY_GROUND
				Object.Value35=0
			endif
			CallFunction(Object.State)
			ProcessObjectAnimation()
			CallFunction(TailsObject_AnimateTail)
			if Object.Animation==ANI_JUMPING
				Screen.AdjustCameraY=Object.Value30
			else
				if Screen.AdjustCameraY==Object.Value30
					Screen.AdjustCameraY=0
					Object.iYPos+=Object.Value30
				endif
			endif
			if Object.Value34==0
				TempValue0=Object.Value42
				Object.Value42=Object.Gravity
				PlayerTileCollision()
				Object.Value42^=1
				CheckEqual(Object.Gravity,GRAVITY_GROUND)
				Object.Value42|=CheckResult
				Object.Value42^=1
				if TempValue0==1
					if Object.Value42==0
						Object.Value19=0
						achieveRingCount=0
						if Object.Animation==ANI_JUMPING
							if Object.Down==0
								if Object.State!=PlayerObject_HandleRoll
									if Object.State!=PlayerObject_Unknown2
										Object.Animation=ANI_WALKING
										if Object.EntityNo==Screen.CameraTarget
											Screen.AdjustCameraY=0
										endif
										Object.iYPos+=Object.Value30
									endif
								endif
							endif
						endif
					endif
				endif
			else
				Object.Value34=0
			endif
		endif
	else
		CallFunction(PlayerObject_ProcessPlayer)
		if Object.Gravity==GRAVITY_GROUND
			Object.Value35=0
		endif
		CallFunction(Object.State)
		ProcessObjectAnimation()
		CallFunction(TailsObject_AnimateTail)
		if Object.Animation==ANI_JUMPING
			Screen.AdjustCameraY=Object.Value30
		else
			if Screen.AdjustCameraY==Object.Value30
				Screen.AdjustCameraY=0
				Object.iYPos+=Object.Value30
			endif
		endif
		if Object.Value34==0
			TempValue0=Object.Value42
			Object.Value42=Object.Gravity
			PlayerTileCollision()
			Object.Value42^=1
			CheckEqual(Object.Gravity,GRAVITY_GROUND)
			Object.Value42|=CheckResult
			Object.Value42^=1
			if TempValue0==1
				if Object.Value42==0
					Object.Value19=0
					achieveRingCount=0
					if Object.Animation==ANI_JUMPING
						if Object.Down==0
							if Object.State!=PlayerObject_HandleRoll
								if Object.State!=PlayerObject_Unknown2
									Object.Animation=ANI_WALKING
									if Object.EntityNo==Screen.CameraTarget
										Screen.AdjustCameraY=0
									endif
									Object.iYPos+=Object.Value30
								endif
							endif
						endif
					endif
				endif
			endif
		else
			Object.Value34=0
		endif
	endif
	CallFunction(PlayerObject_HandleSuper)
endsub


sub ObjectDraw
	if Object.Animation!=Object.PrevAnimation
		Object.PrevAnimation=Object.Animation
		Object.Frame=0
		Object.AnimationTimer=0
		Object.AnimationSpeed=0
	endif
	if Object.Value13!=Object.Animation
		if Object.Animation>4
			Object.Value12=0
		endif
		if Object.Value13>4
			Object.Value12=0
		endif
		Object.Value13=Object.Animation
	endif
	switch Object.Value13
	case 0
		if Object.Frame==0
			TempValue0=Object.Value12
			TempValue0>>=3
			if Object.Visible==1
				DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
			endif
		endif
		break
	case 1
	case 3
	case 4
	case 37
		TempValue0=Object.Value12
		TempValue0>>=3
		if Object.Visible==1
			DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		endif
		break
	case 7
	case 9
		TempValue0=Object.Value12
		TempValue0>>=2
		TempValue0+=11
		if Object.Visible==1
			DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		endif
		break
	case 10
	case 43
		TempValue0=Object.Value12
		TempValue0>>=2
		CheckEqual(Object.XVelocity,0)
		TempValue1=CheckResult
		CheckEqual(Object.YVelocity,0)
		TempValue1&=CheckResult
		TempValue2=Object.Rotation
		if TempValue1==0
			ATan2(Object.Rotation,Object.XVelocity,Object.YVelocity)
			Object.Rotation+=16
			Object.Rotation&=255
			Object.Rotation>>=5
			switch Object.Rotation
			case 0
			case 8
				TempValue0+=5
				Object.Rotation=0
				break
			case 1
				TempValue0+=8
				if Object.Direction==FLIP_NONE
					Object.Rotation=64
				else
					Object.Rotation=0
				endif
				break
			case 2
				TempValue0+=5
				Object.Rotation=64
				break
			case 3
				TempValue0+=8
				if Object.Direction==FLIP_NONE
					Object.Rotation=128
				else
					Object.Rotation=64
				endif
				break
			case 4
				TempValue0+=5
				Object.Rotation=128
				break
			case 5
				TempValue0+=8
				if Object.Direction==FLIP_NONE
					Object.Rotation=192
				else
					Object.Rotation=128
				endif
				break
			case 6
				TempValue0+=5
				Object.Rotation=192
				break
			case 7
				TempValue0+=8
				if Object.Direction==FLIP_NONE
					Object.Rotation=0
				else
					Object.Rotation=192
				endif
				break
			endswitch
			if Object.Direction==FLIP_X
				Object.Rotation+=128
			endif
		else
			TempValue0+=5
			Object.Rotation=0
		endif
		Object.Rotation<<=1
		if Object.Visible==1
			DrawSpriteFX(TempValue0,FX_ROTATE,Object.XPos,Object.YPos)
		endif
		Object.Rotation=TempValue2
		break
	case 17
		TempValue0=Object.Value12
		TempValue0/=10
		TempValue0+=11
		if Object.Visible==1
			DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		endif
		break

	endswitch
	DrawObjectAnimation()
endsub


sub ObjectStartup
	if Stage.PlayerListPos==1
		LoadSpriteSheet("Players/Tails1.gif")
		LoadAnimation("Tails.ani")
		SpriteFrame(-22,-8,16,24,82,199)
		SpriteFrame(-26,-8,20,24,99,199)
		SpriteFrame(-26,-8,20,24,120,199)
		SpriteFrame(-26,-8,20,24,141,199)
		SpriteFrame(-26,-8,20,24,162,199)
		SpriteFrame(-35,-8,24,16,231,166)
		SpriteFrame(-35,-8,24,16,231,183)
		SpriteFrame(-35,-8,24,16,231,200)
		SpriteFrame(-25,9,20,16,235,217)
		SpriteFrame(-25,9,18,16,237,234)
		SpriteFrame(-25,9,20,16,216,234)
		SpriteFrame(-30,-6,24,16,231,166)
		SpriteFrame(-30,-6,24,16,231,183)
		SpriteFrame(-30,-6,24,16,231,200)
	endif
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
