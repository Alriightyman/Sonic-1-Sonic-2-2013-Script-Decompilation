//--------------------Sonic 1 / Sonic 2 SpecialFinish Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 22: TYPE_SPECIALFINISH

// Function declarations
#function SpecialFinish_Function53



function SpecialFinish_Function53
	switch Object.Value9
	case 0
		TempValue0=Screen.CenterX
		FlipSign(TempValue0)
		TempValue0-=160
		Object.Value1-=16
		if Object.Value1<=TempValue0
			Object.Value1=TempValue0
			Object.Value9++
		endif
		break
	case 1
		Object.Value1+=16
		if Object.Value1>=0
			Object.Value1=0
			Object.Value9++
		endif
		break

	endswitch
endfunction


sub ObjectMain
	switch Object.State
	case 0
		Object.Rotation=PlayerObject_constant6
		PlayerObject_constant7=2
		Object.Rotation<<=2
		Object.Value2=8
		Object.State++
		break
	case 1
		Object.Rotation-=Object.Value2
		if Object.Rotation<0
			Object.Rotation+=0x800
		endif
		Object.Value2+=2
		PlayerObject_constant6=Object.Rotation
		PlayerObject_constant6>>=2
		if Object.Value2>248
			if options.gameMode<2
				Object.State++
			else
				Object.State=14
			endif
		endif
		break
	case 2
		Object.Rotation-=Object.Value2
		if Object.Rotation<0
			Object.Rotation+=0x800
		endif
		Object.Value2+=2
		PlayerObject_constant6=Object.Rotation
		PlayerObject_constant6>>=2
		if Object.Value0<256
			Object.Value0+=8
			SetScreenFade(224,224,224,Object.Value0)
		else
			if PlayerObject_constant9==1
				TempValue0=Stage.ActNo
				TempValue0--
				SetBit(specialStage.emeralds,TempValue0,1)
			endif
			Object.Value5=Object[0].Value0
			Object.Value5*=100
			if Object[0].Value0>=50
				Object.Value8=1
			endif
			Stage.ListPos=specialStage.nextZone
			Stage.ActiveList=REGULAR_STAGE
			switch specialStage.emeralds
			case 63
				if options.superStates==0
					Object.Frame=3
					specialStage.listPos++
					specialStage.listPos%=6
					TempValue0=1
				else
					Object.Frame=2
					specialStage.listPos=6
					TempValue0=1
				endif
				break
			case 127
				Object.Frame=3
				specialStage.listPos++
				specialStage.listPos%=7
				TempValue0=1
				break
			default
				Object.Frame=2
				TempValue0=0
				while TempValue0==0
					specialStage.listPos++
					if specialStage.listPos>5
						specialStage.listPos=0
					endif
					GetBit(TempValue1,specialStage.emeralds,specialStage.listPos)
					if TempValue1==0
						TempValue0=1
					endif
				loop
				break

			endswitch
			if PlayerObject_constant9==0
				Object.Frame=1
			endif
			Object.Value0=0
			TempValue0=0
			while TempValue0<20
				ResetObjectEntity(TempValue0,TypeName[BlankObject],0,0,0)
				TempValue0++
			loop
			TempValue0++
			while TempValue0<0x4A0
				ResetObjectEntity(TempValue0,TypeName[BlankObject],0,0,0)
				TempValue0++
			loop
			Stage[0].ActiveLayer=9
			Stage[1].ActiveLayer=9
			Stage[2].ActiveLayer=9
			Stage[3].ActiveLayer=9
			Object.ControlMode=0
			KeyDown.Left=0
			KeyDown.Right=0
			Object.Direction=FLIP_NONE
			if options.gameMode==1
				ArrayPos1=options.saveSlot
				ArrayPos1<<=3
				if stage.player2Enabled==1
					SaveRAM[ArrayPos1]=3
				else
					SaveRAM[ArrayPos1]=Stage.PlayerListPos
				endif
				ArrayPos1++
				SaveRAM[ArrayPos1]=player.lives
				ArrayPos1++
				SaveRAM[ArrayPos1]=player.score
				ArrayPos1++
				SaveRAM[ArrayPos1]=player.scoreBonus
				ArrayPos1++
				TempValue0=Stage.ListPos
				TempValue0++
				if TempValue0>SaveRAM[ArrayPos1]
					SaveRAM[ArrayPos1]=TempValue0
				else
					if SaveRAM[ArrayPos1]>=128
						SaveRAM[ArrayPos1]=TempValue0
					endif
				endif
				ArrayPos1++
				SaveRAM[ArrayPos1]=specialStage.emeralds
				ArrayPos1++
				SaveRAM[ArrayPos1]=specialStage.listPos
				WriteSaveRAM()
			endif
			Object.State++
			SetScreenFade(244,244,244,255)
		endif
		break
	case 3
		if Object.Value0<45
			Object.Value0++
		else
			Object.Value0=0
			Object.State++
		endif
		SetScreenFade(244,244,244,255)
		break
	case 4
		PlayMusic(1)
		Object.DrawOrder=6
		Object.Priority=PRIORITY_ACTIVE
		Object.InkEffect=INK_ALPHA
		Object.Alpha=0
		Object.XPos=Screen.CenterX
		Object.XPos+=128
		Object.Value1=Screen.CenterX
		FlipSign(Object.Value1)
		Object.Value1-=160
		Object.Value3=Screen.CenterX
		Object.Value3+=192
		Object.Value4=Object.Value3
		Object.Value4+=32
		Object.Value7=Object.Value4
		Object.Value7+=32
		if Stage.DebugMode==0
			if specialStage.emeralds>=63
				EngineCallback(SetAchievement,9,100)
			endif
		endif
		Object.State++
		break
	case 5
		if Object.XPos>0
			Object.XPos-=16
			if Object.XPos<0
				Object.XPos=0
			endif
		endif
		if Object.Value1<0
			Object.Value1+=16
			if Object.Value1>0
				Object.Value1=0
			endif
		else
			Object.State++
		endif
		break
	case 6
		if Object.Value6<256
			Object.Value6+=8
		endif
		if Object.Value3>0
			Object.Value3-=16
			if Object.Value3<0
				Object.Value3=0
			endif
		endif
		if Object.Value4>0
			Object.Value4-=16
			if Object.Value4<0
				Object.Value4=0
			endif
		endif
		if Object.Value7>0
			Object.Value7-=16
			if Object.Value7<0
				Object.Value7=0
			endif
		else
			Object.State++
		endif
		break
	case 7
		if Object.Value6<256
			Object.Value6+=8
		endif
		Object.Value0++
		if Object.Value0>299
			Object.Value0=0
			Object.State++
		endif
		break
	case 8
		if Object.Value5>0
			Object.Value5-=100
			player.score+=100
		endif
		if player.score>=player.scoreBonus
			player.lives++
			player.scoreBonus+=0xC350
			PlaySfx(SFXName[Life],0)
			PauseMusic()
			ResetObjectEntity(25,TypeName[MusicEvent],2,0,0)
			Object[25].Priority=PRIORITY_ACTIVE
		endif
		if Object.Value5>0
			Object.Value0++
			if Object.Value0==2
				PlaySfx(SFXName[ScoreAdd],0)
				Object.Value0=0
			endif
		else
			if Object.Value8==0
				Object.State++
				if PlayerObject_constant9==1
					if specialStage.emeralds==127
						Object.State=16
					endif
				endif
			else
				Object.State=12
			endif
			Object.Value0=0
			PlaySfx(SFXName[ScoreTotal],0)
		endif
		break
	case 9
		Object.Value0++
		if Object.Value0==160
			Object.Value0=0
			Object.State++
			PlaySfx(SFXName[Warp],0)
		endif
		break
	case 10
		if Object.Value0<400
			Object.Value0+=8
			SetScreenFade(248,248,248,Object.Value0)
		else
			Object.Value0=248
			Object.State++
			SetScreenFade(248,248,248,255)
		endif
		break
	case 11
		if Object.Value0>0
			Object.Value0-=8
		else
			if options.gameMode==1
				ArrayPos1=options.saveSlot
				ArrayPos1<<=3
				if stage.player2Enabled==1
					SaveRAM[ArrayPos1]=3
				else
					SaveRAM[ArrayPos1]=Stage.PlayerListPos
				endif
				ArrayPos1++
				SaveRAM[ArrayPos1]=player.lives
				ArrayPos1++
				SaveRAM[ArrayPos1]=player.score
				ArrayPos1++
				SaveRAM[ArrayPos1]=player.scoreBonus
				ArrayPos1++
				TempValue0=Stage.ListPos
				TempValue0++
				if TempValue0>SaveRAM[ArrayPos1]
					SaveRAM[ArrayPos1]=TempValue0
				else
					if SaveRAM[ArrayPos1]>=128
						SaveRAM[ArrayPos1]=TempValue0
					endif
				endif
				ArrayPos1++
				SaveRAM[ArrayPos1]=specialStage.emeralds
				ArrayPos1++
				SaveRAM[ArrayPos1]=specialStage.listPos
				WriteSaveRAM()
			endif
			fadeColor=0
			if Stage.ListPos<Stage.ListSize
				LoadStage()
			else
				Stage.ActiveList=PRESENTATION_STAGE
				Stage.ListPos=0
				LoadStage()
			endif
		endif
		SetScreenFade(Object.Value0,Object.Value0,Object.Value0,255)
		break
	case 12
		Object.Value0++
		if Object.Value0==120
			Object.Value0=0
			Object.Value8++
			Object.State++
			PlaySfx(SFXName[Continue],0)
		endif
		break
	case 13
		if specialStage.emeralds==127
			CallFunction(SpecialFinish_Function53)
		endif
		Object.Value0++
		if Object.Value0==360
			Object.Value0=0
			Object.State=10
			PlaySfx(SFXName[Warp],0)
		endif
		break
	case 14
		Object.Rotation-=Object.Value2
		if Object.Rotation<0
			Object.Rotation+=0x800
		endif
		Object.Value2+=2
		PlayerObject_constant6=Object.Rotation
		PlayerObject_constant6>>=2
		if Object.Value0<480
			Object.Value0+=8
			Music.Volume-=2
		else
			Object.Value0=248
			Object.State++
			TempValue0=0
			while TempValue0<20
				ResetObjectEntity(TempValue0,TypeName[BlankObject],0,0,0)
				TempValue0++
			loop
			TempValue0++
			while TempValue0<0x4A0
				ResetObjectEntity(TempValue0,TypeName[BlankObject],0,0,0)
				TempValue0++
			loop
			Stage[0].ActiveLayer=9
			Stage[1].ActiveLayer=9
			Stage[2].ActiveLayer=9
			Stage[3].ActiveLayer=9
			StopMusic()
		endif
		SetScreenFade(248,248,248,Object.Value0)
		break
	case 15
		if Object.Value0>0
			Object.Value0-=8
		else
			if PlayerObject_constant9==1
				timeAttack.result=Stage.Seconds
				timeAttack.result*=100
				TempValue0=Stage.Minutes
				TempValue0*=0x1770
				timeAttack.result+=TempValue0
				timeAttack.result+=Stage.MilliSeconds
			else
				timeAttack.result=0x186A0
			endif
			Engine.State=8
		endif
		SetScreenFade(Object.Value0,Object.Value0,Object.Value0,255)
		break
	case 16
		Object.Value0++
		if Object.Value0==120
			Object.Value0=0
			Object.State++
		endif
		break
	case 17
		CallFunction(SpecialFinish_Function53)
		Object.Value0++
		if Object.Value0==480
			Object.Value0=0
			Object.State=10
			PlaySfx(SFXName[Warp],0)
		endif
		break

	endswitch
endsub


sub ObjectDraw
	switch Object.State
	case 4
	case 5
	case 6
	case 7
	case 8
	case 9
	case 10
	case 11
	case 12
	case 13
	case 16
	case 17
		DrawRect(0,0,Screen.XSize,Screen.YSize,224,224,224,255)
		TempValue0=Screen.CenterX
		TempValue0+=Object.XPos
		DrawSpriteScreenXY(0,TempValue0,48)
		if Object.Value9==0
			TempValue0=Screen.CenterX
			TempValue0+=Object.Value1
			DrawSpriteScreenXY(Object.Frame,TempValue0,68)
		else
			TempValue0=Screen.CenterX
			TempValue0+=Object.Value1
			DrawSpriteScreenXY(26,TempValue0,68)
			DrawSpriteScreenXY(27,TempValue0,68)
			DrawSpriteScreenXY(28,TempValue0,68)
			TempValue0=Screen.CenterX
			TempValue0-=Object.Value1
			DrawSpriteScreenXY(29,TempValue0,68)
			DrawSpriteScreenXY(30,TempValue0,68)
		endif
		TempValue0=Screen.CenterX
		TempValue0-=79
		TempValue0+=Object.Value3
		DrawSpriteScreenXY(4,TempValue0,151)
		TempValue0+=151
		DrawNumbers(9,TempValue0,153,player.score,6,8,0)
		TempValue0=Screen.CenterX
		TempValue0-=79
		TempValue0+=Object.Value4
		DrawSpriteScreenXY(5,TempValue0,167)
		TempValue0+=151
		DrawNumbers(9,TempValue0,169,Object.Value5,5,8,0)
		if Object.Value8!=0
			TempValue0=Screen.CenterX
			TempValue0-=79
			TempValue0+=Object.Value7
			DrawSpriteScreenXY(6,TempValue0,183)
			if Object.Value8==2
				TempValue0+=151
				GetBit(TempValue1,Object.Value0,4)
				TempValue1+=7
				if Object.State!=13
					TempValue1=7
				endif
				DrawSpriteScreenXY(TempValue1,TempValue0,196)
			endif
		endif
		Object.AnimationTimer+=16
		Object.AnimationTimer&=511
		Sin(TempValue0,Object.AnimationTimer)
		TempValue0>>=3
		TempValue0+=190
		TempValue0*=Object.Value6
		TempValue0>>=8
		Object.Alpha=TempValue0
		TempValue0=0
		TempValue1=19
		TempValue3=Screen.CenterX
		if specialStage.emeralds==127
			TempValue3+=12
		endif
		while TempValue0<7
			GetBit(TempValue2,specialStage.emeralds,TempValue0)
			if TempValue2==1
				DrawSpriteScreenFX(TempValue1,FX_INK,TempValue3,112)
			endif
			TempValue0++
			TempValue1++
		loop
		endswitch
endsub



sub ObjectStartup
	LoadSpriteSheet("Special/Objects.gif")
	SpriteFrame(-32,0,56,56,63,401)
	SpriteFrame(-99,0,197,16,120,401)
	SpriteFrame(-112,0,223,16,156,418)
	switch Stage.PlayerListPos
	case 0
	case 3
		SpriteFrame(-127,0,254,16,156,435)
		break
	case 1
		if options.region==0
			SpriteFrame(-127,0,254,16,156,452)
		else
			SpriteFrame(-127,0,254,16,156,469)
		endif
		break
	case 2
		SpriteFrame(-149,0,298,16,156,486)
		break

	endswitch
	SpriteFrame(0,0,44,16,35,458)
	SpriteFrame(0,0,85,16,35,475)
	SpriteFrame(0,0,69,16,35,492)
	switch Stage.PlayerListPos
	case 0
	case 3
		SpriteFrame(-8,-11,16,23,399,376)
		SpriteFrame(-8,-11,16,23,416,376)
		break
	case 1
		SpriteFrame(-8,-11,16,23,433,376)
		SpriteFrame(-8,-11,16,23,450,376)
		break
	case 2
		SpriteFrame(-8,-11,16,23,467,376)
		SpriteFrame(-8,-11,16,23,484,376)
		break

	endswitch
	SpriteFrame(0,0,8,11,120,418)
	SpriteFrame(0,0,8,11,129,418)
	SpriteFrame(0,0,8,11,138,418)
	SpriteFrame(0,0,8,11,147,418)
	SpriteFrame(0,0,8,11,120,430)
	SpriteFrame(0,0,8,11,129,430)
	SpriteFrame(0,0,8,11,138,430)
	SpriteFrame(0,0,8,11,147,430)
	SpriteFrame(0,0,8,11,120,442)
	SpriteFrame(0,0,8,11,129,442)
	SpriteFrame(-28,-4,24,24,176,276)
	SpriteFrame(-4,-4,24,24,201,276)
	if options.superStates==0
		SpriteFrame(-52,-4,24,24,226,276)
	else
		SpriteFrame(-52,-4,24,24,426,276)
	endif
	SpriteFrame(20,-4,24,24,251,276)
	SpriteFrame(-76,-4,24,24,276,276)
	SpriteFrame(44,-4,24,24,301,276)
	SpriteFrame(-100,-4,24,24,401,276)
	switch Stage.PlayerListPos
	case 0
	case 3
		SpriteFrame(-113,-12,53,16,411,435)
		SpriteFrame(-51,-12,70,16,156,435)
		SpriteFrame(28,-12,85,16,411,452)
		SpriteFrame(-77,12,76,16,411,469)
		SpriteFrame(8,12,70,16,156,435)
		break
	case 1
		if options.region==0
			SpriteFrame(-113,-12,53,16,411,435)
			SpriteFrame(-51,-12,70,16,156,452)
			SpriteFrame(28,-12,85,16,411,452)
			SpriteFrame(-77,12,76,16,411,469)
			SpriteFrame(8,12,70,16,156,452)
		else
			SpriteFrame(-113,-12,53,16,411,435)
			SpriteFrame(-51,-12,70,16,156,469)
			SpriteFrame(28,-12,85,16,411,452)
			SpriteFrame(-77,12,76,16,411,469)
			SpriteFrame(8,12,70,16,156,469)
		endif
		break
	case 2
		SpriteFrame(-134,-12,53,16,411,435)
		SpriteFrame(-73,-12,113,16,156,486)
		SpriteFrame(50,-12,85,16,411,452)
		SpriteFrame(-99,12,76,16,411,469)
		SpriteFrame(-14,12,113,16,156,486)
		break

	endswitch
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
