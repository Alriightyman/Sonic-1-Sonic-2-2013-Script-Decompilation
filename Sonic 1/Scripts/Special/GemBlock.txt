//--------------------Sonic 1 / Sonic 2 Gem Block Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 12: TYPE_GEMBLOCK

// Function declarations
#function GemBlock_DebugDraw
#function GemBlock_DebugSpawn

#static 0:GemBlock_staticVar15


function GemBlock_DebugDraw
	TempValue4=Object[0].Value10
	TempValue4-=GemBlock_staticVar15
	DrawSprite(TempValue4)
endfunction


function GemBlock_DebugSpawn
	TempValue4=Object[0].Value10
	TempValue4-=GemBlock_staticVar15
	TempValue5=12
	CallFunction(DebugMode_Function11)
	Object[ArrayPos0].DrawOrder=4
	Object[ArrayPos0].TypeGroup=257
endfunction


sub ObjectMain
	if Object.State==1
		Object.PropertyValue=Object.Value0
		Object.PropertyValue>>=1
		Object.PropertyValue&=3
		Object.Value0++
		if Object.Value0==16
			Object.Priority=PRIORITY_ACTIVE_BOUNDS
			Object.Value0=0
			Object.PropertyValue=Object.Value1
			Object.PropertyValue++
			if Object.PropertyValue==4
				Object.Type=TypeName[BlankObject]
			else
				Object.State=0
			endif
			SpecialSetup_staticVar12=0
		endif
		foreach TypeGroup[256],PlayerObjectPos
			CallFunction(SpecialSetup_Function10)
		floop
	else
		foreach TypeGroup[256],PlayerObjectPos
			CallFunction(SpecialSetup_Function10)
			if SpecialSetup_staticVar12==0
				if CheckResult>0
					Object.State=1
					Object.Priority=PRIORITY_ACTIVE
					SpecialSetup_staticVar12=1
					Object.Value1=Object.PropertyValue
					if PlayerObject_staticVar9==0
						PlaySfx(SFXName[GemBlock],0)
					endif
				endif
			endif
		floop
	endif
endsub


sub ObjectDraw
	CallFunction(SpecialSetup_Function9)
	TempValue2=SpecialSetup_staticVar10
	TempValue2/=5
	switch TempValue2
	case 0
		Object.Direction=FLIP_NONE
		break
	case 1
		Object.Direction=FLIP_X
		break
	case 2
		Object.Direction=FLIP_XY
		break
	case 3
		Object.Direction=FLIP_Y
		break

	endswitch
	DrawSpriteFX(Object.PropertyValue,FX_FLIP,TempValue0,TempValue1)
endsub


sub ObjectStartup
	LoadSpriteSheet("Special/Objects.gif")
	SpriteFrame(-12,-12,24,24,301,76)
	SpriteFrame(-12,-12,24,24,326,76)
	SpriteFrame(-12,-12,24,24,351,76)
	SpriteFrame(-12,-12,24,24,376,76)
	foreach TypeName[GemBlock],ArrayPos0
		Object[ArrayPos0].TypeGroup=257
	floop
	TempValue0=0
	GemBlock_staticVar15=DebugMode_DebugItemCount
	while TempValue0<4
		SetArrayValue(TypeName[GemBlock],DebugMode_DebugItemCount,DebugMode_DebugTypeList)
		SetArrayValue(GemBlock_DebugDraw,DebugMode_DebugItemCount,DebugMode_DebugDrawList)
		SetArrayValue(GemBlock_DebugSpawn,DebugMode_DebugItemCount,DebugMode_DebugSpawnList)
		DebugMode_DebugItemCount++
		TempValue0++
	loop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
