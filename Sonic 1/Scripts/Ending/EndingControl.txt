//--------------------Sonic 1 / Sonic 2 Ending Control Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 47: TYPE_ENDINGCONTROL




sub ObjectMain
	switch Object.State
	case 0
		PlayMusic(0)
		Object.State++
		Object[0].ControlMode=-1
		Object[0].Up=0
		Object[0].Down=0
		Object[0].Left=1
		Object[0].Right=0
		Object[0].JumpHold=0
		Object[0].JumpPress=0
		if options.superStates==0
			TempValue0=63
		else
			TempValue0=127
		endif
		if specialStage.emeralds>=TempValue0
			Object[0].XPos=Object[+1].XPos
			Object[0].YPos=Object[+1].YPos
		endif
		foreach TypeGroup[256],PlayerObjectPos
			if PlayerObjectPos==0
				Object[PlayerObjectPos].Speed=-0x60000
			else
				Object[PlayerObjectPos].Speed=-0x60000
				Object[PlayerObjectPos].XPos=Object[0].XPos
				Object[PlayerObjectPos].XPos+=0x400000
				Object[PlayerObjectPos].YPos=Object[0].YPos
				StopSfx(SFXName[Skidding])
			endif
		floop
		if Object.Value0>0
			Object.Value0-=16
		else
			TempValue0=424
			TempValue0+=Screen.CenterX
			Stage.NewXBoundary2=TempValue0
			Object.State++
		endif
		SetScreenFade(0,0,0,Object.Value0)
		break
	case 1
		Object[0].ControlMode=-1
		Object[0].Up=0
		Object[0].Down=0
		Object[0].Left=1
		Object[0].Right=0
		Object[0].JumpHold=0
		Object[0].JumpPress=0
		if options.superStates==0
			TempValue0=63
		else
			TempValue0=127
		endif
		if specialStage.emeralds>=TempValue0
			Object[0].XPos=Object[+1].XPos
			Object[0].YPos=Object[+1].YPos
		endif
		foreach TypeGroup[256],PlayerObjectPos
			if PlayerObjectPos==0
				Object[PlayerObjectPos].Speed=-0x60000
			else
				Object[PlayerObjectPos].Speed=-0x60000
				Object[PlayerObjectPos].XPos=Object[0].XPos
				Object[PlayerObjectPos].XPos+=0x400000
				Object[PlayerObjectPos].YPos=Object[0].YPos
				StopSfx(SFXName[Skidding])
			endif
		floop
		if Object.Value0>0
			Object.Value0-=16
		else
			TempValue0=424
			TempValue0+=Screen.CenterX
			Stage.NewXBoundary2=TempValue0
			Object.State++
		endif
		SetScreenFade(0,0,0,Object.Value0)
		break
	case 2
		TempValue0=Object.XPos
		TempValue0-=0x180000
		foreach TypeGroup[256],PlayerObjectPos
			if Object[PlayerObjectPos].Speed<-0x60000
				Object[PlayerObjectPos].Speed=-0x60000
			endif
			if Object[PlayerObjectPos].XPos<TempValue0
				Object[PlayerObjectPos].Left=0
				Object[PlayerObjectPos].Right=1
			endif
			if Object[PlayerObjectPos].XPos>Object.XPos
				if Object[PlayerObjectPos].Right==1
					Object[PlayerObjectPos].Right=0
					Object[PlayerObjectPos].Speed=0
					if PlayerObjectPos==PlayerObjectCount
						Object.State++
					else
						if PlayerObjectPos==0
							ResetObjectEntity(PlayerObjectPos,TypeName[EndingPose],0,Object.XPos,Object.YPos)
							Object[PlayerObjectPos].ControlMode=-1
							Object[PlayerObjectPos].DrawOrder=6
							if options.superStates==0
								TempValue0=63
							else
								TempValue0=127
							endif
							if specialStage.emeralds<TempValue0
								switch Stage.PlayerListPos
								case 0
								case 3
									Object[PlayerObjectPos].Frame=0
									break
								case 1
									Object[PlayerObjectPos].Frame=13
									break
								case 2
									Object[PlayerObjectPos].Frame=24
									break

								endswitch
							else
								switch Stage.PlayerListPos
								case 0
								case 3
									Object[PlayerObjectPos].Frame=4
									break
								case 1
									Object[PlayerObjectPos].Frame=16
									break
								case 2
									Object[PlayerObjectPos].Frame=27
									break

								endswitch
								Object[PlayerObjectPos].State=5
							endif
							Object[PlayerObjectPos].Value1=224
						endif
					endif
				endif
			endif
		floop
		break

	endswitch
endsub


sub ObjectStartup
	foreach TypeName[EndingControl],ArrayPos0
		Object[ArrayPos0].Priority=PRIORITY_ACTIVE
		Object[ArrayPos0].Value0=272
	floop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
