//--------------------Sonic 1 / Sonic 2 EndingPose Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 48: TYPE_ENDINGPOSE

// Function declarations
#function EndingPose_Function107



function EndingPose_Function107
	if Object.Value1>0
		Object.Value1-=16
	endif
endfunction


sub ObjectMain
	switch Object.State
	case 0
		Object.State++
		if Stage.PlayerListPos==1
			Object.Value2=36
		endif
		Object.Value0++
		if Stage.PlayerListPos==1
			Object.Value2=Object.Value0
			Object.Value2>>=3
			Object.Value2%=5
			Object.Value2+=36
		endif
		if Object.Value0==240
			PlayerObjectPos=1
			while PlayerObjectPos<PlayerObjectCount
				ResetObjectEntity(PlayerObjectPos,TypeName[EndingPose],0,Object[PlayerObjectPos].XPos,Object[PlayerObjectPos].YPos)
				Object[PlayerObjectPos].DrawOrder=6
				Object[PlayerObjectPos].State=14
				Object[PlayerObjectPos].Frame=43
				Object[PlayerObjectPos].Direction=FLIP_X
				PlayerObjectPos++
			loop
			Object.Value0=0
			switch Stage.PlayerListPos
			case 0
			case 3
				Object.Frame=1
				break
			case 1
				Object.Frame=14
				break
			case 2
				Object.Frame=25
				break

			endswitch
			Object.State++
			Object.Value2=0
		else
			PlayerObjectPos=1
			while PlayerObjectPos<PlayerObjectCount
				if Object[PlayerObjectPos].Speed==0
					Object[PlayerObjectPos].Direction=FLIP_X
				endif
				PlayerObjectPos++
			loop
		endif
		break
	case 1
		Object.Value0++
		if Stage.PlayerListPos==1
			Object.Value2=Object.Value0
			Object.Value2>>=3
			Object.Value2%=5
			Object.Value2+=36
		endif
		if Object.Value0==240
			PlayerObjectPos=1
			while PlayerObjectPos<PlayerObjectCount
				ResetObjectEntity(PlayerObjectPos,TypeName[EndingPose],0,Object[PlayerObjectPos].XPos,Object[PlayerObjectPos].YPos)
				Object[PlayerObjectPos].DrawOrder=6
				Object[PlayerObjectPos].State=14
				Object[PlayerObjectPos].Frame=43
				Object[PlayerObjectPos].Direction=FLIP_X
				PlayerObjectPos++
			loop
			Object.Value0=0
			switch Stage.PlayerListPos
			case 0
			case 3
				Object.Frame=1
				break
			case 1
				Object.Frame=14
				break
			case 2
				Object.Frame=25
				break

			endswitch
			Object.State++
			Object.Value2=0
		else
			PlayerObjectPos=1
			while PlayerObjectPos<PlayerObjectCount
				if Object[PlayerObjectPos].Speed==0
					Object[PlayerObjectPos].Direction=FLIP_X
				endif
				PlayerObjectPos++
			loop
		endif
		break
	case 2
		CallFunction(EndingPose_Function107)
		Object.Value0++
		if Object.Value0==12
			Object.Value0=0
			switch Stage.PlayerListPos
			case 0
			case 3
				Object.Frame=2
				Object.iXPos=Screen.CameraXPos
				Object.iYPos=Screen.CameraYPos
				break
			case 1
			case 2
				break

			endswitch
			Object.State++
		endif
		break
	case 3
		CallFunction(EndingPose_Function107)
		Object.Value0++
		if Object.Value0==4
			Object.Value0=-0x618
			switch Stage.PlayerListPos
			case 0
			case 3
				Object.Frame=3
				break
			case 1
				Object.Frame=15
				Object.iXPos=Screen.CameraXPos
				Object.iYPos=Screen.CameraYPos
				break
			case 2
				Object.Frame=26
				Object.iXPos=Screen.CameraXPos
				Object.iYPos=Screen.CameraYPos
				break

			endswitch
			Object.State++
		endif
		break
	case 4
		if Object.Value0<320
			Object.Value0+=12
		else
			Stage.ActiveList=PRESENTATION_STAGE
			Stage.ListPos=2
			lampPostID=0
			recMilliSeconds=0
			recSeconds=0
			recMinutes=0
			LoadStage()
		endif
		if Object.Value0>0
			TempValue0=Object.Value0
		else
			TempValue0=0
		endif
		SetScreenFade(0,0,0,TempValue0)
		break
	case 5
		Object.Value0++
		if Object.Value0==80
			Object.Value0=0
			Object.State++
		else
			switch Stage.PlayerListPos
			case 0
			case 3
				Object.Frame=4
				break
			case 1
				Object.Frame=16
				break
			case 2
				Object.Frame=27
				break

			endswitch
			PlayerObjectPos=1
			while PlayerObjectPos<PlayerObjectCount
				if Object[PlayerObjectPos].Speed==0
					Object[PlayerObjectPos].Direction=FLIP_X
				endif
				PlayerObjectPos++
			loop
		endif
		break
	case 6
		Object.Frame=Object.Value0
		Object.Frame>>=2
		Object.Frame&=1
		switch Stage.PlayerListPos
		case 0
		case 3
			Object.Frame+=5
			break
		case 1
			Object.Frame+=17
			break
		case 2
			Object.Frame+=27
			break

		endswitch
		Object.Value0++
		if Object.Value0==80
			Object.Value0=0
			switch Stage.PlayerListPos
			case 0
			case 3
				Object.Frame=7
				break
			case 1
				Object.Frame=19
				break
			case 2
				Object.Frame=29
				break

			endswitch
			PlayerObjectPos=1
			while PlayerObjectPos<PlayerObjectCount
				Object[PlayerObjectPos].Up=1
				Object[PlayerObjectPos].ControlMode=-1
				PlayerObjectPos++
			loop
			CreateTempObject(TypeName[Emeralds],0,Object.XPos,Object.YPos)
			Object[TempObjectPos].DrawOrder=6
			Object.State++
		else
			PlayerObjectPos=1
			while PlayerObjectPos<PlayerObjectCount
				if Object[PlayerObjectPos].Speed==0
					Object[PlayerObjectPos].Direction=FLIP_X
				endif
				PlayerObjectPos++
			loop
		endif
		break
	case 7
		break
	case 8
		if Object.Value0<384
			Object.Value0+=6
		else
			Object.Value0=256
			SetTileLayerEntry(184,0,2,2)
			SetTileLayerEntry(185,0,3,2)
			SetTileLayerEntry(186,0,2,3)
			SetTileLayerEntry(187,0,3,3)
			SetTileLayerEntry(188,0,4,2)
			SetTileLayerEntry(189,0,5,2)
			SetTileLayerEntry(190,0,4,3)
			SetTileLayerEntry(191,0,5,3)
			Object.State++
		endif
		SetScreenFade(208,255,224,Object.Value0)
		break
	case 9
		if Object.Value0>0
			Object.Value0-=16
			SetScreenFade(208,255,224,Object.Value0)
		else
			switch Stage.PlayerListPos
			case 0
			case 3
				Object.Frame=8
				break
			case 1
				Object.Frame=20
				break
			case 2
				Object.Frame=30
				break

			endswitch
			Object.State++
			PlayerObjectPos=1
			while PlayerObjectPos<PlayerObjectCount
				ResetObjectEntity(PlayerObjectPos,TypeName[EndingPose],0,Object[PlayerObjectPos].XPos,Object[PlayerObjectPos].YPos)
				Object[PlayerObjectPos].DrawOrder=6
				Object[PlayerObjectPos].State=12
				Object[PlayerObjectPos].Frame=43
				Object[PlayerObjectPos].Direction=FLIP_X
				PlayerObjectPos++
			loop
		endif
		break
	case 10
		switch Stage.PlayerListPos
		case 0
		case 3
			Object.Frame=Object.Value0
			Object.Frame/=6
			Object.Frame&=1
			Object.Frame+=8
			break
		case 1
			Object.Frame=Object.Value0
			Object.Frame/=10
			Object.Frame&=3
			Object.Frame+=20
			if Object.Value0>=40
				Object.Frame=23
			endif
			break
		case 2
			Object.Frame=Object.Value0
			Object.Frame/=10
			Object.Frame&=3
			Object.Frame+=30
			if Object.Value0>=40
				Object.Frame=34
			endif
			break

		endswitch
		Object.Value0++
		if Object.Value0==42
			Object.Value0=0
			Object.State++
		endif
		break
	case 11
		Object.Value0++
		if Object.Value0==60
			Object.Value0=0
			switch Stage.PlayerListPos
			case 0
			case 3
				Object.Frame=1
				break
			case 1
				Object.Frame=14
				break
			case 2
				Object.Frame=25
				break

			endswitch
			Object.State=2
		endif
		break
	case 12
		Object.Frame=Object.Value0
		Object.Frame/=10
		Object.Frame&=3
		Object.Frame+=20
		if Object.Value0>=40
			Object.Frame=23
		endif
		Object.Value0++
		if Object.Value0==42
			Object.Value0=0
			Object.State++
		endif
		break
	case 13
		Object.Value0++
		if Object.Value0==60
			Object.Value0=0
			Object.Frame=43
			Object.State++
		endif
		break
	case 14
		Object.Value0++
		if Object.Value0==8
			Object.Frame++
			Object.Value0=0
			Object.State++
		endif
		break

	endswitch
endsub


sub ObjectDraw
	if Object.Value2!=0
		DrawSprite(Object.Value2)
	endif
	DrawSpriteFX(Object.Frame,FX_FLIP,Object.XPos,Object.YPos)
	if Object.EntityNo==0
		if Object.State>0
			TempValue0=Screen.CenterX
			TempValue0-=96
			TempValue0-=Object.Value1
			if stage.player2Enabled==1
				if options.region==1
					TempValue1=42
				else
					TempValue1=41
				endif
			else
				TempValue1=10
				if Stage.PlayerListPos<3
					TempValue1+=Stage.PlayerListPos
				endif
			endif
			DrawSpriteScreenXY(TempValue1,TempValue0,80)
		endif
	endif
endsub


sub ObjectStartup
	LoadSpriteSheet("Ending/Objects.gif")
	SpriteFrame(-14,-20,30,39,28,16)
	SpriteFrame(-16,-16,32,35,3,220)
	SpriteFrame(-18,-27,44,71,36,184)
	SpriteFrame(-56,-68,174,134,81,121)
	SpriteFrame(-10,-21,24,40,3,16)
	SpriteFrame(-10,-21,24,40,3,16)
	SpriteFrame(-14,-21,28,40,3,57)
	SpriteFrame(-16,-20,29,39,3,98)
	SpriteFrame(-16,-21,32,40,3,138)
	SpriteFrame(-16,-21,32,40,3,179)
	SpriteFrame(-48,0,96,31,256,141)
	SpriteFrame(-48,-17,96,48,256,182)
	SpriteFrame(-48,-17,96,48,256,124)
	SpriteFrame(-10,-13,24,31,288,16)
	SpriteFrame(-19,-12,33,31,254,16)
	SpriteFrame(-55,-48,111,96,400,1)
	SpriteFrame(-12,-16,27,34,313,16)
	SpriteFrame(-12,-16,27,34,59,16)
	SpriteFrame(-15,-16,30,34,87,16)
	SpriteFrame(-15,-14,31,32,118,16)
	SpriteFrame(-12,-16,25,34,150,16)
	SpriteFrame(-12,-16,25,34,176,16)
	SpriteFrame(-12,-16,25,34,202,16)
	SpriteFrame(-12,-16,25,34,228,16)
	SpriteFrame(-14,-23,27,41,325,57)
	SpriteFrame(-16,-21,28,39,296,57)
	SpriteFrame(-32,-52,64,104,448,98)
	SpriteFrame(-12,-23,24,41,32,57)
	SpriteFrame(-16,-23,28,41,57,57)
	SpriteFrame(-18,-22,45,40,86,57)
	SpriteFrame(-16,-23,33,41,132,57)
	SpriteFrame(-16,-23,33,41,166,57)
	SpriteFrame(-16,-23,33,41,200,57)
	SpriteFrame(-16,-23,33,41,200,57)
	SpriteFrame(-16,-23,27,41,268,57)
	SpriteFrame(-16,-23,33,41,234,57)
	SpriteFrame(-21,-6,16,24,256,99)
	SpriteFrame(-25,-6,20,24,273,99)
	SpriteFrame(-25,-6,20,24,294,99)
	SpriteFrame(-25,-6,20,24,315,99)
	SpriteFrame(-25,-6,20,24,336,99)
	SpriteFrame(-48,0,96,40,256,141)
	SpriteFrame(-48,0,96,40,256,199)
	SpriteFrame(-10,-13,22,31,58,99)
	SpriteFrame(-20,-17,36,35,44,131)
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
