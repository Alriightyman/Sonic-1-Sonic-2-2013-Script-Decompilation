//--------------------Sonic 1 / Sonic 2 Eggman Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 59: TYPE_EGGMAN

// Function declarations
#function Eggman_Function135


#array Eggman_array52:(-32,-40,-48,-64,-80,-96,-112,-120,-119,-120)

function Eggman_Function135
	Object.YPos=Object.Value1
	Sin256(TempValue0,Object.Value2)
	TempValue0<<=9
	Object.YPos+=TempValue0
	Object.Value2+=4
	Object.Value2&=255
endfunction


sub ObjectMain
	switch Object.State
	case 0
		TempValue0=Object.iXPos
		TempValue0-=352
		Stage.NewXBoundary1=TempValue0
		TempValue0=Object.iXPos
		TempValue0+=96
		Stage.NewXBoundary2=TempValue0
		TempValue0=Object.XPos
		TempValue0-=0xC00000
		if Object[0].XPos>=TempValue0
			Object.Animation=1
			ResetObjectEntity(26,TypeName[MusicEvent],0,0,0)
			Object[26].Priority=PRIORITY_ACTIVE
			Object.Value1=Object.YPos
			Object.Value12=Object.XPos
			Object.Value11=Object.Value12
			Object.Value11-=0x1000000
			Object.Value10=Object.Value11
			Object.Value10+=0x800000
			Object.Value13=Object.YPos
			Object.Value13+=0x260000
			Object.Value14=Object.YPos
			Object.Value14+=0xF0000
			Object.Value4=144
			Object.Value2=128
			Object.Value15=7
			Object.Value7=8
			Object.Priority=PRIORITY_ACTIVE
			Object.State++
		endif
		break
	case 1
		Object.Value1-=0xE000
		Object.YPos-=0xE000
		Object.Value4--
		if Object.Value4==0
			Object.State=2
		endif
		break
	case 2
		CallFunction(Eggman_Function135)
		if Object.Value2==64
			if Object.Value4==0
				Object.Value4++
			else
				Object.State=3
			endif
		endif
		if Object.Value4==1
			Object.Value6++
			switch Object.Value6
			case 1
				PlaySfx(SFXName[FireDash],0)
				Object.Value5=9
				break
			case 3
				Object.Value5=10
				break
			case 6
				Object.Value5=11
				break
			case 9
				Object.Value5=12
				break
			case 13
				Object.Value5=13
				break
			case 17
				Object.Value5=14
				break
			case 22
				Object.Value5=15
				break
			case 25
				CreateTempObject(TypeName[EggmanFireball1],0,Object.XPos,Object.YPos)
				if Object.Direction==FLIP_NONE
					Object[TempObjectPos].XPos-=0x680000
					Object[TempObjectPos].XVelocity=-0x40000
				else
					Object[TempObjectPos].XPos+=0x680000
					Object[TempObjectPos].XVelocity=0x40000
				endif
				Object[TempObjectPos].YPos-=0x1D0000
				Object[TempObjectPos].Direction=Object.Direction
				break
			case 27
				Object.Value5=16
				break
			case 33
				Object.Value5=17
				break
			case 39
				Object.Value5=18
				break
			case 46
				Object.Value4=2
				Object.Value6=0
				break

			endswitch
		endif
		break
	case 3
		Object.Value1+=0xE000
		Object.YPos+=0xE000
		Object.Value4++
		if Object.XPos<Object.Value10
			TempValue0=36
			TempValue1=-0x54000
		else
			TempValue0=84
			TempValue1=-0x64000
		endif
		if Object.Value4==TempValue0
			PlaySfx(SFXName[SmallFireball],0)
			CreateTempObject(TypeName[EggmanFireball2],0,Object.XPos,Object.YPos)
			Object[TempObjectPos].XVelocity=-0x1C000
			Object[TempObjectPos].YVelocity=TempValue1
			CreateTempObject(TypeName[EggmanFireball2],0,Object.XPos,Object.YPos)
			Object[TempObjectPos].XVelocity=0x1C000
			Object[TempObjectPos].YVelocity=TempValue1
		endif
		if Object.Value4==160
			if Object[0].XPos<Object.Value10
				Object.XPos=Object.Value11
				Object.YPos=Object.Value13
				Object.Value1=Object.Value13
			else
				Object.XPos=Object.Value12
				Object.YPos=Object.Value14
				Object.Value1=Object.Value14
			endif
			if Object[0].XPos<Object.XPos
				Object.Direction=FLIP_NONE
			else
				Object.Direction=FLIP_X
			endif
			Object.Value2=128
			Object.State=1
		endif
		break
	case 4
		Object.Value4++
		if Object.Value4==120
			Object.Value15=8
		endif
		if Object.Value4==180
			Object.Value4=0
			Object.Animation=5
			Object.Value9=0
			Object.State++
			ResetObjectEntity(26,TypeName[MusicEvent],1,0,0)
			Object[26].Priority=PRIORITY_ACTIVE
			TempValue0=TileLayer[0].XSize
			TempValue0<<=7
			Stage.NewXBoundary2=TempValue0
		endif
		break
	case 5
		Object.Value1+=0x10000
		CallFunction(Eggman_Function135)
		if Object.OutOfBounds==1
			Object.Type=TypeName[BlankObject]
			Object.Priority=PRIORITY_ACTIVE_BOUNDS
		endif
		break

	endswitch
	if Object[0].Gravity==GRAVITY_GROUND
		Object.Value16=0
	endif
	if Object.Value7!=0
		if Object.Value8>0
			Object.Value8--
			GetBit(TempValue0,Object.Value8,0)
			if TempValue0==1
				SetPaletteEntry(0,192,0xE0E0E0)
			else
				SetPaletteEntry(0,192,0)
			endif
		endif
		foreach TypeGroup[256],PlayerObjectPos
			if Object.Value8==0
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_HURT)
				TempValue0=CheckResult
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_DYING)
				TempValue0|=CheckResult
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_DROWNING)
				TempValue0|=CheckResult
				if TempValue0!=0
					if Object.Animation!=2
						Object.Animation=2
						Object.AnimationTimer=0
					endif
				endif
				PlayerObjectCollision(C_TOUCH,Object.EntityNo,-24,-24,24,22,PlayerObjectPos,Object[PlayerObjectPos].Value40,Object[PlayerObjectPos].Value38,Object[PlayerObjectPos].Value41,Object[PlayerObjectPos].Value39)
				if CheckResult==1
					CallFunction(PlayerObject_Function43)
					if CheckResult==1
						Object.Value7--
						if Object.Value7==0
							player.score+=1000
							Object.Animation=4
							Object.AnimationTimer=0
							Object.Value9=1
							Object.Value1=Object.YPos
							Object.State=4
							Object.Value6=0
							Object.Value5=0
							if Object.Value16>=7
								if Stage.DebugMode==0
									EngineCallback(SetAchievement,5,100)
								endif
							endif
						else
							Object.Animation=3
							Object.AnimationTimer=0
							Object.Value8=32
							PlaySfx(SFXName[BossHit],0)
							if PlayerObjectPos==0
								if Object[0].Gravity==GRAVITY_AIR
									Object.Value16++
								endif
							endif
						endif
					endif
				else
					if Object.Value6!=0
						TempValue1=Object.Value5
						TempValue1-=8
						if TempValue1<=7
							GetArrayValue(TempValue0,TempValue1,Eggman_array52)
							if Object.Direction==FLIP_NONE
								PlayerObjectCollision(C_TOUCH,Object.EntityNo,TempValue0,-32,-24,-29,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
							else
								FlipSign(TempValue0)
								PlayerObjectCollision(C_TOUCH,Object.EntityNo,24,-32,TempValue0,-29,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
							endif
							if CheckResult==1
								CallFunction(PlayerObject_Function46)
							endif
						endif
					endif
				endif
			endif
		floop
	endif
	if Object.State!=5
		foreach TypeGroup[256],PlayerObjectPos
			TempValue0=Object[PlayerObjectPos].CollisionRight
			TempValue0<<=16
			TempValue0+=Object[PlayerObjectPos].XPos
			TempValue1=Stage.XBoundary2
			TempValue1<<=16
			if TempValue0>TempValue1
				Object[PlayerObjectPos].XVelocity=0
				Object[PlayerObjectPos].Speed=0
				Object[PlayerObjectPos].XPos=TempValue1
				TempValue0=Object[PlayerObjectPos].CollisionRight
				TempValue0<<=16
				Object[PlayerObjectPos].XPos-=TempValue0
			endif
		floop
	endif
	if Object.Value9!=0
		TempValue0=oscillation
		TempValue0&=7
		if TempValue0==0
			Rand(TempValue0,48)
			TempValue0-=24
			TempValue0<<=16
			TempValue0+=Object.XPos
			Rand(TempValue1,48)
			TempValue1-=24
			TempValue1<<=16
			TempValue1+=Object.YPos
			CreateTempObject(TypeName[Explosion],0,TempValue0,TempValue1)
			Object[TempObjectPos].DrawOrder=5
			PlaySfx(SFXName[Explosion],0)
		endif
	endif
	if Object.Value15==8
		TempValue0=oscillation
		TempValue0&=31
		if TempValue0==0
			CreateTempObject(TypeName[EggmanSmokePuff],0,Object.XPos,Object.YPos)
			Object[TempObjectPos].YPos-=0x280000
			Object[TempObjectPos].XVelocity-=0x6000
			Object[TempObjectPos].YVelocity-=0xC000
		endif
	endif
endsub


sub ObjectDraw
	if Object.Value6!=0
		DrawSpriteFX(Object.Value5,FX_FLIP,Object.XPos,Object.YPos)
	endif
	switch Object.Animation
	case 1
		TempValue0=Object.AnimationTimer
		TempValue0>>=3
		Object.AnimationTimer++
		Object.AnimationTimer&=15
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 2
		TempValue0=Object.AnimationTimer
		TempValue0&=15
		TempValue0>>=3
		TempValue0+=2
		Object.AnimationTimer++
		if Object.AnimationTimer==50
			Object.AnimationTimer=0
			if Object[0].Animation!=ANI_DYING
				Object.Animation=1
			endif
		endif
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 3
		TempValue0=Object.AnimationTimer
		TempValue0&=1
		TempValue0+=2
		Object.AnimationTimer++
		if Object.AnimationTimer==50
			Object.AnimationTimer=0
			Object.Animation=1
		endif
		DrawSpriteFX(4,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 4
		TempValue0=Object.AnimationTimer
		TempValue0>>=5
		TempValue0+=4
		TempValue0%=5
		Object.AnimationTimer++
		Object.AnimationTimer&=63
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 5
		DrawSpriteFX(5,FX_FLIP,Object.XPos,Object.YPos)
		break

	endswitch
	DrawSpriteFX(6,FX_FLIP,Object.XPos,Object.YPos)
	DrawSpriteFX(Object.Value15,FX_FLIP,Object.XPos,Object.YPos)
endsub


sub ObjectStartup
	CheckStageFolder("Zone05")
	if CheckResult==1
		LoadSpriteSheet("HTZ/Objects.gif")
		SpriteFrame(-15,-10,17,7,66,108)
		SpriteFrame(-15,-10,17,7,66,116)
		SpriteFrame(-15,-10,17,7,66,124)
		SpriteFrame(-15,-10,17,7,66,132)
		SpriteFrame(-15,-10,17,7,66,140)
		SpriteFrame(-15,-10,17,7,66,148)
		SpriteFrame(-32,-12,64,45,1,210)
		SpriteFrame(-24,-36,40,24,9,186)
		SpriteFrame(-16,-20,32,8,17,132)
		SpriteFrame(-32,-32,8,6,1,124)
		SpriteFrame(-40,-33,16,7,10,124)
		SpriteFrame(-48,-33,24,8,1,54)
		SpriteFrame(-64,-33,40,8,1,63)
		SpriteFrame(-80,-33,56,8,1,72)
		SpriteFrame(-96,-33,72,8,1,81)
		SpriteFrame(-112,-33,88,8,1,90)
		SpriteFrame(-120,-33,88,8,1,99)
		SpriteFrame(-119,-33,63,8,1,108)
		SpriteFrame(-120,-32,31,6,1,117)
		if options.vsMode==1
			foreach TypeName[Eggman],ArrayPos0
				Object[ArrayPos0].Type=TypeName[BlankObject]
			floop
		endif
	else
		LoadSpriteSheet("MBZ/Objects.gif")
		SpriteFrame(-15,-10,17,7,1007,34)
		SpriteFrame(-15,-10,17,7,1007,42)
		SpriteFrame(-15,-10,17,7,1007,50)
		SpriteFrame(-15,-10,17,7,1007,58)
		SpriteFrame(-15,-10,17,7,1007,66)
		SpriteFrame(-15,-10,17,7,1007,74)
		SpriteFrame(-32,-12,64,45,415,154)
		SpriteFrame(-24,-36,40,24,423,130)
		SpriteFrame(-16,-20,32,8,480,170)
		SpriteFrame(-32,-32,8,6,877,116)
		SpriteFrame(-40,-33,16,7,886,116)
		SpriteFrame(-48,-33,24,8,982,46)
		SpriteFrame(-64,-33,40,8,966,55)
		SpriteFrame(-80,-33,56,8,950,64)
		SpriteFrame(-96,-33,72,8,934,73)
		SpriteFrame(-112,-33,88,8,919,82)
		SpriteFrame(-120,-33,88,8,919,91)
		SpriteFrame(-119,-33,63,8,877,100)
		SpriteFrame(-120,-32,31,6,877,109)
	endif
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
