//--------------------Sonic 1 / Sonic 2 Moving Spikes Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 49: TYPE_MOVINGSPIKES

// Function declarations
#function MovingSpikes_Function119
#function MovingSpikes_Function120
#function MovingSpikes_Function121



function MovingSpikes_Function119
	DrawSprite(0)
endfunction


function MovingSpikes_Function120
	CreateTempObject(TypeName[MovingSpikes],0,Object.XPos,Object.YPos)
	Object[TempObjectPos].InkEffect=INK_BLEND
	Object[TempObjectPos].DrawOrder=5
	if Object.Direction==FLIP_X
		Object[TempObjectPos].XPos+=0x680000
		Object[TempObjectPos].XVelocity=-0x10000
		Object[TempObjectPos].Value0=104
	else
		Object[TempObjectPos].XPos-=0x680000
		Object[TempObjectPos].XVelocity=0x10000
		Object[TempObjectPos].Value0=-104
	endif
endfunction


function MovingSpikes_Function121
	TempValue0=Object.XPos
	TempValue0>>=16
	TempValue0-=Screen.CameraXPos
	Absolute(TempValue0)
	TempValue0-=32
	if TempValue0<Screen.CenterX
		TempValue0=Object.YPos
		TempValue0>>=16
		TempValue0-=Screen.CameraYPos
		Absolute(TempValue0)
		if TempValue0<160
			PlaySfx(SFXName[Clank],0)
		endif
	endif
endfunction


sub ObjectMain
	Object.XPos+=Object.XVelocity
	if Object.XVelocity>0
		Object.Value0++
		if Object.Value0==104
			FlipSign(Object.XVelocity)
			CallFunction(MovingSpikes_Function121)
		else
			foreach TypeGroup[49],ArrayPos0
				if ArrayPos0!=Object.EntityNo
					PlayerObjectCollision(C_TOUCH,Object.EntityNo,0,-40,25,40,ArrayPos0,-25,-40,0,40)
					if CheckResult==1
						FlipSign(Object.XVelocity)
						CallFunction(MovingSpikes_Function121)
					endif
				endif
			floop
		endif
	else
		Object.Value0--
		if Object.Value0==-104
			FlipSign(Object.XVelocity)
			CallFunction(MovingSpikes_Function121)
		else
			foreach TypeGroup[49],ArrayPos0
				if ArrayPos0!=Object.EntityNo
					PlayerObjectCollision(C_TOUCH,Object.EntityNo,-25,-40,0,40,ArrayPos0,0,-40,25,40)
					if CheckResult==1
						FlipSign(Object.XVelocity)
						CallFunction(MovingSpikes_Function121)
					endif
				endif
			floop
		endif
	endif
	foreach TypeGroup[256],PlayerObjectPos
		PlayerObjectCollision(C_TOUCH,Object.EntityNo,-16,-32,16,32,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
		if CheckResult==1
			CallFunction(PlayerObject_Function45)
		endif
	floop
endsub


sub ObjectDraw
	DrawSpriteFX(1,FX_INK,Object.XPos,Object.YPos)
	DrawSprite(0)
endsub


sub ObjectStartup
	LoadSpriteSheet("OOZ/Objects.gif")
	SpriteFrame(-24,-40,48,80,206,26)
	SpriteFrame(8,-16,4,32,239,107)
	foreach TypeName[MovingSpikes],ArrayPos0
		Object[ArrayPos0].Priority=PRIORITY_INACTIVE
		Object[ArrayPos0].InkEffect=INK_BLEND
		Object[ArrayPos0].DrawOrder=5
		if Object[ArrayPos0].PropertyValue==1
			Object[ArrayPos0].XPos+=0x680000
			Object[ArrayPos0].XVelocity=-0x10000
			Object[ArrayPos0].Value0=104
		else
			if Object[ArrayPos0].PropertyValue==0
				Object[ArrayPos0].XPos-=0x680000
				Object[ArrayPos0].XVelocity=0x10000
				Object[ArrayPos0].Value0=-104
			else
				Object[ArrayPos0].XVelocity=-0x10000
			endif
		endif
	floop
	SetArrayValue(49,DebugMode_constant25,DebugMode_array12)
	SetArrayValue(119,DebugMode_constant25,DebugMode_array13)
	SetArrayValue(120,DebugMode_constant25,DebugMode_array11)
	DebugMode_constant25++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
