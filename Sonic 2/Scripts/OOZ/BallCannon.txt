//--------------------Sonic 1 / Sonic 2 Ball Cannon Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 52: TYPE_BALLCANNON

// Function declarations
#function BallCannon_Function126
#function BallCannon_Function127



//Unknown Variables
#constant 6:constant0x12499
#constant 0:constant0x1249A
#constant 0:constant0x1249B
#constant 1:constant0x1249C
#constant 0:constant0x1249D
#constant 2:constant0x1249E
#constant 0:constant0x1249F
#constant 6:constant0x124A0
#constant 0:constant0x124A1
#constant 2:constant0x124A2
#constant 1:constant0x124A3
#constant 2:constant0x124A4
#constant 2:constant0x124A5
#constant 2:constant0x124A6
#constant 6:constant0x124A7
#constant 3:constant0x124A8
#constant 1:constant0x124A9
#constant 4:constant0x124AA
#constant 1:constant0x124AB
#constant 5:constant0x124AC
#constant 1:constant0x124AD
#constant 6:constant0x124AE
#constant 3:constant0x124AF
#constant 0:constant0x124B0
#constant 4:constant0x124B1
#constant 0:constant0x124B2
#constant 5:constant0x124B3
#constant 0:constant0x124B4
#constant 8:constant0x124B5
#constant 6:constant0x124B6
#constant 7:constant0x124B7
#constant 8:constant0x124B8
#constant 9:constant0x124B9
#constant 10:constant0x124BA
#constant 11:constant0x124BB
#constant 12:constant0x124BC
#constant 13:constant0x124BD
#constant 8:constant0x124BE
#constant 13:constant0x124BF
#constant 12:constant0x124C0
#constant 11:constant0x124C1
#constant 10:constant0x124C2
#constant 9:constant0x124C3
#constant 8:constant0x124C4
#constant 7:constant0x124C5
#constant 6:constant0x124C6
#constant 0:constant0x124C7

function BallCannon_Function126
	TempValue0=Object[0].Value17
	TempValue0-=BallCannon_constant36
	DrawSprite(TempValue0)
endfunction


function BallCannon_Function127
	TempValue0=Object[0].Value17
	TempValue0-=BallCannon_constant36
	CreateTempObject(TypeName[BallCannon],TempValue0,Object.XPos,Object.YPos)
	Object[TempObjectPos].DrawOrder=4
	Object[TempObjectPos].Value2=0x12499
	Object[TempObjectPos].Value3=0x124AE
	Object[TempObjectPos].Value4=0x124BE
	Object[TempObjectPos].XVelocity=0x100000
	Object[TempObjectPos].YVelocity=0
	Object[TempObjectPos].Value6=1
	switch Object[TempObjectPos].PropertyValue
	case 0
		Object[TempObjectPos].Value2=0x12499
		Object[TempObjectPos].Value3=0x124AE
		Object[TempObjectPos].Value4=0x124BE
		Object[TempObjectPos].XVelocity=0x100000
		Object[TempObjectPos].YVelocity=0
		break
	case 1
		Object[TempObjectPos].Value2=0x124AE
		Object[TempObjectPos].Value3=0x124A0
		Object[TempObjectPos].Value4=0x124BE
		Object[TempObjectPos].XVelocity=0
		Object[TempObjectPos].YVelocity=0x100000
		break
	case 2
		Object[TempObjectPos].Value2=0x124A0
		Object[TempObjectPos].Value3=0x124A7
		Object[TempObjectPos].Value4=0x124BE
		Object[TempObjectPos].XVelocity=-0x100000
		Object[TempObjectPos].YVelocity=0
		break
	case 3
		Object[TempObjectPos].Value2=0x124A7
		Object[TempObjectPos].Value3=0x12499
		Object[TempObjectPos].Value4=0x124BE
		Object[TempObjectPos].XVelocity=0
		Object[TempObjectPos].YVelocity=-0x100000
		break
	case 4
		Object[TempObjectPos].Value2=0x124AE
		Object[TempObjectPos].Value3=0x12499
		Object[TempObjectPos].Value4=0x124B5
		Object[TempObjectPos].XVelocity=0
		Object[TempObjectPos].YVelocity=-0x100000
		break
	case 5
		Object[TempObjectPos].Value2=0x124A0
		Object[TempObjectPos].Value3=0x124AE
		Object[TempObjectPos].Value4=0x124B5
		Object[TempObjectPos].XVelocity=0x100000
		Object[TempObjectPos].YVelocity=0
		break
	case 6
		Object[TempObjectPos].Value2=0x124A7
		Object[TempObjectPos].Value3=0x124A0
		Object[TempObjectPos].Value4=0x124B5
		Object[TempObjectPos].XVelocity=0
		Object[TempObjectPos].YVelocity=0x100000
		break
	case 7
		Object[TempObjectPos].Value2=0x12499
		Object[TempObjectPos].Value3=0x124A7
		Object[TempObjectPos].Value4=0x124B5
		Object[TempObjectPos].XVelocity=-0x100000
		Object[TempObjectPos].YVelocity=0
		break

	endswitch
endfunction


sub ObjectMain
	switch Object.State
	case 1
		if Object.Value0==0
			if Object.Value1==6
				Object.Value1=0
				Object.Value0=3
				Object.State++
			else
				GetArrayValue(Object.Frame,Object.Value1,Object.Value2)
				Object.Value1++
				GetArrayValue(Object.Direction,Object.Value1,Object.Value2)
				Object.Value1++
			endif
		endif
		Object.Value0++
		Object.Value0&=3
		break
	case 2
		if Object.Value0==0
			if Object.Value1==8
				Object.Value1=5
				Object.Value0=1
				Object.State++
			else
				GetArrayValue(Object.Frame,Object.Value1,Object.Value4)
				Object.Direction=FLIP_NONE
				Object.Value1++
			endif
		endif
		Object.Value0++
		Object.Value0&=1
		break
	case 3
		if Object.Value0==0
			if Object.Value1<0
				Object.Value1=0
				Object.State++
				foreach TypeGroup[256],PlayerObjectPos
					TempValue0=1
					TempValue0<<=PlayerObjectPos
					TempValue0&=Object.Value5
					if TempValue0!=0
						if Object.Value6==1
							Object[PlayerObjectPos].State=12
							Object[PlayerObjectPos].Gravity=GRAVITY_AIR
							Object[PlayerObjectPos].Value35=0
							Object[PlayerObjectPos].TileCollisions=1
						endif
						Object[PlayerObjectPos].Visible=1
						Object[PlayerObjectPos].Value1=0
						Object[PlayerObjectPos].Speed=Object.XVelocity
						Object[PlayerObjectPos].XVelocity=Object.XVelocity
						Object[PlayerObjectPos].YVelocity=Object.YVelocity
					endif
				floop
			else
				GetArrayValue(Object.Direction,Object.Value1,Object.Value3)
				Object.Value1--
				GetArrayValue(Object.Frame,Object.Value1,Object.Value3)
				Object.Value1--
			endif
		endif
		Object.Value0++
		Object.Value0&=3
		break
	case 4
		Object.Value0++
		if Object.Value0==16
			Object.Value0=0
			Object.Value5=0
			Object.State=0
		endif
		break

	endswitch
	foreach TypeGroup[256],PlayerObjectPos
		PlayerObjectCollision(C_TOUCH,Object.EntityNo,-4,-4,4,4,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
		if CheckResult==1
			TempValue0=1
			TempValue0<<=PlayerObjectPos
			TempValue0&=Object.Value5
			if TempValue0==0
				Object[PlayerObjectPos].State=1
				Object[PlayerObjectPos].Animation=ANI_JUMPING
				Object[PlayerObjectPos].AnimationSpeed=240
				Object[PlayerObjectPos].Value5=240
				Object[PlayerObjectPos].XPos=Object.XPos
				Object[PlayerObjectPos].YPos=Object.YPos
				Object[PlayerObjectPos].Speed=0
				Object[PlayerObjectPos].XVelocity=0
				Object[PlayerObjectPos].YVelocity=0
				Object[PlayerObjectPos].Visible=0
				Object[PlayerObjectPos].TileCollisions=0
				TempValue0=1
				TempValue0<<=PlayerObjectPos
				Object.Value5|=TempValue0
				Object.Value0=0
				Object.Value1=0
				Object.State=1
				if Object.Priority!=PRIORITY_XBOUNDS_DESTROY
					Object.Priority=PRIORITY_ACTIVE
				endif
				PlaySfx(SFXName[Rolling],0)
			endif
		endif
	floop
	if Object.OutOfBounds==1
		if Object.Priority!=PRIORITY_XBOUNDS_DESTROY
			Object.Priority=PRIORITY_ACTIVE_BOUNDS
			Object.Value1=0
			Object.Value5=0
			Object.Value0=0
			GetArrayValue(Object.Frame,0,Object.Value2)
			GetArrayValue(Object.Direction,1,Object.Value2)
			Object.State=0
		endif
	endif
endsub


sub ObjectDraw
	DrawSpriteFX(Object.Frame,FX_FLIP,Object.XPos,Object.YPos)
endsub


sub ObjectStartup
	CheckStageFolder("Zone07")
	if CheckResult==1
		LoadSpriteSheet("OOZ/Objects.gif")
		SpriteFrame(-24,-40,48,64,133,142)
		SpriteFrame(-24,-32,48,56,133,85)
		SpriteFrame(-24,-24,48,48,133,93)
		SpriteFrame(-24,-24,64,48,1,101)
		SpriteFrame(-24,-24,56,48,1,150)
		SpriteFrame(-24,-24,48,48,1,150)
		SpriteFrame(-24,-24,48,48,316,1)
		SpriteFrame(-24,-24,48,48,365,1)
		SpriteFrame(-24,-24,48,48,414,1)
		SpriteFrame(-24,-24,48,48,463,1)
		SpriteFrame(-24,-24,48,48,316,50)
		SpriteFrame(-24,-24,48,48,365,50)
		SpriteFrame(-24,-24,48,48,414,50)
		SpriteFrame(-24,-24,48,48,463,50)
	else
		LoadSpriteSheet("MBZ/Objects.gif")
		SpriteFrame(-24,-40,48,64,813,861)
		SpriteFrame(-24,-32,48,56,764,869)
		SpriteFrame(-24,-24,48,48,764,877)
		SpriteFrame(-24,-24,64,48,763,926)
		SpriteFrame(-24,-24,56,48,771,975)
		SpriteFrame(-24,-24,48,48,771,975)
		SpriteFrame(-24,-24,48,48,828,926)
		SpriteFrame(-24,-24,48,48,877,926)
		SpriteFrame(-24,-24,48,48,926,926)
		SpriteFrame(-24,-24,48,48,975,926)
		SpriteFrame(-24,-24,48,48,828,975)
		SpriteFrame(-24,-24,48,48,877,975)
		SpriteFrame(-24,-24,48,48,926,975)
		SpriteFrame(-24,-24,48,48,975,975)
	endif
	foreach TypeName[BallCannon],ArrayPos0
		if Object[ArrayPos0].PropertyValue>7
			Object[ArrayPos0].Value6=1
			Object[ArrayPos0].PropertyValue&=7
		endif
		switch Object[ArrayPos0].PropertyValue
		case 0
			Object[ArrayPos0].Value2=0x12499
			Object[ArrayPos0].Value3=0x124AE
			Object[ArrayPos0].Value4=0x124BE
			Object[ArrayPos0].XVelocity=0x100000
			Object[ArrayPos0].YVelocity=0
			break
		case 1
			Object[ArrayPos0].Value2=0x124AE
			Object[ArrayPos0].Value3=0x124A0
			Object[ArrayPos0].Value4=0x124BE
			Object[ArrayPos0].XVelocity=0
			Object[ArrayPos0].YVelocity=0x100000
			break
		case 2
			Object[ArrayPos0].Value2=0x124A0
			Object[ArrayPos0].Value3=0x124A7
			Object[ArrayPos0].Value4=0x124BE
			Object[ArrayPos0].XVelocity=-0x100000
			Object[ArrayPos0].YVelocity=0
			break
		case 3
			Object[ArrayPos0].Value2=0x124A7
			Object[ArrayPos0].Value3=0x12499
			Object[ArrayPos0].Value4=0x124BE
			Object[ArrayPos0].XVelocity=0
			Object[ArrayPos0].YVelocity=-0x100000
			break
		case 4
			Object[ArrayPos0].Value2=0x124AE
			Object[ArrayPos0].Value3=0x12499
			Object[ArrayPos0].Value4=0x124B5
			Object[ArrayPos0].XVelocity=0
			Object[ArrayPos0].YVelocity=-0x100000
			break
		case 5
			Object[ArrayPos0].Value2=0x124A0
			Object[ArrayPos0].Value3=0x124AE
			Object[ArrayPos0].Value4=0x124B5
			Object[ArrayPos0].XVelocity=0x100000
			Object[ArrayPos0].YVelocity=0
			break
		case 6
			Object[ArrayPos0].Value2=0x124A7
			Object[ArrayPos0].Value3=0x124A0
			Object[ArrayPos0].Value4=0x124B5
			Object[ArrayPos0].XVelocity=0
			Object[ArrayPos0].YVelocity=0x100000
			break
		case 7
			Object[ArrayPos0].Value2=0x12499
			Object[ArrayPos0].Value3=0x124A7
			Object[ArrayPos0].Value4=0x124B5
			Object[ArrayPos0].XVelocity=-0x100000
			Object[ArrayPos0].YVelocity=0
			break

		endswitch
		Object[ArrayPos0].DrawOrder=4
		Object[ArrayPos0].PropertyValue=0
		GetArrayValue(Object[ArrayPos0].Frame,0,Object[ArrayPos0].Value2)
		GetArrayValue(Object[ArrayPos0].Direction,1,Object[ArrayPos0].Value2)
	floop
	TempValue0=0
	BallCannon_constant36=DebugMode_constant25
	while TempValue0<4
		SetArrayValue(52,DebugMode_constant25,DebugMode_array12)
		SetArrayValue(126,DebugMode_constant25,DebugMode_array13)
		SetArrayValue(127,DebugMode_constant25,DebugMode_array11)
		DebugMode_constant25++
		TempValue0++
	loop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
