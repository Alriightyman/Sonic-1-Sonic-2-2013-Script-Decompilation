//--------------------Sonic 1 / Sonic 2 Eggman Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 60: TYPE_EGGMAN

// Function declarations
#function Eggman_Function135



function Eggman_Function135
	Sin256(Object.YPos,Object.Value2)
	Object.YPos<<=9
	Object.YPos+=Object.Value1
	Object.Value2+=4
	Object.Value2&=255
endfunction


sub ObjectMain
	switch Object.State
	case 0
		if Object[0].XPos>Object.XPos
			TempValue0=Screen.CenterX
			FlipSign(TempValue0)
			if TempValue0>-192
				TempValue0=-192
			endif
			TempValue0+=Object.iXPos
			Stage.NewXBoundary1=TempValue0
			TempValue0=Screen.CenterX
			if TempValue0<192
				TempValue0=192
			endif
			TempValue0+=Object.iXPos
			Stage.NewXBoundary2=TempValue0
			TempValue0=Stage.NewYBoundary2
			TempValue0-=Screen.YSize
			Stage.NewYBoundary1=TempValue0
			Object.Value6=Object.YPos
			Object.Value6-=0x400000
			Object.Value7=Object.YPos
			Object.Value7-=0x440000
			Object.Value8=Object.YPos
			Object.Animation=1
			ResetObjectEntity(26,TypeName[MusicEvent],0,0,0)
			Object[26].Priority=PRIORITY_ACTIVE
			Object.Value3=8
			Object.Priority=PRIORITY_ACTIVE
			Object.State=1
		endif
		break
	case 1
		Object.Value0++
		if Object.Value0==60
			Object.Value0=0
			Object.YVelocity=-0x8000
			if Object[0].XPos>Object.XPos
				Object.Direction=FLIP_NONE
			else
				Object.Direction=FLIP_X
			endif
			Object.State=2
		endif
		break
	case 2
		Object.YPos+=Object.YVelocity
		if Object.YPos<=Object.Value6
			Object.YPos=Object.Value6
			Object.Value1=Object.YPos
			Object.Value2=0
			Object.State=3
		endif
		if Object.Animation==1
			Object.AnimationTimer=0
		endif
		break
	case 3
		CallFunction(Eggman_Function135)
		Object.Value0++
		if Object.Value4>0
			Object.Value0=168
		endif
		if Object.Value0==168
			Object.Value0=0
			Object.YVelocity=-0x4000
			Object.State=4
		endif
		break
	case 4
		Object.YPos+=Object.YVelocity
		if Object.YPos<Object.Value7
			Object.YPos=Object.Value7
			Object.YVelocity=0x8000
		endif
		if Object.YPos>=Object.Value8
			Object.YPos=Object.Value8
			Object.YVelocity=-0x8000
			if Object[0].XPos>Object.XPos
				Object.Direction=FLIP_NONE
			else
				Object.Direction=FLIP_X
			endif
			if Object.Value9==1
				TempValue0=Object.EntityNo
				TempValue0++
				ResetObjectEntity(TempValue0,TypeName[EggmanHarpoon],Object.Direction,Object.XPos,Object.YPos)
				Object[+1].YPos-=0x300000
				Object[+1].Priority=PRIORITY_ACTIVE
				Object.State=5
			else
				TempValue0=Object.EntityNo
				TempValue0++
				ResetObjectEntity(TempValue0,TypeName[EggmanCannon],Object.Direction,Object.XPos,Object.YPos)
				Object[+1].YPos-=0x200000
				Object[+1].Priority=PRIORITY_ACTIVE
				Object.State=6
			endif
			Object.Visible=0
			Object.Value9=0
		endif
		if Object.Animation==1
			Object.AnimationTimer=0
		endif
		break
	case 5
		if Object[+1].Type==TypeName[BlankObject]
			TempValue0=Object.EntityNo
			TempValue0++
			ResetObjectEntity(TempValue0,TypeName[EggmanCannon],Object.Direction,Object.XPos,Object.YPos)
			Object[+1].YPos-=0x200000
			Object[+1].Priority=PRIORITY_ACTIVE
			Object.State=6
		endif
		break
	case 6
		if Object[+1].Type==TypeName[BlankObject]
			Object.Visible=1
			Object.State=2
		endif
		break
	case 7
		Object.Value0++
		if Object.Value0==180
			Object.Value0=0
			Object.Animation=5
			Object.Value5=0
			Object.State=8
			ResetObjectEntity(26,TypeName[MusicEvent],1,0,0)
			Object[26].Priority=PRIORITY_ACTIVE
			TempValue0=TileLayer[0].XSize
			TempValue0<<=7
			Stage.NewXBoundary2=TempValue0
		endif
		break
	case 8
		Object.Value0++
		if Object.Value0==30
			Object.YVelocity=0
			Object.Value0=0
			Object.State=9
		endif
		break
	case 9
		if Object.YVelocity<0x10000
			Object.YVelocity+=0x400
		endif
		Object.YPos+=Object.YVelocity
		if Object.YPos>Object.Value8
			ResetObjectEntity(Object.EntityNo,TypeName[BlankObject],0,0,0)
		endif
		break
	endswitch
	if Object.Value3!=0
		if Object.Value4>0
			Object.Value4--
			GetBit(TempValue0,Object.Value4,0)
			if TempValue0==1
				SetPaletteEntry(0,192,0xE0E0E0)
			else
				SetPaletteEntry(0,192,0)
			endif
		endif
		if Object.Visible==1
			foreach TypeGroup[256],PlayerObjectPos
				if Object.Value4<32
					CheckEqual(Object[PlayerObjectPos].Animation,ANI_HURT)
					TempValue0=CheckResult
					CheckEqual(Object[PlayerObjectPos].Animation,ANI_DYING)
					TempValue0|=CheckResult
					CheckEqual(Object[PlayerObjectPos].Animation,ANI_DROWNING)
					TempValue0|=CheckResult
					if TempValue0!=0
						if Object.Animation!=2
							Object.Animation=2
							Object.AnimationTimer=0
						endif
					endif
					PlayerObjectCollision(C_TOUCH,Object.EntityNo,-24,-10,24,24,PlayerObjectPos,Object[PlayerObjectPos].Value40,Object[PlayerObjectPos].Value38,Object[PlayerObjectPos].Value41,Object[PlayerObjectPos].Value39)
					if CheckResult==1
						CallFunction(PlayerObject_Function43)
						if CheckResult==1
							Object.Value3--
							if Object.Value3==0
								player.score+=1000
								Object.Value0=0
								Object.Animation=4
								Object.AnimationTimer=0
								Object.Value5=1
								Object.Value1=Object.YPos
								Object.State=7
								SetPaletteEntry(0,192,0)
							else
								Object.Animation=3
								Object.AnimationTimer=0
								Object.Value4=64
								Object.Value9=1
								PlaySfx(SFXName[BossHit],0)
							endif
						endif
					endif
				endif
			floop
		endif
	endif
	if Object.State!=9
		foreach TypeGroup[256],PlayerObjectPos
			TempValue0=Object[PlayerObjectPos].CollisionRight
			TempValue0<<=16
			TempValue0+=Object[PlayerObjectPos].XPos
			TempValue1=Stage.XBoundary2
			TempValue1<<=16
			if TempValue0>TempValue1
				Object[PlayerObjectPos].XVelocity=0
				Object[PlayerObjectPos].Speed=0
				Object[PlayerObjectPos].XPos=TempValue1
				TempValue0=Object[PlayerObjectPos].CollisionRight
				TempValue0<<=16
				Object[PlayerObjectPos].XPos-=TempValue0
			endif
		floop
	endif
	if Object.Value5==1
		TempValue0=oscillation
		TempValue0&=7
		if TempValue0==0
			Rand(TempValue0,48)
			TempValue0-=24
			TempValue0<<=16
			TempValue0+=Object.XPos
			Rand(TempValue1,48)
			TempValue1-=24
			TempValue1<<=16
			TempValue1+=Object.YPos
			CreateTempObject(TypeName[Explosion],0,TempValue0,TempValue1)
			Object[TempObjectPos].DrawOrder=5
			PlaySfx(SFXName[Explosion],0)
		endif
	endif
endsub


sub ObjectDraw
	DrawSpriteFX(6,FX_FLIP,Object.XPos,Object.YPos)
	switch Object.Animation
	case 1
		TempValue0=Object.AnimationTimer
		TempValue0/=40
		Object.AnimationTimer++
		Object.AnimationTimer%=80
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 2
		TempValue0=Object.AnimationTimer
		TempValue0&=15
		TempValue0>>=3
		TempValue0+=2
		Object.AnimationTimer++
		if Object.AnimationTimer==50
			Object.AnimationTimer=0
			if Object[0].Animation!=ANI_DYING
				Object.Animation=1
			endif
		endif
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 3
		TempValue0=Object.AnimationTimer
		TempValue0&=1
		TempValue0+=2
		Object.AnimationTimer++
		if Object.AnimationTimer==50
			Object.AnimationTimer=0
			Object.Animation=1
		endif
		DrawSpriteFX(4,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 4
		TempValue0=Object.AnimationTimer
		TempValue0>>=5
		TempValue0+=4
		TempValue0%=5
		Object.AnimationTimer++
		Object.AnimationTimer&=63
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 5
		DrawSpriteFX(5,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 6
		DrawSpriteFX(5,FX_FLIP,Object.XPos,Object.YPos)
		break
	endswitch
endsub


sub ObjectStartup
	SetPaletteEntry(0,192,0)
	CheckStageFolder("Zone07")
	if CheckResult==1
		LoadSpriteSheet("OOZ/Objects.gif")
		SpriteFrame(-12,-12,24,12,462,118)
		SpriteFrame(-12,-12,24,12,487,118)
		SpriteFrame(-12,-12,24,12,462,131)
		SpriteFrame(-12,-12,24,12,487,131)
		SpriteFrame(-12,-12,24,12,462,144)
		SpriteFrame(-12,-12,24,12,487,144)
		SpriteFrame(-48,-32,96,64,365,125)
		if options.vsMode==1
			foreach TypeName[Eggman],ArrayPos0
				Object[ArrayPos0].Type=TypeName[BlankObject]
			floop
		endif
	else
		LoadSpriteSheet("MBZ/Objects.gif")
		SpriteFrame(-12,-12,24,12,413,91)
		SpriteFrame(-12,-12,24,12,438,91)
		SpriteFrame(-12,-12,24,12,413,104)
		SpriteFrame(-12,-12,24,12,438,104)
		SpriteFrame(-12,-12,24,12,413,117)
		SpriteFrame(-12,-12,24,12,438,117)
		SpriteFrame(-48,-32,96,64,313,112)
	endif
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
