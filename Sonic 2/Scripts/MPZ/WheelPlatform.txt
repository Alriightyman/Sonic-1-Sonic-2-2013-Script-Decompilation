//--------------------Sonic 1 / Sonic 2 Wheel Platform Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 52: TYPE_WHEELPLATFORM

// Function declarations
#function WheelPlatform_Function119
#function WheelPlatform_Function120



function WheelPlatform_Function119
	DrawSprite(3)
	TempValue0=Object.XPos
	TempValue0-=0x880000
	TempValue1=Object.YPos
	TempValue1+=0xC0000
	DrawSpriteXY(2,TempValue0,TempValue1)
	TempValue0-=0x380000
	DrawSpriteXY(0,TempValue0,TempValue1)
	TempValue0=Object.XPos
	TempValue0+=0x880000
	DrawSpriteXY(2,TempValue0,TempValue1)
	TempValue0+=0x380000
	DrawSpriteXY(1,TempValue0,TempValue1)
endfunction


function WheelPlatform_Function120
	CreateTempObject(TypeName[WheelPlatform],0,Object.XPos,Object.YPos)
endfunction


sub ObjectMain
	Object.Value15=1
	TempValue0=Object.XPos
	TempValue0>>=16
	TempValue0-=Screen.CameraXPos
	Absolute(TempValue0)
	TempValue0-=576
	TempValue1=Object.YPos
	TempValue1>>=16
	TempValue1-=Screen.CameraYPos
	Absolute(TempValue1)
	TempValue1-=128
	if TempValue0>=Screen.CenterX
		Object.Value15=0
	endif
	if TempValue1>=Screen.CenterY
		Object.Value15=0
	endif
	if Object.Value15==1
		GetArrayValue(Object.Value0,16,StageSetup_array9)
		Object.Value0>>=8
		Object.Value10=Object.Value0
		Object.Value10>>=1
		Object.Value0-=56
		Object.Value10-=28
		GetArrayValue(Object.Value1,18,StageSetup_array9)
		Object.Value1>>=8
		Object.Value11=Object.Value1
		Object.Value11>>=1
		Object.Value1-=56
		Object.Value11-=28
		GetBit(TempValue0,Object.PropertyValue,0)
		if TempValue0==1
			FlipSign(Object.Value0)
			FlipSign(Object.Value1)
			Object.Rotation+=34
		else
			Object.Rotation-=34
		endif
		GetBit(TempValue0,Object.PropertyValue,1)
		if TempValue0==1
			FlipSign(Object.Value0)
			TempValue0=Object.Value0
			Object.Value0=Object.Value1
			Object.Value1=TempValue0
		endif
		Object.Value0<<=16
		Object.Value0+=Object.XPos
		Object.Value1<<=16
		Object.Value1+=Object.YPos
		Object.Value10<<=16
		Object.Value11<<=16
		FlipSign(Object.Value10)
		FlipSign(Object.Value11)
		Object.Value2=Object.Value0
		Object.Value2-=0x880000
		Object.Value3=Object.Value1
		Object.Value3+=0xC0000
		Object.Value4=Object.Value0
		Object.Value4+=0x880000
		Object.Value5=Object.Value3
		Object.Value6=Object.Value0
		Object.Value6-=0xC00000
		Object.Value7=Object.Value3
		Object.Value8=Object.Value0
		Object.Value8+=0xC00000
		Object.Value9=Object.Value3
		TempValue1=Object.Value0
		TempValue1-=Object.Value13
		TempValue2=Object.Value1
		TempValue2-=Object.Value14
		Object.Value13=Object.Value0
		Object.Value14=Object.Value1
		TempValue4=Object.XPos
		TempValue5=Object.YPos
		Object.XPos=Object.Value0
		Object.YPos=Object.Value1
		TempValue7=0
		foreach TypeGroup[256],PlayerObjectPos
			GetBit(TempValue6,Object.Value12,TempValue7)
			if TempValue6==1
				Object[PlayerObjectPos].XPos+=TempValue1
				Object[PlayerObjectPos].YPos+=TempValue2
			endif
			SetBit(Object.Value12,TempValue7,0)
			TempValue0=0
			PlayerObjectCollision(C_BOX,Object.EntityNo,-64,-24,64,0,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			switch CheckResult
			case 1
				SetBit(Object.Value12,TempValue7,1)
				break
			case 4
				if Object[PlayerObjectPos].Gravity==GRAVITY_GROUND
					CallFunction(PlayerObject_Function50)
				endif
				break
			case 2
			case 3
			endswitch
			PlayerObjectCollision(C_BOX,Object.EntityNo,-96,-24,-64,24,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			switch CheckResult
			case 1
				SetBit(Object.Value12,TempValue7,1)
				break
			case 4
				if Object[PlayerObjectPos].Gravity==GRAVITY_GROUND
					CallFunction(PlayerObject_Function50)
				endif
				break
			case 2
			case 3
			endswitch
			PlayerObjectCollision(C_BOX,Object.EntityNo,64,-24,96,24,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			switch CheckResult
			case 1
				SetBit(Object.Value12,TempValue7,1)
				break
			case 4
				if Object[PlayerObjectPos].Gravity==GRAVITY_GROUND
					CallFunction(PlayerObject_Function50)
				endif
				break
			case 2
			case 3
			endswitch
			PlayerObjectCollision(C_BOX,Object.EntityNo,-176,4,-96,20,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			switch CheckResult
			case 1
				SetBit(Object.Value12,TempValue7,1)
				break
			case 4
				if Object[PlayerObjectPos].Gravity==GRAVITY_GROUND
					CallFunction(PlayerObject_Function50)
				endif
				break
			case 2
			case 3
			endswitch
			PlayerObjectCollision(C_BOX,Object.EntityNo,96,4,176,20,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			switch CheckResult
			case 1
				SetBit(Object.Value12,TempValue7,1)
				break
			case 4
				if Object[PlayerObjectPos].Gravity==GRAVITY_GROUND
					CallFunction(PlayerObject_Function50)
				endif
				break
			case 2
			case 3
			endswitch
			PlayerObjectCollision(C_BOX,Object.EntityNo,-208,0,-176,24,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			switch CheckResult
			case 1
				SetBit(Object.Value12,TempValue7,1)
				break
			case 4
				if Object[PlayerObjectPos].Gravity==GRAVITY_GROUND
					CallFunction(PlayerObject_Function50)
				endif
				break
			case 2
			case 3
			endswitch
			PlayerObjectCollision(C_BOX,Object.EntityNo,176,0,208,24,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			switch CheckResult
			case 1
				SetBit(Object.Value12,TempValue7,1)
				break
			case 4
				if Object[PlayerObjectPos].Gravity==GRAVITY_GROUND
					CallFunction(PlayerObject_Function50)
				endif
				break
			case 2
			case 3
			endswitch
			TempValue7++
		floop
		Object.XPos=TempValue4
		Object.YPos=TempValue5
	endif
endsub


sub ObjectDraw
	if Object.Value15==1
		TempValue6=Object.XPos
		TempValue6-=0xC00000
		TempValue7=Object.YPos
		TempValue7+=0xC0000
		TempValue0=0
		TempValue2=Object.Rotation
		Object.Rotation>>=5
		Object.Rotation&=511
		while TempValue0<8
			DrawSpriteFX(5,FX_ROTATE,TempValue6,TempValue7)
			Object.Rotation+=64
			Object.Rotation&=511
			TempValue0++
		loop
		TempValue5=Object.XPos
		TempValue5+=0xC00000
		TempValue0=0
		while TempValue0<8
			DrawSpriteFX(5,FX_ROTATE,TempValue5,TempValue7)
			Object.Rotation+=64
			Object.Rotation&=511
			TempValue0++
		loop
		Object.Rotation=TempValue2
		TempValue6+=Object.Value10
		TempValue7+=Object.Value11
		DrawSpriteXY(4,TempValue6,TempValue7)
		TempValue5+=Object.Value10
		DrawSpriteXY(4,TempValue5,TempValue7)
		DrawSpriteXY(3,Object.Value0,Object.Value1)
		DrawSpriteXY(2,Object.Value2,Object.Value3)
		DrawSpriteXY(0,Object.Value6,Object.Value7)
		DrawSpriteXY(2,Object.Value4,Object.Value5)
		DrawSpriteXY(1,Object.Value8,Object.Value9)
	endif
endsub


sub ObjectStartup
	LoadSpriteSheet("MPZ/Objects.gif")
	SpriteFrame(-16,-12,32,24,479,182)
	SpriteFrame(-16,-12,32,24,479,133)
	SpriteFrame(-40,-8,80,16,349,165)
	SpriteFrame(-96,-24,192,48,319,207)
	SpriteFrame(-12,-12,24,24,487,157)
	SpriteFrame(-2,-14,4,4,40,34)
	foreach TypeName[WheelPlatform],ArrayPos0
		Object[ArrayPos0].Priority=PRIORITY_ACTIVE
	floop
	SetArrayValue(52,DebugMode_staticVar25,DebugMode_array12)
	SetArrayValue(119,DebugMode_staticVar25,DebugMode_array13)
	SetArrayValue(120,DebugMode_staticVar25,DebugMode_array11)
	DebugMode_staticVar25++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
