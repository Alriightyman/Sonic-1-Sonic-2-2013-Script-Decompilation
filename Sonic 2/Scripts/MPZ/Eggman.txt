//--------------------Sonic 1 / Sonic 2 Eggman Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 79: TYPE_EGGMAN

// Function declarations
#function Eggman_Function171
#function Eggman_Function172

#static 0:Eggman_staticVar42

#array Eggman_array53:(8,9,9,8,8,17)
#array Eggman_array52:(0,2,4,6,1,3,5)

function Eggman_Function171
	Object.YPos=Object.Value1
	Sin256(TempValue0,Object.Value2)
	TempValue0<<=9
	Object.YPos+=TempValue0
	Object.Value2+=4
	Object.Value2&=255
endfunction


function Eggman_Function172
	Object.Value22--
	if Object.Value22==0
		if Object.Value21>0
			PlaySfx(SFXName[SmallLaser],0)
			Object.Value22=30
			Object.Value4=16
			ArrayPos0=Object.EntityNo
			ArrayPos0+=8
			ArrayPos0+=Object.Value21
			ResetObjectEntity(ArrayPos0,Eggman_staticVar42,0,Object.XPos,Object.YPos)
			Object[ArrayPos0].Direction=Object.Direction
			Object[ArrayPos0].XVelocity=Object.Value11
			Object[ArrayPos0].XVelocity<<=2
			if Object.Direction==FLIP_NONE
				FlipSign(Object[ArrayPos0].XVelocity)
				Object[ArrayPos0].XPos+=0x40000
			else
				Object[ArrayPos0].XPos-=0x40000
			endif
			Object[ArrayPos0].Value0=Object[ArrayPos0].XPos
			Object[ArrayPos0].Value0&=-0x10000
			Object[ArrayPos0].YPos+=0x70000
			Object.Value21--
		endif
	endif
endfunction


sub ObjectMain
	switch Object.State
	case 0
		TempValue0=Object.iXPos
		TempValue0-=Screen.CenterX
		Stage.NewXBoundary1=TempValue0
		TempValue0=Object.iXPos
		TempValue0+=Screen.CenterX
		Stage.NewXBoundary2=TempValue0
		TempValue0=Object.iYPos
		TempValue0+=72
		Stage.NewYBoundary2=TempValue0
		if Object[0].XPos>=Object.XPos
			Object.Animation=1
			ResetObjectEntity(26,TypeName[MusicEvent],0,0,0)
			Object[26].Priority=PRIORITY_ACTIVE
			Object.Value11=0x10000
			Object.Value11*=Screen.CenterX
			Object.Value11/=160
			Object.Value23=0x200000
			Object.Value23*=Screen.CenterX
			Object.Value23/=160
			Object.Value2=128
			Object.Value15=1
			Object.Value5=Stage.NewXBoundary1
			Object.Value5+=32
			Object.Value5<<=16
			Object.Value6=Stage.NewXBoundary2
			Object.Value6-=32
			Object.Value6<<=16
			ArrayPos0=Object.EntityNo
			ArrayPos1=ArrayPos0
			ArrayPos1+=7
			TempValue0=36
			while ArrayPos0<ArrayPos1
				ArrayPos0++
				Object[ArrayPos0].Type=TypeName[EggmanBalloon]
				Object[ArrayPos0].Value0=Object.EntityNo
				Object[ArrayPos0].Angle=TempValue0
				if TempValue0>=128
					Object[ArrayPos0].DrawOrder=2
				endif
				Object[ArrayPos0].Priority=PRIORITY_ACTIVE
				TempValue0+=36
			loop
			Object.Value17=39
			Object.Value18=39
			Object.Value7=Object.XPos
			Object.Value8=Object.YPos
			Object.Value8-=0x300000
			Object.Value9=Object.YPos
			Object.Value9-=0x800000
			Object.Value10=Object.YPos
			Object.YPos-=0x1200000
			Object.Value1=Object.YPos
			Object.Value4=0
			Object.Value12=8
			Object.Priority=PRIORITY_ACTIVE
			Object.State=1
		endif
		break
	case 1
		Object.Value1+=0x10000
		if Object.Value1>=Object.Value10
			Object.XVelocity=Object.Value11
			if Object[0].XPos<Object.XPos
				Object.Direction=FLIP_NONE
				FlipSign(Object.XVelocity)
			else
				Object.Direction=FLIP_X
			endif
			Object.Value4=2
			Object.State=2
		endif
		CallFunction(Eggman_Function171)
		break
	case 2
		Object.XPos+=Object.XVelocity
		TempValue0=0
		if Object.Direction==FLIP_NONE
			if Object.XPos<=Object.Value5
				TempValue0=1
			endif
		else
			if Object.XPos>=Object.Value6
				TempValue0=1
			endif
		endif
		if TempValue0==1
			FlipSign(Object.XVelocity)
			Object.Direction^=FLIP_X
			Object.Value4--
			if Object.Value4==0
				Object.XVelocity=Object.Value11
				if Object.Direction==FLIP_NONE
					FlipSign(Object.XVelocity)
				endif
				Object.YVelocity=-0x10000
				Object.State=3
			endif
		endif
		CallFunction(Eggman_Function171)
		break
	case 3
		Object.XPos+=Object.XVelocity
		Object.Value1+=Object.YVelocity
		if Object.Value1<=Object.Value8
			Object.YVelocity=0
		endif
		if Object.Direction==FLIP_NONE
			if Object.XPos<=Object.Value7
				TempValue0=1
			endif
		else
			if Object.XPos>=Object.Value7
				TempValue0=1
			endif
		endif
		if TempValue0==1
			Object.XVelocity=0
			Object.XPos=Object.Value7
			Object.State=4
		endif
		CallFunction(Eggman_Function171)
		break
	case 4
		Object.Value17++
		Object.Value18++
		if Object.Value17>=104
			Object.State=5
		endif
		CallFunction(Eggman_Function171)
		break
	case 5
		Object.Value18--
		if Object.Value18<=0
			Object.State=6
		endif
		CallFunction(Eggman_Function171)
		break
	case 6
		Object.Value17--
		if Object.Value17<=39
			Object.State=7
		endif
		CallFunction(Eggman_Function171)
		break
	case 7
		Object.Value18++
		if Object.Value18>=39
			Object.State=1
		endif
		CallFunction(Eggman_Function171)
		break
	case 8
		Object.Value1+=Object.YVelocity
		if Object.Value1<=Object.Value9
			Object.YVelocity=0
		endif
		if Object.Value17>39
			Object.Value17--
		endif
		if Object.Value18>0
			Object.Value18--
		else
			if Object.Value19<0x100000
				Object.Value19+=0x8000
			endif
		endif
		if Object.Value20==0
			if Object.Value12>1
				Object.State=9
			else
				Object.YVelocity=-0x18000
				Object.XVelocity=Object.Value11
				if Object.Direction==FLIP_NONE
					FlipSign(Object.XVelocity)
				endif
				Object.State=10
			endif
		endif
		CallFunction(Eggman_Function171)
		break
	case 9
		Object.Value19-=0x8000
		if Object.Value19<=0
			Object.Value19=0
			Object.State=7
		endif
		CallFunction(Eggman_Function171)
		break
	case 10
		if Object.Value4==0
			Object.XPos+=Object.XVelocity
			Object.Value1+=Object.YVelocity
			if Object.Value1<=Object.Value9
				Object.YVelocity=0
			endif
			if Object.Direction==FLIP_NONE
				TempValue0=Object.Value5
				TempValue0+=Object.Value23
				if Object.XPos<=TempValue0
					Object.YVelocity=0x18000
					Object.Value21=3
					Object.Value22=30
					Object.Direction=FLIP_X
					Object.State=11
				endif
			else
				TempValue0=Object.Value6
				TempValue0-=Object.Value23
				if Object.XPos>=TempValue0
					Object.YVelocity=0x18000
					Object.Value21=3
					Object.Value22=30
					Object.Direction=FLIP_NONE
					Object.State=11
				endif
			endif
			CallFunction(Eggman_Function171)
			CallFunction(Eggman_Function172)
		else
			Object.Value4--
		endif
		break
	case 11
		if Object.Value4==0
			Object.XPos+=Object.XVelocity
			Object.Value1+=Object.YVelocity
			if Object.Value1>=Object.Value10
				Object.YVelocity=-0x18000
				Object.State=12
			endif
			if Object.Direction==FLIP_NONE
				if Object.XPos>=Object.Value6
					Object.XVelocity=0
				endif
			else
				if Object.XPos<=Object.Value5
					Object.XVelocity=0
				endif
			endif
			CallFunction(Eggman_Function171)
			CallFunction(Eggman_Function172)
		else
			Object.Value4--
		endif
		break
	case 12
		if Object.Value4==0
			Object.XPos+=Object.XVelocity
			Object.Value1+=Object.YVelocity
			TempValue0=Object.Value10
			TempValue0-=0x300000
			if Object.Value1<=TempValue0
				Object.XVelocity=Object.Value11
				if Object.Direction==FLIP_NONE
					FlipSign(Object.XVelocity)
				endif
			endif
			if Object.Value1<=Object.Value9
				Object.YVelocity=0
				Object.State=10
			endif
			CallFunction(Eggman_Function171)
			CallFunction(Eggman_Function172)
		else
			Object.Value4--
		endif
		break
	case 13
		Object.Value4++
		if Object.Value4==180
			Object.Value4=0
			Object.Animation=5
			Object.Value14=0
			Object.State++
			ResetObjectEntity(26,TypeName[MusicEvent],1,0,0)
			Object[26].Priority=PRIORITY_ACTIVE
			TempValue0=TileLayer[0].XSize
			TempValue0<<=7
			Stage.NewXBoundary2=TempValue0
		endif
		break
	case 14
		Object.YPos+=Object.YVelocity
		Object.YVelocity+=0x1800
		Object.Value4++
		if Object.Value4==15
			Object.YVelocity=0
			Object.Value4=0
			Object.AnimationTimer=0
			Object.State++
		endif
		break
	case 15
		if Object.Value4<48
			Object.YPos+=Object.YVelocity
			Object.YVelocity-=0x800
			Object.Value4++
		else
			Object.Value4=0
			Object.YVelocity=0
			Object.Value1=Object.YPos
			Object.State++
		endif
		break
	case 16
		Object.YPos=Object.Value1
		CallFunction(Eggman_Function171)
		if Object.Value4<8
			Object.Value4++
		else
			Object.Value4=0
			Object.Animation=6
			Object.AnimationTimer=0
			Object.Value15=2
			Object.Value16=0
			Object.Direction=FLIP_X
			Object.Priority=PRIORITY_ACTIVE
			TempValue0=TileLayer[0].XSize
			TempValue0<<=7
			Stage.NewXBoundary2=TempValue0
			Object.State++
		endif
		break
	case 17
		Object.XPos+=0x40000
		Object.Value1-=0x4000
		CallFunction(Eggman_Function171)
		if Object.OutOfBounds==1
			Object.Type=TypeName[BlankObject]
		endif
		break
	endswitch
	if Object.Value12!=0
		if Object.Value13>0
			Object.Value13--
			GetBit(TempValue0,Object.Value13,0)
			if TempValue0==1
				SetPaletteEntry(0,192,0xE0E0E0)
			else
				SetPaletteEntry(0,192,0)
			endif
		endif
		foreach TypeGroup[256],PlayerObjectPos
			if Object.Value13==0
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_HURT)
				TempValue0=CheckResult
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_DYING)
				TempValue0|=CheckResult
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_DROWNING)
				TempValue0|=CheckResult
				if TempValue0!=0
					if Object.Animation!=2
						Object.Animation=2
						Object.AnimationTimer=0
					endif
				endif
				PlayerObjectCollision(C_TOUCH,Object.EntityNo,-24,-24,24,22,PlayerObjectPos,Object[PlayerObjectPos].Value40,Object[PlayerObjectPos].Value38,Object[PlayerObjectPos].Value41,Object[PlayerObjectPos].Value39)
				if CheckResult==1
					CallFunction(PlayerObject_Function43)
					if CheckResult==1
						Object.Value12--
						if Object.Value12==0
							player.score+=1000
							Object.Value15=0
							Object.Value16=0
							Object.Animation=4
							Object.AnimationTimer=0
							Object.Value14=1
							Object.Value1=Object.YPos
							Object.State=13
							Object.Value4=0
						else
							TempValue0=7
							TempValue0-=Object.Value12
							GetArrayValue(ArrayPos0,TempValue0,Eggman_array52)
							ArrayPos0+=Object.EntityNo
							ArrayPos0++
							Object[ArrayPos0].State++
							if Object[0].XPos<Object[ArrayPos0].XPos
								Object[ArrayPos0].XVelocity=-0x8000
								Object[ArrayPos0].Direction=FLIP_NONE
							else
								Object[ArrayPos0].XVelocity=0x8000
								Object[ArrayPos0].Direction=FLIP_X
							endif
							Object[ArrayPos0].YVelocity=-0x40000
							Object[ArrayPos0].Priority=PRIORITY_ACTIVE
							Object.Value20++
							Object.XVelocity=0
							Object.YVelocity=-0x18000
							Object.State=8
							Object.Animation=3
							Object.AnimationTimer=0
							Object.Value13=64
							PlaySfx(SFXName[BossHit],0)
						endif
					endif
				endif
			endif
		floop
	endif
	if Object.State!=17
		foreach TypeGroup[256],PlayerObjectPos
			TempValue0=Object[PlayerObjectPos].CollisionRight
			TempValue0<<=16
			TempValue0+=Object[PlayerObjectPos].XPos
			TempValue1=Stage.XBoundary2
			TempValue1<<=16
			if TempValue0>TempValue1
				Object[PlayerObjectPos].XVelocity=0
				Object[PlayerObjectPos].Speed=0
				Object[PlayerObjectPos].XPos=TempValue1
				TempValue0=Object[PlayerObjectPos].CollisionRight
				TempValue0<<=16
				Object[PlayerObjectPos].XPos-=TempValue0
			endif
		floop
	endif
	if Object.Value14!=0
		TempValue0=oscillation
		TempValue0&=7
		if TempValue0==0
			Rand(TempValue0,48)
			TempValue0-=24
			TempValue0<<=16
			TempValue0+=Object.XPos
			Rand(TempValue1,48)
			TempValue1-=24
			TempValue1<<=16
			TempValue1+=Object.YPos
			CreateTempObject(TypeName[Explosion],0,TempValue0,TempValue1)
			Object[TempObjectPos].DrawOrder=5
			PlaySfx(SFXName[Explosion],0)
		endif
	endif
endsub


sub ObjectDraw
	switch Object.Animation
	case 1
		TempValue0=Object.AnimationTimer
		TempValue0>>=3
		Object.AnimationTimer++
		Object.AnimationTimer&=15
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 2
		TempValue0=Object.AnimationTimer
		TempValue0&=15
		TempValue0>>=3
		TempValue0+=2
		Object.AnimationTimer++
		if Object.AnimationTimer==50
			Object.AnimationTimer=0
			if Object[0].Animation!=ANI_DYING
				Object.Animation=1
			endif
		endif
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 3
		TempValue0=Object.AnimationTimer
		TempValue0&=1
		TempValue0+=2
		Object.AnimationTimer++
		if Object.AnimationTimer==50
			Object.AnimationTimer=0
			Object.Animation=1
		endif
		DrawSpriteFX(4,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 4
		TempValue0=Object.AnimationTimer
		TempValue0>>=5
		TempValue0+=4
		TempValue0%=5
		Object.AnimationTimer++
		Object.AnimationTimer&=63
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 5
		DrawSpriteFX(5,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 6
		TempValue0=Object.AnimationTimer
		TempValue0>>=3
		Object.AnimationTimer++
		Object.AnimationTimer&=15
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		TempValue0=Object.AnimationTimer
		TempValue0>>=2
		TempValue0&=1
		if TempValue0==1
			DrawSpriteFX(16,FX_FLIP,Object.XPos,Object.YPos)
		endif
	endswitch
	if Object.Animation>0
		DrawSpriteFX(6,FX_FLIP,Object.XPos,Object.YPos)
		DrawSpriteFX(7,FX_FLIP,Object.XPos,Object.YPos)
	endif
	switch Object.Value15
	case 1
		GetArrayValue(TempValue0,Object.Value16,Eggman_array53)
		Object.Value16++
		if Object.Value16==6
			Object.Value16=0
		endif
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 2
		TempValue0=Object.Value16
		TempValue0/=3
		TempValue0+=10
		Object.Value16++
		if Object.Value16>=18
			Object.Value16=0
			TempValue0=8
			Object.Value15=1
		endif
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	endswitch
endsub


sub ObjectStartup
	CheckStageFolder("Zone09")
	if CheckResult==1
		LoadSpriteSheet("MPZ/Objects.gif")
		SpriteFrame(-28,-24,44,16,195,151)
		SpriteFrame(-28,-24,44,16,195,168)
		SpriteFrame(-28,-24,44,16,240,155)
		SpriteFrame(-28,-24,44,16,240,172)
		SpriteFrame(-28,-24,44,16,285,157)
		SpriteFrame(-28,-24,44,16,285,174)
		SpriteFrame(-24,-28,56,49,220,206)
		SpriteFrame(-32,-8,8,23,190,69)
		SpriteFrame(31,4,12,8,289,125)
		SpriteFrame(30,2,14,12,302,125)
		SpriteFrame(31,-2,22,14,285,192)
		SpriteFrame(31,-9,32,26,67,75)
		SpriteFrame(31,-2,22,14,285,192)
		SpriteFrame(31,-9,32,26,67,75)
		SpriteFrame(31,4,12,8,289,125)
		SpriteFrame(30,2,14,12,302,125)
		SpriteFrame(-3,-28,11,8,332,144)
		SpriteFrame(0,0,1,1,332,144)
		Eggman_staticVar42=81
		if options.vsMode==1
			foreach TypeName[Eggman],ArrayPos0
				Object[ArrayPos0].Type=TypeName[BlankObject]
			floop
		endif
	else
		LoadSpriteSheet("MBZ/Objects.gif")
		SpriteFrame(-28,-28,60,20,1,1)
		SpriteFrame(-28,-28,60,20,62,1)
		SpriteFrame(-28,-28,60,20,1,22)
		SpriteFrame(-28,-28,60,20,62,22)
		SpriteFrame(-28,-28,60,20,1,43)
		SpriteFrame(-28,-28,60,20,62,43)
		SpriteFrame(-24,-28,56,49,255,206)
		SpriteFrame(-32,-8,8,23,316,232)
		SpriteFrame(31,4,12,8,57,90)
		SpriteFrame(30,2,14,12,57,99)
		SpriteFrame(31,-2,22,14,34,97)
		SpriteFrame(31,-9,32,26,72,86)
		SpriteFrame(31,-2,22,14,34,97)
		SpriteFrame(31,-9,32,26,72,86)
		SpriteFrame(31,4,12,8,57,90)
		SpriteFrame(30,2,14,12,57,99)
		SpriteFrame(-3,-28,11,8,45,88)
		SpriteFrame(0,0,0,0,7,2)
		Eggman_staticVar42=0
	endif
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
