//--------------------Sonic 1 / Sonic 2 Large Gear Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 48: TYPE_LARGEGEAR

// Function declarations
#function LargeGear_Function114
#function LargeGear_Function115


#array LargeGear_array40:(0,0,0,0,0,0,0,0)
#array LargeGear_array41:(0,0,0,0,0,0,0,0)

function LargeGear_Function114
	TempValue0=0
	TempValue1=Object.Rotation
	Object.Rotation=0
	while TempValue0<8
		DrawSpriteFX(0,FX_ROTATE,Object.XPos,Object.YPos)
		Object.Rotation+=64
		TempValue0++
	loop
	TempValue0=0
	while TempValue0<8
		DrawSpriteFX(2,FX_ROTATE,Object.XPos,Object.YPos)
		Object.Rotation+=64
		TempValue0++
	loop
	Object.Rotation=TempValue1
	Cos(TempValue0,0)
	TempValue0*=-28
	TempValue0<<=7
	TempValue0+=Object.XPos
	Sin(TempValue1,0)
	TempValue1*=-28
	TempValue1<<=7
	TempValue1+=Object.YPos
	DrawSpriteXY(1,TempValue0,TempValue1)
endfunction


function LargeGear_Function115
	CreateTempObject(TypeName[LargeGear],Object.Direction,Object.XPos,Object.YPos)
	Object[TempObjectPos].DrawOrder=2
endfunction


sub ObjectMain
	Object.Rotation=oscillation
	Object.Rotation&=63
	Object.Value0=oscillation
	if Object.PropertyValue==1
		FlipSign(Object.Rotation)
		Object.Rotation+=104
		Object.Rotation&=63
		FlipSign(Object.Value0)
		Object.Value0+=552
		Object.Value0&=511
	endif
	TempValue0=0
	TempValue1=Object.Value0
	while TempValue0<8
		Cos(TempValue2,TempValue1)
		TempValue2*=-75
		TempValue2>>=9
		SetArrayValue(TempValue2,TempValue0,LargeGear_array40)
		Sin(TempValue2,TempValue1)
		TempValue2*=-75
		TempValue2>>=9
		SetArrayValue(TempValue2,TempValue0,LargeGear_array41)
		TempValue0++
		TempValue1+=64
	loop
	TempValue7=0
	foreach TypeGroup[256],PlayerObjectPos
		GetBit(TempValue6,Object.Value2,TempValue7)
		if TempValue6==1
			Object[PlayerObjectPos].YPos+=0x40000
		endif
		SetBit(Object.Value2,TempValue7,0)
		TempValue0=0
		TempValue5=9
		while TempValue0<8
			GetArrayValue(TempValue1,TempValue0,LargeGear_array40)
			GetArrayValue(TempValue2,TempValue0,LargeGear_array41)
			TempValue3=TempValue1
			TempValue4=TempValue2
			TempValue1-=10
			TempValue2-=10
			TempValue3+=10
			TempValue4+=10
			if TempValue6==1
				PlayerObjectCollision(C_PLATFORM,Object.EntityNo,TempValue1,TempValue2,TempValue3,TempValue4,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			else
				PlayerObjectCollision(C_BOX,Object.EntityNo,TempValue1,TempValue2,TempValue3,TempValue4,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			endif
			if CheckResult==1
				Object[PlayerObjectPos].Gravity=Object.EntityNo
				SetBit(Object.Value2,TempValue7,1)
				TempValue5=TempValue0
			endif
			TempValue0++
		loop
		if TempValue5<8
			GetArrayValue(TempValue0,TempValue5,LargeGear_array40)
			switch TempValue5
			case 0
				TempValue0-=Object.Value3
				break
			case 1
				TempValue0-=Object.Value4
				break
			case 2
				TempValue0-=Object.Value5
				break
			case 3
				TempValue0-=Object.Value6
				break
			case 4
				TempValue0-=Object.Value7
				break
			case 5
				TempValue0-=Object.Value8
				break
			case 6
				TempValue0-=Object.Value9
				break
			case 7
				TempValue0-=Object.Value10
				break
			endswitch
			TempValue0<<=16
			TempValue1=TempValue0
			TempValue1>>=2
			TempValue0+=TempValue1
			Object[PlayerObjectPos].XPos+=TempValue0
		else
			if TempValue6==1
				Object[PlayerObjectPos].YPos-=0x40000
			endif
		endif
		ArrayPos0=Stage.ObjectEntityPos
		Stage.ObjectEntityPos=PlayerObjectPos
		if Object.XPos>Object[ArrayPos0].XPos
			ObjectTileCollision(CMODE_RWALL,Object.CollisionLeft,0,0)
		else
			ObjectTileCollision(CMODE_LWALL,Object.CollisionRight,0,0)
		endif
		ObjectTileCollision(CMODE_FLOOR,0,Object.CollisionBottom,0)
		Stage.ObjectEntityPos=ArrayPos0
		PlayerObjectCollision(C_BOX,Object.EntityNo,-64,-8,64,8,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
		TempValue7++
	floop
	GetArrayValue(Object.Value3,0,LargeGear_array40)
	GetArrayValue(Object.Value4,1,LargeGear_array40)
	GetArrayValue(Object.Value5,2,LargeGear_array40)
	GetArrayValue(Object.Value6,3,LargeGear_array40)
	GetArrayValue(Object.Value7,4,LargeGear_array40)
	GetArrayValue(Object.Value8,5,LargeGear_array40)
	GetArrayValue(Object.Value9,6,LargeGear_array40)
	GetArrayValue(Object.Value10,7,LargeGear_array40)
endsub


sub ObjectDraw
	if Object.Value1==0
		TempValue0=0
		TempValue1=Object.Rotation
		while TempValue0<8
			DrawSpriteFX(0,FX_ROTATE,Object.XPos,Object.YPos)
			Object.Rotation+=64
			TempValue0++
		loop
		Object.Rotation=TempValue1
		AddDrawListEntityRef(4,Object.EntityNo)
	else
		TempValue0=0
		TempValue1=Object.Rotation
		while TempValue0<8
			DrawSpriteFX(2,FX_ROTATE,Object.XPos,Object.YPos)
			Object.Rotation+=64
			TempValue0++
		loop
		Object.Rotation=TempValue1
		Cos(TempValue0,Object.Value0)
		TempValue0*=-28
		TempValue0<<=7
		TempValue0+=Object.XPos
		Sin(TempValue1,Object.Value0)
		TempValue1*=-28
		TempValue1<<=7
		TempValue1+=Object.YPos
		DrawSpriteXY(1,TempValue0,TempValue1)
	endif
	Object.Value1^=1
endsub


sub ObjectStartup
	LoadSpriteSheet("MPZ/Objects.gif")
	SpriteFrame(-14,-88,28,32,256,1)
	SpriteFrame(-12,-12,24,24,487,157)
	SpriteFrame(-2,-14,4,4,40,34)
	foreach TypeName[LargeGear],ArrayPos0
		Object[ArrayPos0].DrawOrder=2
	floop
	SetArrayValue(48,DebugMode_staticVar25,DebugMode_array12)
	SetArrayValue(114,DebugMode_staticVar25,DebugMode_array13)
	SetArrayValue(115,DebugMode_staticVar25,DebugMode_array11)
	DebugMode_staticVar25++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
