//--------------------Sonic 1 / Sonic 2 Cylinder Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 53: TYPE_CYLINDER



#array Cylinder_array45:(6,5,4,3,2,1,0,11,10,9,8,7,6)

sub ObjectMain
	Object.Priority=PRIORITY_ACTIVE
	TempValue2=0
	foreach TypeGroup[256],PlayerObjectPos
		GetBit(TempValue3,Object.Value1,TempValue2)
		if TempValue3==0
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,Object.Value10,60,Object.Value11,76,PlayerObjectPos,0x10000,1,0x10000,0x10000)
			if Object[PlayerObjectPos].YVelocity<0
				CheckResult=0
			endif
			if CheckResult==1
				SetBit(Object.Value1,TempValue2,1)
				Object[PlayerObjectPos].YVelocity=0
				switch TempValue2
				case 0
					Object.Value2=0
					Object.Value6=Object[PlayerObjectPos].Direction
					break
				case 1
					Object.Value3=0
					Object.Value7=Object[PlayerObjectPos].Direction
					break
				case 2
					Object.Value4=0
					Object.Value8=Object[PlayerObjectPos].Direction
					break
				case 3
					Object.Value5=0
					Object.Value9=Object[PlayerObjectPos].Direction
					break
				endswitch
			else
				TempValue0=Object[PlayerObjectPos].CollisionTop
				TempValue0<<=16
				TempValue0+=Object[PlayerObjectPos].YPos
				TempValue0-=Object.YPos
				if TempValue0<-0x300000
					PlayerObjectCollision(C_BOX,Object.EntityNo,Object.Value10,-64,Object.Value11,-48,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
				else
					TempValue0=Object[PlayerObjectPos].CollisionBottom
					TempValue0<<=16
					TempValue0+=Object[PlayerObjectPos].YPos
					TempValue0-=Object.YPos
					if TempValue0>0x400000
						PlayerObjectCollision(C_BOX,Object.EntityNo,Object.Value10,48,Object.Value11,64,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
					endif
				endif
			endif
		else
			TempValue3=0
			TempValue0=Object[PlayerObjectPos].XPos
			TempValue0-=Object.XPos
			Absolute(TempValue0)
			CheckLower(Object[PlayerObjectPos].YVelocity,-0x40000)
			TempValue3|=CheckResult
			CheckGreater(TempValue0,Object.Value12)
			TempValue3|=CheckResult
			if TempValue3==1
				SetBit(Object.Value1,TempValue2,0)
				if Object[PlayerObjectPos].Gravity==GRAVITY_AIR
					if Object[PlayerObjectPos].YVelocity>=0
						if Object[PlayerObjectPos].State!=34
							if Object[PlayerObjectPos].Animation!=ANI_SKIDDING
								if Object[PlayerObjectPos].XVelocity<0
									Object[PlayerObjectPos].Direction=FLIP_X
								endif
								Object[PlayerObjectPos].Animation=ANI_TWIRL
								Object[PlayerObjectPos].Angle=0
								Object[PlayerObjectPos].Rotation=0
							endif
						endif
					endif
				endif
				switch TempValue2
				case 0
					TempValue6=Object.Value2
					break
				case 1
					TempValue6=Object.Value3
					break
				case 2
					TempValue6=Object.Value4
					break
				case 3
					TempValue6=Object.Value5
					break
				endswitch
				TempValue6+=32
				TempValue6&=255
				if TempValue6>=64
					Object[PlayerObjectPos].YVelocity=0
				else
					Object[PlayerObjectPos].YVelocity>>=1
				endif
			else
				Object[PlayerObjectPos].YVelocity=0
				TempValue0>>=16
				switch TempValue2
				case 0
					TempValue6=Object.Value2
					TempValue7=Object.Value6
					break
				case 1
					TempValue6=Object.Value3
					TempValue7=Object.Value7
					break
				case 2
					TempValue6=Object.Value4
					TempValue7=Object.Value8
					break
				case 3
					TempValue6=Object.Value5
					TempValue7=Object.Value9
					break
				endswitch
				TempValue6+=4
				TempValue6&=255
				Cos256(Object[PlayerObjectPos].YPos,TempValue6)
				Object[PlayerObjectPos].YPos*=42
				Object[PlayerObjectPos].YPos>>=8
				Object[PlayerObjectPos].YPos-=Object[PlayerObjectPos].CollisionBottom
				Object[PlayerObjectPos].YPos+=19
				Object[PlayerObjectPos].YPos<<=16
				Object[PlayerObjectPos].YPos+=Object.YPos
				if Object[PlayerObjectPos].State==10
					if Object[PlayerObjectPos].Gravity==GRAVITY_AIR
						Object[PlayerObjectPos].PrevAnimation=ANI_TWIRL
						Object[PlayerObjectPos].Animation=ANI_TWIRL
						Object[PlayerObjectPos].AnimationSpeed=0
						Object[PlayerObjectPos].Direction=FLIP_NONE
						TempValue0=TempValue6
						TempValue0/=21
						if Object[PlayerObjectPos].XVelocity!=0
							if Object[PlayerObjectPos].XVelocity>0
								TempValue7=0
							else
								TempValue7=1
							endif
						endif
						if TempValue7==0
							Object[PlayerObjectPos].Frame=TempValue0
							Object[PlayerObjectPos].Rotation=0
						else
							GetArrayValue(Object[PlayerObjectPos].Frame,TempValue0,Cylinder_array45)
							Object[PlayerObjectPos].Rotation=256
						endif
					endif
				endif
				if Object[PlayerObjectPos].State==14
					if Object[PlayerObjectPos].XVelocity!=0
						if Object[PlayerObjectPos].XVelocity>0
							Object[PlayerObjectPos].Direction=FLIP_NONE
						else
							Object[PlayerObjectPos].Direction=FLIP_X
						endif
					endif
				endif
				switch TempValue2
				case 0
					Object.Value2=TempValue6
					Object.Value6=TempValue7
					break
				case 1
					Object.Value3=TempValue6
					Object.Value7=TempValue7
					break
				case 2
					Object.Value4=TempValue6
					Object.Value8=TempValue7
					break
				case 3
					Object.Value5=TempValue6
					Object.Value9=TempValue7
					break
				endswitch
				Object[PlayerObjectPos].Gravity=GRAVITY_GROUND
			endif
		endif
		TempValue2++
	floop
	if Object.Value1!=0
		if Object.PropertyValue==0
			if Object.OutOfBounds==1
				Object.Priority=PRIORITY_ACTIVE_BOUNDS
			endif
		endif
		TempValue0=0
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,Object.Value10,-64,Object.Value11,64,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			TempValue0|=CheckResult
		floop
		if TempValue0==0
			Object.Value1=0
		endif
	endif
endsub


sub ObjectStartup
	foreach TypeName[Cylinder],ArrayPos0
		if Object[ArrayPos0].PropertyValue==0
			Object[ArrayPos0].Value11=192
			Object[ArrayPos0].Priority=PRIORITY_ACTIVE_BOUNDS
		else
			Object[ArrayPos0].Value11=384
			Object[ArrayPos0].Priority=PRIORITY_ACTIVE
		endif
		Object[ArrayPos0].Value12=Object[ArrayPos0].Value11
		Object[ArrayPos0].Value12<<=16
		Object[ArrayPos0].Value10=Object[ArrayPos0].Value11
		FlipSign(Object[ArrayPos0].Value10)
	floop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
