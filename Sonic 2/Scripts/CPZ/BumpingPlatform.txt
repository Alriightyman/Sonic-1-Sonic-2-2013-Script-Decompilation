//--------------------Sonic 1 / Sonic 2 Bumping Platform Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 59: TYPE_BUMPINGPLATFORM

// Function declarations
#function BumpingPlatform_Function140
#function BumpingPlatform_Function141


#array BumpingPlatform_array51:(0,1,1,0)
#array BumpingPlatform_array52:(0x680000,0xA80000,0xE80000,0x680000)
#array BumpingPlatform_array53:(-0x680000,0,-0xB00000,0x400000,-0x780000,0x800000,0x670000,0)

function BumpingPlatform_Function140
	DrawSprite(0)
endfunction


function BumpingPlatform_Function141
	CreateTempObject(TypeName[BumpingPlatform],0,Object.XPos,Object.YPos)
	Object[TempObjectPos].State=0
	Object[TempObjectPos].Value2=Object.XPos
	Object[TempObjectPos].Value2-=0x680000
	Object[TempObjectPos].Value3=Object.XPos
	Object[TempObjectPos].Value3+=0x680000
	Object[TempObjectPos].Value0=Object.XPos
	Object[TempObjectPos].Value0+=-0x680000
	Object[TempObjectPos].Value1=Object.XPos
	Object[TempObjectPos].Value1+=0
endfunction


sub ObjectMain
	TempValue6=Object.Value0
	TempValue7=Object.Value1
	GetBit(TempValue0,Object.Direction,0)
	if TempValue0==0
		Object.Value0+=0x10000
		if Object.Value0>=Object.Value3
			SetBit(Object.Direction,0,1)
		endif
	else
		Object.Value0-=0x10000
		if Object.Value0<=Object.Value2
			SetBit(Object.Direction,0,0)
		endif
	endif
	if Object.State==1
		if Object.Direction==FLIP_Y
			TempValue0=Object.Value0
			TempValue0+=0x180000
			TempValue1=Object.Value1
			TempValue1-=0x180000
			if TempValue0==TempValue1
				Object.Direction^=FLIP_XY
			endif
		endif
		if Object.Direction==FLIP_X
			TempValue0=Object.Value0
			TempValue0-=0x180000
			TempValue1=Object.Value1
			TempValue1+=0x180000
			if TempValue0==TempValue1
				Object.Direction^=FLIP_XY
			endif
		endif
		GetBit(TempValue0,Object.Direction,1)
		if TempValue0==0
			Object.Value1+=0x10000
			if Object.Value1>=Object.Value3
				SetBit(Object.Direction,1,1)
			endif
		else
			Object.Value1-=0x10000
			if Object.Value1<=Object.Value2
				SetBit(Object.Direction,1,0)
			endif
		endif
		if Object.Direction==FLIP_Y
			TempValue0=Object.Value0
			TempValue0+=0x180000
			TempValue1=Object.Value1
			TempValue1-=0x180000
			if TempValue0==TempValue1
				Object.Direction^=FLIP_XY
			endif
		endif
		if Object.Direction==FLIP_X
			TempValue0=Object.Value0
			TempValue0-=0x180000
			TempValue1=Object.Value1
			TempValue1+=0x180000
			if TempValue0==TempValue1
				Object.Direction^=FLIP_XY
			endif
		endif
	endif
	TempValue4=Object.Value0
	TempValue5=Object.Value1
	TempValue4-=TempValue6
	TempValue5-=TempValue7
	TempValue0=Object.XPos
	foreach TypeGroup[256],PlayerObjectPos
		Object.XPos=TempValue6
		PlayerObjectCollision(C_PLATFORM,Object.EntityNo,-24,-8,24,6,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
		if CheckResult==1
			Object[PlayerObjectPos].XPos+=TempValue4
		endif
		if Object.State==1
			Object.XPos=TempValue7
			PlayerObjectCollision(C_PLATFORM,Object.EntityNo,-24,-8,24,6,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			if CheckResult==1
				Object[PlayerObjectPos].XPos+=TempValue5
			endif
		endif
	floop
	Object.XPos=TempValue0
endsub


sub ObjectDraw
	DrawSpriteXY(0,Object.Value0,Object.YPos)
	if Object.State==1
		DrawSpriteXY(0,Object.Value1,Object.YPos)
	endif
endsub


sub ObjectStartup
	LoadSpriteSheet("CPZ/Objects.gif")
	SpriteFrame(-24,-8,48,14,6,204)
	foreach TypeName[BumpingPlatform],ArrayPos0
		TempValue0=Object[ArrayPos0].PropertyValue
		GetArrayValue(Object[ArrayPos0].State,TempValue0,BumpingPlatform_array51)
		GetArrayValue(TempValue1,TempValue0,BumpingPlatform_array52)
		Object[ArrayPos0].Value2=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value2-=TempValue1
		Object[ArrayPos0].Value3=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value3+=TempValue1
		TempValue0<<=1
		GetArrayValue(TempValue1,TempValue0,BumpingPlatform_array53)
		Object[ArrayPos0].Value0=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value0+=TempValue1
		TempValue0++
		GetArrayValue(TempValue1,TempValue0,BumpingPlatform_array53)
		Object[ArrayPos0].Value1=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value1+=TempValue1
		if Object[ArrayPos0].PropertyValue==2
			Object[ArrayPos0].Direction=FLIP_X
		endif
		Object[ArrayPos0].Priority=PRIORITY_ACTIVE
	floop
	SetArrayValue(59,DebugMode_staticVar25,DebugMode_array12)
	SetArrayValue(140,DebugMode_staticVar25,DebugMode_array13)
	SetArrayValue(141,DebugMode_staticVar25,DebugMode_array11)
	DebugMode_staticVar25++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
