//--------------------Sonic 1 / Sonic 2 ChemicalDropper Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 71: TYPE_CHEMICALDROPPER

// Function declarations
#function ChemicalDropper_Function163
#function ChemicalDropper_Function164


#array ChemicalDropper_array55:(2,2,2,2,2,2,2,3,3,3,3,3,3,2,2,2,2,2)
#array ChemicalDropper_array56:(18,4,4,4,5,5,5,6,6,6,7,7,7,8,8,9,10,10,10)
#array ChemicalDropper_array57:(12,31,33)

//Unknown Variables
#static 6:staticVar0x16CA2
#static 13:staticVar0x16CA3
#static 18:staticVar0x16CA4
#static 14:staticVar0x16CA5
#static 16:staticVar0x16CA6
#static 15:staticVar0x16CA7
#static 17:staticVar0x16CA8

function ChemicalDropper_Function163
	CreateTempObject(TypeName[ChemicalDropper],0,TempValue0,TempValue1)
	Object[TempObjectPos].State=5
	Object[TempObjectPos].Direction=Object.Direction
	Rand(Object[TempObjectPos].XVelocity,8)
	Object[TempObjectPos].XVelocity-=4
	Object[TempObjectPos].XVelocity<<=16
	Object[TempObjectPos].YVelocity=-0x38000
	Rand(Object[TempObjectPos].Value3,255)
	Object[TempObjectPos].Value3+=30
	Object[TempObjectPos].Value3&=127
endfunction


function ChemicalDropper_Function164
	Object.YPos=Object.Value1
	Sin256(TempValue0,Object.Value2)
	TempValue0<<=10
	Object.YPos+=TempValue0
	Object.Value2+=2
	Object.Value2&=255
	Object[-1].XPos=Object.XPos
	Object[-1].YPos=Object.YPos
	CheckGreater(Object[0].XPos,Object.XPos)
	Object.Direction=CheckResult
	Object[-1].Direction=Object.Direction
endfunction


sub ObjectMain
	switch Object.State
	case 0
		if Object.XPos==Object.Value5
			if Object.Value12==0
				Object.Value6=1
				Object.Value7=0
				Object.State++
			endif
		else
			if Object.XPos>Object.Value5
				Object.XPos-=0x30000
				if Object.XPos<=Object.Value5
					Object.XPos=Object.Value5
				endif
			else
				Object.XPos+=0x30000
				if Object.XPos>=Object.Value5
					Object.XPos=Object.Value5
				endif
			endif
		endif
		CallFunction(ChemicalDropper_Function164)
		break
	case 1
		CallFunction(ChemicalDropper_Function164)
		break
	case 2
		TempValue0=Object.XPos
		if Object[0].XPos<=Object.XPos
			TempValue0-=0x480000
		else
			TempValue0+=0x480000
		endif
		TempValue0&=-0x10000
		TempValue1=Object[0].XPos
		TempValue1&=-0x10000
		if TempValue1==TempValue0
			if Object.Value11==0x580000
				Object.Value12=4
			endif
		else
			if Object[0].XPos<TempValue0
				TempValue0=Stage.NewXBoundary1
				TempValue0-=16
				TempValue0<<=16
				if Object.XPos>TempValue0
					Object.XPos-=0x10000
				endif
			else
				TempValue0=Stage.NewXBoundary2
				TempValue0+=16
				TempValue0<<=16
				if Object.XPos<TempValue0
					Object.XPos+=0x10000
				endif
			endif
		endif
		CallFunction(ChemicalDropper_Function164)
		break
	case 3
		if Object.XPos==Object.Value4
			if Object.Value12==0
				Object.Value6=1
				Object.Value7=0
				Object.State=1
			endif
		else
			if Object.XPos>Object.Value4
				Object.XPos-=0x30000
				if Object.XPos<=Object.Value4
					Object.XPos=Object.Value4
				endif
			else
				Object.XPos+=0x30000
				if Object.XPos>=Object.Value4
					Object.XPos=Object.Value4
				endif
			endif
		endif
		CallFunction(ChemicalDropper_Function164)
		break
	case 4
		Object.Value6=0
		Object.Value12=0
		TempValue0=Object.XPos
		if Object.Direction==FLIP_NONE
			TempValue0-=Object.Value11
		else
			TempValue0+=Object.Value11
		endif
		TempValue1=Object.YPos
		TempValue1-=0x380000
		CallFunction(ChemicalDropper_Function163)
		Object[TempObjectPos].Frame=35
		TempValue1+=0x80000
		TempValue2=Object.Value11
		TempValue2>>=16
		TempValue2-=16
		TempValue2/=24
		while TempValue2>=0
			if Object.Direction==FLIP_NONE
				TempValue0+=0x180000
			else
				TempValue0-=0x180000
			endif
			CallFunction(ChemicalDropper_Function163)
			Object[TempObjectPos].Frame=36
			TempValue2--
		loop
		TempValue0=Object.XPos
		TempValue1=Object.YPos
		CallFunction(ChemicalDropper_Function163)
		Object[TempObjectPos].Frame=37
		CallFunction(ChemicalDropper_Function163)
		Object[TempObjectPos].Frame=38
		CallFunction(ChemicalDropper_Function163)
		Object[TempObjectPos].Frame=39
		if Object.Direction==FLIP_NONE
			TempValue0+=0x40000
		else
			TempValue0-=0x40000
		endif
		TempValue1+=0x190000
		TempValue2=0
		while TempValue2<Object.Value8
			CallFunction(ChemicalDropper_Function163)
			Object[TempObjectPos].Frame=1
			TempValue1+=0x80000
			TempValue2++
		loop
		Object.Type=TypeName[BlankObject]
		break
	case 5
		Object.Value3--
		if Object.Value3<=0
			Object.Value3=30
			CreateTempObject(TypeName[Explosion],0,Object.XPos,Object.YPos)
			Object[TempObjectPos].DrawOrder=5
			PlaySfx(SFXName[Explosion2],0)
			Object.State++
		endif
		break
	case 6
		Object.Value3--
		if Object.Value3<=0
			Object.State++
		endif
		break
	case 7
		Object.XPos+=Object.XVelocity
		Object.YPos+=Object.YVelocity
		Object.YVelocity+=0x3800
		TempValue1=Object.YPos
		TempValue1>>=16
		TempValue1-=Screen.CameraYPos
		Absolute(TempValue1)
		TempValue1-=128
		if TempValue1>=Screen.CenterY
			Object.Type=TypeName[BlankObject]
		endif
		break
	endswitch
	switch Object.Value6
	case 1
		Object.Value9=1
		Object.Value8++
		if Object.Value8==8
			Object.Value6=2
			Object.Value10=8
			Object.Value7=0
			Object.Value12=1
			Object.Value15=18
			Object.Value16=4
		endif
		break
	case 2
		Object.Value7++
		if Object.Value7==18
			Object.Value7=0
			Object.Value10--
			if Object.Value10<0
				Object.Value10=9
			endif
		endif
		GetArrayValue(Object.Value9,Object.Value7,ChemicalDropper_array55)
		break
	case 3
		Object.Value9=1
		Object.Value8--
		if Object.Value8==0
			Object.Value6=0
			Object.Value10=8
			Object.Value7=0
			Object.Value12=3
			Object.State=2
		endif
		break
	endswitch
	switch Object.Value12
	case 0
		Object.Value11=0x100000
		Object.Value13=12
		break
	case 1
		Object.Value14++
		if Object.Value14==19
			Object.Value14=0
			Object.Value15++
			if Object.Value15>=30
				Object.Value15=30
				Object.Value6=3
				Object.Value12=2
			endif
		endif
		GetArrayValue(Object.Value16,Object.Value14,ChemicalDropper_array56)
		break
	case 2
		break
	case 3
		Object.Value11+=0x10000
		if Object.Value11>=0x580000
			Object.Value11=0x580000
		endif
		TempValue0=Object.Value11
		TempValue0>>=16
		TempValue0-=16
		TempValue0/=24
		GetArrayValue(Object.Value13,TempValue0,ChemicalDropper_array57)
		break
	case 4
		Object.Value14++
		switch Object.Value14
		case 8
			Object.Value17=1
			break
		case 20
			Object.Value17=2
			break
		case 32
			TempValue0=Object.XPos
			if Object.Direction==FLIP_NONE
				TempValue0-=Object.Value11
				TempValue0+=0xC0000
			else
				TempValue0+=Object.Value11
				TempValue0-=0xC0000
			endif
			TempValue1=Object.YPos
			TempValue1-=0x260000
			CreateTempObject(TypeName[ChemicalDrop],0,TempValue0,TempValue1)
			Object[TempObjectPos].DrawOrder=2
			break
		case 40
			Object.Value17=1
			break
		case 48
			Object.Value17=0
			Object.Value12=5
			Object.Value14=0
			if Object.Value18==0
				Object.State=3
			else
				Object.State=0
			endif
			Object.Value18^=1
			break
		case 9
		case 10
		case 11
		case 12
		case 13
		case 14
		case 15
		case 16
		case 17
		case 18
		case 19
		case 21
		case 22
		case 23
		case 24
		case 25
		case 26
		case 27
		case 28
		case 29
		case 30
		case 31
		case 33
		case 34
		case 35
		case 36
		case 37
		case 38
		case 39
		case 41
		case 42
		case 43
		case 44
		case 45
		case 46
		case 47
		endswitch
		break
	case 5
		Object.Value11-=0x10000
		if Object.Value11<=0x100000
			Object.Value11=0x100000
			Object.Value12=0
		endif
		TempValue0=Object.Value11
		TempValue0>>=16
		TempValue0-=16
		TempValue0/=24
		GetArrayValue(Object.Value13,TempValue0,ChemicalDropper_array57)
		break
	endswitch
endsub


sub ObjectDraw
	if Object.State<4
		TempValue0=Object.XPos
		if Object.Direction==FLIP_NONE
			TempValue0-=Object.Value11
		else
			TempValue0+=Object.Value11
		endif
		TempValue1=Object.YPos
		TempValue1-=0x380000
		if Object.Value12==1
			DrawSpriteFX(Object.Value16,FX_FLIP,Object.XPos,Object.YPos)
			DrawSpriteFX(Object.Value15,FX_FLIP,TempValue0,TempValue1)
		endif
		if Object.Value12==2
			DrawSpriteFX(Object.Value15,FX_FLIP,TempValue0,TempValue1)
		endif
		if Object.Value12==3
			DrawSpriteFX(Object.Value15,FX_FLIP,TempValue0,TempValue1)
		endif
		if Object.Value12==4
			if Object.Value14<32
				DrawSpriteFX(Object.Value15,FX_FLIP,TempValue0,TempValue1)
			endif
		endif
		TempValue0=Object.XPos
		if Object.Direction==FLIP_NONE
			TempValue0-=Object.Value11
		else
			TempValue0+=Object.Value11
		endif
		TempValue1=Object.YPos
		TempValue1-=0x380000
		DrawSpriteFX(Object.Value13,FX_FLIP,TempValue0,TempValue1)
		switch Object.Value17
		case 0
			DrawSpriteFX(18,FX_FLIP,TempValue0,TempValue1)
			DrawSpriteFX(13,FX_FLIP,TempValue0,TempValue1)
			break
		case 1
			DrawSpriteFX(16,FX_FLIP,TempValue0,TempValue1)
			DrawSpriteFX(14,FX_FLIP,TempValue0,TempValue1)
			break
		case 2
			DrawSpriteFX(17,FX_FLIP,TempValue0,TempValue1)
			DrawSpriteFX(15,FX_FLIP,TempValue0,TempValue1)
			break
		endswitch
		TempValue0=Object.XPos
		if Object.Direction==FLIP_NONE
			TempValue0+=0x40000
		else
			TempValue0-=0x40000
		endif
		TempValue1=Object.YPos
		TempValue1+=0x190000
		TempValue2=0
		while TempValue2<Object.Value8
			if TempValue2==Object.Value10
				DrawSpriteFX(Object.Value9,FX_FLIP,TempValue0,TempValue1)
			else
				DrawSpriteFX(1,FX_FLIP,TempValue0,TempValue1)
			endif
			TempValue1+=0x80000
			TempValue2++
		loop
		DrawSpriteFX(0,FX_FLIP,Object.XPos,Object.YPos)
	else
		DrawSpriteFX(Object.Frame,FX_FLIP,Object.XPos,Object.YPos)
	endif
endsub


sub ObjectStartup
	CheckStageFolder("Zone02")
	if CheckResult==1
		LoadSpriteSheet("CPZ/Objects.gif")
		SpriteFrame(-5,-68,37,52,55,74)
		SpriteFrame(-4,-4,8,8,61,147)
		SpriteFrame(-5,-4,10,8,59,138)
		SpriteFrame(-6,-4,12,8,57,129)
		SpriteFrame(-5,-60,8,3,93,74)
		SpriteFrame(-5,-60,8,5,93,78)
		SpriteFrame(-4,-60,6,8,93,84)
		SpriteFrame(-4,-60,6,13,93,93)
		SpriteFrame(-5,-60,8,14,93,107)
		SpriteFrame(-4,-50,8,8,93,122)
		SpriteFrame(-4,-46,8,8,93,122)
		SpriteFrame(-4,-4,8,8,93,122)
		SpriteFrame(0,0,48,24,93,131)
		SpriteFrame(1,24,22,2,74,189)
		SpriteFrame(6,24,16,6,74,192)
		SpriteFrame(11,24,16,8,74,199)
		SpriteFrame(-2,24,14,6,74,208)
		SpriteFrame(-4,24,15,8,74,215)
		SpriteFrame(0,0,0,0,0,0)
		SpriteFrame(1,22,22,2,70,131)
		SpriteFrame(1,20,22,4,70,131)
		SpriteFrame(1,18,22,6,70,131)
		SpriteFrame(1,16,22,8,70,131)
		SpriteFrame(1,14,22,10,70,131)
		SpriteFrame(1,12,22,12,70,131)
		SpriteFrame(1,10,22,14,70,131)
		SpriteFrame(1,8,22,16,70,131)
		SpriteFrame(1,6,22,18,70,131)
		SpriteFrame(1,4,22,20,70,131)
		SpriteFrame(1,2,22,22,70,131)
		SpriteFrame(1,0,22,24,70,131)
		SpriteFrame(0,0,72,24,93,131)
		SpriteFrame(3,3,18,29,97,189)
		SpriteFrame(0,0,96,24,93,131)
		SpriteFrame(3,3,18,29,117,189)
		SpriteFrame(0,0,28,24,93,131)
		SpriteFrame(0,2,24,4,121,141)
		SpriteFrame(-5,-68,29,12,55,74)
		SpriteFrame(8,-56,24,24,68,86)
		SpriteFrame(17,-32,14,16,77,110)
		SpriteFrame(-15,-32,22,24,81,156)
		SpriteFrame(-15,-24,30,16,104,156)
		SpriteFrame(-15,-23,31,15,104,173)
	else
		LoadSpriteSheet("MBZ/Objects.gif")
		SpriteFrame(-5,-68,37,52,34,138)
		SpriteFrame(-4,-4,8,8,38,130)
		SpriteFrame(-5,-4,10,8,36,121)
		SpriteFrame(-6,-4,12,8,34,112)
		SpriteFrame(-5,-60,8,3,72,138)
		SpriteFrame(-5,-60,8,5,72,142)
		SpriteFrame(-4,-60,6,8,72,148)
		SpriteFrame(-4,-60,6,13,72,157)
		SpriteFrame(-5,-60,8,14,72,171)
		SpriteFrame(-4,-50,8,8,104,155)
		SpriteFrame(-4,-46,8,8,104,155)
		SpriteFrame(-4,-4,8,8,104,155)
		SpriteFrame(0,0,48,24,70,113)
		SpriteFrame(1,24,22,2,81,163)
		SpriteFrame(6,24,16,6,81,166)
		SpriteFrame(11,24,16,8,81,173)
		SpriteFrame(-2,24,14,6,81,182)
		SpriteFrame(-4,24,15,8,113,156)
		SpriteFrame(0,0,0,0,0,0)
		SpriteFrame(1,22,22,2,47,113)
		SpriteFrame(1,20,22,4,47,113)
		SpriteFrame(1,18,22,6,47,113)
		SpriteFrame(1,16,22,8,47,113)
		SpriteFrame(1,14,22,10,47,113)
		SpriteFrame(1,12,22,12,47,113)
		SpriteFrame(1,10,22,14,47,113)
		SpriteFrame(1,8,22,16,47,113)
		SpriteFrame(1,6,22,18,47,113)
		SpriteFrame(1,4,22,20,47,113)
		SpriteFrame(1,2,22,22,47,113)
		SpriteFrame(1,0,22,24,47,113)
		SpriteFrame(0,0,72,24,70,113)
		SpriteFrame(3,3,18,29,1,64)
		SpriteFrame(0,0,96,24,70,113)
		SpriteFrame(3,3,18,29,21,64)
		SpriteFrame(0,0,28,24,70,113)
		SpriteFrame(0,2,24,4,98,123)
		SpriteFrame(-5,-68,29,12,34,138)
		SpriteFrame(8,-56,24,24,47,150)
		SpriteFrame(17,-32,14,16,56,174)
		SpriteFrame(-15,-32,22,24,81,138)
		SpriteFrame(-15,-24,30,16,104,138)
		SpriteFrame(-15,-23,31,15,135,138)
	endif
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
