//--------------------Sonic 1 / Sonic 2 Chemical Ball Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 55: TYPE_CHEMICALBALL

// Function declarations
#function ChemicalBall_Function131
#function ChemicalBall_Function132
#function ChemicalBall_Function133
#function ChemicalBall_Function134

#constant 0:ChemicalBall_constant46


function ChemicalBall_Function131
	Object[ArrayPos0].XPos=Object[ArrayPos0].Value7
	Object[ArrayPos0].YPos=Object[ArrayPos0].Value8
	Object[ArrayPos0].Value0=Object[ArrayPos0].Value1
	if Object[ArrayPos0].Direction==FLIP_NONE
		Object[ArrayPos0].Value3=0x600000
		Object[ArrayPos0].Value4=0xB00
	else
		Object[ArrayPos0].Value3=-0x600000
		Object[ArrayPos0].Value4=-0xB00
	endif
	Object[ArrayPos0].Value6=-0x48000
	Object[ArrayPos0].XVelocity=0
	Object[ArrayPos0].YVelocity=-0x48000
	Object[ArrayPos0].State=0
	if Object[ArrayPos0].Priority!=PRIORITY_XBOUNDS_DESTROY
		Object[ArrayPos0].Priority=PRIORITY_ACTIVE_BOUNDS
	endif
endfunction


function ChemicalBall_Function132
	DrawSprite(0)
endfunction


function ChemicalBall_Function133
	TempValue0=Object[0].Value17
	TempValue0-=ChemicalBall_constant46
	CreateTempObject(TypeName[ChemicalBall],0,Object.XPos,Object.YPos)
	ArrayPos0=Object[TempObjectPos].EntityNo
	Object[ArrayPos0].Value7=Object.XPos
	Object[ArrayPos0].Value8=Object.YPos
	Object[ArrayPos0].Value2=TempValue0
	Object[ArrayPos0].Value2>>=3
	Object[ArrayPos0].Direction=Object.Direction
	Object[ArrayPos0].Value1=TempValue0
	Object[ArrayPos0].Value1&=7
	CallFunction(ChemicalBall_Function131)
endfunction


function ChemicalBall_Function134
	TempValue0=Screen.CameraXPos
	TempValue1=Object.XPos
	TempValue1>>=16
	TempValue0-=TempValue1
	Absolute(TempValue0)
	TempValue0-=8
	if TempValue0<=Screen.CenterX
		TempValue0=Screen.CameraYPos
		TempValue1=Object.YPos
		TempValue1>>=16
		TempValue0-=TempValue1
		Absolute(TempValue0)
		TempValue0-=8
		if TempValue0<=Screen.CenterY
			PlaySfx(SFXName[ChemicalJump],0)
		endif
	endif
endfunction


sub ObjectMain
	Object.Priority=PRIORITY_ACTIVE
	if Object.State==0
		Object.Value0--
		if Object.Value0<0
			Object.State++
			Object.Value0=59
			CallFunction(ChemicalBall_Function134)
		endif
	else
		Object.XPos+=Object.XVelocity
		Object.YPos+=Object.YVelocity
		Object.YVelocity+=0x1800
		if Object.Value2==0
			Object.XVelocity+=Object.Value4
			if Object.YVelocity==0
				FlipSign(Object.Value4)
			endif
			if Object.YPos>=Object.Value8
				Object.YVelocity=Object.Value6
				Object.XVelocity=0
				Object.State--
			endif
		else
			if Object.YVelocity==0
				Object.XPos+=Object.Value3
			endif
			if Object.YVelocity==0x18000
				CallFunction(ChemicalBall_Function134)
			endif
			if Object.YPos==Object.Value8
				Object.YVelocity=Object.Value6
				Object.XPos=Object.Value7
				FlipSign(Object.Value4)
				CallFunction(ChemicalBall_Function134)
			endif
		endif
	endif
	TempValue0=Screen.CameraXPos
	TempValue1=Object.Value3
	TempValue1>>=1
	TempValue1+=Object.Value7
	TempValue1>>=16
	TempValue0-=TempValue1
	Absolute(TempValue0)
	TempValue0-=192
	if TempValue0>Screen.CenterX
		ArrayPos0=Object.EntityNo
		CallFunction(ChemicalBall_Function131)
	endif
	foreach TypeGroup[256],PlayerObjectPos
		PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-8,8,8,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
		if CheckResult==1
			CallFunction(PlayerObject_Function45)
		endif
	floop
endsub


sub ObjectDraw
	DrawSprite(0)
endsub


sub ObjectStartup
	LoadSpriteSheet("CPZ/Objects.gif")
	SpriteFrame(-8,-8,16,16,207,125)
	foreach TypeName[ChemicalBall],ArrayPos0
		Object[ArrayPos0].Value7=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value8=Object[ArrayPos0].YPos
		GetBit(Object[ArrayPos0].Value2,Object[ArrayPos0].PropertyValue,7)
		GetBit(Object[ArrayPos0].Direction,Object[ArrayPos0].PropertyValue,6)
		Object[ArrayPos0].Value1=Object[ArrayPos0].PropertyValue
		Object[ArrayPos0].Value1&=63
		CallFunction(ChemicalBall_Function131)
	floop
	TempValue0=0
	ChemicalBall_constant46=DebugMode_constant25
	while TempValue0<16
		SetArrayValue(55,DebugMode_constant25,DebugMode_array12)
		SetArrayValue(132,DebugMode_constant25,DebugMode_array13)
		SetArrayValue(133,DebugMode_constant25,DebugMode_array11)
		DebugMode_constant25++
		TempValue0++
	loop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
