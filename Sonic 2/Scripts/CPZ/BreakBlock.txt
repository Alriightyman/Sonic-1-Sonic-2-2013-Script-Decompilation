//--------------------Sonic 1 / Sonic 2 Break Block Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 50: TYPE_BREAKBLOCK

// Function declarations
#function BreakBlock_Function121
#function BreakBlock_Function122



function BreakBlock_Function121
	DrawSprite(0)
endfunction


function BreakBlock_Function122
	CreateTempObject(TypeName[BreakBlock],0,Object.XPos,Object.YPos)
endfunction


sub ObjectMain
	switch Object.State
	case 0
		foreach TypeGroup[256],PlayerObjectPos
			if Object[PlayerObjectPos].Animation==ANI_JUMPING
				PlayerObjectCollision(C_BOX,Object.EntityNo,-16,-16,16,16,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
				if CheckResult==1
					Object[PlayerObjectPos].YVelocity=-0x30000
					Object[PlayerObjectPos].Gravity=GRAVITY_AIR
					CreateTempObject(TypeName[ObjectScore],Object[PlayerObjectPos].Value19,Object.XPos,Object.YPos)
					Object[TempObjectPos].DrawOrder=4
					CreateTempObject(TypeName[BreakBlock],0,Object.XPos,Object.YPos)
					Object[TempObjectPos].iXPos-=8
					Object[TempObjectPos].iYPos-=8
					Object[TempObjectPos].XVelocity=-0x20000
					Object[TempObjectPos].YVelocity=-0x20000
					Object[TempObjectPos].State=1
					Object[TempObjectPos].DrawOrder=5
					CreateTempObject(TypeName[BreakBlock],0,Object.XPos,Object.YPos)
					Object[TempObjectPos].iXPos+=8
					Object[TempObjectPos].iYPos-=8
					Object[TempObjectPos].XVelocity=0x20000
					Object[TempObjectPos].YVelocity=-0x20000
					Object[TempObjectPos].State=2
					Object[TempObjectPos].DrawOrder=5
					CreateTempObject(TypeName[BreakBlock],0,Object.XPos,Object.YPos)
					Object[TempObjectPos].iXPos-=8
					Object[TempObjectPos].iYPos+=8
					Object[TempObjectPos].XVelocity=-0x10000
					Object[TempObjectPos].YVelocity=-0x10000
					Object[TempObjectPos].State=3
					Object[TempObjectPos].DrawOrder=5
					CreateTempObject(TypeName[BreakBlock],0,Object.XPos,Object.YPos)
					Object[TempObjectPos].iXPos+=8
					Object[TempObjectPos].iYPos+=8
					Object[TempObjectPos].XVelocity=0x10000
					Object[TempObjectPos].YVelocity=-0x10000
					Object[TempObjectPos].State=4
					Object[TempObjectPos].DrawOrder=5
					Object.Type=TypeName[BlankObject]
					ArrayPos0=22
					if Object[PlayerObjectPos].Value16==0
						ArrayPos0+=PlayerObjectPos
					endif
					switch Object[PlayerObjectPos].Value19
					case 0
						options.gameMode+=100
						break
					case 1
						options.gameMode+=200
						break
					case 2
						options.gameMode+=500
						break
					case 3
					case 4
					case 5
					case 6
					case 7
					case 8
					case 9
					case 10
					case 11
					case 12
					case 13
					case 14
						options.gameMode+=1000
						break
					case 15
						options.gameMode+=0x2710
						break

					endswitch
					if Object[PlayerObjectPos].Gravity==GRAVITY_AIR
						if Object[PlayerObjectPos].Value19<15
							Object[PlayerObjectPos].Value19++
						endif
					endif
					PlaySfx(SFXName[BlockBreak],0)
				endif
			else
				PlayerObjectCollision(C_BOX,Object.EntityNo,-16,-16,16,16,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			endif
		floop
		break
	case 1
	case 2
	case 3
	case 4
		Object.XPos+=Object.XVelocity
		Object.YPos+=Object.YVelocity
		Object.YVelocity+=0x3800
		if Object.OutOfBounds==1
			Object.Type=TypeName[BlankObject]
		endif
		break

	endswitch
endsub


sub ObjectDraw
	DrawSprite(Object.State)
endsub


sub ObjectStartup
	LoadSpriteSheet("CPZ/Objects.gif")
	SpriteFrame(-16,-16,32,32,165,223)
	SpriteFrame(-8,-8,16,16,165,223)
	SpriteFrame(-8,-8,16,16,181,223)
	SpriteFrame(-8,-8,16,16,165,239)
	SpriteFrame(-8,-8,16,16,181,239)
	SetArrayValue(50,DebugMode_constant25,DebugMode_array12)
	SetArrayValue(121,DebugMode_constant25,DebugMode_array13)
	SetArrayValue(122,DebugMode_constant25,DebugMode_array11)
	DebugMode_constant25++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
