//--------------------Sonic 1 / Sonic 2 VSGame Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 37: TYPE_VSGAME




sub ObjectMain
	switch Object.State
	case 0
		if vs.playerID==0
			if oscillation==500
				EngineCallback(TransmitGlobal,"vs.randomValue",vs.randomValue)
			endif
		endif
		if Object[0].State!=1
			Object.Value1=Object[0].XPos
			Object.Value2=Object[0].YPos
		endif
		if Object[1].State!=1
			Object.Value3=Object[1].XPos
			Object.Value4=Object[1].YPos
		endif
		break
	case 1
		if Object.Value0<384
			Object.Value0+=16
			if Object[0].State==1
				Object.State=2
			endif
			if Object[1].State==1
				Object.State=2
			endif
		else
			Object.State=2
			if Object[1].Type!=TypeName[BlankObject]
				Object[0].State=12
				Object[0].XPos=Object[30].Value3
				Object[0].YPos=Object[30].Value4
				Object[1].State=12
				Object[1].XPos=Object[30].Value1
				Object[1].YPos=Object[30].Value2
				Screen.CameraXPos=Object[0].iXPos
				Screen.CameraYPos=Object[0].iYPos
				TempValue0=Object[0].CollisionPlane
				Object[0].CollisionPlane=Object[1].CollisionPlane
				Object[1].CollisionPlane=TempValue0
				TempValue0=Object[0].Value37
				Object[0].Value37=Object[1].Value37
				Object[1].Value37=TempValue0
				ArrayPos0=0
				ArrayPos0+=PlayerObjectCount
				TempValue0=Object[ArrayPos0].Type
				if PlayerObject_constant3==1
					TempValue0=invincibilityType
					Object[0].Value7=0x4EC
				endif
				ArrayPos1=1
				ArrayPos1+=PlayerObjectCount
				TempValue1=Object[ArrayPos1].Type
				if TempValue0==TempValue1
					if TempValue0!=invincibilityType
						PlayerObjectPos=0
						CallFunction(PlayerObject_Function37)
						PlayerObjectPos=1
						ArrayPos0=ArrayPos1
						CallFunction(PlayerObject_Function37)
					else
						TempValue0=Object[0].Value7
						Object[0].Value7=Object[1].Value7
						Object[1].Value7=TempValue0
					endif
				else
					if TempValue0==invincibilityType
						PlayerObjectPos=0
						CallFunction(PlayerObject_Function37)
						ResetObjectEntity(ArrayPos1,invincibilityType,0,Object[1].XPos,Object[1].YPos)
						Object[ArrayPos1].Priority=PRIORITY_ACTIVE
						TempValue0=Object[0].Value7
						Object[0].Value7=Object[1].Value7
						Object[1].Value7=TempValue0
					else
						if TempValue1==invincibilityType
							ResetObjectEntity(ArrayPos0,invincibilityType,0,Object[0].XPos,Object[0].YPos)
							Object[ArrayPos0].Priority=PRIORITY_ACTIVE
							PlayerObjectPos=1
							ArrayPos0=ArrayPos1
							CallFunction(PlayerObject_Function37)
							TempValue0=Object[0].Value7
							Object[0].Value7=Object[1].Value7
							Object[1].Value7=TempValue0
						else
							PlayerObjectPos=0
							CallFunction(PlayerObject_Function37)
							PlayerObjectPos=1
							ArrayPos0=ArrayPos1
							CallFunction(PlayerObject_Function37)
						endif
					endif
				endif
				TempValue0=Object[0].Value6
				Object[0].Value6=Object[1].Value6
				Object[1].Value6=TempValue0
				PlayerObjectPos=0
				CallFunction(PlayerObject_Function41)
				PlayerObjectPos=1
				CallFunction(PlayerObject_Function41)
				foreach TypeGroup[256],PlayerObjectPos
					switch Object[PlayerObjectPos].PropertyValue
					case 1
					case 2
						if Object[PlayerObjectPos].Value37>1
							Object[PlayerObjectPos].Value37=1
							ArrayPos0=PlayerObjectPos
							ArrayPos0+=PlayerObjectCount
							if Object[ArrayPos0].Type!=invincibilityType
								CallFunction(PlayerObject_Function37)
							endif
						endif
						endswitch
					floop
				endif
			endif
			SetScreenFade(208,255,224,Object.Value0)
			break
		case 2
			if Object.Value0>0
				Object.Value0-=16
			else
				Object.Type=TypeName[BlankObject]
			endif
			SetScreenFade(208,255,224,Object.Value0)
			break
		case 3
			if Object.Value6>0
				Object.Value0++
				if Object.Value0==60
					Object.Value0=0
					Object.Value6--
					if Object.Value6==0
						PlayerObjectPos=Object.Value5
						if Object[PlayerObjectPos].State!=28
							if Object[PlayerObjectPos].Type!=TypeName[DeathEvent]
								if PlayerObjectPos==0
									if vs.playerID==0
										TempValue2=0
									else
										TempValue2=1
									endif
								else
									if vs.playerID==0
										TempValue2=1
									else
										TempValue2=0
									endif
								endif
								if TempValue2==0
									vs.time1P=Stage.Seconds
									vs.time1P*=100
									TempValue2=Stage.Minutes
									TempValue2*=0x1770
									vs.time1P+=TempValue2
									vs.time1P+=Stage.MilliSeconds
								else
									vs.time2P=Stage.Seconds
									vs.time2P*=100
									TempValue2=Stage.Minutes
									TempValue2*=0x1770
									vs.time2P+=TempValue2
									vs.time2P+=Stage.MilliSeconds
								endif
								stage.timeOver=1
								CallFunction(PlayerObject_Function50)
							endif
						endif
					endif
				endif
			endif
			break
		case 4
			if Object.Value0<384
				Object.Value0+=16
			else
				if vs.playerID==0
					vs.rings1P=Object[0].Value0
					vs.rings2P=Object[1].Value0
				else
					vs.rings1P=Object[1].Value0
					vs.rings2P=Object[0].Value0
				endif
				Stage.ActiveList=PRESENTATION_STAGE
				Stage.ListPos=3
				LoadStage()
			endif
			if Object.Value0>0
				SetScreenFade(0,0,0,Object.Value0)
			endif
			break
		case 5
			if Object.Value0==320
				Object[0].Value0=vs.rings1P
				Object[0].Speed=vs.speed
				Object[0].XVelocity=vs.speed
				Object[0].YVelocity=0
				Object[0].Gravity=GRAVITY_GROUND
				Object[0].Value37=vs.items1P
				TempValue0=PlayerObjectPos
				TempValue1=ArrayPos0
				PlayerObjectPos=0
				ArrayPos0=PlayerObjectCount
				ArrayPos0+=PlayerObjectPos
				CallFunction(PlayerObject_Function37)
				PlayerObjectPos=TempValue0
				ArrayPos0=TempValue1
				TempValue0=vs.time1P
				TempValue0/=0x1770
				Stage.Minutes=TempValue0
				TempValue0=vs.time1P
				TempValue0/=100
				TempValue0%=60
				Stage.Seconds=TempValue0
				TempValue0=vs.time1P
				TempValue0%=100
				Stage.MilliSeconds=TempValue0
				TitleCard_constant23=1
			endif
			if Object.Value0<256
				Stage.State=STAGE_RUNNING
				Stage.TimeEnabled=1
				Object[0].Visible=1
			else
				if Stage.ListPos==2
					Object[0].YPos=Object.YPos
				endif
			endif
			if Object.Value0>0
				Object.Value0-=16
			else
				Object.Type=TypeName[BlankObject]
			endif
			SetScreenFade(0,0,0,Object.Value0)
			break
		case 6
			if Object.Value0>-1
				if Object.Value0<320
					Object.Value0+=16
				else
					vs.rings1P=Object[0].Value0
					vs.time1P=Stage.Seconds
					vs.time1P*=100
					TempValue2=Stage.Minutes
					TempValue2*=0x1770
					vs.time1P+=TempValue2
					vs.time1P+=Stage.MilliSeconds
					vs.items1P=Object[0].Value37
					vs.speed=Object[0].Speed
					Stage.ListPos++
					LoadStage()
				endif
				SetScreenFade(0,0,0,Object.Value0)
			else
				if Object[0].XPos>Object.XPos
					Object.Value0=0
				endif
			endif
			break

		endswitch
endsub



sub ObjectDraw
	switch Object.State
	case 0
		TempValue0=vs.playerID
		TempValue0^=1
		DrawSpriteXY(TempValue0,Object[1].XPos,Object[1].YPos)
		break
	case 3
		TempValue0=vs.playerID
		TempValue0^=1
		DrawSpriteXY(TempValue0,Object[1].XPos,Object[1].YPos)
		TempValue0=Object.Value6
		TempValue0/=10
		TempValue0+=2
		TempValue1=Screen.CenterX
		TempValue1-=8
		DrawSpriteScreenXY(TempValue0,TempValue1,13)
		TempValue0=Object.Value6
		TempValue0%=10
		TempValue0+=2
		TempValue1+=8
		DrawSpriteScreenXY(TempValue0,TempValue1,13)
		break
	case 5
		if Object.Value0>256
			DrawRect(0,0,Screen.XSize,Screen.YSize,0,0,0,255)
		endif
		break

	endswitch
endsub


sub ObjectStartup
	LoadSpriteSheet("Global/Display.gif")
	SpriteFrame(-8,-32,16,7,103,48)
	SpriteFrame(-8,-32,16,7,103,56)
	SpriteFrame(0,0,8,11,1,50)
	SpriteFrame(0,0,8,11,10,50)
	SpriteFrame(0,0,8,11,19,50)
	SpriteFrame(0,0,8,11,28,50)
	SpriteFrame(0,0,8,11,1,62)
	SpriteFrame(0,0,8,11,10,62)
	SpriteFrame(0,0,8,11,19,62)
	SpriteFrame(0,0,8,11,28,62)
	SpriteFrame(0,0,8,11,1,74)
	SpriteFrame(0,0,8,11,10,74)
	TempValue0=0
	foreach TypeName[VSGame],ArrayPos0
		switch Object[ArrayPos0].PropertyValue
		case 1
			Object[ArrayPos0].State=5
			Object[ArrayPos0].Value0=320
			Object[ArrayPos0].Priority=PRIORITY_ACTIVE_PAUSED
			Object[ArrayPos0].DrawOrder=6
			Object[0].Visible=0
			Stage.State=STAGE_PAUSED
			TempValue0++
			break
		case 2
			Object[ArrayPos0].State=6
			Object[ArrayPos0].Value0=-1
			Object[ArrayPos0].Priority=PRIORITY_XBOUNDS
			TempValue0++
			break
		default
			Object[ArrayPos0].Type=TypeName[BlankObject]
			endswitch
		floop
		if TempValue0==0
			vs.bossAttack=0
		endif
		if options.vsMode==1
			Object[30].Type=TypeName[VSGame]
			Object[30].Priority=PRIORITY_ACTIVE
			Object[30].DrawOrder=5
			Object[30].Value6=60
		endif
endsub


sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
