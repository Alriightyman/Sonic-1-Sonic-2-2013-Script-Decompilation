//--------------------Sonic 1 / Sonic 2 Player2Object Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 3: TYPE_PLAYER2OBJECT

// Function declarations
#function Player2Object_Function68
#function Player2Object_Function69
#function Player2Object_Function61
#function Player2Object_Function62
#function Player2Object_Function63
#function Player2Object_Function64
#function Player2Object_Function65
#function Player2Object_Function66
#function Player2Object_Function67
#function Player2Object_Function70

#constant 0:Player2Object_constant13
#constant 0:Player2Object_constant14
#constant 0:Player2Object_constant15
#constant 0:Player2Object_constant16
#constant 0:Player2Object_constant17
#constant 0:Player2Object_constant18
#constant 0:Player2Object_constant20
#constant 0:Player2Object_constant19

#array Player2Object_array6:(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
#array Player2Object_array7:(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)

function Player2Object_Function68
	TempValue0=0
endfunction


function Player2Object_Function69
	CheckNotEqual(Object.Value44,68)
	TempValue0=CheckResult
	CheckNotEqual(Object.Up,1)
	TempValue0&=CheckResult
	if TempValue0==0
		CallFunction(PlayerObject_Function8)
	endif
endfunction


function Player2Object_Function61
	if Object.ControlMode>-1
		Player2Object_constant13<<=1
		Player2Object_constant13|=Object[0].Up
		Player2Object_constant13&=0xFFFF
		Player2Object_constant14<<=1
		Player2Object_constant14|=Object[0].Down
		Player2Object_constant14&=0xFFFF
		Player2Object_constant15<<=1
		Player2Object_constant15|=Object[0].Left
		Player2Object_constant15&=0xFFFF
		Player2Object_constant16<<=1
		Player2Object_constant16|=Object[0].Right
		Player2Object_constant16&=0xFFFF
		Player2Object_constant17<<=1
		Player2Object_constant17|=Object[0].JumpPress
		Player2Object_constant17&=0xFFFF
		Player2Object_constant18<<=1
		Player2Object_constant18|=Object[0].JumpHold
		Player2Object_constant18&=0xFFFF
		if Object[0].State==34
			Player2Object_constant14<<=15
			Player2Object_constant15<<=15
			Player2Object_constant16<<=15
			Player2Object_constant17<<=15
			Player2Object_constant18<<=15
		endif
		TempValue0=Player2Object_constant13
		TempValue0>>=15
		Object.Up=TempValue0
		TempValue0=Player2Object_constant14
		TempValue0>>=15
		Object.Down=TempValue0
		TempValue0=Player2Object_constant15
		TempValue0>>=15
		Object.Left=TempValue0
		TempValue0=Player2Object_constant16
		TempValue0>>=15
		Object.Right=TempValue0
		TempValue0=Player2Object_constant17
		TempValue0>>=15
		Object.JumpPress=TempValue0
		TempValue0=Player2Object_constant18
		TempValue0>>=15
		Object.JumpHold=TempValue0
	else
		Player2Object_constant13=0
		Player2Object_constant14=0
		Player2Object_constant15=0
		Player2Object_constant16=0
		Player2Object_constant17=0
		Player2Object_constant18=0
	endif
	if Object[0].State!=28
		if Object[0].Type!=TypeName[DeathEvent]
			SetArrayValue(Object[0].XPos,Player2Object_constant19,Player2Object_array6)
			SetArrayValue(Object[0].YPos,Player2Object_constant19,Player2Object_array7)
			Player2Object_constant19++
			Player2Object_constant19&=15
			Player2Object_constant20++
			Player2Object_constant20&=15
			CheckEqual(Object[0].Gravity,GRAVITY_AIR)
			TempValue0=CheckResult
			CheckEqual(Object[0].Value42,0)
			TempValue0&=CheckResult
			if TempValue0==0
				GetArrayValue(Object.Value46,Player2Object_constant20,Player2Object_array6)
				GetArrayValue(Object.Value47,Player2Object_constant20,Player2Object_array7)
			else
				Object.Value46=Object[0].XPos
				Object.Value47=Object[0].YPos
			endif
		else
			TempValue0=Player2Object_constant19
			TempValue0--
			if TempValue0<0
				TempValue0+=16
			endif
			GetArrayValue(Object.Value46,TempValue0,Player2Object_array6)
			GetArrayValue(Object.Value47,TempValue0,Player2Object_array7)
		endif
	else
		TempValue0=Player2Object_constant19
		TempValue0--
		if TempValue0<0
			TempValue0+=16
		endif
		GetArrayValue(Object.Value46,TempValue0,Player2Object_array6)
		GetArrayValue(Object.Value47,TempValue0,Player2Object_array7)
	endif
endfunction


function Player2Object_Function62
	CallFunction(Player2Object_Function61)
	if Object[0].Type==TypeName[PlayerObject]
		TempValue0=Object.Angle
		TempValue0+=16
		TempValue0&=224
		if TempValue0==0
			if Object.Left==1
				TempValue0=Object[0].XPos
				TempValue0-=0x80000
				if Object.XPos<TempValue0
					if Object.XVelocity<=0
						Object.Left=0
					endif
				endif
			endif
			if Object.Right==1
				TempValue0=Object[0].XPos
				TempValue0+=0x80000
				if Object.XPos>TempValue0
					if Object.YVelocity<=0
						Object.Right=0
					endif
				endif
			endif
		endif
		if Object[0].State!=34
			TempValue0=Object.Value46
			TempValue1=Object[0].Gravity
			TempValue1|=Object[0].Value42
			if TempValue1==0
				if Object[0].Speed<0x20000
					if Object[0].Speed>-0x20000
						if Object[0].Direction==FLIP_NONE
							TempValue0-=0x200000
						else
							TempValue0+=0x200000
						endif
					endif
				endif
			endif
			TempValue0-=Object.XPos
			if TempValue0!=0
				if TempValue0<0
					if TempValue0<=-0x300000
						Object.Right=0
						Object.Left=1
					endif
					if Object.Speed!=0
						if Object.Direction==FLIP_X
							Cos256(TempValue1,Object.Angle)
							TempValue1*=192
							Object.XPos-=TempValue1
						endif
					endif
				else
					if TempValue0>=0x300000
						Object.Left=0
						Object.Right=1
					endif
					if Object.Speed!=0
						if Object.Direction==FLIP_NONE
							Cos256(TempValue1,Object.Angle)
							TempValue1*=192
							Object.XPos+=TempValue1
						endif
					endif
				endif
			endif
			if Object.Animation==ANI_PUSHING
				Object.Value45++
				if Object[0].Direction==Object.Direction
					if Object[0].Animation==ANI_PUSHING
						Object.Value45=0
					endif
				endif
				if Object.Value45>=30
					if Object.Gravity==GRAVITY_GROUND
						CallFunction(PlayerObject_Function6)
					endif
					Object.Value1=0
					Object.Value45=0
				endif
			else
				TempValue0=Object.YPos
				TempValue0-=Object.Value47
				if TempValue0>0x200000
					Object.Value45++
					if Object.Value45>=64
						if Object.Gravity==GRAVITY_GROUND
							CallFunction(PlayerObject_Function6)
						endif
						Object.Value1=0
						Object.Value45=0
					endif
				else
					Object.Value45=0
				endif
			endif
			if Object.ControlLock>0
				if Object.Speed<0x8000
					if Object.Speed>-0x8000
						Object.Value44=63
					endif
				endif
			endif
		endif
	endif
endfunction


function Player2Object_Function63
	Object.Up=0
	Object.Down=0
	Object.Left=0
	Object.Right=0
	Object.JumpPress=0
	Object.JumpHold=0
	if Object.ControlLock==0
		if Object.Gravity==GRAVITY_GROUND
			if Object.Speed<0x4000
				if Object.Speed>-0x4000
					Object.Value44=64
					Object.Value45=1
					if Object.Animation!=ANI_SPINDASH
						if Object.XPos<Object.Value46
							Object.Direction=FLIP_NONE
						else
							Object.Direction=FLIP_X
						endif
						Object.Down=1
					endif
				endif
			endif
		endif
	endif
endfunction


function Player2Object_Function64
	if Object.Value45<64
		Object.Down=1
		TempValue0=Object.Value45
		TempValue0&=15
		if TempValue0==0
			Object.JumpPress=1
		else
			Object.JumpPress=0
		endif
		Object.Value45++
	else
		Object.Value45=0
		Object.Down=0
		Object.JumpPress=0
		Object.Value44=62
	endif
endfunction


function Player2Object_Function65
	CallFunction(Player2Object_Function61)
	if Object.Value25==0x3800
		Object.Animation=ANI_FLYING
	else
		Object.Animation=ANI_SWIMMING
	endif
	TempValue0=Object.Value46
	TempValue0-=Object.XPos
	TempValue1=TempValue0
	TempValue0>>=4
	if Object.XPos<Object.Value46
		Object.Direction=FLIP_NONE
		if TempValue0>0xC0000
			TempValue0=0xC0000
		endif
		if Object[0].XVelocity>0
			TempValue0+=Object[0].XVelocity
		endif
		TempValue0+=0x10000
		if TempValue0>TempValue1
			TempValue0=TempValue1
			TempValue1=0
		endif
	else
		Object.Direction=FLIP_X
		if TempValue0<-0xC0000
			TempValue0=-0xC0000
		endif
		if Object[0].XVelocity<0
			TempValue0+=Object[0].XVelocity
		endif
		TempValue0-=0x10000
		if TempValue0<TempValue1
			TempValue0=TempValue1
			TempValue1=0
		endif
	endif
	Object.XPos+=TempValue0
	if Object.YPos<Object.Value47
		Object.YPos+=0x10000
	endif
	if Object.YPos>Object.Value47
		Object.YPos-=0x10000
	endif
	if Object[0].Type!=TypeName[DeathEvent]
		if Object[0].State!=28
			if Object[0].State!=29
				if Object[0].State!=31
					if TempValue1==0
						TempValue0=Object.Value47
						TempValue0-=Object.YPos
						if TempValue0<0
							FlipSign(TempValue0)
						endif
						if TempValue0<0x20000
							Object.State=12
							Object.Animation=ANI_JUMPING
							Object.Gravity=GRAVITY_AIR
							Object.TileCollisions=1
							Object.ObjectInteractions=1
							Object.ControlMode=1
							Object.ControlLock=0
							Object.Angle=0
							Object.Value44=62
							Object.CollisionPlane=Object[0].CollisionPlane
							Player2Object_constant13=0
							Player2Object_constant14=0
							Player2Object_constant15=0
							Player2Object_constant16=0
							Player2Object_constant17=0
							Player2Object_constant18=0
						endif
					endif
				endif
			endif
		endif
	endif
endfunction


function Player2Object_Function66
	if Object[0].Type==TypeName[PlayerObject]
		if Object.OutOfBounds==1
			Object.Value43++
		else
			Object.Value43=0
		endif
		if Object.Value43>239
			Object.Value43=0
			Object.State=65
			Object.XPos=Object[0].XPos
			Object.YPos=Screen.YOffset
			Object.YPos-=128
			Object.YPos<<=16
			Object.XVelocity=0
			Object.YVelocity=0
			Object.Speed=0
			Object.TileCollisions=0
			Object.ObjectInteractions=0
			Object.ControlMode=1
			Object.Value18=4
			Object.Value3=0
			Object.Value4=0
		endif
		CheckEqual(Object[0].State,28)
		TempValue0=CheckResult
		CheckEqual(Object[0].Type,TypeName[DeathEvent])
		TempValue0|=CheckResult
		CheckNotEqual(Object.State,27)
		TempValue0&=CheckResult
		CheckNotEqual(Object.State,28)
		TempValue0&=CheckResult
		if TempValue0==1
			Object.Value43=0
			Object.State=65
			Object.XVelocity=0
			Object.YVelocity=0
			Object.Speed=0
			Object.TileCollisions=0
			Object.ObjectInteractions=0
		endif
	endif
endfunction


function Player2Object_Function67
	if Object.State==28
		Object.Value44=68
	endif
	if Object.State==29
		Object.Value44=68
	endif
	CallFunction(Object.Value44)
	if Object.State!=27
		if Object.Value8>0
			Object.Value8--
			GetBit(TempValue0,Object.Value8,2)
			if TempValue0==1
				Object.Visible=0
			else
				Object.Visible=1
			endif
		endif
	endif
	if Object.Value7>0
		if Object.State!=27
			if Object.Value7>0x7D0
				Object.Value7=120
				Object.Value8=3
			endif
		endif
		Object.Value7--
		if Object.Value7==0
			Object.Value8=0
			Object.Visible=1
		endif
	endif
	if Object.State!=16
		if Object.State!=17
			if Object.LookPos>0
				Object.LookPos-=2
			endif
			if Object.LookPos<0
				Object.LookPos+=2
			endif
		endif
	endif
	if Object.State!=19
		if Object.Value26!=0
			StopSfx(SFXName[Flying])
			StopSfx(SFXName[Tired])
			Object.Value26=0
		endif
	endif
endfunction


function Player2Object_Function70
	EngineCallback(ReceiveEntity,Object.EntityNo,1)
	Object.Type=TypeName[Player2Object]
	if Object.Value6>0
		Object.Value6--
		if Object.Value6<1
			PlayerObjectPos=Object.EntityNo
			CallFunction(PlayerObject_Function41)
			TempValue0=0
			foreach TypeGroup[256],PlayerObjectPos
				TempValue0+=Object[PlayerObjectPos].Value6
			floop
			if TempValue0==0
				if SlowDownMusic!=0
					CallFunction(SlowDownMusic)
				endif
			endif
			Object.Value6=0
		endif
	endif
	if Object.State!=27
		if Object.Value8>0
			Object.Value8--
			GetBit(TempValue0,Object.Value8,2)
			if TempValue0==1
				Object.Visible=0
			else
				Object.Visible=1
			endif
		endif
	endif
	if Object.Value7>0
		Object.Value7--
		if Object.Value7==0
			TempValue0=0
			foreach TypeGroup[256],PlayerObjectPos
				TempValue0+=Object[PlayerObjectPos].Value7
			floop
			if TempValue0==0
				if Music.CurrentTrack==2
					PlayMusic(0)
				endif
			endif
			if Object[+PlayerObjectCount].Type==invincibilityType
				PlayerObjectPos=Object.EntityNo
				ArrayPos0=PlayerObjectPos
				ArrayPos0+=PlayerObjectCount
				CallFunction(PlayerObject_Function37)
			endif
		endif
	endif
	if Object.State!=16
		if Object.State!=17
			if Object.LookPos>0
				Object.LookPos-=2
			endif
			if Object.LookPos<0
				Object.LookPos+=2
			endif
		endif
	endif
	if Object.Value11>0
		Object.Value11--
		if Object.Value11==0
			if Object.EntityNo==Screen.CameraTarget
				Screen.CameraStyle=0
			endif
		endif
	endif
	if Object.State!=19
		if Object.Value26!=0
			StopSfx(SFXName[Flying])
			StopSfx(SFXName[Tired])
			Object.Value26=0
		endif
	endif
endfunction


sub ObjectMain
	if options.vsMode==0
		CallFunction(Player2Object_Function67)
		CallFunction(Object.State)
		ProcessObjectAnimation()
		CallFunction(TailsObject_Function60)
	else
		CallFunction(Player2Object_Function70)
		CallFunction(Object.State)
		ProcessObjectAnimation()
		if Object.PropertyValue==1
			CallFunction(TailsObject_Function60)
		endif
	endif
	if Object.EntityNo==Screen.CameraTarget
		if Object.Animation==ANI_JUMPING
			Screen.AdjustCameraY=Object.Value30
		else
			if Screen.AdjustCameraY==Object.Value30
				Screen.AdjustCameraY=0
				Object.iYPos+=Object.Value30
			endif
		endif
	endif
	if Object.Value34==0
		TempValue0=Object.Value42
		Object.Value42=Object.Gravity
		PlayerTileCollision()
		Object.Value42^=1
		CheckEqual(Object.Gravity,GRAVITY_GROUND)
		Object.Value42|=CheckResult
		Object.Value42^=1
		if TempValue0==1
			if Object.Value42==0
				Object.Value19=0
				if Object.Animation==ANI_JUMPING
					if Object.Down==0
						if Object.State!=14
							if Object.State!=31
								Object.Animation=ANI_WALKING
								if Object.EntityNo==Screen.CameraTarget
									Screen.AdjustCameraY=0
								endif
								Object.iYPos+=Object.Value30
							endif
						endif
					endif
				endif
			endif
		endif
	else
		Object.Value34=0
	endif
	if options.vsMode==0
		CallFunction(Player2Object_Function66)
	endif
endsub


sub ObjectDraw
	if Object.Animation!=Object.PrevAnimation
		Object.PrevAnimation=Object.Animation
		Object.Frame=0
		Object.AnimationTimer=0
		Object.AnimationSpeed=0
	endif
	if Object.PropertyValue==1
		if Object.Value13!=Object.Animation
			if Object.Animation>4
				Object.Value12=0
			endif
			if Object.Value13>4
				Object.Value12=0
			endif
			Object.Value13=Object.Animation
		endif
		switch Object.Value13
		case 0
			if Object.Frame==0
				TempValue0=Object.Value12
				TempValue0>>=3
				if Object.Visible==1
					DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
				endif
			endif
			break
		case 1
		case 3
		case 4
		case 21
		case 36
		case 37
			TempValue0=Object.Value12
			TempValue0>>=3
			if Object.Visible==1
				DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
			endif
			break
		case 7
		case 9
			TempValue0=Object.Value12
			TempValue0>>=2
			TempValue0+=11
			if Object.Visible==1
				DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
			endif
			break
		case 10
		case 43
			TempValue0=Object.Value12
			TempValue0>>=2
			CheckEqual(Object.XVelocity,0)
			TempValue1=CheckResult
			CheckEqual(Object.YVelocity,0)
			TempValue1&=CheckResult
			TempValue2=Object.Rotation
			if TempValue1==0
				ATan2(Object.Rotation,Object.XVelocity,Object.YVelocity)
				Object.Rotation+=16
				Object.Rotation&=255
				Object.Rotation>>=5
				switch Object.Rotation
				case 0
				case 8
					TempValue0+=5
					Object.Rotation=0
					break
				case 1
					TempValue0+=8
					if Object.Direction==FLIP_NONE
						Object.Rotation=64
					else
						Object.Rotation=0
					endif
					break
				case 2
					TempValue0+=5
					Object.Rotation=64
					break
				case 3
					TempValue0+=8
					if Object.Direction==FLIP_NONE
						Object.Rotation=128
					else
						Object.Rotation=64
					endif
					break
				case 4
					TempValue0+=5
					Object.Rotation=128
					break
				case 5
					TempValue0+=8
					if Object.Direction==FLIP_NONE
						Object.Rotation=192
					else
						Object.Rotation=128
					endif
					break
				case 6
					TempValue0+=5
					Object.Rotation=192
					break
				case 7
					TempValue0+=8
					if Object.Direction==FLIP_NONE
						Object.Rotation=0
					else
						Object.Rotation=192
					endif
					break

				endswitch
				if Object.Direction==FLIP_X
					Object.Rotation+=128
				endif
			else
				TempValue0+=5
				Object.Rotation=0
			endif
			Object.Rotation<<=1
			if Object.Visible==1
				DrawSpriteFX(TempValue0,FX_ROTATE,Object.XPos,Object.YPos)
			endif
			Object.Rotation=TempValue2
			break
		case 17
			TempValue0=Object.Value12
			TempValue0/=10
			TempValue0+=11
			if Object.Visible==1
				DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
			endif
			break

		endswitch
	endif
	DrawObjectAnimation()
endsub


sub ObjectStartup
	Player2Object_constant20=1
	Player2Object_constant19=0
	Player2Object_constant13=0
	Player2Object_constant14=0
	Player2Object_constant15=0
	Player2Object_constant16=0
	Player2Object_constant17=0
	Player2Object_constant18=0
	TempValue7=0
	if options.vsMode==1
		ResetObjectEntity(1,TypeName[Player2Object],1,Object[0].XPos,Object[0].YPos)
		vs.restartX1=Object[0].XPos
		vs.restartY1=Object[0].YPos
		vs.restartX2=Object[0].XPos
		vs.restartY2=Object[0].YPos
		Object[1].TypeGroup=256
		Object[1].State=12
		Object[1].Priority=PRIORITY_ACTIVE
		Object[1].DrawOrder=-1
		Object[1].Value18=4
		Object[1].Value31=0x2000
		Object[1].Value33=7
		PlayerObjectPos=1
		CallFunction(PlayerObject_Function41)
		Object[1].Value38=0x10000
		Object[1].Value39=0x10000
		Object[1].Value40=0x10000
		Object[1].Value41=0x10000
		switch vs.player2Type
		case 0
			LoadAnimation("Sonic.ani")
			Object[1].PropertyValue=0
			Object[1].Value30=-5
			Object[1].Value32=58
			ANI_PEELOUT=ANI_RUNNING
			break
		case 1
			LoadAnimation("Tails.ani")
			Object[1].PropertyValue=1
			Object[1].Value30=-1
			Object[1].Value32=8
			stage.player2Enabled=0
			break
		case 2
			LoadAnimation("Knuckles.ani")
			Object[1].PropertyValue=2
			Object[1].Value30=-5
			Object[1].Value32=9
			ANI_PEELOUT=ANI_RUNNING
			break

		endswitch
		stage.player2Enabled=0
		PlayerObjectCount=2
		TempValue7=1
	endif
	if stage.player2Enabled==1
		ResetObjectEntity(1,TypeName[Player2Object],1,Object[0].XPos,Object[0].YPos)
		if starPostID==0
			Object[1].XPos-=0x100000
		endif
		LoadAnimation("Tails.ani")
		Object[1].TypeGroup=256
		Object[1].PropertyValue=1
		Object[1].State=12
		Object[1].Priority=PRIORITY_ACTIVE
		Object[1].ControlMode=0
		Object[1].DrawOrder=-1
		Object[1].Value18=4
		PlayerObjectPos=1
		CallFunction(PlayerObject_Function41)
		Object[1].Value31=0x2000
		Object[1].Value30=-1
		Object[1].Value16=1
		Object[1].Value32=69
		Object[1].Value33=7
		CheckStageFolder("Continue")
		if CheckResult==1
			Object[1].Value44=68
		else
			Object[1].Value44=62
		endif
		TempValue0=0
		while TempValue0<16
			SetArrayValue(Object[0].XPos,TempValue0,Player2Object_array6)
			SetArrayValue(Object[0].YPos,TempValue0,Player2Object_array7)
			TempValue0++
		loop
		Object[1].Value38=0x10000
		Object[1].Value39=0x10000
		Object[1].Value40=0x10000
		Object[1].Value41=0x10000
		TempValue7=1
	endif
	if TempValue7==1
		LoadSpriteSheet("Players/Tails1.gif")
		SpriteFrame(-22,-8,16,24,82,199)
		SpriteFrame(-26,-8,20,24,99,199)
		SpriteFrame(-26,-8,20,24,120,199)
		SpriteFrame(-26,-8,20,24,141,199)
		SpriteFrame(-26,-8,20,24,162,199)
		SpriteFrame(-35,-8,24,16,231,166)
		SpriteFrame(-35,-8,24,16,231,183)
		SpriteFrame(-35,-8,24,16,231,200)
		SpriteFrame(-25,9,20,16,235,217)
		SpriteFrame(-25,9,18,16,237,234)
		SpriteFrame(-25,9,20,16,216,234)
		SpriteFrame(-30,-6,24,16,231,166)
		SpriteFrame(-30,-6,24,16,231,183)
		SpriteFrame(-30,-6,24,16,231,200)
	endif
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
