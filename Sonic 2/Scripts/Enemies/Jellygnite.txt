//--------------------Sonic 1 / Sonic 2 Jellygnite Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 69: TYPE_JELLYGNITE

// Function declarations
#function Jellygnite_Function143
#function Jellygnite_Function144
#function Jellygnite_Function145



function Jellygnite_Function143
	DrawSpriteFX(0,FX_FLIP,Object.XPos,Object.YPos)
endfunction


function Jellygnite_Function144
	CreateTempObject(TypeName[Jellygnite],0,Object.XPos,Object.YPos)
	Object[TempObjectPos].Value1=Object[TempObjectPos].XPos
	Object[TempObjectPos].Value2=Object[TempObjectPos].YPos
	Object[TempObjectPos].Value12=0x7FFFFFFF
endfunction


function Jellygnite_Function145
	if Object.Value12!=0x7FFFFFFF
		PlayerObjectPos=Object.Value12
		if Object.Value15!=0
			Object.Value13--
			if Object.Value13==0
				Object.Value14=0
				Object.Value15=0
			endif
			TempValue0=0
			if Object[PlayerObjectPos].Left!=0
				TempValue0|=1
			endif
			if Object[PlayerObjectPos].Right!=0
				TempValue0|=2
			endif
			if TempValue0!=0
				if TempValue0!=3
					if TempValue0!=Object.Value15
						Object.Value15=TempValue0
						Object.Value14++
						if Object.Value14>=4
							Object[PlayerObjectPos].State=12
							Object.Value12=0x7FFFFFFF
						else
							Object.Value13=32
						endif
					endif
				endif
			endif
		else
			if Object[PlayerObjectPos].Left!=0
				Object.Value15|=1
				Object.Value13=32
			endif
			if Object[PlayerObjectPos].Right!=0
				Object.Value15|=2
				Object.Value13=32
			endif
		endif
		Object[PlayerObjectPos].XPos=Object.XPos
		Object[PlayerObjectPos].YPos=Object.YPos
		Object[PlayerObjectPos].YPos+=0xC0000
	endif
endfunction


sub ObjectMain
	switch Object.State
	case 0
		if Object.Priority!=PRIORITY_XBOUNDS_DESTROY
			Object.Priority=PRIORITY_ACTIVE
		endif
		Object.Angle+=4
		Object.Angle&=511
		Sin(Object.Value3,Object.Angle)
		Object.Value3<<=1
		Object.Value8++
		Object.Value8&=511
		Sin(Object.XPos,Object.Value8)
		Object.XPos<<=11
		Object.XPos+=Object.Value1
		TempValue1=0x7FFFFFFF
		TempValue2=0
		foreach TypeGroup[256],PlayerObjectPos
			TempValue0=Object.XPos
			TempValue0-=Object[PlayerObjectPos].XPos
			Absolute(TempValue0)
			if TempValue0<TempValue1
				TempValue1=TempValue0
				TempValue2=PlayerObjectPos
			endif
		floop
		PlayerObjectPos=TempValue2
		if Object[PlayerObjectPos].YPos>stage.newWaterLevel
			TempValue2=Object[PlayerObjectPos].YPos
			TempValue2-=0x200000
			if Object.YPos>TempValue2
				Object.YVelocity-=0x800
				if Object.YVelocity<-0xC000
					Object.YVelocity=-0xC000
				endif
			else
				Object.YVelocity+=0x800
				if Object.YVelocity>0xC000
					Object.YVelocity=0xC000
				endif
			endif
		else
			Object.YVelocity>>=1
		endif
		Object.YPos+=Object.YVelocity
		break
	case 1
		if Object.Value3<0x600
			Object.Value3+=128
		else
			Object.State=2
			Object.Animation=2
			PlaySfx(SFXName[Electricity],0)
		endif
		PlayerObjectPos=Object.Value12
		Object[PlayerObjectPos].XPos=Object.XPos
		Object[PlayerObjectPos].YPos=Object.YPos
		Object[PlayerObjectPos].YPos+=0xC0000
		Object[PlayerObjectPos].Frame=0
		Object[PlayerObjectPos].AnimationTimer=0
		break
	case 2
		CallFunction(Jellygnite_Function145)
		Object.Value0++
		if Object.Value0==60
			if Object.Value12!=0x7FFFFFFF
				PlayerObjectPos=Object.Value12
				if Object[PlayerObjectPos].State!=29
					Object[PlayerObjectPos].State=12
					CallFunction(PlayerObject_Function45)
				endif
				Object.Value12=0x7FFFFFFF
			endif
			ResetObjectEntity(Object.EntityNo,TypeName[SmokePuff],0,Object.XPos,Object.YPos)
			Object.DrawOrder=4
			PlaySfx(SFXName[Destroy],0)
		endif
		break

	endswitch
	if Object.Type==TypeName[Jellygnite]
		if Object.OutOfBounds==1
			TempValue0=Object.XPos
			TempValue1=Object.YPos
			Object.XPos=Object.Value1
			Object.YPos=Object.Value2
			if Object.OutOfBounds==1
				Object.Animation=0
				if Object.Priority!=PRIORITY_XBOUNDS_DESTROY
					Object.Priority=PRIORITY_ACTIVE_BOUNDS
				endif
				Object.State=0
			else
				Object.XPos=TempValue0
				Object.YPos=TempValue1
			endif
		endif
		TempValue7=Object.Value12
		foreach TypeGroup[256],PlayerObjectPos
			if PlayerObjectPos!=TempValue7
				PlayerObjectCollision(C_TOUCH,Object.EntityNo,-14,-14,14,14,PlayerObjectPos,Object[PlayerObjectPos].Value40,Object[PlayerObjectPos].Value38,Object[PlayerObjectPos].Value41,Object[PlayerObjectPos].Value39)
				if CheckResult==1
					if Object.State==0
						if Object[PlayerObjectPos].YPos<Object.YPos
							CallFunction(PlayerObject_Function44)
						else
							Object.State=1
							Object.Animation=1
							Object.Value12=PlayerObjectPos
							Object[PlayerObjectPos].XVelocity=0
							Object[PlayerObjectPos].YVelocity=0
							Object[PlayerObjectPos].Speed=0
							Object[PlayerObjectPos].Value1=0
							Object[PlayerObjectPos].State=1
							Object[PlayerObjectPos].Gravity=GRAVITY_AIR
							Object[PlayerObjectPos].Animation=ANI_GRABBED
						endif
					else
						if Object[PlayerObjectPos].YPos<Object.YPos
							CallFunction(PlayerObject_Function44)
						endif
					endif
				endif
			endif
		floop
		if Object.Type==TypeName[Jellygnite]
			switch Object.Animation
			case 0
				Object.Frame=0
				Object.Value9=3
				Object.Value10=5
				break
			case 1
				Object.Frame=1
				Object.Value9=3
				Object.Value10=5
				break
			case 2
				Object.Frame=Object.AnimationTimer
				Object.Frame>>=5
				Object.Value9=Object.Frame
				Object.Value9+=3
				Object.Value10=Object.Frame
				Object.Value10+=5
				Object.Frame++
				Object.AnimationTimer+=Object.Value0
				Object.AnimationTimer&=63
				break

			endswitch
		else
			if TempValue7!=0x7FFFFFFF
				PlayerObjectPos=TempValue7
				if Object[PlayerObjectPos].State==1
					Object[PlayerObjectPos].State=12
				endif
			endif
		endif
	else
		if Object.Value12!=0x7FFFFFFF
			PlayerObjectPos=Object.Value12
			if Object[PlayerObjectPos].State==1
				Object[PlayerObjectPos].State=12
			endif
		endif
	endif
endsub


sub ObjectDraw
	if Object.Value11==0
		TempValue1=Object.Angle
		TempValue1&=511
		TempValue0=0
		TempValue2=Object.YPos
		TempValue2+=0x70000
		while TempValue0<4
			Cos(Object.Value6,TempValue1)
			Object.Value6<<=9
			Object.Value6+=Object.XPos
			Sin(Object.Value7,TempValue1)
			Object.Value7<<=8
			Object.Value7+=TempValue2
			DrawSpriteXY(Object.Value10,Object.Value6,Object.Value7)
			TempValue0++
			TempValue1+=32
			TempValue1&=511
			TempValue2+=0x60000
		loop
		AddDrawListEntityRef(4,Object.EntityNo)
	else
		TempValue0=0
		TempValue4=Object.Value3
		Object.Value4=0
		Object.Value5=0
		while TempValue0<4
			TempValue5=TempValue4
			TempValue5>>=7
			TempValue5&=511
			Sin(TempValue2,TempValue5)
			TempValue2*=786
			Object.Value4+=TempValue2
			Cos(TempValue3,TempValue5)
			TempValue3*=786
			Object.Value5+=TempValue3
			Object.Value6=Object.Value4
			Object.Value6+=Object.XPos
			Object.Value6-=0xD0000
			Object.Value7=Object.Value5
			Object.Value7+=Object.YPos
			Object.Value7+=0x10000
			DrawSpriteXY(Object.Value9,Object.Value6,Object.Value7)
			Object.Value6=Object.Value4
			FlipSign(Object.Value6)
			Object.Value6+=Object.XPos
			Object.Value6+=0xD0000
			DrawSpriteXY(Object.Value9,Object.Value6,Object.Value7)
			TempValue0++
			TempValue4+=Object.Value3
		loop
		DrawSpriteFX(Object.Frame,FX_FLIP,Object.XPos,Object.YPos)
	endif
	Object.Value11^=1
endsub


sub ObjectStartup
	LoadSpriteSheet("HPZ/Objects.gif")
	SpriteFrame(-16,-16,32,20,33,123)
	SpriteFrame(-16,-16,32,20,66,123)
	SpriteFrame(-16,-16,32,20,40,144)
	SpriteFrame(-3,-3,6,6,198,50)
	SpriteFrame(-3,-3,6,6,131,97)
	SpriteFrame(-3,-3,6,6,33,144)
	SpriteFrame(-3,-3,6,6,131,90)
	foreach TypeName[Jellygnite],ArrayPos0
		Object[ArrayPos0].Value1=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value2=Object[ArrayPos0].YPos
		Object[ArrayPos0].Value12=0x7FFFFFFF
	floop
	SetArrayValue(69,DebugMode_constant25,DebugMode_array12)
	SetArrayValue(143,DebugMode_constant25,DebugMode_array13)
	SetArrayValue(144,DebugMode_constant25,DebugMode_array11)
	DebugMode_constant25++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
