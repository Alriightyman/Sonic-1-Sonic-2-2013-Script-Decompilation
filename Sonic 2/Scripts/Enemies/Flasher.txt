//--------------------Sonic 1 / Sonic 2 Flasher Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 57: TYPE_FLASHER

// Function declarations
#function Flasher_Function137
#function Flasher_Function138


#array Flasher_array41:(256,416,520,645,768,832,912,0x440,0xF000)
#array Flasher_array42:(1,1,0,1,1,1,0,1,0,1,1,0,0,1,0,1)
#array Flasher_array43:(1,0,0,0,0,0,1,0,0,0,0,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0)
#array Flasher_array44:(2,3,4,3,2,0,2,0,3,0,4,0,3,0)
#array Flasher_array45:(4,4,4,4,3,3,3,3,2,2,2,2,1,1,1,1,0,0,0,0)

function Flasher_Function137
	DrawSpriteFX(0,FX_FLIP,Object.XPos,Object.YPos)
endfunction


function Flasher_Function138
	CreateTempObject(TypeName[Flasher],0,Object.XPos,Object.YPos)
endfunction


sub ObjectMain
	switch Object.State
	case 0
		Object.Value0++
		if Object.Value0==64
			Object.Value0=128
			Object.XVelocity=-0x10000
			Object.YVelocity=0x4000
			Object.Speed=512
			Object.State=1
			if Object.Priority!=PRIORITY_XBOUNDS_DESTROY
				Object.Priority=PRIORITY_ACTIVE
			endif
		endif
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-8,8,8,PlayerObjectPos,Object[PlayerObjectPos].Value40,Object[PlayerObjectPos].Value38,Object[PlayerObjectPos].Value41,Object[PlayerObjectPos].Value39)
			if CheckResult==1
				CallFunction(PlayerObject_Function44)
			endif
		floop
		break
	case 1
		if Object.Value0>0
			Object.Value0--
			if Object.XVelocity<0
				Object.Direction=FLIP_NONE
			else
				Object.Direction=FLIP_X
			endif
			GetArrayValue(TempValue0,Object.Value2,Flasher_array41)
			Object.Value1++
			if Object.Value1==TempValue0
				GetArrayValue(Object.Value3,Object.Value4,Flasher_array42)
				if Object.Value3==1
					FlipSign(Object.Speed)
				endif
				Object.Value4++
				GetArrayValue(Object.Value3,Object.Value4,Flasher_array42)
				if Object.Value3==1
					FlipSign(Object.YVelocity)
				endif
				Object.Value4++
				Object.Value4&=15
				Object.Value2++
				if Object.Value2==10
					Object.Value2=0
					Object.Value1=0
				endif
			endif
			Object.XVelocity+=Object.Speed
			Object.XPos+=Object.XVelocity
			Object.YPos+=Object.YVelocity
		else
			Object.State=2
		endif
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-8,8,8,PlayerObjectPos,Object[PlayerObjectPos].Value40,Object[PlayerObjectPos].Value38,Object[PlayerObjectPos].Value41,Object[PlayerObjectPos].Value39)
			if CheckResult==1
				CallFunction(PlayerObject_Function44)
			endif
		floop
		break
	case 2
		GetArrayValue(Object.Frame,Object.Value0,Flasher_array43)
		Object.Value0++
		if Object.Value0==26
			Object.Value0=0
			Object.State=3
		endif
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-8,8,8,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			if Object[PlayerObjectPos].Value37!=4
				if CheckResult==1
					CallFunction(PlayerObject_Function47)
				else
					PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-8,8,8,PlayerObjectPos,Object[PlayerObjectPos].Value40,Object[PlayerObjectPos].Value38,Object[PlayerObjectPos].Value41,Object[PlayerObjectPos].Value39)
					if CheckResult==1
						CallFunction(PlayerObject_Function44)
					endif
				endif
			else
				if CheckResult==1
					CallFunction(PlayerObject_Function44)
				endif
			endif
		floop
		break
	case 3
		GetArrayValue(Object.Frame,Object.AnimationTimer,Flasher_array44)
		Object.AnimationTimer++
		if Object.AnimationTimer==14
			Object.AnimationTimer=6
		endif
		Object.Value0++
		if Object.Value0==128
			Object.Value0=0
			Object.State=4
		endif
		foreach TypeGroup[256],PlayerObjectPos
			if Object[PlayerObjectPos].Value37!=4
				PlayerObjectCollision(C_TOUCH,Object.EntityNo,-12,-12,12,12,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
				if CheckResult==1
					CallFunction(PlayerObject_Function47)
				else
					PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-8,8,8,PlayerObjectPos,Object[PlayerObjectPos].Value40,Object[PlayerObjectPos].Value38,Object[PlayerObjectPos].Value41,Object[PlayerObjectPos].Value39)
					if CheckResult==1
						CallFunction(PlayerObject_Function44)
					endif
				endif
			else
				PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-8,8,8,PlayerObjectPos,Object[PlayerObjectPos].Value40,Object[PlayerObjectPos].Value38,Object[PlayerObjectPos].Value41,Object[PlayerObjectPos].Value39)
				if CheckResult==1
					CallFunction(PlayerObject_Function44)
				endif
			endif
		floop
		break
	case 4
		GetArrayValue(Object.Frame,Object.Value0,Flasher_array45)
		Object.Value0++
		if Object.Value0==20
			Object.Value0=128
			Object.State=1
		endif
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-8,8,8,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			if Object[PlayerObjectPos].Value37!=4
				if CheckResult==1
					CallFunction(PlayerObject_Function47)
				else
					PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-8,8,8,PlayerObjectPos,Object[PlayerObjectPos].Value40,Object[PlayerObjectPos].Value38,Object[PlayerObjectPos].Value41,Object[PlayerObjectPos].Value39)
					if CheckResult==1
						CallFunction(PlayerObject_Function44)
					endif
				endif
			else
				if CheckResult==1
					CallFunction(PlayerObject_Function44)
				endif
			endif
		floop
		break
	endswitch
	if Object.OutOfBounds==1
		TempValue0=Object.XPos
		TempValue1=Object.YPos
		Object.XPos=Object.Value5
		Object.YPos=Object.Value6
		if Object.OutOfBounds==1
			if Object.Priority!=PRIORITY_XBOUNDS_DESTROY
				Object.Value0=0
				Object.Frame=0
				Object.State=0
				Object.Priority=PRIORITY_ACTIVE_BOUNDS
			endif
		else
			Object.XPos=TempValue0
			Object.YPos=TempValue1
		endif
	endif
endsub


sub ObjectDraw
	DrawSpriteFX(Object.Frame,FX_FLIP,Object.XPos,Object.YPos)
endsub


sub ObjectStartup
	CheckStageFolder("Zone06")
	if CheckResult==1
		LoadSpriteSheet("MCZ/Objects.gif")
		SpriteFrame(-16,-8,23,15,1,1)
		SpriteFrame(-16,-8,23,15,25,1)
		SpriteFrame(-16,-8,24,16,1,17)
		SpriteFrame(-16,-12,28,24,1,34)
		SpriteFrame(-16,-16,32,32,1,59)
	else
		LoadSpriteSheet("MBZ/Objects.gif")
		SpriteFrame(-16,-8,23,15,1,1)
		SpriteFrame(-16,-8,23,15,25,1)
		SpriteFrame(-16,-8,24,16,1,17)
		SpriteFrame(-16,-12,28,24,1,34)
		SpriteFrame(-16,-16,32,32,1,59)
	endif
	foreach TypeName[Flasher],ArrayPos0
		Object[ArrayPos0].Value5=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value6=Object[ArrayPos0].YPos
	floop
	SetArrayValue(57,DebugMode_staticVar25,DebugMode_array12)
	SetArrayValue(137,DebugMode_staticVar25,DebugMode_array13)
	SetArrayValue(138,DebugMode_staticVar25,DebugMode_array11)
	DebugMode_staticVar25++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
