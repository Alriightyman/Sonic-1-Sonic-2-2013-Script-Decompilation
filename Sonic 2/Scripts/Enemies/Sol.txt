//--------------------Sonic 1 / Sonic 2 Sol Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 50: TYPE_SOL

// Function declarations
#function Sol_Function116
#function Sol_Function117
#function Sol_Function118
#function Sol_Function119
#function Sol_Function120



function Sol_Function116
	DrawSpriteFX(0,FX_FLIP,Object.XPos,Object.YPos)
endfunction


function Sol_Function117
	CreateTempObject(TypeName[Sol],0,Object.XPos,Object.YPos)
	Object[TempObjectPos].Value2=Object[TempObjectPos].XPos
	Object[TempObjectPos].Value1=15
	Object[TempObjectPos].Value3=1
	if Object[TempObjectPos].PropertyValue==0
		Object[TempObjectPos].Direction=FLIP_NONE
		Object[TempObjectPos].XVelocity=-0x4000
	else
		Object[TempObjectPos].Direction=FLIP_X
		Object[TempObjectPos].XVelocity=0x4000
	endif
endfunction


function Sol_Function118
	TempValue0=0
	TempValue7=Object.Angle
	TempValue1=Object.XPos
	TempValue2=Object.YPos
	while TempValue0<4
		GetBit(TempValue6,Object.Value1,TempValue0)
		if TempValue6==1
			Cos256(Object.XPos,TempValue7)
			Object.XPos<<=12
			Object.XPos+=TempValue1
			Sin256(Object.YPos,TempValue7)
			Object.YPos<<=12
			Object.YPos+=TempValue2
			foreach TypeGroup[256],PlayerObjectPos
				PlayerObjectCollision(C_TOUCH,Object.EntityNo,-4,-4,4,4,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
				if CheckResult==1
					CallFunction(PlayerObject_Function46)
				endif
			floop
		endif
		TempValue7+=64
		TempValue7&=255
		TempValue0++
	loop
	Object.XPos=TempValue1
	Object.YPos=TempValue2
	foreach TypeGroup[256],PlayerObjectPos
		PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-8,8,8,PlayerObjectPos,Object[PlayerObjectPos].Value40,Object[PlayerObjectPos].Value38,Object[PlayerObjectPos].Value41,Object[PlayerObjectPos].Value39)
		if CheckResult==1
			CallFunction(PlayerObject_Function44)
		endif
	floop
endfunction


function Sol_Function119
	foreach TypeGroup[256],PlayerObjectPos
		PlayerObjectCollision(C_TOUCH,Object.EntityNo,-4,-4,4,4,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
		if CheckResult==1
			CallFunction(PlayerObject_Function46)
		endif
	floop
endfunction


function Sol_Function120
	if Object.OutOfBounds==1
		TempValue0=Object.XPos
		Object.XPos=Object.Value2
		if Object.OutOfBounds==1
			Object.XPos=Object.Value2
			Object.Value1=15
			if Object.PropertyValue==0
				Object.Direction=FLIP_NONE
				Object.XVelocity=-0x4000
			else
				Object.Direction=FLIP_X
				Object.XVelocity=0x4000
			endif
			Object.Value0=0
			Object.AnimationTimer=0
			Object.Priority=PRIORITY_ACTIVE_BOUNDS
			Object.State=0
			Object.Angle=0
		else
			Object.XPos=TempValue0
		endif
	endif
endfunction


sub ObjectMain
	switch Object.State
	case 0
		Object.Priority=PRIORITY_ACTIVE
		Object.XPos+=Object.XVelocity
		if Object.Direction==FLIP_NONE
			Object.Angle++
		else
			Object.Angle--
		endif
		Object.Angle&=255
		CallFunction(Sol_Function118)
		if Object.Value3==1
			Object.Value6=0x7FFFFFFF
			Object.Value4=0xFFFF
			Object.Value5=0
			foreach TypeGroup[256],PlayerObjectPos
				TempValue0=Object[PlayerObjectPos].YPos
				TempValue0-=Object.YPos
				Absolute(TempValue0)
				if TempValue0<Object.Value6
					Object.Value6=TempValue0
					Object.Value5=PlayerObjectPos
				endif
				if TempValue0<0x400000
					if Object.Value4!=0xFFFF
						ArrayPos0=Object.Value4
						TempValue0=Object[PlayerObjectPos].XPos
						TempValue0-=Object.XPos
						Absolute(TempValue0)
						TempValue1=Object[ArrayPos0].XPos
						TempValue1-=Object.XPos
						Absolute(TempValue1)
						if TempValue0<TempValue1
							Object.Value4=PlayerObjectPos
						endif
					else
						Object.Value4=PlayerObjectPos
					endif
				endif
			floop
			if Object.Value4!=0xFFFF
				ArrayPos0=Object.Value4
				TempValue0=Object.XPos
				TempValue0-=Object[ArrayPos0].XPos
				Absolute(TempValue0)
				if TempValue0<=0x800000
					Object.State=1
					Object.Frame=1
				endif
			else
				ArrayPos0=Object.Value5
			endif
			if Object[ArrayPos0].XPos<Object.XPos
				Object.Direction=FLIP_NONE
				Object.XVelocity=-0x4000
			else
				Object.Direction=FLIP_X
				Object.XVelocity=0x4000
			endif
		endif
		CallFunction(Sol_Function120)
		break
	case 1
		Object.XPos+=Object.XVelocity
		if Object.Direction==FLIP_NONE
			Object.Angle++
		else
			Object.Angle--
		endif
		Object.Angle&=255
		TempValue0=0
		TempValue7=Object.Angle
		while TempValue0<4
			if TempValue7==64
				GetBit(TempValue6,Object.Value1,TempValue0)
				if TempValue6==1
					Cos256(TempValue1,TempValue7)
					TempValue1<<=12
					TempValue1+=Object.XPos
					Sin256(TempValue2,TempValue7)
					TempValue2<<=12
					TempValue2+=Object.YPos
					SetBit(Object.Value1,TempValue0,0)
					CreateTempObject(TypeName[Sol],0,TempValue1,TempValue2)
					Object[TempObjectPos].State=3
					Object[TempObjectPos].Value8=Object.Value8
					Object[TempObjectPos].Value7=Object.Value7
					if Object.Direction==FLIP_NONE
						Object[TempObjectPos].XVelocity=-0x20000
					else
						Object[TempObjectPos].XVelocity=0x20000
					endif
				endif
			endif
			TempValue7+=64
			TempValue7&=255
			TempValue0++
		loop
		CallFunction(Sol_Function118)
		if Object.Value1==0
			Object.State=2
			if Object.Direction==FLIP_NONE
				Object.XVelocity=-0x4000
			else
				Object.XVelocity=0x4000
			endif
		endif
		if Object.AnimationTimer<16
			Object.AnimationTimer++
		else
			Object.Frame=2
		endif
		CallFunction(Sol_Function120)
		break
	case 2
		Object.XPos+=Object.XVelocity
		CallFunction(Sol_Function118)
		CallFunction(Sol_Function120)
		break
	case 3
		Object.XPos+=Object.XVelocity
		CallFunction(Sol_Function119)
		if Object.OutOfBounds==1
			Object.Type=TypeName[BlankObject]
		endif
		break
	endswitch
	Object.Value8++
	if Object.Value8>=12
		Object.Value8=0
	endif
	Object.Value7=Object.Value8
	Object.Value7/=6
	Object.Value7+=3
endsub


sub ObjectDraw
	switch Object.State
	case 0
	case 1
		TempValue0=0
		TempValue7=Object.Angle
		while TempValue0<4
			GetBit(TempValue6,Object.Value1,TempValue0)
			if TempValue6==1
				Cos256(TempValue1,TempValue7)
				TempValue1<<=12
				TempValue1+=Object.XPos
				Sin256(TempValue2,TempValue7)
				TempValue2<<=12
				TempValue2+=Object.YPos
				DrawSpriteXY(Object.Value7,TempValue1,TempValue2)
			endif
			TempValue7+=64
			TempValue7&=255
			TempValue0++
		loop
		DrawSpriteFX(Object.Frame,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 2
		DrawSpriteFX(Object.Frame,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 3
		DrawSprite(Object.Value7)
		break
	endswitch
endsub


sub ObjectStartup
	CheckStageFolder("Zone05")
	if CheckResult==1
		LoadSpriteSheet("HTZ/Objects.gif")
		SpriteFrame(-8,-8,16,16,91,222)
		SpriteFrame(-8,-8,16,16,91,222)
		SpriteFrame(-8,-8,16,16,91,222)
		SpriteFrame(-8,-8,16,16,1,33)
		SpriteFrame(-8,-8,16,16,18,33)
	else
		LoadSpriteSheet("MBZ/Objects.gif")
		SpriteFrame(-8,-8,16,16,91,222)
		SpriteFrame(-8,-8,16,16,91,222)
		SpriteFrame(-8,-8,16,16,91,222)
		SpriteFrame(-8,-8,16,16,1,33)
		SpriteFrame(-8,-8,16,16,18,33)
	endif
	foreach TypeName[Sol],ArrayPos0
		Object[ArrayPos0].Value2=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value1=15
		Object[ArrayPos0].Value3=1
		if Object[ArrayPos0].PropertyValue==0
			Object[ArrayPos0].Direction=FLIP_NONE
			Object[ArrayPos0].XVelocity=-0x4000
		else
			Object[ArrayPos0].Direction=FLIP_X
			Object[ArrayPos0].XVelocity=0x4000
		endif
	floop
	SetArrayValue(50,DebugMode_staticVar25,DebugMode_array12)
	SetArrayValue(116,DebugMode_staticVar25,DebugMode_array13)
	SetArrayValue(117,DebugMode_staticVar25,DebugMode_array11)
	DebugMode_staticVar25++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
