//--------------------Sonic 1 / Sonic 2 Rail Rocket Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 67: TYPE_RAILROCKET

// Function declarations
#function RailRocket_Function139
#function RailRocket_Function140



function RailRocket_Function139
	DrawSprite(Object.Direction)
endfunction


function RailRocket_Function140
	CreateTempObject(TypeName[RailRocket],0,Object.XPos,Object.YPos)
	Object[TempObjectPos].Value11=Object.Direction
endfunction


sub ObjectMain
	switch Object.State
	case 0
		if Object.Value5>0
			if Object.Value12>0
				Object.Value12-=16
			else
				Object.Value12-=8
			endif
		else
			if Object.Value12<0
				Object.Value12+=16
			else
				Object.Value12+=8
			endif
		endif
		Object.Value5+=Object.Value12
		if Object.Value10==1
			Object.Speed=-0x80000
			Object.State=1
			PlaySfx(SFXName[Launch],0)
		endif
		break
	case 1
		Object.YPos+=Object.Speed
		TempValue0=Object.Speed
		TempValue0>>=1
		if Object.Value11==0
			Object.XPos+=TempValue0
			Object.Value5+=32
			if Object.Value5>=512
				Object.Value5=512
			endif
		else
			Object.XPos-=TempValue0
			Object.Value5-=32
			if Object.Value5<=-512
				Object.Value5=-512
			endif
		endif
		if Object.YPos<=Object.Value9
			Object.Speed=0
			Object.YPos=Object.Value9
			if Object.Value11==0
				Object.Value12=-128
			else
				Object.Value12=128
			endif
			Object.State=2
		endif
		Object.Frame=Object.AnimationTimer
		Object.Frame>>=3
		TempValue0=Object.Speed
		Absolute(TempValue0)
		TempValue0>>=16
		Object.AnimationTimer+=TempValue0
		Object.AnimationTimer&=15
		Object.Value13++
		Object.Value13&=3
		if ringTimer==0
			CreateTempObject(TypeName[DustPuff],0,Object.XPos,Object.YPos)
			if Object.Value11==0
				Object[TempObjectPos].iXPos+=10
			else
				Object[TempObjectPos].iXPos-=10
			endif
			Object[TempObjectPos].iYPos+=22
		endif
		break
	case 2
		if Object.Value5>0
			if Object.Value12>0
				Object.Value12-=16
			else
				Object.Value12-=8
			endif
		else
			if Object.Value12<0
				Object.Value12+=16
			else
				Object.Value12+=8
			endif
		endif
		Object.Value5+=Object.Value12
		Object.Value0++
		if Object.Value0==60
			Object.Value0=0
			Object.State=3
		endif
		Object.Value13++
		Object.Value13&=3
		break
	case 3
		Object.Speed+=0x1800
		if Object.Speed>0x80000
			Object.Speed=0x80000
		endif
		Object.YPos+=Object.Speed
		TempValue0=Object.Speed
		TempValue0>>=1
		if Object.Value11==0
			Object.XPos+=TempValue0
			Object.Value5-=32
			if Object.Value5<=-512
				Object.Value5=-512
			endif
		else
			Object.XPos-=TempValue0
			Object.Value5+=32
			if Object.Value5>=512
				Object.Value5=512
			endif
		endif
		if Object.YPos>=Object.Value2
			Object.Speed=0
			Object.XPos=Object.Value1
			Object.YPos=Object.Value2
			if Object.Value11==0
				Object.Value12=128
			else
				Object.Value12=-128
			endif
			Object.State=4
		endif
		Object.Frame=Object.AnimationTimer
		Object.Frame>>=3
		TempValue0=Object.Speed
		Absolute(TempValue0)
		TempValue0>>=16
		Object.AnimationTimer+=TempValue0
		Object.AnimationTimer&=15
		break
	case 4
		if Object.Value5>0
			if Object.Value12>0
				Object.Value12-=16
			else
				Object.Value12-=8
			endif
		else
			if Object.Value12<0
				Object.Value12+=16
			else
				Object.Value12+=8
			endif
		endif
		Object.Value5+=Object.Value12
		if Object.Value10==0
			Object.State=0
		endif
		break
	endswitch
	TempValue0=0
	TempValue4=Object.Value5
	Object.Value3=Object.XPos
	Object.Value4=Object.YPos
	while TempValue0<8
		TempValue5=TempValue4
		TempValue5>>=7
		TempValue5&=511
		Sin(TempValue2,TempValue5)
		TempValue2*=786
		Object.Value3+=TempValue2
		Cos(TempValue3,TempValue5)
		TempValue3*=786
		Object.Value4+=TempValue3
		TempValue0++
		TempValue4+=Object.Value5
	loop
	if Object.Value8>0
		Object.Value8--
	endif
	Object.Value10=0
	TempValue0=Object.XPos
	TempValue1=Object.YPos
	Object.XPos=Object.Value3
	Object.YPos=Object.Value4
	foreach TypeGroup[256],PlayerObjectPos
		if Object[PlayerObjectPos].State!=1
			if Object.Value8==0
				PlayerObjectCollision(C_TOUCH,Object.EntityNo,-10,16,10,24,PlayerObjectPos,0x10000,0,0x10000,0)
				if CheckResult==1
					if Object[PlayerObjectPos].Gravity==GRAVITY_AIR
						Object[PlayerObjectPos].State=1
						Object[PlayerObjectPos].Animation=ANI_HANGING
						Object[PlayerObjectPos].Speed=0
						Object[PlayerObjectPos].XVelocity=0
						Object[PlayerObjectPos].YVelocity=0
						Object[PlayerObjectPos].XPos=Object.XPos
						Object[PlayerObjectPos].YPos=Object[PlayerObjectPos].CollisionTop
						FlipSign(Object[PlayerObjectPos].YPos)
						Object[PlayerObjectPos].YPos+=8
						Object[PlayerObjectPos].YPos<<=16
						Object[PlayerObjectPos].YPos+=Object.YPos
						PlaySfx(SFXName[Catch],0)
						Object.Value10=1
					endif
				endif
			endif
		else
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-4,8,20,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			if CheckResult==1
				if Object[PlayerObjectPos].JumpPress==1
					Object[PlayerObjectPos].State=12
					Object[PlayerObjectPos].YVelocity=-0x40000
					Object[PlayerObjectPos].Gravity=GRAVITY_AIR
					Object.Value8=30
				else
					Object[PlayerObjectPos].XPos=Object.XPos
					Object[PlayerObjectPos].YPos=Object[PlayerObjectPos].CollisionTop
					FlipSign(Object[PlayerObjectPos].YPos)
					Object[PlayerObjectPos].YPos+=8
					Object[PlayerObjectPos].YPos<<=16
					Object[PlayerObjectPos].YPos+=Object.YPos
					Object.Value10=1
				endif
			endif
		endif
	floop
	Object.XPos=TempValue0
	Object.YPos=TempValue1
endsub


sub ObjectDraw
	TempValue0=0
	TempValue4=Object.Value5
	Object.Value6=Object.XPos
	Object.Value7=Object.YPos
	while TempValue0<7
		TempValue5=TempValue4
		TempValue5>>=7
		TempValue5&=511
		Sin(TempValue2,TempValue5)
		TempValue2*=786
		Object.Value6+=TempValue2
		Cos(TempValue3,TempValue5)
		TempValue3*=786
		Object.Value7+=TempValue3
		DrawSpriteXY(2,Object.Value6,Object.Value7)
		TempValue0++
		TempValue4+=Object.Value5
	loop
	DrawSpriteXY(3,Object.Value3,Object.Value4)
	switch Object.State
	case 1
	case 2
		Object.Direction=Object.Value11
		TempValue0=Object.Value13
		TempValue0>>=1
		TempValue0+=4
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	endswitch
	Object.Direction=Object.Value11
	Object.Direction^=Object.Frame
	DrawSpriteFX(Object.Frame,FX_FLIP,Object.XPos,Object.YPos)
endsub


sub ObjectStartup
	LoadSpriteSheet("HPZ/Objects.gif")
	SpriteFrame(-20,-27,40,54,66,168)
	SpriteFrame(-20,-27,40,54,140,57)
	SpriteFrame(-3,-3,6,6,198,50)
	SpriteFrame(-8,-3,16,16,193,57)
	SpriteFrame(4,11,12,16,210,46)
	SpriteFrame(5,11,8,12,184,57)
	foreach TypeName[RailRocket],ArrayPos0
		Object[ArrayPos0].Value1=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value2=Object[ArrayPos0].YPos
		Object[ArrayPos0].Value11=Object[ArrayPos0].PropertyValue
		Object[ArrayPos0].Value11>>=7
		TempValue0=Object[ArrayPos0].PropertyValue
		TempValue0&=127
		if TempValue0==0
			Object[ArrayPos0].Value9=Object[ArrayPos0].YPos
			Object[ArrayPos0].Value9-=0x1000000
		else
			TempValue0<<=21
			Object[ArrayPos0].Value9=Object[ArrayPos0].YPos
			Object[ArrayPos0].Value9-=TempValue0
		endif
	floop
	SetArrayValue(67,DebugMode_staticVar25,DebugMode_array12)
	SetArrayValue(139,DebugMode_staticVar25,DebugMode_array13)
	SetArrayValue(140,DebugMode_staticVar25,DebugMode_array11)
	DebugMode_staticVar25++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
