//--------------------Sonic 1 / Sonic 2 Tube Switch Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 62: TYPE_TUBESWITCH




sub ObjectMain
	foreach TypeGroup[256],PlayerObjectPos
		if Object[PlayerObjectPos].Value34==1
			Object[PlayerObjectPos].Value34=0
		endif
		CheckEqual(Object[PlayerObjectPos].State,28)
		TempValue0=CheckResult
		CheckEqual(Object[PlayerObjectPos].State,25)
		TempValue0|=CheckResult
		CheckEqual(Object[PlayerObjectPos].State,24)
		TempValue0|=CheckResult
		if TempValue0==0
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,-16,-16,16,16,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			if CheckResult==1
				if Object[PlayerObjectPos].YVelocity<0
					Object[PlayerObjectPos].YVelocity=0
				endif
				switch Object.PropertyValue
				case 0
					if Object[PlayerObjectPos].XVelocity>0
						if Object[PlayerObjectPos].Animation!=ANI_JUMPING
							if Object[PlayerObjectPos].State!=31
								PlaySfx(SFXName[Rolling],0)
							endif
						endif
						if Object[PlayerObjectPos].State==20
							FlipSign(Object[PlayerObjectPos].Speed)
						endif
						Object[PlayerObjectPos].Direction=FLIP_NONE
						Object[PlayerObjectPos].State=31
						Object[PlayerObjectPos].Animation=ANI_JUMPING
					else
						if Object[PlayerObjectPos].Gravity==GRAVITY_GROUND
							if Object[PlayerObjectPos].XVelocity>-0x20000
								Object[PlayerObjectPos].Speed=-0x20000
							endif
						endif
						Object[PlayerObjectPos].State=14
						Object[PlayerObjectPos].Animation=ANI_JUMPING
					endif
					break
				case 1
					if Object[PlayerObjectPos].XVelocity<0
						if Object[PlayerObjectPos].Animation!=ANI_JUMPING
							if Object[PlayerObjectPos].State!=31
								PlaySfx(SFXName[Rolling],0)
							endif
						endif
						if Object[PlayerObjectPos].State==20
							FlipSign(Object[PlayerObjectPos].Speed)
						endif
						Object[PlayerObjectPos].Direction=FLIP_X
						Object[PlayerObjectPos].State=31
						Object[PlayerObjectPos].Animation=ANI_JUMPING
					else
						if Object[PlayerObjectPos].Gravity==GRAVITY_GROUND
							if Object[PlayerObjectPos].XVelocity<0x20000
								Object[PlayerObjectPos].Speed=0x20000
							endif
						endif
						Object[PlayerObjectPos].State=14
						Object[PlayerObjectPos].Animation=ANI_JUMPING
					endif
					break
				case 2
					if Object[PlayerObjectPos].Gravity==GRAVITY_AIR
						if Object[PlayerObjectPos].YVelocity>0
							Object[PlayerObjectPos].Animation=ANI_JUMPING
							Object[PlayerObjectPos].State=31
							Object[PlayerObjectPos].Gravity=GRAVITY_GROUND
							Object[PlayerObjectPos].Speed=Object[PlayerObjectPos].YVelocity
							Object[PlayerObjectPos].CollisionMode=CMODE_RWALL
							Object[PlayerObjectPos].Angle=64
							PlaySfx(SFXName[Rolling],0)
						endif
					endif
					break
				case 3
					if Object[PlayerObjectPos].Gravity==GRAVITY_AIR
						if Object[PlayerObjectPos].YVelocity>0
							Object[PlayerObjectPos].Animation=ANI_JUMPING
							Object[PlayerObjectPos].State=31
							Object[PlayerObjectPos].Gravity=GRAVITY_GROUND
							Object[PlayerObjectPos].Speed=Object[PlayerObjectPos].YVelocity
							FlipSign(Object[PlayerObjectPos].Speed)
							Object[PlayerObjectPos].CollisionMode=CMODE_LWALL
							Object[PlayerObjectPos].Angle=192
							PlaySfx(SFXName[Rolling],0)
						endif
					endif
					break

				endswitch
				Object.Value0=1
			else
				Object.Value0=0
			endif
		endif
	floop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
