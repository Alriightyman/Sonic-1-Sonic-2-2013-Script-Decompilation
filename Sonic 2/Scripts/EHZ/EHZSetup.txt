//--------------------Sonic 1 / Sonic 2 EHZ Setup Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 40: TYPE_EHZSETUP

// Function declarations
#function EHZSetup_Function97
#function EHZSetup_Function98
#function EHZSetup_Function99
#function EHZSetup_Function100


#array EHZSetup_array38:(508,24,509,10,510,12,511,24,510,12,509,10)
#array EHZSetup_array39:(512,128,513,20,512,8,513,8,512,8,513,8)
#array EHZSetup_array40:(514,128,515,12,514,12,515,12,514,6,515,6,514,6,515,6)
#array EHZSetup_array41:(516,8,517,8)
#array EHZSetup_array42:(518,128,519,8,518,8,519,8,518,8,519,12,518,12,519,12)
#array EHZSetup_array43:(1,2,1,3,1,2,2,1,2,3,1,2,1,2,0,0,2,0,3,2,2,3,2,2,1,3,0,0,1,0,1,3,1,2,1,3,1,2,2,1,2,3,1,2,1,2,0,0,2,0,3,2,2,3,2,2,1,3,0,0,1,0,1,3)

#constant 0:constant0xF884

#array EHZSetup_ReplayDataS:(0x440000,0x2910000,32,1,40,27,8,39,56,1,40,9,8,40,56,1,40,6,8,8,56,1,40,6,8,175,56,1,40,7,8,111,0,2,4,35,52,1,36,7,4,73,0,4,8,4,56,1,40,7,8,68,0,5,4,30,0,8,2,4,50,1,34,1,50,1,32,4,0,15,8,56,0,1,2,32,50,1,34,1,42,1,40,3,8,255,8,97,0,12,4,5,0,26,8,21,56,1,40,9,8,255,8,4,10,3,2,7,10,2)
#array EHZSetup_ReplayDataT:(0x440000,0x2950000,32,13,40,38,8,47,56,1,40,12,8,224,56,1,40,5,8,69,56,1,40,8,32,2,0,2,8,12,0,28,8,16,0,1,8,255,8,5,56,1,40,24,8,218,56,1,40,9,8,50,0,1,4,7,0,16,8,174,56,1,40,12,8,7,56,1,40,8,8,4,56,1,40,5,8,3,4,2,52,1,36,5,4,4,52,1,32,5,0,4,4,1,52,1,36,3,4,4,52,1,36,4,4,5,52,1,36,3,4,1,0,2,8,2,56,1,40,3,32,2,0,1,8,5,0,5,8,3,56,1,40,2,8,1,0,9,8,5,0,15,8,22,0,3,4,2,52,1,36,9,32,2,40,8,8,4,56,1,40,4,32,1,0,3,48,1,32,6,0,4,48,1,32,5,0,1,8,3,0,1,48,1,32,5,0,3,48,1,32,3,40,3,8,2,0,1,48,1,32,5,0,5,48,1,32,4,0,4,48,1,32,4,0,5,48,1,32,4,0,4,48,1,32,5,0,4,48,1,32,4,0,5,48,1,32,4,0,5,48,1,32,4,0,5,48,1,32,5,0,3,48,1,32,4,0,4,48,1,32,5,0,3,48,1,32,5,0,3,48,1,32,6,0,3,48,1,32,4,0,4,48,1,32,4,0,4,48,1,32,4,0,4,48,1,32,4,40,2,8,39,56,1,40,12,8,13,0,17,8,4,0,12,4,11,8,8)
#array EHZSetup_ReplayDataK:(0x440000,0x2910000,0,18,8,77,56,1,40,13,8,70,56,1,40,14,8,3,0,22,4,4,0,3,48,1,32,16,40,3,8,1,0,30,48,1,32,38,40,149,8,11,0,3,4,6,0,4,4,5,0,5,8,13,0,14,4,89,0,6,8,44,10,1,2,13,0,52,8,59,56,1,40,17,8,18,0,4,4,33,0,1,8,105,56,1,40,30,8,45,4,6,0,52,8,6,56,1,40,19,8,54,10,6,2,17,10,2,8,58,56,1,40,4,8,197,56,1,41,10,9,14,57,1,41,40,33,4,1,126,9,12,8,6,56,1,40,12)

function EHZSetup_Function97
	CheckEqual(Object[25].Type,TypeName[MusicEvent])
	TempValue0=CheckResult
	CheckEqual(Object[25].PropertyValue,2)
	TempValue0&=CheckResult
	CheckEqual(stage.musicFlag,0)
	TempValue0&=CheckResult
	if TempValue0==0
		switch Music.CurrentTrack
		case 0
			SetMusicTrack("Invincibility_F.ogg",2,0x78B1)
			SwapMusicTrack("EmeraldHill_F.ogg",0,0x1DD80,0x1F40)
			break
		case 2
			SetMusicTrack("EmeraldHill_F.ogg",0,0x1DD80)
			SwapMusicTrack("Invincibility_F.ogg",2,0x78B1,0x1F40)
			break
		case 4
		case 6
		case 7
			SetMusicTrack("EmeraldHill_F.ogg",0,0x1DD80)
			SetMusicTrack("Invincibility_F.ogg",2,0x78B1)
			break

		endswitch
	else
		stage.musicFlag=1
	endif
endfunction


function EHZSetup_Function98
	CheckEqual(Object[25].Type,TypeName[MusicEvent])
	TempValue0=CheckResult
	CheckEqual(Object[25].PropertyValue,2)
	TempValue0&=CheckResult
	CheckEqual(stage.musicFlag,0)
	TempValue0&=CheckResult
	if TempValue0==0
		switch Music.CurrentTrack
		case 0
			SetMusicTrack("Invincibility.ogg",2,0x9717)
			SwapMusicTrack("EmeraldHill.ogg",0,0x254AE,0x30D4)
			break
		case 2
			SetMusicTrack("EmeraldHill.ogg",0,0x254AE)
			SwapMusicTrack("Invincibility.ogg",2,0x9717,0x30D4)
			break
		case 4
		case 6
		case 7
			SetMusicTrack("EmeraldHill.ogg",0,0x254AE)
			SetMusicTrack("Invincibility.ogg",2,0x9717)
			break

		endswitch
	else
		stage.musicFlag=2
	endif
endfunction


function EHZSetup_Function99
	CheckEqual(Object[25].Type,TypeName[MusicEvent])
	TempValue0=CheckResult
	CheckEqual(Object[25].PropertyValue,2)
	TempValue0&=CheckResult
	CheckEqual(stage.musicFlag,0)
	TempValue0&=CheckResult
	if TempValue0==0
		switch Music.CurrentTrack
		case 0
			SetMusicTrack("Invincibility_F.ogg",2,0x78B1)
			SwapMusicTrack("EmeraldHill2_F.ogg",0,0x136F4,0x1F40)
			break
		case 2
			SetMusicTrack("EmeraldHill2_F.ogg",0,0x136F4)
			SwapMusicTrack("Invincibility_F.ogg",2,0x78B1,0x1F40)
			break
		case 4
		case 6
		case 7
			SetMusicTrack("EmeraldHill2_F.ogg",0,0x136F4)
			SetMusicTrack("Invincibility_F.ogg",2,0x78B1)
			break

		endswitch
	else
		stage.musicFlag=1
	endif
endfunction


function EHZSetup_Function100
	CheckEqual(Object[25].Type,TypeName[MusicEvent])
	TempValue0=CheckResult
	CheckEqual(Object[25].PropertyValue,2)
	TempValue0&=CheckResult
	CheckEqual(stage.musicFlag,0)
	TempValue0&=CheckResult
	if TempValue0==0
		switch Music.CurrentTrack
		case 0
			SetMusicTrack("Invincibility.ogg",2,0x9717)
			SwapMusicTrack("EmeraldHill2.ogg",0,0x184F4,0x30D4)
			break
		case 2
			SetMusicTrack("EmeraldHill2.ogg",0,0x184F4)
			SwapMusicTrack("Invincibility.ogg",2,0x9717,0x30D4)
			break
		case 4
		case 6
		case 7
			SetMusicTrack("EmeraldHill2.ogg",0,0x184F4)
			SetMusicTrack("Invincibility.ogg",2,0x9717)
			break

		endswitch
	else
		stage.musicFlag=2
	endif
endfunction


sub ObjectMain
	if Object.State<5
		Object.Value1++
		if Object.Value1==8
			Object.Value1=0
			GetPaletteEntry(0,159,TempValue1)
			GetPaletteEntry(0,158,TempValue0)
			SetPaletteEntry(0,159,TempValue0)
			GetPaletteEntry(0,148,TempValue0)
			SetPaletteEntry(0,158,TempValue0)
			GetPaletteEntry(0,147,TempValue0)
			SetPaletteEntry(0,148,TempValue0)
			SetPaletteEntry(0,147,TempValue1)
		endif
	endif
	Object.Value4++
	if Object.Value4>7
		TileLayer[1].DeformationOffset++
		Object.Value4=0
	endif
	if Object.Value5<2
		GetArrayValue(TempValue0,Object.Value6,EHZSetup_array38)
		Copy16x16Tile(502,TempValue0)
		TempValue0+=12
		Copy16x16Tile(503,TempValue0)
		TempValue0+=4
		Copy16x16Tile(504,TempValue0)
		Object.Value6++
		GetArrayValue(Object.Value5,Object.Value6,EHZSetup_array38)
		Object.Value6++
		Object.Value6%=12
	else
		Object.Value5--
	endif
	if Object.Value7<2
		GetArrayValue(TempValue0,Object.Value8,EHZSetup_array39)
		Copy16x16Tile(764,TempValue0)
		Object.Value8++
		GetArrayValue(Object.Value7,Object.Value8,EHZSetup_array39)
		Object.Value8++
		Object.Value8%=12
	else
		Object.Value7--
	endif
	if Object.Value9<2
		GetArrayValue(TempValue0,Object.Value10,EHZSetup_array40)
		Copy16x16Tile(765,TempValue0)
		Object.Value10++
		GetArrayValue(Object.Value9,Object.Value10,EHZSetup_array40)
		Object.Value10++
		Object.Value10&=15
	else
		Object.Value9--
	endif
	if Object.Value11<2
		GetArrayValue(TempValue0,Object.Value12,EHZSetup_array41)
		Copy16x16Tile(766,TempValue0)
		Object.Value12++
		GetArrayValue(Object.Value11,Object.Value12,EHZSetup_array41)
		Object.Value12++
		Object.Value12&=3
	else
		Object.Value11--
	endif
	if Object.Value13<2
		GetArrayValue(TempValue0,Object.Value14,EHZSetup_array42)
		Copy16x16Tile(767,TempValue0)
		Object.Value14++
		GetArrayValue(Object.Value13,Object.Value14,EHZSetup_array42)
		Object.Value14++
		Object.Value14&=15
	else
		Object.Value13--
	endif
	if EHZSetup_constant33==0
		if Stage.DebugMode==0
			if specialStage.emeralds>=127
				if options.gameMode==0
					EHZSetup_constant33=1
					EngineCallback(SetAchievement,2,100)
				endif
				if options.gameMode==1
					ArrayPos1=options.saveSlot
					ArrayPos1<<=3
					ArrayPos1+=4
					if SaveRAM[ArrayPos1]<20
						EHZSetup_constant33=1
						EngineCallback(SetAchievement,2,100)
					endif
				endif
			endif
		endif
	endif
endsub


sub ObjectStartup
	if Stage.ActiveList!=BONUS_STAGE
		if options.vsMode==0
			SetMusicTrack("EmeraldHill.ogg",0,0x254AE)
			SpeedUpMusic=97
			SlowDownMusic=98
		else
			SetMusicTrack("EmeraldHill2.ogg",0,0x184F4)
			SpeedUpMusic=99
			SlowDownMusic=100
		endif
	else
		SetMusicTrack("DeathEgg.ogg",0,1)
	endif
	animalType1=49
	animalType2=50
	TileLayer[1].ScrollPos=-0x80000
	ArrayPos0=0
	while ArrayPos0<576
		TempValue0=ArrayPos0
		TempValue0&=63
		GetArrayValue(Stage[ArrayPos0].DeformationData2,TempValue0,EHZSetup_array43)
		ArrayPos0++
	loop
	Object[10].Type=TypeName[EHZSetup]
	Object[10].Priority=PRIORITY_ACTIVE
	SetPaletteEntry(0,192,0)
	if options.attractMode==1
		switch Stage.PlayerListPos
		case 0
			PlayerObject_constant2=EHZSetup_ReplayDataS
			PlayerObject_constant8=110
			PlayerObject_constant7=0x654
			break
		case 1
			PlayerObject_constant2=EHZSetup_ReplayDataT
			PlayerObject_constant8=318
			PlayerObject_constant7=0x708
			break
		case 2
			PlayerObject_constant2=EHZSetup_ReplayDataK
			PlayerObject_constant8=138
			PlayerObject_constant7=0x708
			break

		endswitch
		CallFunction(PlayerObject_Function36)
	endif
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
