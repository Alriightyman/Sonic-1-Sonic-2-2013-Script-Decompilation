//--------------------Sonic 1 / Sonic 2 Eggman Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 60: TYPE_EGGMAN

// Function declarations
#function Eggman_Function129



function Eggman_Function129
	if Object.Value6==0
		PlaySfx(SFXName[Helicopter],0)
	endif
	Object.Value6++
	Object.Value6&=31
endfunction


sub ObjectMain
	switch Object.State
	case 0
		TempValue0=Object.iXPos
		TempValue0-=200
		Stage.NewXBoundary1=TempValue0
		TempValue0=Object.iXPos
		TempValue0+=200
		Stage.NewXBoundary2=TempValue0
		if Object[0].XPos>Object.XPos
			Object.Animation=1
			ResetObjectEntity(26,TypeName[MusicEvent],0,0,0)
			Object[26].Priority=PRIORITY_ACTIVE
			Object[+1].Type=TypeName[EggmanCar]
			Object[+1].XPos=Object.XPos
			Object[+1].XPos+=0x1590000
			Object[+1].YPos=Object.YPos
			Object[+1].Value2=Object.XPos
			Object[+1].Value2-=0x1180000
			TempValue0=Object.iXPos
			TempValue0-=200
			TempValue0+=Screen.CenterX
			if Screen.CameraXPos<TempValue0
				TempValue0-=Screen.CameraXPos
				TempValue0<<=16
				Object[+1].Value2-=TempValue0
			endif
			Object[+1].Value3=Object.XPos
			Object[+1].Value3+=0x1500000
			Object[+1].Priority=PRIORITY_ACTIVE
			Object[+2].Type=TypeName[EggmanDrill]
			Object[+2].Priority=PRIORITY_ACTIVE
			Object[-1].Type=TypeName[EggmanWheel]
			Object[-1].Value1=-0x2C0000
			Object[-1].Value2=Object[+1].EntityNo
			Object[-1].Priority=PRIORITY_ACTIVE
			Object[+3].Type=TypeName[EggmanWheel]
			Object[+3].Value1=-0xC0000
			Object[+3].Value2=Object[+1].EntityNo
			Object[+3].Priority=PRIORITY_ACTIVE
			Object[+4].Type=TypeName[EggmanWheel]
			Object[+4].Value1=0x1C0000
			Object[+4].Value2=Object[+1].EntityNo
			Object[+4].Priority=PRIORITY_ACTIVE
			Object.XPos+=0x1580000
			Object.YPos-=0x13F0000
			Object.Priority=PRIORITY_ACTIVE
			Object.State++
		endif
		break
	case 1
		CallFunction(Eggman_Function129)
		Object.XPos-=0x10000
		Object.YPos+=0x10000
		Object.Value0++
		if Object.Value0==320
			Object.Value3=1
			Object.Value4=0
			Object.Value0=0
			Object.State++
		endif
		break
	case 2
		break
	case 3
		Object.Value0++
		if Object.Value0==24
			Object.Value0=0
			Object.Value8=8
			Object.State++
			Object[+1].XVelocity=-0x20000
			Object[+1].State++
		endif
		break
	case 4
		break
	case 5
		Object.Value0++
		if Object.Value0==180
			Object.Value0=0
			Object.Value3=4
			Object.Animation=5
			Object.Value2=0
			Object.State++
			ResetObjectEntity(26,TypeName[MusicEvent],1,0,0)
			Object[26].Priority=PRIORITY_ACTIVE
			TempValue0=TileLayer[0].XSize
			TempValue0<<=7
			Stage.NewXBoundary2=TempValue0
		endif
		break
	case 6
		break
	case 7
		CallFunction(Eggman_Function129)
		Object.YPos-=0x10000
		Object.Value0++
		if Object.Value0==96
			Object.Value0=0
			Object.Direction=FLIP_X
			Object.Animation=6
			Object.State++
		endif
		break
	case 8
		if Object.OutOfBounds==0
			CallFunction(Eggman_Function129)
		endif
		Object.XPos+=0x60000
		TempValue0=Stage.NewXBoundary2
		TempValue0+=128
		TempValue0<<=16
		if Object.XPos>=TempValue0
			Object.Type=TypeName[BlankObject]
		endif
		break
	endswitch
	if Object.Value8!=0
		if Object.Value9>0
			Object.Value9--
			GetBit(TempValue0,Object.Value9,0)
			if TempValue0==1
				SetPaletteEntry(0,192,0xE0E0E0)
			else
				SetPaletteEntry(0,192,0)
			endif
		endif
		foreach TypeGroup[256],PlayerObjectPos
			if Object.Value9==0
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_HURT)
				TempValue0=CheckResult
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_DYING)
				TempValue0|=CheckResult
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_DROWNING)
				TempValue0|=CheckResult
				if TempValue0!=0
					if Object.Animation!=2
						Object.Animation=2
						Object.AnimationTimer=0
					endif
					if PlayerObjectPos==0
						Object.Value10=1
					endif
				endif
				PlayerObjectCollision(C_TOUCH,Object.EntityNo,-24,-24,24,24,PlayerObjectPos,Object[PlayerObjectPos].Value40,Object[PlayerObjectPos].Value38,Object[PlayerObjectPos].Value41,Object[PlayerObjectPos].Value39)
				if CheckResult==1
					CallFunction(PlayerObject_Function43)
					if CheckResult==1
						Object.Value8--
						if Object.Value8==0
							player.score+=1000
							Object.Animation=4
							Object.AnimationTimer=0
							Object.Value2=1
							Object.State++
							Object[+1].State++
							Object[+1].YVelocity=-0x18000
							Object[+1].YPos=Object[+1].Value1
							if Object[+2].State==0
								Object[+2].State=2
								if Object.Direction==FLIP_NONE
									Object[+2].XVelocity=-0x30000
								else
									Object[+2].XVelocity=0x30000
								endif
							endif
						else
							Object.Animation=3
							Object.AnimationTimer=0
							Object.Value9=32
							PlaySfx(SFXName[BossHit],0)
						endif
					endif
				endif
			endif
		floop
	endif
	if Object.State!=8
		foreach TypeGroup[256],PlayerObjectPos
			TempValue0=Object[PlayerObjectPos].CollisionRight
			TempValue0<<=16
			TempValue0+=Object[PlayerObjectPos].XPos
			TempValue1=Stage.XBoundary2
			TempValue1<<=16
			if TempValue0>TempValue1
				Object[PlayerObjectPos].XVelocity=0
				Object[PlayerObjectPos].Speed=0
				Object[PlayerObjectPos].XPos=TempValue1
				TempValue0=Object[PlayerObjectPos].CollisionRight
				TempValue0<<=16
				Object[PlayerObjectPos].XPos-=TempValue0
			endif
		floop
	endif
	if Object.Value2==1
		TempValue0=oscillation
		TempValue0&=7
		if TempValue0==0
			Rand(TempValue0,96)
			TempValue0-=48
			TempValue0<<=16
			TempValue0+=Object.XPos
			Rand(TempValue1,48)
			TempValue1-=24
			TempValue1<<=16
			TempValue1+=Object.YPos
			CreateTempObject(TypeName[Explosion],0,TempValue0,TempValue1)
			Object[TempObjectPos].DrawOrder=5
			PlaySfx(SFXName[Explosion],0)
		endif
	endif
endsub


sub ObjectDraw
	if Object.Animation!=0
		switch Object.Value3
		case 0
			TempValue0=Object.Value4
			TempValue0>>=1
			TempValue0+=12
			Object.Value4++
			Object.Value4&=3
			DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
			break
		case 1
			TempValue0=Object.Value4
			TempValue0/=6
			TempValue0+=8
			Object.Value4++
			if Object.Value4==24
				Object.Value4=0
				Object.Value3=2
			endif
			DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
			break
		case 2
			TempValue0=Object.Value4
			TempValue0<<=16
			TempValue0+=Object.YPos
			DrawSpriteFX(7,FX_FLIP,Object.XPos,TempValue0)
			Object.Value4++
			if Object.Value4==12
				Object.State++
				Object.Value3=3
			endif
			break
		case 4
			Object.Value4--
			if Object.Value4>0
				TempValue0=Object.Value4
			else
				TempValue0=0
			endif
			TempValue0<<=16
			TempValue0+=Object.YPos
			DrawSpriteFX(7,FX_FLIP,Object.XPos,TempValue0)
			if Object.Value4==-12
				Object.Value4=24
				Object.Value3=5
			endif
			break
		case 5
			Object.Value4--
			TempValue0=Object.Value4
			TempValue0/=6
			TempValue0+=8
			if Object.Value4==0
				Object.Value3=0
				Object.State++
			endif
			DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
			break
		case 3
		endswitch
		DrawSpriteFX(6,FX_FLIP,Object.XPos,Object.YPos)
	endif
	switch Object.Animation
	case 1
		TempValue0=Object.AnimationTimer
		TempValue0>>=3
		Object.AnimationTimer++
		Object.AnimationTimer&=15
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 2
		TempValue0=Object.AnimationTimer
		TempValue0&=15
		TempValue0>>=3
		TempValue0+=2
		Object.AnimationTimer++
		if Object.AnimationTimer==50
			Object.AnimationTimer=0
			if Object[0].Animation!=ANI_DYING
				Object.Animation=1
			endif
		endif
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 3
		TempValue0=Object.AnimationTimer
		TempValue0&=1
		TempValue0+=2
		Object.AnimationTimer++
		if Object.AnimationTimer==50
			Object.AnimationTimer=0
			Object.Animation=1
		endif
		DrawSpriteFX(4,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 4
		TempValue0=Object.AnimationTimer
		TempValue0>>=5
		TempValue0+=4
		TempValue0%=5
		Object.AnimationTimer++
		Object.AnimationTimer&=63
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 5
		DrawSpriteFX(5,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 6
		TempValue0=Object.AnimationTimer
		TempValue0>>=3
		Object.AnimationTimer++
		Object.AnimationTimer&=15
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		TempValue0=Object.AnimationTimer
		TempValue0>>=2
		TempValue0&=1
		if TempValue0==1
			DrawSpriteFX(14,FX_FLIP,Object.XPos,Object.YPos)
		endif
		break
	endswitch
endsub


sub ObjectStartup
	CheckStageFolder("Zone01")
	if CheckResult==1
		LoadSpriteSheet("EHZ/Objects.gif")
		SpriteFrame(-28,-28,60,20,70,155)
		SpriteFrame(-28,-28,60,20,131,155)
		SpriteFrame(-28,-28,60,20,70,176)
		SpriteFrame(-28,-28,60,20,131,176)
		SpriteFrame(-28,-28,60,20,70,197)
		SpriteFrame(-28,-28,60,20,131,197)
		SpriteFrame(-32,-8,64,29,0,209)
		SpriteFrame(2,-40,16,16,65,239)
		SpriteFrame(-62,-40,144,16,1,239)
		SpriteFrame(-46,-40,112,16,17,239)
		SpriteFrame(-30,-40,80,16,33,239)
		SpriteFrame(-14,-40,48,16,49,239)
		SpriteFrame(2,-40,80,16,65,222)
		SpriteFrame(-62,-40,79,16,1,239)
		SpriteFrame(-3,-28,11,8,27,53)
		if options.vsMode==1
			foreach TypeName[Eggman],ArrayPos0
				Object[ArrayPos0].Type=TypeName[BlankObject]
			floop
		endif
	else
		LoadSpriteSheet("MBZ/Objects.gif")
		SpriteFrame(-28,-28,60,20,1,1)
		SpriteFrame(-28,-28,60,20,62,1)
		SpriteFrame(-28,-28,60,20,1,22)
		SpriteFrame(-28,-28,60,20,62,22)
		SpriteFrame(-28,-28,60,20,1,43)
		SpriteFrame(-28,-28,60,20,62,43)
		SpriteFrame(-32,-8,64,29,415,170)
		SpriteFrame(2,-40,16,16,169,91)
		SpriteFrame(-62,-40,144,16,105,91)
		SpriteFrame(-46,-40,112,16,121,91)
		SpriteFrame(-30,-40,80,16,137,91)
		SpriteFrame(-14,-40,48,16,153,91)
		SpriteFrame(2,-40,80,16,42,64)
		SpriteFrame(-62,-40,79,16,105,91)
		SpriteFrame(-3,-28,11,8,45,88)
	endif
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
