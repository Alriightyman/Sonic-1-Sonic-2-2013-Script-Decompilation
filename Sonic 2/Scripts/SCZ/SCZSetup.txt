//--------------------Sonic 1 / Sonic 2 SCZ Setup Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 40: TYPE_SCZSETUP


#static 0:SCZSetup_staticVar38
#static 0:SCZSetup_staticVar39
#static 0:SCZSetup_staticVar40

#array SCZSetup_array38:(0xE0E040,0xE0A020,0xE06000,0xC02000,0xE0E0E0,0xE0E040,0xE0A020,0xE06000,0xE0E040,0xE0A020,0xE06000,0xC02000,0xE0A020,0xE06000,0xC02000,0x802000)

//Unknown Variables
#static 0:staticVar0xF884
#static 0:staticVar0xF885
#static 0:staticVar0xF886
#static 0:staticVar0xF887
#static 0:staticVar0xF888

sub ObjectMain
	Object.Value1++
	if Object.Value1==2
		Object.Value1=0
		GetArrayValue(TempValue0,Object.Value2,SCZSetup_array38)
		SetPaletteEntry(0,167,TempValue0)
		Object.Value2++
		Object.Value2&=15
		GetArrayValue(TempValue0,Object.Value2,SCZSetup_array38)
		SetPaletteEntry(0,168,TempValue0)
		Object.Value2++
		Object.Value2&=15
		GetArrayValue(TempValue0,Object.Value2,SCZSetup_array38)
		SetPaletteEntry(0,169,TempValue0)
		Object.Value2++
		Object.Value2&=15
		GetArrayValue(TempValue0,Object.Value2,SCZSetup_array38)
		SetPaletteEntry(0,170,TempValue0)
		Object.Value2++
		Object.Value2&=15
	endif
	Screen.CameraStyle=0
	Object[0].Gravity=GRAVITY_AIR
	Object[0].TileCollisions=0
	switch Object.State
	case 0
		SCZSetup_staticVar33+=SCZSetup_staticVar34
		TempValue0=SCZSetup_staticVar33
		TempValue0>>=16
		Stage.XBoundary1=TempValue0
		TempValue0+=Screen.XSize
		Stage.XBoundary2=TempValue0
		if Stage.XBoundary1>=0x1180
			Object.State++
		endif
		break
	case 1
		SCZSetup_staticVar34=-0x10000
		SCZSetup_staticVar35=0x10000
		SCZSetup_staticVar33+=SCZSetup_staticVar34
		SCZSetup_staticVar36+=SCZSetup_staticVar35
		TempValue0=SCZSetup_staticVar33
		TempValue0>>=16
		Stage.XBoundary1=TempValue0
		TempValue0+=Screen.XSize
		Stage.XBoundary2=TempValue0
		TempValue0=SCZSetup_staticVar36
		TempValue0>>=16
		Stage.YBoundary1=TempValue0
		TempValue0+=Screen.YSize
		Stage.YBoundary2=TempValue0
		TempValue0<<=16
		stage.deathBoundary=TempValue0
		if Stage.YBoundary1>=0x500
			Object.State++
		endif
		break
	case 2
		SCZSetup_staticVar34=0x10000
		SCZSetup_staticVar35=0
		SCZSetup_staticVar33+=SCZSetup_staticVar34
		TempValue0=SCZSetup_staticVar33
		TempValue0>>=16
		Stage.XBoundary1=TempValue0
		TempValue0+=Screen.XSize
		Stage.XBoundary2=TempValue0
		if Stage.XBoundary1>=0x1488
			Object[0].ControlMode=-1
			Object[0].JumpPress=0
			Object[0].JumpHold=0
			Object[0].Left=0
			Object[0].Right=1
			Object[0].Up=0
			Object[0].Down=0
			HParallax[0].ScrollSpeed=0
			Object.State++
		endif
		break
	case 3
		SCZSetup_staticVar34=0
		TempValue0=Stage.XBoundary2
		TempValue0-=32
		TempValue0<<=16
		if Object[0].XPos>TempValue0
			Object.State++
		endif
		break
	case 4
		Object[0].YVelocity=0
		Object.Value0+=4
		Music.Volume-=2
		SetScreenFade(0,0,0,Object.Value0)
		if Object.Value0==320
			fadeColor=0
			Object.Value0=0
			starPostID=0
			Object.Direction=FLIP_NONE
			Stage.ListPos++
			if options.gameMode==1
				ArrayPos1=options.saveSlot
				ArrayPos1<<=3
				if stage.player2Enabled==1
					SaveRAM[ArrayPos1]=3
				else
					SaveRAM[ArrayPos1]=Stage.PlayerListPos
				endif
				ArrayPos1++
				SaveRAM[ArrayPos1]=player.lives
				ArrayPos1++
				SaveRAM[ArrayPos1]=player.score
				ArrayPos1++
				SaveRAM[ArrayPos1]=player.scoreBonus
				ArrayPos1++
				SaveRAM[ArrayPos1]=Stage.ListPos
				SaveRAM[ArrayPos1]++
				ArrayPos1++
				SaveRAM[ArrayPos1]=specialStage.emeralds
				ArrayPos1++
				SaveRAM[ArrayPos1]=specialStage.listPos
				WriteSaveRAM()
			endif
			if options.gameMode==2
				timeAttack.result=Stage.Seconds
				timeAttack.result*=100
				TempValue0=Stage.Minutes
				TempValue0*=0x1770
				timeAttack.result+=TempValue0
				timeAttack.result+=Stage.MilliSeconds
				Stage.ListPos--
				EngineCallback(SetLeaderboard,Stage.ListPos,timeAttack.result)
				Engine.State=8
			else
				TempValue0=Engine.TrialMode
				if Stage.ListPos>=Stage.ListSize
					TempValue0=1
				endif
				if TempValue0==0
					LoadStage()
				else
					Stage.ActiveList=PRESENTATION_STAGE
					Stage.ListPos=0
					LoadStage()
				endif
			endif
		endif
		break
	endswitch
	if Object.State<3
		foreach TypeGroup[256],PlayerObjectPos
			TempValue0=Object[PlayerObjectPos].CollisionRight
			TempValue0<<=16
			TempValue0+=Object[PlayerObjectPos].XPos
			TempValue1=Stage.XBoundary2
			TempValue1<<=16
			if TempValue0>TempValue1
				Object[PlayerObjectPos].XVelocity=0
				Object[PlayerObjectPos].Speed=0
				Object[PlayerObjectPos].XPos=TempValue1
				TempValue0=Object[PlayerObjectPos].CollisionRight
				TempValue0<<=16
				Object[PlayerObjectPos].XPos-=TempValue0
			endif
		floop
	endif
	SCZSetup_staticVar37=SCZSetup_staticVar38
	SCZSetup_staticVar37>>=1
	SCZSetup_staticVar38++
	SCZSetup_staticVar38%=12
	SCZSetup_staticVar39=SCZSetup_staticVar40
	SCZSetup_staticVar39>>=1
	SCZSetup_staticVar40++
	SCZSetup_staticVar40%=6
endsub


sub ObjectStartup
	SetMusicTrack("SkyChase.ogg",0,0x3066D)
	animalType1=41
	animalType2=42
	Object[10].Type=TypeName[SCZSetup]
	Object[10].Priority=PRIORITY_ACTIVE
	SCZSetup_staticVar33=Screen.CenterX
	SCZSetup_staticVar33*=-0x10000
	SCZSetup_staticVar33+=Object[0].XPos
	SCZSetup_staticVar36=0
	SCZSetup_staticVar34=0x10000
	SCZSetup_staticVar35=0
	SCZSetup_staticVar37=0
	SCZSetup_staticVar38=0
	SCZSetup_staticVar39=0
	SCZSetup_staticVar40=0
	Stage.YBoundary2=240
	stage.deathBoundary=0xF00000
	HParallax[0].ScrollSpeed=0x8000
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
