//--------------------Sonic 1 / Sonic 2 Ring Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 6: TYPE_RING



#array Ring_array15:(50,83,116,149,182,215,17,50)
#array Ring_array16:(17,17,17,17,17,17,50,50)

sub ObjectMain
	ArrayPos0=3DScene.NoVertices
	ArrayPos1=3DScene.NoFaces
	if Object.Value7==1
		FaceBuffer[ArrayPos1].Flag=FACE_TEXTURED_D
		FaceBuffer[ArrayPos1].a=ArrayPos0
		VertexBuffer[ArrayPos0].x=Object.Value11
		VertexBuffer[ArrayPos0].y=Object.Value12
		VertexBuffer[ArrayPos0].z=Object.Value13
		VertexBuffer[ArrayPos0].u=Object.Value14
		VertexBuffer[ArrayPos0].v=50
		ArrayPos0++
		FaceBuffer[ArrayPos1].b=ArrayPos0
		VertexBuffer[ArrayPos0].x=Object.Value11
		VertexBuffer[ArrayPos0].y=Object.Value12
		VertexBuffer[ArrayPos0].z=Object.Value13
		TempValue0=Object[0].YPos
		TempValue0-=0xE00000
		Object.Scale=Object.YPos
		Object.Scale-=TempValue0
		if Object.Scale>0
			Object.Scale>>=14
			Object.Scale+=0x400
		else
			Object.Scale=0x400
		endif
		VertexBuffer[ArrayPos0].u=Object.Scale
		VertexBuffer[ArrayPos0].v=Object.Scale
		ArrayPos0++
		FaceBuffer[ArrayPos1].c=ArrayPos0
		VertexBuffer[ArrayPos0].x=Object.Value11
		VertexBuffer[ArrayPos0].y=Object.Value12
		VertexBuffer[ArrayPos0].z=Object.Value13
		VertexBuffer[ArrayPos0].u=17
		VertexBuffer[ArrayPos0].v=16
		ArrayPos0++
		FaceBuffer[ArrayPos1].d=ArrayPos0
		VertexBuffer[ArrayPos0].x=Object.Value11
		VertexBuffer[ArrayPos0].y=Object.Value12
		VertexBuffer[ArrayPos0].z=Object.Value13
		ArrayPos0++
		ArrayPos1++
		3DScene.NoVertices+=4
		3DScene.NoFaces++
	endif
	FaceBuffer[ArrayPos1].Flag=FACE_TEXTURED_C
	FaceBuffer[ArrayPos1].a=ArrayPos0
	VertexBuffer[ArrayPos0].x=Object.Value4
	VertexBuffer[ArrayPos0].y=Object.Value5
	VertexBuffer[ArrayPos0].z=Object.Value6
	GetArrayValue(VertexBuffer[ArrayPos0].u,ringFrame,Ring_array15)
	GetArrayValue(VertexBuffer[ArrayPos0].v,ringFrame,Ring_array16)
	ArrayPos0++
	FaceBuffer[ArrayPos1].b=ArrayPos0
	VertexBuffer[ArrayPos0].x=Object.Value4
	VertexBuffer[ArrayPos0].y=Object.Value5
	VertexBuffer[ArrayPos0].z=Object.Value6
	TempValue0=Object[0].YPos
	TempValue0-=0xE00000
	Object.Scale=Object.YPos
	Object.Scale-=TempValue0
	if Object.Scale>0
		Object.Scale>>=14
		Object.Scale+=0x400
	else
		Object.Scale=0x400
	endif
	VertexBuffer[ArrayPos0].u=Object.Scale
	VertexBuffer[ArrayPos0].v=Object.Scale
	ArrayPos0++
	FaceBuffer[ArrayPos1].c=ArrayPos0
	VertexBuffer[ArrayPos0].x=Object.Value4
	VertexBuffer[ArrayPos0].y=Object.Value5
	VertexBuffer[ArrayPos0].z=Object.Value6
	VertexBuffer[ArrayPos0].u=16
	VertexBuffer[ArrayPos0].v=16
	ArrayPos0++
	FaceBuffer[ArrayPos1].d=ArrayPos0
	VertexBuffer[ArrayPos0].x=Object.Value4
	VertexBuffer[ArrayPos0].y=Object.Value5
	VertexBuffer[ArrayPos0].z=Object.Value6
	3DScene.NoVertices+=4
	3DScene.NoFaces++
	if Object.Value3<Object[0].Value13
		Object.Type=TypeName[BlankObject]
	else
		foreach TypeGroup[4],PlayerObjectPos
			TempValue1=Object.Value3
			TempValue1-=0x20000
			TempValue2=Object.Value3
			TempValue2+=0x20000
			if Object[PlayerObjectPos].Value14>TempValue1
				if Object[PlayerObjectPos].Value14<TempValue2
					TempValue0=Object[PlayerObjectPos].Value15
					TempValue0-=Object.Value1
					TempValue1=TempValue0
					TempValue1*=TempValue0
					TempValue0=Object[PlayerObjectPos].Value16
					TempValue0-=Object.Value2
					TempValue2=TempValue0
					TempValue2*=TempValue0
					TempValue1+=TempValue2
					if TempValue1<0xC40000
						if options.vsMode==0
							Object[PlayerObjectPos].Value0++
						else
							if ReceiveValue>-1
								if PlayerObjectPos==2
									Object[PlayerObjectPos].Value0++
								endif
							else
								Object[PlayerObjectPos].Value0++
							endif
						endif
						Object.Type=TypeName[RingSparkle]
						Object.AnimationTimer=0
						Object.Frame=0
						if ringPan==0
							PlaySfx(SFXName[RingL],0)
							SetSfxAttributes(SFXName[RingL],-1,-100)
							ringPan=1
						else
							PlaySfx(SFXName[RingR],0)
							SetSfxAttributes(SFXName[RingR],-1,100)
							ringPan=0
						endif
					endif
				endif
			endif
		floop
	endif
endsub


sub ObjectStartup
	LoadSpriteSheet("Special/Objects.gif")
	foreach TypeName[Ring],ArrayPos0
		Object[ArrayPos0].Angle=Object[ArrayPos0].iXPos
		Object[ArrayPos0].Angle-=448
		Object[ArrayPos0].Angle&=511
		Sin(Object[ArrayPos0].Value1,Object[ArrayPos0].Angle)
		Object[ArrayPos0].Value1*=-48
		Object[ArrayPos0].Value1>>=1
		Cos(Object[ArrayPos0].Value2,Object[ArrayPos0].Angle)
		Object[ArrayPos0].Value2*=-48
		Object[ArrayPos0].Value2>>=1
		if Object[ArrayPos0].Value2<-0x400
			Object[ArrayPos0].Value7=1
			Sin(Object[ArrayPos0].Value8,Object[ArrayPos0].Angle)
			Object[ArrayPos0].Value8*=-60
			Object[ArrayPos0].Value8>>=1
			Cos(Object[ArrayPos0].Value9,Object[ArrayPos0].Angle)
			Object[ArrayPos0].Value9*=-60
			Object[ArrayPos0].Value9>>=1
			Object[ArrayPos0].Value14=116
			if Object[ArrayPos0].Angle>32
				if Object[ArrayPos0].Angle<480
					if Object[ArrayPos0].Angle<256
						Object[ArrayPos0].Value14=149
					else
						Object[ArrayPos0].Value14=182
					endif
				endif
			endif
		endif
	floop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
