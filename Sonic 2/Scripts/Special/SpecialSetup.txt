//--------------------Sonic 1 / Sonic 2 Special Setup Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 1: TYPE_SPECIALSETUP


#static 0:SpecialSetup_staticVar0
#static 0:SpecialSetup_staticVar1
#static 0:SpecialSetup_staticVar2
#static 0:SpecialSetup_staticVar3
#static 0:SpecialSetup_staticVar4

#array SpecialSetup_array1:(0,0,0)
#array SpecialSetup_array2:(0,0,0)
#array SpecialSetup_array3:(0,0,0)
#array SpecialSetup_array0:(0xE0E0E0,0xD0D0D0,0xC0C0C0,0xB0B0B0,0xA0A0A0,0x909090,0x808080,0x707070,0x606060,0x707070,0x808080,0x909090,0xA0A0A0,0xB0B0B0,0xC0C0C0,0xD0D0D0)

sub ObjectMain
	ringTimer++
	if ringTimer==4
		ringTimer=0
		ringFrame++
		ringFrame&=7
	endif
	Object.Value1++
	if Object.Value1==4
		Object.Value1=0
		Object.Value2++
		Object.Value2&=15
		GetArrayValue(TempValue0,Object.Value2,SpecialSetup_array0)
		SetPaletteEntry(0,142,TempValue0)
		Object.Value3++
		Object.Value3&=15
		GetArrayValue(TempValue0,Object.Value3,SpecialSetup_array0)
		SetPaletteEntry(0,143,TempValue0)
	endif
	if options.attractMode==0
		if Object[2].ControlMode>-1
			options.touchControls=1
		else
			options.touchControls=0
		endif
	else
		options.touchControls=0
	endif
endsub


sub ObjectStartup
	SetMusicTrack("SpecialStage.ogg",0,0x79404)
	SetMusicTrack("ActComplete.ogg",1,0)
	SpecialSetup_staticVar0=0
	Object[9].Type=TypeName[SpecialSetup]
	Object[9].Priority=PRIORITY_ACTIVE
	Object[9].DrawOrder=1
	Object[9].Value3=8
	Object[10].Type=TypeName[HUD]
	Object[10].Priority=PRIORITY_ACTIVE
	Object[10].DrawOrder=6
	if Stage.PlayerListPos>2
		Stage.PlayerListPos=0
		stage.player2Enabled=1
	endif
	if options.vsMode==0
		TempValue1=Stage.ActNo
	else
		if vs.activeList==3
			TempValue1=Stage.ActNo
			TempValue1+=3
		else
			vs.randomValue*=0x41C64E6D
			vs.randomValue+=0x3039
			vs.randomValue&=0x7FFFFFFF
			TempValue1=vs.randomValue
			TempValue1>>=16
			TempValue1%=12
			TempValue1++
		endif
	endif
	TempValue1<<=3
	TempValue0=TempValue1
	TempValue0-=8
	LoadPalette("SpecialStage.act",0,192,TempValue0,TempValue1)
	GetPaletteEntry(0,197,SpecialSetup_staticVar1)
	SpecialSetup_staticVar1|=-0x1000000
	GetPaletteEntry(0,192,SpecialSetup_staticVar2)
	SpecialSetup_staticVar2|=-0x1000000
	if options.attractMode==0
	endif
	TempValue0=1
	foreach TypeName[StartMessage],ArrayPos0
		Object[11].Type=TypeName[StartMessage]
		Object[11].Priority=PRIORITY_ACTIVE_PAUSED
		Object[11].DrawOrder=5
		SetArrayValue(Object[ArrayPos0].Value0,0,SpecialSetup_array1)
		SetArrayValue(Object[ArrayPos0].Value1,0,SpecialSetup_array2)
		SetArrayValue(Object[ArrayPos0].Value2,0,SpecialSetup_array3)
		ResetObjectEntity(ArrayPos0,TypeName[BlankObject],0,0,0)
	floop
	TempValue0=1
	foreach TypeName[Checkpoint],ArrayPos0
		if TempValue0<3
			SetArrayValue(Object[ArrayPos0].Value0,TempValue0,SpecialSetup_array1)
			SetArrayValue(Object[ArrayPos0].Value1,TempValue0,SpecialSetup_array2)
			SetArrayValue(Object[ArrayPos0].Value2,TempValue0,SpecialSetup_array3)
			TempValue0++
		endif
		Object[ArrayPos0].Value0=0
		Object[ArrayPos0].Value1=0
		Object[ArrayPos0].Value2=0
	floop
	SpecialSetup_staticVar3=0
	if stage.player2Enabled==1
		SpecialSetup_staticVar4=5
	else
		if Stage.PlayerListPos==2
			SpecialSetup_staticVar4=13
		else
			SpecialSetup_staticVar4=9
		endif
	endif
	ArrayPos0=32
	while ArrayPos0<0x420
		if Object[ArrayPos0].Type==TypeName[BlankObject]
			Object[ArrayPos0].YPos=0x7FFF0000
		else
			Object[ArrayPos0].Priority=PRIORITY_INACTIVE
		endif
		ArrayPos0++
	loop
	ArrayPos0=32
	while ArrayPos0<768
		ArrayPos1=767
		ArrayPos2=766
		while ArrayPos1>ArrayPos0
			if Object[ArrayPos1].YPos<Object[ArrayPos2].YPos
				TempValue0=Object[ArrayPos1].Type
				TempValue1=Object[ArrayPos1].PropertyValue
				TempValue2=Object[ArrayPos1].XPos
				TempValue3=Object[ArrayPos1].YPos
				Object[ArrayPos1].Type=Object[ArrayPos2].Type
				Object[ArrayPos1].PropertyValue=Object[ArrayPos2].PropertyValue
				Object[ArrayPos1].XPos=Object[ArrayPos2].XPos
				Object[ArrayPos1].YPos=Object[ArrayPos2].YPos
				Object[ArrayPos2].Type=TempValue0
				Object[ArrayPos2].PropertyValue=TempValue1
				Object[ArrayPos2].XPos=TempValue2
				Object[ArrayPos2].YPos=TempValue3
			endif
			ArrayPos1--
			ArrayPos2--
		loop
		ArrayPos0++
	loop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
