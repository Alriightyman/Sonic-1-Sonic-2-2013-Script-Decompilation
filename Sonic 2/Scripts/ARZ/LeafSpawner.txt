//--------------------Sonic 1 / Sonic 2 Leaf Spawner Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 61: TYPE_LEAFSPAWNER

// Function declarations
#function LeafSpawner_Function140



function LeafSpawner_Function140
	CreateTempObject(TypeName[Leaf],0,Object[PlayerObjectPos].XPos,Object[PlayerObjectPos].YPos)
	Rand(TempValue2,16)
	TempValue2-=8
	TempValue2<<=16
	Object[TempObjectPos].XPos+=TempValue2
	Rand(TempValue2,16)
	TempValue2-=8
	TempValue2<<=16
	Object[TempObjectPos].YPos+=TempValue2
	Rand(Object[TempObjectPos].Frame,2)
	Object[TempObjectPos].Value1=Object[PlayerObjectPos].XPos
	Object[TempObjectPos].Value2=Object[PlayerObjectPos].YPos
	Object[TempObjectPos].Value3=2
	Object[TempObjectPos].Value4=4
endfunction


sub ObjectMain
	if Object.Value0==0
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,Object.Value2,-32,Object.Value1,32,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			if CheckResult==1
				TempValue0=Object[PlayerObjectPos].XVelocity
				Absolute(TempValue0)
				TempValue1=Object[PlayerObjectPos].YVelocity
				Absolute(TempValue1)
				TempValue0|=TempValue1
				if TempValue0>0x20000
					Object.Value0=15
					PlaySfx(SFXName[Rustle],0)
					CallFunction(LeafSpawner_Function140)
					Object[TempObjectPos].XVelocity=-0x8000
					Object[TempObjectPos].YVelocity=-0x8000
					CallFunction(LeafSpawner_Function140)
					Object[TempObjectPos].XVelocity=0xC000
					Object[TempObjectPos].YVelocity=-0x4000
					CallFunction(LeafSpawner_Function140)
					Object[TempObjectPos].XVelocity=-0xC000
					Object[TempObjectPos].YVelocity=0x4000
					CallFunction(LeafSpawner_Function140)
					Object[TempObjectPos].XVelocity=0x8000
					Object[TempObjectPos].YVelocity=0x8000
				endif
			endif
		floop
	else
		Object.Value0--
	endif
endsub


sub ObjectStartup
	foreach TypeName[LeafSpawner],ArrayPos0
		Object[ArrayPos0].Value1=32
		Object[ArrayPos0].Value1<<=Object[ArrayPos0].PropertyValue
		Object[ArrayPos0].Value2=Object[ArrayPos0].Value1
		FlipSign(Object[ArrayPos0].Value2)
	floop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
