//--------------------Sonic 1 / Sonic 2 BrokenMonitor Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 14: TYPE_BROKENMONITOR

// Function declarations
#function BrokenMonitor_Function80

#constant 0:BrokenMonitor_constant27


function BrokenMonitor_Function80
endfunction


sub ObjectMain
	switch Object.State
	case 0
		if Object.Value1<0
			Object.Value0+=Object.Value1
			Object.Value1+=0x1800
		else
			Object.Value1=0
		endif
		if Object.Value1==0
			Object.State=1
			Object.InkEffect=INK_ALPHA
			PlayerObjectPos=Object.Value3
			switch Object.PropertyValue
			case 1
				Object[PlayerObjectPos].Value0+=10
				if ringPan==0
					PlaySfx(SFXName[RingL],0)
					SetSfxAttributes(SFXName[RingL],-1,-100)
					ringPan=1
				else
					PlaySfx(SFXName[RingR],0)
					SetSfxAttributes(SFXName[RingR],-1,100)
					ringPan=0
				endif
				if Object[PlayerObjectPos].Value0>999
					Object[PlayerObjectPos].Value0=999
				endif
				if Object[0].Value0>=ringExtraLife
					if options.gameMode!=2
						player.lives++
						PlaySfx(SFXName[Life],0)
						PauseMusic()
						ResetObjectEntity(25,TypeName[MusicEvent],2,0,0)
						Object[25].Priority=PRIORITY_ACTIVE
					endif
					ringExtraLife+=100
					if ringExtraLife>300
						ringExtraLife=1000
					endif
				endif
				break
			case 2
				PlaySfx(SFXName[BlueShield],0)
				ArrayPos0=PlayerObjectCount
				ArrayPos0+=PlayerObjectPos
				Object[PlayerObjectPos].Value37=1
				if PlayerObject_constant3!=1
					if Object[ArrayPos0].Type!=invincibilityType
						CallFunction(PlayerObject_Function37)
					endif
				endif
				break
			case 3
				if PlayerObject_constant3!=1
					ArrayPos0=PlayerObjectCount
					ArrayPos0+=PlayerObjectPos
					ResetObjectEntity(ArrayPos0,invincibilityType,0,Object[PlayerObjectPos].XPos,Object[PlayerObjectPos].YPos)
					Object[ArrayPos0].Priority=PRIORITY_ACTIVE
					Object[PlayerObjectPos].Value7=0x4EC
					PlayMusic(2)
				endif
				break
			case 4
				if SpeedUpMusic!=0
					if Object[PlayerObjectPos].Value6==0
						CallFunction(SpeedUpMusic)
					endif
				endif
				Object[PlayerObjectPos].Value6=0x528
				CallFunction(PlayerObject_Function41)
				break
			case 5
			case 6
			case 7
				ArrayPos0=25
				if Object[PlayerObjectPos].Value16==0
					ArrayPos0+=PlayerObjectPos
				endif
				options.gameMode++
				PlaySfx(SFXName[Life],0)
				PauseMusic()
				ResetObjectEntity(25,TypeName[MusicEvent],2,0,0)
				Object[25].Priority=PRIORITY_ACTIVE
				break
			case 8
				PlayerObjectPos=0
				Object[0].Value0+=50
				if PlayerObject_constant3!=1
					Object.Type=Object[0].Type
					CallFunction(PlayerObject_Function56)
					Object.Type=TypeName[BrokenMonitor]
				else
					if ringPan==0
						PlaySfx(SFXName[RingL],0)
						SetSfxAttributes(SFXName[RingL],-1,-100)
						ringPan=1
					else
						PlaySfx(SFXName[RingR],0)
						SetSfxAttributes(SFXName[RingR],-1,100)
						ringPan=0
					endif
				endif
				if Object[0].Value0>999
					Object[0].Value0=999
				endif
				if Object[0].Value0>=ringExtraLife
					if options.gameMode!=2
						player.lives++
						PlaySfx(SFXName[Life],0)
						PauseMusic()
						ResetObjectEntity(25,TypeName[MusicEvent],2,0,0)
						Object[25].Priority=PRIORITY_ACTIVE
					endif
					ringExtraLife+=100
					if ringExtraLife>300
						ringExtraLife=1000
					endif
				endif
				break
			case 9
				PlaySfx(SFXName[BubbleShield],0)
				ArrayPos0=PlayerObjectCount
				ArrayPos0+=PlayerObjectPos
				Object[PlayerObjectPos].Value37=2
				if PlayerObject_constant3!=1
					if Object[ArrayPos0].Type!=invincibilityType
						CallFunction(PlayerObject_Function37)
					endif
				endif
				if Object[PlayerObjectPos].Value4>=3
					Object[PlayerObjectPos].Value3=0
					Object[PlayerObjectPos].Value4=0
					CallFunction(BrokenMonitor_constant27)
				endif
				break
			case 10
				PlaySfx(SFXName[FireShield],0)
				ArrayPos0=PlayerObjectCount
				ArrayPos0+=PlayerObjectPos
				Object[PlayerObjectPos].Value37=3
				if PlayerObject_constant3!=1
					if Object[ArrayPos0].Type!=invincibilityType
						CallFunction(PlayerObject_Function37)
					endif
				endif
				break
			case 11
				PlaySfx(SFXName[LightningShield],0)
				ArrayPos0=PlayerObjectCount
				ArrayPos0+=PlayerObjectPos
				Object[PlayerObjectPos].Value37=4
				if PlayerObject_constant3!=1
					if Object[ArrayPos0].Type!=invincibilityType
						CallFunction(PlayerObject_Function37)
					endif
				endif
				break
			case 12
				CallFunction(PlayerObject_Function45)
				break
			case 13
				CreateTempObject(TypeName[VSGame],0,Object.XPos,Object.YPos)
				Object[TempObjectPos].State=1
				PlaySfx(SFXName[Teleport],0)
				break
			case 14
				PlaySfx(SFXName[Spike],0)
				options.spikeBehavior^=1
				break
			case 15
				PlaySfx(SFXName[BlueShield],0)
				options.shieldType++
				options.shieldType&=3
				ArrayPos0=PlayerObjectCount
				PlayerObjectPos=0
				CallFunction(PlayerObject_Function37)
				break
			case 16
				if specialStage.emeralds==127
					specialStage.emeralds=0
				else
					specialStage.emeralds=127
				endif
				PlaySfx(SFXName[Transform],0)
				break

			endswitch
		endif
		break
	case 1
		Object.Value1++
		if Object.Value1==30
			Object.Value1=0
			Object.State=2
			Object.PropertyValue=0
			if Object.Priority!=PRIORITY_XBOUNDS_DESTROY
				Object.Priority=PRIORITY_ACTIVE_BOUNDS
			endif
		else
			if Object.Value1>14
				Object.Alpha-=16
			endif
		endif
		break

	endswitch
endsub


sub ObjectDraw
	DrawSprite(0)
	if Object.PropertyValue>0
		DrawSpriteFX(Object.PropertyValue,FX_INK,Object.XPos,Object.Value0)
	endif
endsub


sub ObjectStartup
	LoadSpriteSheet("Global/Items.gif")
	SpriteFrame(-16,0,32,16,18,34)
	SpriteFrame(-8,-9,16,14,18,66)
	SpriteFrame(-8,-9,16,14,35,66)
	SpriteFrame(-8,-9,16,14,18,81)
	SpriteFrame(-8,-9,16,14,35,81)
	SpriteFrame(-8,-9,16,14,18,96)
	SpriteFrame(-8,-9,16,14,35,96)
	SpriteFrame(-8,-9,16,14,18,111)
	SpriteFrame(-8,-9,16,14,35,111)
	SpriteFrame(-8,-9,16,14,18,141)
	SpriteFrame(-8,-9,16,14,35,126)
	SpriteFrame(-8,-9,16,14,18,126)
	SpriteFrame(-8,-9,16,14,35,141)
	SpriteFrame(-8,-9,16,14,18,156)
	SpriteFrame(-8,-9,16,14,35,156)
	SpriteFrame(-8,-9,16,14,18,171)
	SpriteFrame(-8,-9,16,14,35,171)
	BrokenMonitor_constant27=80
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
