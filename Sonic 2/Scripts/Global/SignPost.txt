//--------------------Sonic 1 / Sonic 2 Sign Post Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 21: TYPE_SIGNPOST

// Function declarations
#function SignPost_Function89
#function SignPost_Function90



function SignPost_Function89
	DrawSprite(0)
	DrawSprite(1)
endfunction


function SignPost_Function90
	CreateTempObject(TypeName[SignPost],0,Object.XPos,Object.YPos)
	Object[TempObjectPos].Frame=1
	Object[TempObjectPos].Value1=16
	if options.vsMode==1
		Object[TempObjectPos].State=3
	endif
endfunction


sub ObjectMain
	switch Object.State
	case 0
		TempValue0=Object.YPos
		TempValue0+=0x400000
		if Object[0].YPos<TempValue0
			Stage.NewXBoundary1=Object.XPos
			Stage.NewXBoundary1>>=16
			Stage.NewXBoundary1-=Screen.CenterX
			Stage.NewXBoundary1-=Screen.CenterX
			Stage.NewXBoundary2=Object.XPos
			Stage.NewXBoundary2>>=16
			Stage.NewXBoundary2+=Screen.CenterX
			if Object[0].XPos>Object.XPos
				Stage.NewXBoundary1=Object.XPos
				Stage.NewXBoundary1>>=16
				Stage.NewXBoundary1-=Screen.CenterX
				switch Object[0].PropertyValue
				case 0
					EditFrame(5,-24,-16,48,32,34,1)
					break
				case 1
					EditFrame(5,-24,-16,48,32,34,34)
					break
				case 2
					EditFrame(5,-24,-16,48,32,34,67)
					break
				endswitch
				if Stage.DebugMode==0
					if Stage.ActiveList==BONUS_STAGE
						if Stage.Minutes<7
							EngineCallback(SetAchievement,10,100)
						endif
					else
						if Stage.ListPos==0
							if Stage.Minutes==0
								if Stage.Seconds<35
									EngineCallback(SetAchievement,0,100)
								endif
							endif
						endif
					endif
				endif
				Stage.TimeEnabled=0
				Object.State=1
				PlaySfx(SFXName[SignPost],0)
				if PlayerObject_staticVar3==1
					PlayerObject_staticVar3=2
					if Stage.DebugMode==0
						EngineCallback(SetAchievement,3,100)
					endif
				endif
			endif
		endif
		break
	case 1
		Music.Volume--
		Object.Value2++
		if Object.Value2==2
			Object.Value2=0
			Object.Frame++
			if Object.Frame==5
				Object.Frame=1
				Rand(TempValue0,48)
				TempValue0<<=16
				TempValue0+=Object.XPos
				TempValue0-=0x180000
				Rand(TempValue1,32)
				TempValue1<<=16
				TempValue1+=Object.YPos
				TempValue1-=0x140000
				CreateTempObject(TypeName[RingSparkle],0,TempValue0,TempValue1)
				Object.Value1--
				if Object.Value1==0
					SetBit(Object.Value3,0,1)
					if stage.player2Enabled==1
						SetBit(Object.Value3,1,1)
					endif
					Object.State=2
				endif
			endif
		endif
		break
	case 2
		TempValue0=Screen.CenterX
		TempValue0<<=16
		TempValue0+=Object.XPos
		if Object[0].XPos>TempValue0
			PlayMusic(1)
			Object.State=6
			Object[30].Type=TypeName[ActFinish]
			Object[30].DrawOrder=6
			Object[30].Priority=PRIORITY_ACTIVE
		endif
		break
	case 3
		Stage.NewXBoundary2=Object.XPos
		Stage.NewXBoundary2>>=16
		Stage.NewXBoundary2+=Screen.CenterX
		foreach TypeGroup[256],PlayerObjectPos
			GetBit(TempValue1,Object.Value3,PlayerObjectPos)
			if TempValue1==0
				if Object[PlayerObjectPos].XPos>Object.XPos
					Object.Priority=PRIORITY_ACTIVE
					SetBit(Object.Value3,PlayerObjectPos,1)
					if PlayerObjectPos==0
						if PlayerObject_staticVar3==1
							PlayerObject_staticVar3=2
						endif
						if vs.playerID==0
							TempValue2=0
						else
							TempValue2=1
						endif
					else
						if vs.playerID==0
							TempValue2=1
						else
							TempValue2=0
						endif
					endif
					if TempValue2==0
						vs.time1P=Stage.MilliSeconds
						vs.time1P=Stage.Seconds
						vs.time1P*=100
						TempValue2=Stage.Minutes
						TempValue2*=0x1770
						vs.time1P+=TempValue2
						vs.time1P+=Stage.MilliSeconds
					else
						vs.time2P=Stage.MilliSeconds
						vs.time2P=Stage.Seconds
						vs.time2P*=100
						TempValue2=Stage.Minutes
						TempValue2*=0x1770
						vs.time2P+=TempValue2
						vs.time2P+=Stage.MilliSeconds
					endif
					Object.Value5=PlayerObjectPos
					Object.Value1=16
					Object.State=4
					PlaySfx(SFXName[SignPost],0)
					if Object.Value4==0
						PlaySfx(SFXName[SignPost2P],0)
						Object[30].State=3
						Object[30].Value5=PlayerObjectPos
						Object[30].Value5^=1
						switch Object[PlayerObjectPos].PropertyValue
						case 0
							EditFrame(5,-24,-16,48,32,34,1)
							break
						case 1
							EditFrame(5,-24,-16,48,32,34,34)
							break
						case 2
							EditFrame(5,-24,-16,48,32,34,67)
							break
						endswitch
					else
						Object[30].State=0
					endif
					if Object.Value3==3
						Object.Value4=1
						Object[30].State=0
					endif
				endif
			endif
		floop
		break
	case 4
		if Object.Value4==1
			Music.Volume--
		else
			foreach TypeGroup[256],PlayerObjectPos
				GetBit(TempValue1,Object.Value3,PlayerObjectPos)
				if TempValue1==0
					if Object[PlayerObjectPos].XPos>Object.XPos
						Object.Value2=1
						Object.Frame=4
						Object.Value1=1
					endif
				endif
			floop
		endif
		Object.Value2++
		if Object.Value2==2
			Object.Value2=0
			Object.Frame++
			if Object.Frame==5
				Object.Frame=1
				Rand(TempValue0,48)
				TempValue0<<=16
				TempValue0+=Object.XPos
				TempValue0-=0x180000
				Rand(TempValue1,32)
				TempValue1<<=16
				TempValue1+=Object.YPos
				TempValue1-=0x140000
				CreateTempObject(TypeName[RingSparkle],0,TempValue0,TempValue1)
				Object.Value1--
				if Object.Value1==0
					if Object.Value4==0
						Object.Value4=1
						Object.State=3
						if Object.Value5==0
							Screen.CameraTarget=1
							Object[1].TrackScroll=1
							Object[9].Type=TypeName[BlankObject]
							CreateTempObject(TypeName[VSGame],0,Object.XPos,Object.YPos)
							Object[TempObjectPos].Value0=384
							Object[TempObjectPos].State=2
							Screen.CameraXPos=Object[1].XPos
							Screen.CameraXPos>>=16
							Screen.CameraYPos=Object[1].YPos
							Screen.CameraYPos>>=16
						endif
					else
						Object.State=6
						Object[30].State=4
						Object[30].Value0=-768
					endif
				endif
			endif
		endif
		break
	case 6
		break
	case 5
	endswitch
	TempValue0=40
	TempValue0+=212
	TempValue0<<=16
	TempValue0+=Object.XPos
	PlayerObjectPos=0
	while PlayerObjectPos<PlayerObjectCount
		GetBit(TempValue1,Object.Value3,PlayerObjectPos)
		if TempValue1==1
			Object[PlayerObjectPos].ObjectInteractions=0
			Object[PlayerObjectPos].ControlMode=-1
			Object[PlayerObjectPos].Up=0
			Object[PlayerObjectPos].Down=0
			Object[PlayerObjectPos].Left=0
			Object[PlayerObjectPos].Right=1
			Object[PlayerObjectPos].JumpPress=0
			Object[PlayerObjectPos].JumpHold=0
		endif
		if Object[PlayerObjectPos].XPos>TempValue0
			Object[PlayerObjectPos].XPos=TempValue0
			Object[PlayerObjectPos].Speed=0
			Object[PlayerObjectPos].XVelocity=0
		endif
		if Object[PlayerObjectPos].Type==TypeName[DebugMode]
			SetBit(Object.Value3,PlayerObjectPos,0)
		endif
		PlayerObjectPos++
	loop
endsub


sub ObjectDraw
	DrawSprite(0)
	if Object.Value1>8
		DrawSprite(Object.Frame)
	else
		TempValue0=Object.Frame
		TempValue0+=4
		DrawSprite(TempValue0)
	endif
endsub


sub ObjectStartup
	LoadSpriteSheet("Global/Items2.gif")
	SpriteFrame(-24,16,48,16,34,132)
	SpriteFrame(-24,-16,48,32,34,100)
	SpriteFrame(-16,-16,32,32,149,99)
	SpriteFrame(-4,-16,8,32,247,2)
	SpriteFrame(-16,-16,32,32,116,99)
	SpriteFrame(-24,-16,48,32,34,1)
	SpriteFrame(-16,-16,32,32,149,99)
	SpriteFrame(-4,-16,8,32,247,2)
	SpriteFrame(-16,-16,32,32,116,99)
	foreach TypeName[SignPost],ArrayPos0
		CheckGreater(Object[ArrayPos0].PropertyValue,0)
		TempValue0=CheckResult
		CheckEqual(options.vsMode,0)
		TempValue0&=CheckResult
		if TempValue0==1
			Object[ArrayPos0].Type=TypeName[BlankObject]
		else
			Object[ArrayPos0].Frame=1
			Object[ArrayPos0].Value1=16
			if Object[ArrayPos0].PropertyValue!=2
				Object[ArrayPos0].Priority=PRIORITY_XBOUNDS
			endif
		endif
		if options.vsMode==1
			Object[ArrayPos0].State=3
		endif
	floop
	SetArrayValue(21,DebugMode_staticVar25,DebugMode_array12)
	SetArrayValue(89,DebugMode_staticVar25,DebugMode_array13)
	SetArrayValue(90,DebugMode_staticVar25,DebugMode_array11)
	DebugMode_staticVar25++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
