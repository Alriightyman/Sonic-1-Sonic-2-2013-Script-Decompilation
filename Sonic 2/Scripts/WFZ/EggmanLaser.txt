//--------------------Sonic 1 / Sonic 2 Eggman Laser Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 83: TYPE_EGGMANLASER


#constant 0:EggmanLaser_constant52


sub ObjectMain
	switch Object.State
	case 0
		Object.Value1=Object.XPos
		Object.Value1-=0x600000
		Object.Value2=Object.XPos
		Object.Value2+=0x600000
		Object.Value4=6
		Object.DrawOrder=4
		Object.InkEffect=INK_ADD
		CheckStageFolder("Zone11")
		if CheckResult==1
			Object.Value9=196
		else
			Object.Value9=192
		endif
		Object.Value6=8
		Object.Value0++
		if Object.Value0>=90
			Object.Value0=0
			Object.State=2
		endif
		break
	case 1
		Object.Value0++
		if Object.Value0>=90
			Object.Value0=0
			Object.State=2
		endif
		break
	case 2
		Object.YPos+=0x4000
		Object.Value0++
		if Object.Value0>=96
			Object.Value0=0
			Object[1].Type=TypeName[EggmanDispenser]
			Object.State=3
			if Object[0].XPos<Object.XPos
				Object.XVelocity=-0x10000
			else
				Object.XVelocity=0x10000
			endif
		endif
		break
	case 3
		Object.Value0++
		if Object.Value0>112
			Object.Value0=0
			Object.State=4
		else
			Object.XPos+=Object.XVelocity
			if Object.XVelocity>0
				if Object.XPos>=Object.Value2
					FlipSign(Object.XVelocity)
				endif
			else
				if Object.XPos<=Object.Value1
					FlipSign(Object.XVelocity)
				endif
			endif
		endif
		break
	case 4
		Object.AnimationTimer++
		if Object.AnimationTimer==6
			Object.AnimationTimer=0
			Object.Frame++
			if Object.Frame==3
				Object.State=5
			endif
		endif
		break
	case 5
		Object.Value0++
		if Object.Value0>26
			Object.Value0=0
			Object.State=6
		endif
		break
	case 6
		Object.Value3+=0x10000
		Object.Value0++
		if Object.Value0>12
			Object.Value0=0
			Object.State=7
		endif
		break
	case 7
		Object.Value0++
		if Object.Value0>60
			Object.Value0=15
			Object.AnimationTimer=15
			Object.Value5=8
			Object.Alpha=512
			Object.State=8
		endif
		break
	case 8
		if Object.AnimationTimer>2
			Object.Value4=6
		else
			Object.Value4=5
		endif
		Object.AnimationTimer--
		if Object.AnimationTimer==0
			Object.Value0--
			if Object.Value0==0
				Object.State=9
			else
				Object.AnimationTimer=Object.Value0
				if Object.Value0==13
					PlaySfx(SFXName[LaserCharge],0)
				endif
			endif
		endif
		break
	case 9
		Object.Value4-=5
		Object.Value4^=1
		Object.Value4+=5
		Object.Value0++
		if Object.Value0>64
			Object.Value0=0
			Object.Alpha=160
			Object.State=10
			Object.Value4=5
			PlaySfx(SFXName[LargeLaser],0)
		endif
		break
	case 10
		Object.Value5+=32
		if Object.Value5>=128
			Object.Alpha+=32
			Object.Value5=167
			Object.Value0=0
			if Object[0].XPos<Object.XPos
				Object.XVelocity=-0x10000
			else
				Object.XVelocity=0x10000
			endif
			Object.State=11
		endif
		break
	case 11
		Object.Value0++
		Object.Alpha--
		if Object.Value0>112
			Object.Value0=0
			Object.State=12
		else
			Object.XPos+=Object.XVelocity
			if Object.XVelocity>0
				if Object.XPos>=Object.Value2
					Object.XVelocity=0
				endif
			else
				if Object.XPos<=Object.Value1
					Object.XVelocity=0
				endif
			endif
		endif
		break
	case 12
		Object.Value3-=0x10000
		Object.Alpha-=24
		Object.Value0++
		if Object.Value0>12
			Object.Value0=0
			Object.AnimationTimer=0
			Object.State=13
		endif
		break
	case 13
		Object.AnimationTimer++
		if Object.AnimationTimer==6
			Object.AnimationTimer=0
			Object.Frame--
			if Object.Frame==0
				if Object[0].XPos<Object.XPos
					Object.XVelocity=-0x10000
				else
					Object.XVelocity=0x10000
				endif
				Object.State=3
			endif
		endif
		break
	case 14
		if Object.Alpha>0
			Object.Alpha-=24
		endif
		Object.Value0++
		if Object.Value0>=180
			Object.Value0=0
			Object.Value8=2
			Object.State=15
		endif
		break
	case 15
		TempValue0=TileLayer[0].YSize
		TempValue0<<=7
		Stage.NewYBoundary2=TempValue0
		TempValue0<<=16
		stage.deathBoundary=TempValue0
		break

	endswitch
	if Object.Value6!=0
		if Object.Value7>0
			Object.Value7--
			GetBit(TempValue0,Object.Value7,0)
			if TempValue0==1
				SetPaletteEntry(0,Object.Value9,0xE0E0E0)
			else
				SetPaletteEntry(0,Object.Value9,0)
			endif
		endif
		if Object.Value3>0
			foreach TypeGroup[256],PlayerObjectPos
				PlayerObjectCollision(C_TOUCH,Object.EntityNo,-16,0,16,16,PlayerObjectPos,Object[PlayerObjectPos].Value40,Object[PlayerObjectPos].Value38,Object[PlayerObjectPos].Value41,Object[PlayerObjectPos].Value39)
				if CheckResult==1
					if Object.Value7==0
						CallFunction(PlayerObject_Function43)
						if CheckResult==1
							Object.Value6--
							if Object.Value6==0
								player.score+=1000
								Object.Value8=1
								Object.Value0=0
								Object.State=14
								Object[4].State=2
								Object[3].Value0=240
								Object[2].Value0=240
								Object[1].Value8=1
								Object[1].Value0=0
								Object[1].State=14
								CreateTempObject(TypeName[Explosion],0,Object[+1].XPos,Object[+1].YPos)
								Object[+1].State=2
								CreateTempObject(TypeName[Explosion],0,Object[+2].XPos,Object[+2].YPos)
								Object[+2].State=2
								CreateTempObject(TypeName[Explosion],0,Object[+3].XPos,Object[+3].YPos)
								Object[+3].State=2
								StopSfx(SFXName[LaserCharge])
								StopSfx(SFXName[LargeLaser])
							else
								Object.Value7=32
								PlaySfx(SFXName[BossHit],0)
							endif
						endif
					endif
				else
					if Object.State==11
						PlayerObjectCollision(C_TOUCH,Object.EntityNo,-16,0,16,168,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
						if CheckResult==1
							CallFunction(PlayerObject_Function45)
						endif
					endif
				endif
			floop
		endif
	endif
	if Object.Value8==1
		TempValue0=oscillation
		TempValue0&=7
		if TempValue0==0
			Rand(TempValue0,96)
			TempValue0-=48
			TempValue0<<=16
			TempValue0+=Object.XPos
			Rand(TempValue1,48)
			TempValue1-=24
			TempValue1<<=16
			TempValue1+=Object.YPos
			CreateTempObject(TypeName[Explosion],0,TempValue0,TempValue1)
			Object[TempObjectPos].DrawOrder=5
			PlaySfx(SFXName[Explosion],0)
		endif
	endif
endsub


sub ObjectDraw
	if Object.Value8<2
		TempValue1=Object.YPos
		TempValue1+=Object.Value3
		DrawSpriteXY(4,Object.XPos,TempValue1)
		DrawSprite(Object.Frame)
		TempValue0=168
		TempValue0-=Object.Value5
		EditFrame(5,-16,0,32,Object.Value5,EggmanLaser_constant52,TempValue0)
		DrawSpriteFX(Object.Value4,FX_INK,Object.XPos,TempValue1)
	endif
endsub


sub ObjectStartup
	CheckStageFolder("Zone11")
	if CheckResult==1
		LoadSpriteSheet("SCZ/Objects.gif")
		SpriteFrame(-32,-8,64,23,311,1)
		SpriteFrame(-32,-8,64,22,311,25)
		SpriteFrame(-32,-8,64,19,311,48)
		SpriteFrame(-32,-8,64,13,311,68)
		SpriteFrame(-16,-8,32,16,376,1)
		SpriteFrame(-16,0,32,168,261,1)
		SpriteFrame(0,0,1,1,261,168)
		EggmanLaser_constant52=261
	else
		LoadSpriteSheet("MBZ/Objects.gif")
		SpriteFrame(-32,-8,64,23,513,139)
		SpriteFrame(-32,-8,64,22,578,139)
		SpriteFrame(-32,-8,64,19,643,139)
		SpriteFrame(-32,-8,64,13,578,162)
		SpriteFrame(-16,-8,32,16,397,1)
		SpriteFrame(-16,0,32,168,480,1)
		SpriteFrame(0,0,1,1,480,168)
		EggmanLaser_constant52=480
	endif
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
