//--------------------Sonic 1 / Sonic 2 Grab Panel Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 52: TYPE_GRABPANEL

// Function declarations
#function GrabPanel_DebugDraw
#function GrabPanel_DebugSpawn



function GrabPanel_DebugDraw
	DrawSprite(0)
endfunction


function GrabPanel_DebugSpawn
	CreateTempObject(TypeName[GrabPanel],0,Object.XPos,Object.YPos)
	Object[TempObjectPos].Value0=60
endfunction


sub ObjectMain
	TempValue7=0
	foreach TypeGroup[256],PlayerObjectPos
		TempValue2=0
		if Object[PlayerObjectPos].Type==TypeName[TailsObject]
			TempValue3=-0x100000
		else
			TempValue3=-0x160000
		endif
		TempValue0=Object.XPos
		TempValue0+=TempValue3
		TempValue0-=Object[PlayerObjectPos].XPos
		Absolute(TempValue0)
		if TempValue0<=0x40000
			TempValue0=Object.YPos
			TempValue0-=Object[PlayerObjectPos].YPos
			TempValue1=TempValue0
			Absolute(TempValue0)
			if TempValue0<=0x160000
				Object[PlayerObjectPos].Animation=ANI_CLINGING
				Object[PlayerObjectPos].AnimationSpeed=128
				Object[PlayerObjectPos].Direction=FLIP_X
				Object[PlayerObjectPos].XPos=Object.XPos
				Object[PlayerObjectPos].XPos+=TempValue3
				if Object.PropertyValue==127
					Object[PlayerObjectPos].State=PlayerObject_Blank
					Object[PlayerObjectPos].XVelocity=0
					Object[PlayerObjectPos].YVelocity=0
					Object[PlayerObjectPos].Speed=0
				endif
				TempValue2=1
			else
				if Object[PlayerObjectPos].Animation==ANI_CLINGING
					Object[PlayerObjectPos].YPos=Object.YPos
					if TempValue1<0
						Object[PlayerObjectPos].YPos+=0x160000
					else
						Object[PlayerObjectPos].YPos-=0x160000
					endif
					TempValue2=1
				endif
			endif
			if TempValue2!=0
				if PlayerObjectPos==0
					if Object[PlayerObjectPos].JumpPress!=0
						if Object[PlayerObjectPos].YPos<Object.YPos
							TempValue7=1
						else
							TempValue7=2
						endif
					endif
					Object.Value0--
					if Object.Value0==0
						if Object[PlayerObjectPos].YPos<Object.YPos
							TempValue7=1
						else
							TempValue7=2
						endif
					endif
				endif
			endif
		endif
	floop
	if TempValue7!=0
		Object[PlayerObjectPos].Animation=ANI_FANROTATE
		PlaySfx(SFXName[LedgeBreak],0)
		TempValue0=Object.XPos
		TempValue0-=0x100000
		TempValue1=Object.YPos
		TempValue1-=0x100000
		if TempValue7==1
			CreateTempObject(TypeName[GrabPanelPart],0,TempValue0,TempValue1)
			Object[TempObjectPos].XVelocity=-0x40000
			Object[TempObjectPos].State=1
			TempValue1+=0x200000
			CreateTempObject(TypeName[GrabPanelPart],4,TempValue0,TempValue1)
			Object[TempObjectPos].XVelocity=-0x40000
			TempValue0-=0x200000
			TempValue1-=0x200000
			CreateTempObject(TypeName[GrabPanelPart],16,TempValue0,TempValue1)
			Object[TempObjectPos].XVelocity=-0x40000
			TempValue1+=0x200000
			CreateTempObject(TypeName[GrabPanelPart],24,TempValue0,TempValue1)
			Object[TempObjectPos].XVelocity=-0x40000
		else
			CreateTempObject(TypeName[GrabPanelPart],4,TempValue0,TempValue1)
			Object[TempObjectPos].XVelocity=-0x40000
			TempValue1+=0x200000
			CreateTempObject(TypeName[GrabPanelPart],0,TempValue0,TempValue1)
			Object[TempObjectPos].XVelocity=-0x40000
			Object[TempObjectPos].State=1
			TempValue0-=0x200000
			TempValue1-=0x200000
			CreateTempObject(TypeName[GrabPanelPart],24,TempValue0,TempValue1)
			Object[TempObjectPos].XVelocity=-0x40000
			TempValue1+=0x200000
			CreateTempObject(TypeName[GrabPanelPart],16,TempValue0,TempValue1)
			Object[TempObjectPos].XVelocity=-0x40000
		endif
		Object.Type=TypeName[BlankObject]
	endif
endsub


sub ObjectDraw
	if Object.PropertyValue!=127
		DrawSprite(0)
	endif
endsub


sub ObjectStartup
	LoadSpriteSheet("SCZ/Objects.gif")
	SpriteFrame(-64,-32,64,64,1,69)
	foreach TypeName[GrabPanel],ArrayPos0
		Object[ArrayPos0].Value0=Object[ArrayPos0].PropertyValue
		Object[ArrayPos0].Value0*=60
	floop
	SetArrayValue(TypeName[GrabPanel],DebugMode_constant25,DebugMode_array12)
	SetArrayValue(GrabPanel_DebugDraw,DebugMode_constant25,DebugMode_array13)
	SetArrayValue(GrabPanel_DebugSpawn,DebugMode_constant25,DebugMode_array11)
	DebugMode_constant25++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
