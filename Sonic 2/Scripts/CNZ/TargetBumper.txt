//--------------------Sonic 1 / Sonic 2 Target Bumper Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 45: TYPE_TARGETBUMPER

// Function declarations
#function TargetBumper_Function111
#function TargetBumper_Function112
#function TargetBumper_Function113



//Unknown Variables
#static 0:staticVar0x10F6E

function TargetBumper_Function111
	TempValue0=Object[0].Value17
	TempValue0-=TargetBumper_staticVar33
	TempValue1=Object.Direction
	switch TempValue0
	case 0
		Object.Direction=FLIP_NONE
		TempValue0=0
		break
	case 1
		Object.Direction=FLIP_NONE
		TempValue0=3
		break
	case 2
		Object.Direction=FLIP_X
		TempValue0=3
		break
	case 3
		Object.Direction=FLIP_NONE
		TempValue0=6
		break
	case 4
		Object.Direction=FLIP_X
		TempValue0=6
		break
	endswitch
	DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
	Object.Direction=TempValue1
endfunction


function TargetBumper_Function112
	TempValue0=Object[0].Value17
	TempValue0-=TargetBumper_staticVar33
	CreateTempObject(TypeName[TargetBumper],TempValue0,Object.XPos,Object.YPos)
	Object[TempObjectPos].DrawOrder=4
	switch Object[TempObjectPos].PropertyValue
	case 0
		Object[TempObjectPos].Direction=FLIP_NONE
		Object[TempObjectPos].Value4=0
		Object[TempObjectPos].Value1=0
		Object[TempObjectPos].Value2=0x20000
		break
	case 1
		Object[TempObjectPos].Direction=FLIP_NONE
		Object[TempObjectPos].Value4=3
		Object[TempObjectPos].Value1=-0x20000
		Object[TempObjectPos].Value2=0x20000
		break
	case 2
		Object[TempObjectPos].Direction=FLIP_X
		Object[TempObjectPos].Value4=3
		Object[TempObjectPos].Value1=0x20000
		Object[TempObjectPos].Value2=0x20000
		break
	case 3
		Object[TempObjectPos].Direction=FLIP_NONE
		Object[TempObjectPos].Value4=6
		Object[TempObjectPos].Value1=-0x20000
		Object[TempObjectPos].Value2=0
		break
	case 4
		Object[TempObjectPos].Direction=FLIP_X
		Object[TempObjectPos].Value4=6
		Object[TempObjectPos].Value1=0x20000
		Object[TempObjectPos].Value2=0
		break
	endswitch
endfunction


function TargetBumper_Function113
	switch Object.PropertyValue
	case 0
		Object.XVelocity=Object[PlayerObjectPos].XVelocity
		if Object[PlayerObjectPos].YPos>Object.YPos
			Object.YVelocity=0x70000
		else
			Object.YVelocity=-0x70000
		endif
		break
	case 1
		ATan2(TempValue0,Object[PlayerObjectPos].XVelocity,Object[PlayerObjectPos].YVelocity)
		TempValue0-=96
		TempValue1=TempValue0
		Absolute(TempValue1)
		FlipSign(TempValue0)
		TempValue0+=96
		TempValue2=TempValue1
		TempValue2&=255
		if TempValue2>=64
			TempValue1-=128
			FlipSign(TempValue1)
			TempValue2=TempValue1
			TempValue2&=255
			if TempValue2>=56
				TempValue0=96
				TempValue0+=128
			endif
		else
			if TempValue2>=56
				TempValue0=96
			endif
		endif
		TempValue0&=255
		Cos256(Object.XVelocity,TempValue0)
		Sin256(Object.YVelocity,TempValue0)
		Object.XVelocity*=-0x700
		Object.YVelocity*=-0x700
		break
	case 2
		ATan2(TempValue0,Object[PlayerObjectPos].XVelocity,Object[PlayerObjectPos].YVelocity)
		TempValue0-=32
		TempValue1=TempValue0
		Absolute(TempValue1)
		FlipSign(TempValue0)
		TempValue0+=32
		TempValue2=TempValue1
		TempValue2&=255
		if TempValue2>=64
			TempValue1-=128
			FlipSign(TempValue1)
			TempValue2=TempValue1
			TempValue2&=255
			if TempValue2>=56
				TempValue0=32
				TempValue0+=128
			endif
		else
			if TempValue2>=56
				TempValue0=32
			endif
		endif
		TempValue0&=255
		Cos256(Object.XVelocity,TempValue0)
		Sin256(Object.YVelocity,TempValue0)
		Object.XVelocity*=-0x700
		Object.YVelocity*=-0x700
		break
	case 3
		Object.YVelocity=Object[PlayerObjectPos].YVelocity
		if Object[PlayerObjectPos].XPos>Object.XPos
			Object.XVelocity=0x70000
		else
			Object.XVelocity=-0x70000
		endif
		break
	case 4
		Object.YVelocity=Object[PlayerObjectPos].YVelocity
		if Object[PlayerObjectPos].XPos>Object.XPos
			Object.XVelocity=0x70000
		else
			Object.XVelocity=-0x70000
		endif
		break
	endswitch
	if Object[PlayerObjectPos].State==34
		Object[1].Value36=30
	endif
	CheckEqual(Object[PlayerObjectPos].Animation,ANI_GLIDING)
	TempValue2=CheckResult
	CheckEqual(Object[PlayerObjectPos].Animation,ANI_GLIDING_STOP)
	TempValue2|=CheckResult
	CheckEqual(Object[PlayerObjectPos].Animation,ANI_FLYING)
	TempValue2|=CheckResult
	CheckEqual(Object[PlayerObjectPos].State,31)
	TempValue2|=CheckResult
	CheckEqual(Object[PlayerObjectPos].State,13)
	TempValue2|=CheckResult
	if TempValue2==0
		Object[PlayerObjectPos].State=12
		if Object[PlayerObjectPos].Animation!=ANI_JUMPING
			if Object[PlayerObjectPos].Animation!=ANI_RUNNING
				Object[PlayerObjectPos].Animation=ANI_WALKING
			endif
		endif
	endif
	if Object[PlayerObjectPos].Animation==ANI_GLIDING
		if Object.XVelocity>0
			if Object[PlayerObjectPos].XVelocity<0
				Object[PlayerObjectPos].Animation=ANI_GLIDING_DROP
				Object[PlayerObjectPos].State=22
			else
				Object[PlayerObjectPos].State=21
			endif
		else
			if Object[PlayerObjectPos].XVelocity>0
				Object[PlayerObjectPos].Animation=ANI_GLIDING_DROP
				Object[PlayerObjectPos].State=22
			else
				Object[PlayerObjectPos].State=20
			endif
		endif
	endif
	Object[PlayerObjectPos].XVelocity=Object.XVelocity
	Object[PlayerObjectPos].Speed=Object[PlayerObjectPos].XVelocity
	if Object[PlayerObjectPos].Animation==ANI_GLIDING
		if Object.XVelocity<0
			FlipSign(Object[PlayerObjectPos].Speed)
		endif
	endif
	Object[PlayerObjectPos].Value1=0
	Object[PlayerObjectPos].YVelocity=Object.YVelocity
	Object[PlayerObjectPos].Gravity=GRAVITY_AIR
	Object[PlayerObjectPos].TileCollisions=1
endfunction


sub ObjectMain
	if Object.State>0
		Object.AnimationTimer=Object.Value0
		Object.AnimationTimer>>=2
		Object.AnimationTimer++
		Object.Value0++
		if Object.Value0>12
			Object.Value0=0
			Object.State=0
			Object.AnimationTimer=0
			if Object.Value3>2
				Object.Type=TypeName[BlankObject]
			endif
		endif
	endif
	if Object.Visible==1
		TempValue7=0
		foreach TypeGroup[256],PlayerObjectPos
			TempValue6=Object.Value6
			TempValue6>>=TempValue7
			TempValue6&=255
			if TempValue6==0
				switch Object.PropertyValue
				case 0
					PlayerObjectCollision(C_TOUCH,Object.EntityNo,-14,-4,14,4,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
					break
				case 1
					PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-8,8,8,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
					break
				case 2
					PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-8,8,8,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
					break
				case 3
					PlayerObjectCollision(C_TOUCH,Object.EntityNo,-4,-14,4,14,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
					break
				case 4
					PlayerObjectCollision(C_TOUCH,Object.EntityNo,-4,-14,4,14,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
					break
				endswitch
				if CheckResult==1
					if Object.State==0
						PlaySfx(SFXName[TargetBumper],0)
						if Object.Value3<3
							switch Object.Value5
							case 0
								CheckNotEqual(Object[+1].Type,TypeName[TargetBumper])
								TempValue0=CheckResult
								CheckNotEqual(Object[+2].Type,TypeName[TargetBumper])
								TempValue0&=CheckResult
								break
							case 1
								CheckNotEqual(Object[-1].Type,TypeName[TargetBumper])
								TempValue0=CheckResult
								CheckNotEqual(Object[+1].Type,TypeName[TargetBumper])
								TempValue0&=CheckResult
								break
							case 2
								CheckNotEqual(Object[-1].Type,TypeName[TargetBumper])
								TempValue0=CheckResult
								CheckNotEqual(Object[-2].Type,TypeName[TargetBumper])
								TempValue0&=CheckResult
								break
							endswitch
							CheckEqual(Object.Value3,2)
							TempValue0&=CheckResult
							ArrayPos0=22
							if Object[PlayerObjectPos].Value16==0
								ArrayPos0+=PlayerObjectPos
							endif
							if TempValue0==0
								CreateTempObject(TypeName[ObjectScore],16,Object.XPos,Object.YPos)
								options.gameMode+=10
							else
								CreateTempObject(TypeName[ObjectScore],2,Object.XPos,Object.YPos)
								options.gameMode+=500
							endif
							Object.Value3++
						endif
						CallFunction(TargetBumper_Function113)
					else
						if Object.Value0>5
							PlaySfx(SFXName[TargetBumper],0)
							CallFunction(TargetBumper_Function113)
						endif
					endif
					Object.State=1
					Object.Priority=PRIORITY_ACTIVE
					TempValue6=3
					TempValue6<<=TempValue7
					Object.Value6|=TempValue6
				endif
			else
				TempValue5=1
				TempValue5<<=TempValue7
				Object.Value6-=TempValue5
			endif
			TempValue7+=8
		floop
	endif
endsub


sub ObjectDraw
	if Object.Visible==1
		TempValue0=Object.AnimationTimer
		TempValue0&=1
		Object.Frame=Object.Value4
		if Object.Value3<2
			Object.Frame+=Object.Value3
		else
			Object.Frame+=2
		endif
		if TempValue0==0
			DrawSpriteFX(Object.Frame,FX_FLIP,Object.XPos,Object.YPos)
		else
			TempValue1=Object.XPos
			TempValue1+=Object.Value1
			TempValue2=Object.YPos
			TempValue2+=Object.Value2
			DrawSpriteFX(Object.Frame,FX_FLIP,TempValue1,TempValue2)
		endif
	endif
endsub


sub ObjectStartup
	LoadSpriteSheet("CNZ/Objects.gif")
	SpriteFrame(-16,-6,32,12,1,166)
	SpriteFrame(-16,-6,32,12,1,153)
	SpriteFrame(-16,-6,32,12,1,140)
	SpriteFrame(-12,-12,24,24,1,229)
	SpriteFrame(-12,-12,24,24,1,204)
	SpriteFrame(-12,-12,24,24,1,179)
	SpriteFrame(-6,-16,12,32,60,140)
	SpriteFrame(-6,-16,12,32,47,140)
	SpriteFrame(-6,-16,12,32,34,140)
	foreach TypeName[TargetBumper],ArrayPos0
		Object[ArrayPos0].Value5=Object[ArrayPos0].PropertyValue
		Object[ArrayPos0].Value5>>=6
		Object[ArrayPos0].PropertyValue&=63
		switch Object[ArrayPos0].PropertyValue
		case 0
			Object[ArrayPos0].Direction=FLIP_NONE
			Object[ArrayPos0].Value4=0
			Object[ArrayPos0].Value1=0
			Object[ArrayPos0].Value2=0x20000
			break
		case 1
			Object[ArrayPos0].Direction=FLIP_NONE
			Object[ArrayPos0].Value4=3
			Object[ArrayPos0].Value1=-0x20000
			Object[ArrayPos0].Value2=0x20000
			break
		case 2
			Object[ArrayPos0].Direction=FLIP_X
			Object[ArrayPos0].Value4=3
			Object[ArrayPos0].Value1=0x20000
			Object[ArrayPos0].Value2=0x20000
			break
		case 3
			Object[ArrayPos0].Direction=FLIP_NONE
			Object[ArrayPos0].Value4=6
			Object[ArrayPos0].Value1=-0x20000
			Object[ArrayPos0].Value2=0
			break
		case 4
			Object[ArrayPos0].Direction=FLIP_X
			Object[ArrayPos0].Value4=6
			Object[ArrayPos0].Value1=0x20000
			Object[ArrayPos0].Value2=0
			break
		endswitch
	floop
	TempValue0=0
	TargetBumper_staticVar33=DebugMode_staticVar25
	while TempValue0<5
		SetArrayValue(45,DebugMode_staticVar25,DebugMode_array12)
		SetArrayValue(111,DebugMode_staticVar25,DebugMode_array13)
		SetArrayValue(112,DebugMode_staticVar25,DebugMode_array11)
		DebugMode_staticVar25++
		TempValue0++
	loop
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
