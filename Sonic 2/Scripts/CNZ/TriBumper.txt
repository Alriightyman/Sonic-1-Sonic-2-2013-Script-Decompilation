//--------------------Sonic 1 / Sonic 2 Tri Bumper Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 64: TYPE_TRIBUMPER

// Function declarations
#function TriBumper_Function139
#function TriBumper_Function140



function TriBumper_Function139
	ATan2(TempValue0,Object[PlayerObjectPos].XVelocity,Object[PlayerObjectPos].YVelocity)
	TempValue0-=TempValue3
	TempValue1=TempValue0
	Absolute(TempValue1)
	FlipSign(TempValue0)
	TempValue0+=256
	TempValue0+=TempValue3
	TempValue0&=255
	if TempValue1>=56
		TempValue0=TempValue3
	endif
	Cos256(Object[PlayerObjectPos].XVelocity,TempValue0)
	Object[PlayerObjectPos].XVelocity*=-0xA00
	Sin256(Object[PlayerObjectPos].YVelocity,TempValue0)
	Object[PlayerObjectPos].YVelocity*=-0xA00
endfunction


function TriBumper_Function140
	if Object[PlayerObjectPos].State==34
		Object[1].Value36=30
	endif
	CheckEqual(Object[PlayerObjectPos].Animation,ANI_GLIDING)
	TempValue2=CheckResult
	CheckEqual(Object[PlayerObjectPos].Animation,ANI_GLIDING_STOP)
	TempValue2|=CheckResult
	CheckEqual(Object[PlayerObjectPos].Animation,ANI_FLYING)
	TempValue2|=CheckResult
	CheckEqual(Object[PlayerObjectPos].State,31)
	TempValue2|=CheckResult
	CheckEqual(Object[PlayerObjectPos].State,13)
	TempValue2|=CheckResult
	if Object[PlayerObjectPos].Animation!=ANI_GLIDING
		Object[PlayerObjectPos].Speed=Object[PlayerObjectPos].XVelocity
		Object[PlayerObjectPos].Value1=0
	endif
	if TempValue2==0
		Object[PlayerObjectPos].State=12
		if Object[PlayerObjectPos].Animation!=ANI_JUMPING
			if Object[PlayerObjectPos].Animation!=ANI_RUNNING
				Object[PlayerObjectPos].Animation=ANI_WALKING
			endif
		endif
	endif
	Object[PlayerObjectPos].Gravity=GRAVITY_AIR
	Object[PlayerObjectPos].TileCollisions=1
	PlaySfx(SFXName[CNZBumper],0)
endfunction


sub ObjectMain
	switch Object.PropertyValue
	case 0
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,-32,-32,32,32,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			if CheckResult==1
				TempValue0=Object.YPos
				TempValue0-=Object[PlayerObjectPos].YPos
				FlipSign(TempValue0)
				if TempValue0>=0x200000
					Object[PlayerObjectPos].YVelocity=0xA0000
					CallFunction(TriBumper_Function140)
				else
					TempValue0=Object.XPos
					TempValue0-=Object[PlayerObjectPos].XPos
					FlipSign(TempValue0)
					if TempValue0>=0x200000
						Object[PlayerObjectPos].XVelocity=0xA0000
						CallFunction(TriBumper_Function140)
					else
						TempValue0=Object.XPos
						TempValue0-=Object[PlayerObjectPos].XPos
						if TempValue0>=0x200000
							TempValue0=0x200000
						endif
						TempValue0+=Object.YPos
						TempValue0-=0x80000
						TempValue1=Object[PlayerObjectPos].YPos
						TempValue1+=0xE0000
						TempValue0-=TempValue1
						if TempValue0<0
							TempValue3=32
							CallFunction(TriBumper_Function139)
							CallFunction(TriBumper_Function140)
						endif
					endif
				endif
			endif
		floop
		break
	case 1
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,-32,-32,32,32,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			if CheckResult==1
				TempValue0=Object.YPos
				TempValue0-=Object[PlayerObjectPos].YPos
				FlipSign(TempValue0)
				if TempValue0>=0x200000
					Object[PlayerObjectPos].YVelocity=0xA0000
					CallFunction(TriBumper_Function140)
				else
					TempValue0=Object.XPos
					TempValue0-=Object[PlayerObjectPos].XPos
					if TempValue0>=0x200000
						Object[PlayerObjectPos].XVelocity=-0xA0000
						CallFunction(TriBumper_Function140)
					else
						TempValue0=Object.XPos
						TempValue0-=Object[PlayerObjectPos].XPos
						FlipSign(TempValue0)
						if TempValue0>=0x200000
							TempValue0=0x200000
						endif
						TempValue0+=Object.YPos
						TempValue0-=0x80000
						TempValue1=Object[PlayerObjectPos].YPos
						TempValue1+=0xE0000
						TempValue0-=TempValue1
						if TempValue0<0
							TempValue3=96
							CallFunction(TriBumper_Function139)
							CallFunction(TriBumper_Function140)
						endif
					endif
				endif
			endif
		floop
		break
	case 2
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,-64,-8,64,8,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			if CheckResult==1
				TempValue0=Object.YPos
				TempValue0-=Object[PlayerObjectPos].YPos
				FlipSign(TempValue0)
				if TempValue0>=0x80000
					Object[PlayerObjectPos].YVelocity=0xA00
					CallFunction(TriBumper_Function140)
				else
					TempValue0=Object.XPos
					TempValue0-=Object[PlayerObjectPos].XPos
					if TempValue0>=0x400000
						Object[PlayerObjectPos].XVelocity=-0xA0000
						CallFunction(TriBumper_Function140)
					else
						FlipSign(TempValue0)
						if TempValue0>=0x400000
							Object[PlayerObjectPos].XVelocity=0xA0000
							CallFunction(TriBumper_Function140)
						else
							if TempValue0<0
								TempValue3=56
							else
								TempValue3=72
							endif
							CallFunction(TriBumper_Function139)
							CallFunction(TriBumper_Function140)
						endif
					endif
				endif
			endif
		floop
		break
	case 3
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,-64,-8,64,8,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			if CheckResult==1
				TempValue0=Object.YPos
				TempValue0-=Object[PlayerObjectPos].YPos
				if TempValue0>=0x80000
					Object[PlayerObjectPos].YVelocity=-0xA0000
					CallFunction(TriBumper_Function140)
				else
					TempValue0=Object.XPos
					TempValue0-=Object[PlayerObjectPos].XPos
					if TempValue0>=0x400000
						Object[PlayerObjectPos].XVelocity=-0xA0000
						CallFunction(TriBumper_Function140)
					else
						FlipSign(TempValue0)
						if TempValue0>=0x400000
							Object[PlayerObjectPos].XVelocity=0xA0000
							CallFunction(TriBumper_Function140)
						else
							if TempValue0<0
								TempValue3=200
							else
								TempValue3=184
							endif
							CallFunction(TriBumper_Function139)
							CallFunction(TriBumper_Function140)
						endif
					endif
				endif
			endif
		floop
		break
	case 4
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-64,8,64,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			if CheckResult==1
				TempValue0=Object.XPos
				TempValue0-=Object[PlayerObjectPos].XPos
				FlipSign(TempValue0)
				if TempValue0>=0x80000
					Object[PlayerObjectPos].XVelocity=0xA0000
					CallFunction(TriBumper_Function140)
				else
					TempValue0=Object.YPos
					TempValue0-=Object[PlayerObjectPos].YPos
					if TempValue0>=0x400000
						Object[PlayerObjectPos].YVelocity=-0xA0000
						CallFunction(TriBumper_Function140)
					else
						FlipSign(TempValue0)
						if TempValue0>=0x400000
							Object[PlayerObjectPos].YVelocity=0xA0000
							CallFunction(TriBumper_Function140)
						else
							if TempValue0<0
								TempValue3=8
							else
								TempValue3=248
							endif
							CallFunction(TriBumper_Function139)
							CallFunction(TriBumper_Function140)
						endif
					endif
				endif
			endif
		floop
		break
	case 5
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_TOUCH,Object.EntityNo,-8,-64,8,64,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			if CheckResult==1
				TempValue0=Object.XPos
				TempValue0-=Object[PlayerObjectPos].XPos
				if TempValue0>=0x80000
					Object[PlayerObjectPos].XVelocity=0xA0000
					CallFunction(TriBumper_Function140)
				else
					TempValue0=Object.YPos
					TempValue0-=Object[PlayerObjectPos].YPos
					if TempValue0>=0x400000
						Object[PlayerObjectPos].YVelocity=-0xA0000
						CallFunction(TriBumper_Function140)
					else
						FlipSign(TempValue0)
						if TempValue0>=0x400000
							Object[PlayerObjectPos].YVelocity=0xA0000
							CallFunction(TriBumper_Function140)
						else
							if TempValue0<0
								TempValue3=120
							else
								TempValue3=136
							endif
							CallFunction(TriBumper_Function139)
							CallFunction(TriBumper_Function140)
						endif
					endif
				endif
			endif
		floop
		break
	endswitch
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
