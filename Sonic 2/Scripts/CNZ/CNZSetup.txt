//--------------------Sonic 1 / Sonic 2 CNZ Setup Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 40: TYPE_CNZSETUP

// Function declarations
#function CNZSetup_Function97
#function CNZSetup_Function98
#function CNZSetup_Function99
#function CNZSetup_Function100
#function CNZSetup_Function101
#function CNZSetup_Function102


#array CNZSetup_array38:(0xE08000,0xE0A000,0xC0E000,0xE0E0E0,0xA0E000,0x40E000,0xC060,0x40C0C0,0x80E0,0x40E0,0x4000E0,0x8000C0,0xE020C0,0xE00080,0xE00040,0xE00000,0xE04000,0xE06000)
#array CNZSetup_array40:(390,391,394,395,398,399,402,403,406,407,410,411,414,415,418,419,422,423,426,427,430,431,434,435,438,439,442,443,446,447,450,451)
#array CNZSetup_array41:(388,389,392,393,396,397,400,401,404,405,408,409,412,413,416,417,420,421,424,425,428,429,432,433,436,437,440,441,444,445,448,449)
#array CNZSetup_array39:(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,6,7,0,1,2,3,4,5,6,7,255)
#array CNZSetup_array42:(1,2,1,3,1,2,2,1,2,3,1,2,1,2,0,0,2,0,3,2,2,3,2,2,1,3,0,0,1,0,1,3,1,2,1,3,1,2,2,1,2,3,1,2,1,2,0,0,2,0,3,2,2,3,2,2,1,3,0,0,1,0,1,3)

#array CNZSetup_ReplayDataS:(0x480000,0x2AC0000,0,73,8,107,0,1,48,1,32,3,0,3,4,20,0,37,4,23,0,108,4,23,0,24,8,60,56,1,40,31,8,4,0,9,4,8,0,41,8,99,0,2,4,39,0,18,8,2,0,9,8,37,56,1,40,17,32,6,36,25,32,5,40,42,32,8,36,6,32,3,40,89,32,1,36,3,4,37,0,5,8,45,56,1,40,3,32,13,40,8,32,1,36,2,4,71,0,115,8,38,0,14,8,12,0,1,4,22,0,30,48,1,32,2,40,45,32,9,40,8,8,51,0,1,4,106,0,14,4,9,0,2,4,14,0,15,4,18,0,27)
#array CNZSetup_ReplayDataT:(0x480000,0x2B00000,0,52,8,105,56,1,32,3,0,8,4,20,0,12,8,10,56,1,40,41,8,7,0,6,4,11,0,3,48,1,32,4,40,31,8,73,56,1,40,65,8,29,0,20,4,7,0,2,8,36,56,1,40,6,8,11,0,2,48,1,32,4,40,5,8,5,56,1,40,8,8,6,0,46,8,114,0,3,4,51,0,28,8,27,0,9,4,9,0,179,8,38,0,12,8,17,0,1,4,4,0,15,4,9,0,1,8,15,0,1,4,15,0,8,4,18,52,1,36,5,4,7,52,1,36,4,4,5,48,1,32,4,0,3,48,1,32,4,40,3,56,1,40,4,56,1,32,4,40,2,8,1,56,1,40,3,56,1,40,4,8,1,48,1,32,3,48,1,32,4,48,1,32,4,48,1,32,3,0,1,48,1,32,3,48,1,32,4,0,1,48,1,32,3,48,1,32,4,48,1,32,4,48,1,32,3,0,1,48,1,32,3,48,1,32,6,48,1,32,1,48,1,32,6,48,1,32,3,48,1,32,2,40,4,56,1,40,2,56,1,40,1,32,6,0,1,48,1,32,2,48,1,32,6,48,1,32,3,48,1,32,5,0,1,48,1,32,2,48,1,32,5,0,1,48,1,32,2,48,1,32,5,0,1,48,1,32,3,48,1,32,5,0,1,48,1,32,3,48,1,32,5,48,1,32,1,40,3,56,1,40,4,56,1,40,1,32,3,48,1,32,5,48,1,32,5,48,1,32,5,0,1,48,1,32,2,48,1,32,4,0,2,48,1,32,2,48,1,32,4,48,1,32,4,48,1,32,5,36,1,4,1,52,1,36,1,52,1,36,7,4,1,52,1,36,2,32,1,48,1,32,7,0,1,52,1,36,3,4,23,52,1,32,1,40,2,56,1,40,7,8,1,56,1,40,2,56,1,40,1,32,4,48,1,32,5,48,1,32,3,0,2,48,1,32,2,48,1,32,6,0,2,48,2,32,7,0,1,48,1,32,1,48,1,32,6,48,1,32,3,48,1,32,3,48,1,32,5,48,1,32,5,0,1,48,1,32,2,48,1,32,6,0,2,48,2,32,4,40,3,8,3,48,1,32,1,48,1,36,6,4,2,52,1,36,1,52,1,36,7,4,1,52,1,36,3,52,1,36,3,4,10,0,9,8,10,0,33,8,5)
#array CNZSetup_ReplayDataK:(0x480000,0x2AC0000,0,58,8,133,56,1,40,12,8,13,56,1,40,250,8,32,56,1,40,5,8,6,0,9,4,5,0,15,4,4,0,8,4,8,0,5,4,13,0,25,8,11,0,3,4,23,0,4,8,29,48,1,36,8,4,1,0,32,4,27,52,1,36,2,32,1,0,19,8,14,0,10,4,8,52,1,36,18,32,2,40,46,32,1,36,20,32,1,40,14,42,43,10,14,58,1,42,5,10,2,8,8,0,11,4,18,52,1,36,72,37,17,5,2,4,34,0,12,4,3,0,6,4,102,52,1,36,3,4,184,52,1,36,24,4,7,52,1,36,10,37,14,36,23,37,11,33,2,41,2,9,10,57,1,41,11,9,16,57,1,41,39,40,2,8,12,56,1,40,5,32,10,40,47,32,1)

function CNZSetup_Function97
	if Object.Gravity==GRAVITY_AIR
		Object.State=98
		Object.Value1=0
		CallFunction(PlayerObject_Function4)
	else
		TempValue1=0
		GetBit(TempValue0,Object.Direction,0)
		if TempValue0==0
			if Object.Left==1
				if Object.Speed>0
					Object.Speed-=Object.Value31
				else
					Object.Direction^=FLIP_X
					Object.Speed=-0x8000
				endif
			else
				if Object.Angle==0
					if Object.Speed<=0
						Object.Speed=0x40000
					endif
				endif
			endif
		else
			if Object.Right==1
				if Object.Speed<0
					Object.Speed+=Object.Value31
				else
					Object.Direction^=FLIP_X
					Object.Speed=0x8000
				endif
			else
				if Object.Angle==0
					if Object.Speed>=0
						Object.Speed=-0x40000
					endif
				endif
			endif
		endif
		if Object.Speed>0
			Object.Speed-=Object.Value29
			Sin256(TempValue0,Object.Angle)
			if TempValue0>0
				Sin256(TempValue0,Object.Angle)
				TempValue0*=0x5000
			else
				Sin256(TempValue0,Object.Angle)
				TempValue0*=0x1E00
			endif
			TempValue0>>=8
			Object.Speed+=TempValue0
		else
			Object.Speed+=Object.Value29
			Sin256(TempValue0,Object.Angle)
			if TempValue0<0
				Sin256(TempValue0,Object.Angle)
				TempValue0*=0x5000
			else
				Sin256(TempValue0,Object.Angle)
				TempValue0*=0x1E00
			endif
			TempValue0>>=8
			Object.Speed+=TempValue0
		endif
		CallFunction(PlayerObject_Function51)
		Object.AnimationSpeed=Object.Value5
		CallFunction(PlayerObject_Function5)
	endif
endfunction


function CNZSetup_Function98
	CallFunction(PlayerObject_Function3)
	if Object.Gravity==GRAVITY_AIR
		CallFunction(PlayerObject_Function4)
	else
		Object.State=97
		CallFunction(PlayerObject_Function5)
		Object.Value14=0
	endif
	Object.Animation=ANI_JUMPING
endfunction


function CNZSetup_Function99
	CheckEqual(Object[25].Type,TypeName[MusicEvent])
	TempValue0=CheckResult
	CheckEqual(Object[25].PropertyValue,2)
	TempValue0&=CheckResult
	CheckEqual(stage.musicFlag,0)
	TempValue0&=CheckResult
	if TempValue0==0
		switch Music.CurrentTrack
		case 0
			SetMusicTrack("Invincibility_F.ogg",2,0x78B1)
			SwapMusicTrack("CasinoNight_F.ogg",0,0xC488,0x1F40)
			break
		case 2
			SetMusicTrack("CasinoNight_F.ogg",0,0xC488)
			SwapMusicTrack("Invincibility_F.ogg",2,0x78B1,0x1F40)
			break
		case 4
		case 6
		case 7
			SetMusicTrack("CasinoNight_F.ogg",0,0xC488)
			SetMusicTrack("Invincibility_F.ogg",2,0x78B1)
			break

		endswitch
	else
		stage.musicFlag=1
	endif
endfunction


function CNZSetup_Function100
	CheckEqual(Object[25].Type,TypeName[MusicEvent])
	TempValue0=CheckResult
	CheckEqual(Object[25].PropertyValue,2)
	TempValue0&=CheckResult
	CheckEqual(stage.musicFlag,0)
	TempValue0&=CheckResult
	if TempValue0==0
		switch Music.CurrentTrack
		case 0
			SetMusicTrack("Invincibility.ogg",2,0x9717)
			SwapMusicTrack("CasinoNight.ogg",0,0xF564,0x30D4)
			break
		case 2
			SetMusicTrack("CasinoNight.ogg",0,0xF564)
			SwapMusicTrack("Invincibility.ogg",2,0x9717,0x30D4)
			break
		case 4
		case 6
		case 7
			SetMusicTrack("CasinoNight.ogg",0,0xF564)
			SetMusicTrack("Invincibility.ogg",2,0x9717)
			break

		endswitch
	else
		stage.musicFlag=2
	endif
endfunction


function CNZSetup_Function101
	CheckEqual(Object[25].Type,TypeName[MusicEvent])
	TempValue0=CheckResult
	CheckEqual(Object[25].PropertyValue,2)
	TempValue0&=CheckResult
	CheckEqual(stage.musicFlag,0)
	TempValue0&=CheckResult
	if TempValue0==0
		switch Music.CurrentTrack
		case 0
			SetMusicTrack("Invincibility_F.ogg",2,0x78B1)
			SwapMusicTrack("CasinoNight2_F.ogg",0,0x12BAE,0x1F40)
			break
		case 2
			SetMusicTrack("CasinoNight2_F.ogg",0,0x12BAE)
			SwapMusicTrack("Invincibility_F.ogg",2,0x78B1,0x1F40)
			break
		case 4
		case 6
		case 7
			SetMusicTrack("CasinoNight2_F.ogg",0,0x12BAE)
			SetMusicTrack("Invincibility_F.ogg",2,0x78B1)
			break

		endswitch
	else
		stage.musicFlag=1
	endif
endfunction


function CNZSetup_Function102
	CheckEqual(Object[25].Type,TypeName[MusicEvent])
	TempValue0=CheckResult
	CheckEqual(Object[25].PropertyValue,2)
	TempValue0&=CheckResult
	CheckEqual(stage.musicFlag,0)
	TempValue0&=CheckResult
	if TempValue0==0
		switch Music.CurrentTrack
		case 0
			SetMusicTrack("Invincibility.ogg",2,0x9717)
			SwapMusicTrack("CasinoNight2.ogg",0,0x1767C,0x30D4)
			break
		case 2
			SetMusicTrack("CasinoNight2.ogg",0,0x1767C)
			SwapMusicTrack("Invincibility.ogg",2,0x9717,0x30D4)
			break
		case 4
		case 6
		case 7
			SetMusicTrack("CasinoNight2.ogg",0,0x1767C)
			SetMusicTrack("Invincibility.ogg",2,0x9717)
			break

		endswitch
	else
		stage.musicFlag=2
	endif
endfunction


sub ObjectMain
	Object.Value5++
	if Object.Value5>7
		TileLayer[1].DeformationOffset++
		Object.Value5=0
	endif
	Object.Value1++
	if Object.Value1==8
		Object.Value1=0
		RotatePalette(0,165,167,1)
		RotatePalette(0,171,173,1)
		RotatePalette(0,178,180,0)
		Object.Value2++
		Object.Value2%=18
		GetArrayValue(TempValue0,Object.Value2,CNZSetup_array38)
		SetPaletteEntry(0,187,TempValue0)
		Object.Value3++
		Object.Value3%=18
		GetArrayValue(TempValue0,Object.Value3,CNZSetup_array38)
		SetPaletteEntry(0,186,TempValue0)
		Object.Value4++
		Object.Value4%=18
		GetArrayValue(TempValue0,Object.Value4,CNZSetup_array38)
		SetPaletteEntry(0,185,TempValue0)
	endif
	if Object.AnimationTimer<2
		GetArrayValue(TempValue0,Object.Value6,CNZSetup_array39)
		if TempValue0==255
			Object.Value6=0
			GetArrayValue(TempValue0,Object.Value6,CNZSetup_array39)
		endif
		TempValue0<<=2
		GetArrayValue(TempValue1,TempValue0,CNZSetup_array40)
		Copy16x16Tile(760,TempValue1)
		TempValue0++
		GetArrayValue(TempValue1,TempValue0,CNZSetup_array40)
		Copy16x16Tile(761,TempValue1)
		TempValue0++
		GetArrayValue(TempValue1,TempValue0,CNZSetup_array40)
		Copy16x16Tile(762,TempValue1)
		TempValue0++
		GetArrayValue(TempValue1,TempValue0,CNZSetup_array40)
		Copy16x16Tile(763,TempValue1)
		Object.Value6++
		GetArrayValue(TempValue0,Object.Value7,CNZSetup_array39)
		if TempValue0==255
			Object.Value7=0
			GetArrayValue(TempValue0,Object.Value7,CNZSetup_array39)
		endif
		TempValue0<<=2
		GetArrayValue(TempValue1,TempValue0,CNZSetup_array41)
		Copy16x16Tile(764,TempValue1)
		TempValue0++
		GetArrayValue(TempValue1,TempValue0,CNZSetup_array41)
		Copy16x16Tile(765,TempValue1)
		TempValue0++
		GetArrayValue(TempValue1,TempValue0,CNZSetup_array41)
		Copy16x16Tile(766,TempValue1)
		TempValue0++
		GetArrayValue(TempValue1,TempValue0,CNZSetup_array41)
		Copy16x16Tile(767,TempValue1)
		Object.Value7++
		Object.AnimationTimer=6
	else
		Object.AnimationTimer--
	endif
endsub


sub ObjectStartup
	if options.vsMode==0
		SetMusicTrack("CasinoNight.ogg",0,0xF564)
		SpeedUpMusic=99
		SlowDownMusic=100
	else
		SetMusicTrack("CasinoNight2.ogg",0,0x1767C)
		SpeedUpMusic=101
		SlowDownMusic=102
	endif
	SetPaletteEntry(0,192,0)
	animalType1=41
	animalType2=42
	ArrayPos0=0
	while ArrayPos0<576
		TempValue0=ArrayPos0
		TempValue0&=63
		GetArrayValue(Stage[ArrayPos0].DeformationData2,TempValue0,CNZSetup_array42)
		ArrayPos0++
	loop
	Object[10].Type=TypeName[CNZSetup]
	Object[10].Priority=PRIORITY_ACTIVE
	Object[10].Value3=1
	Object[10].Value4=2
	Object[10].Value7=70
	if options.attractMode==1
		switch Stage.PlayerListPos
		case 0
			PlayerObject_constant2=CNZSetup_ReplayDataS
			PlayerObject_constant8=142
			PlayerObject_constant7=0x708
			break
		case 1
			PlayerObject_constant2=CNZSetup_ReplayDataT
			PlayerObject_constant8=522
			PlayerObject_constant7=0x708
			break
		case 2
			PlayerObject_constant2=CNZSetup_ReplayDataK
			PlayerObject_constant8=178
			PlayerObject_constant7=0x708
			break

		endswitch
		CallFunction(PlayerObject_Function36)
	endif
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
