//--------------------Sonic 1 / Sonic 2 Eggman Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 58: TYPE_EGGMAN

// Function declarations
#function Eggman_Function139
#function Eggman_Function140
#function Eggman_Function141


#array Eggman_array46:(9,9,10,10)

function Eggman_Function139
	Sin256(Object.YPos,Object.Value2)
	Object.YPos<<=10
	Object.YPos+=Object.Value1
	Object.Value2+=2
	Object.Value2&=255
endfunction


function Eggman_Function140
	Object[1].Angle=Object.Rotation
	Object[+1].Angle=Object.Rotation
	Object[1].Frame=Object.Value18
	Object[1].Frame>>=2
	if Object.Rotation>88
		Object[1].Frame+=3
		TempValue0=Object.Rotation
		TempValue0-=128
		TempValue0&=511
	else
		TempValue0=Object.Rotation
	endif
	Object[+1].Frame=Object[1].Frame
	Object.Value18+=Object.Value19
	Object.Value18%=12
	Object[1].XPos=Object.XPos
	Object[+1].XPos=Object.XPos
	if Object.Direction==FLIP_NONE
		Object[1].XPos+=Object.Value15
		Object[+1].XPos+=Object.Value16
		Object[1].Rotation=512
		Object[1].Rotation-=TempValue0
		Object[1].Rotation&=511
		Object[+1].Rotation=Object[1].Rotation
	else
		Object[1].XPos-=Object.Value15
		Object[+1].XPos-=Object.Value16
		Object[1].Rotation=TempValue0
		Object[+1].Rotation=TempValue0
	endif
	Object[1].YPos=Object.YPos
	Object[1].YPos+=Object.Value17
	Object[1].Direction=Object.Direction
	Object[+1].YPos=Object.YPos
	Object[+1].YPos+=Object.Value17
	Object[+1].Direction=Object.Direction
endfunction


function Eggman_Function141
	if Object.YPos<Object.Value20
		Object.Value21++
		Object.Value21%=40
		if Object.Value21==8
			PlaySfx(SFXName[Rumble],0)
		endif
		TempValue0=Object.Value21
		TempValue0&=3
		if TempValue0==0
			Screen.ShakeY=2
		endif
		TempValue0=oscillation
		TempValue0&=7
		if TempValue0==0
			TempValue0=oscillation
			TempValue0&=15
			if TempValue0==0
				TempValue0=1
			else
				TempValue0=0
			endif
			Rand(TempValue1,Screen.XSize)
			TempValue2=Object.Value21
			TempValue2<<=4
			TempValue1+=TempValue2
			TempValue1%=Screen.XSize
			TempValue1-=Screen.CenterX
			TempValue1<<=16
			TempValue1+=Object.Value6
			TempValue2=Object.Value9
			TempValue2+=0x900000
			CreateTempObject(TypeName[BossRock],TempValue0,TempValue1,TempValue2)
		endif
	endif
endfunction


sub ObjectMain
	switch Object.State
	case 0
		TempValue0=Object[1].XPos
		TempValue0-=0x100000
		if Object[0].XPos>TempValue0
			TempValue0=Object[1].iXPos
			TempValue0-=Screen.CenterX
			Stage.NewXBoundary1=TempValue0
			TempValue0=Object[1].iXPos
			TempValue0+=Screen.CenterX
			Stage.NewXBoundary2=TempValue0
			TempValue0=Stage.NewYBoundary2
			TempValue0-=Screen.YSize
			Stage.NewYBoundary1=TempValue0
			Object.Value6=Object[1].XPos
			Object.Value7=-112
			Object.Value7*=Screen.XSize
			Object.Value7/=320
			Object.Value7<<=16
			Object.Value8=Object.Value7
			FlipSign(Object.Value8)
			Object.Value7+=Object[1].XPos
			Object.Value8+=Object[1].XPos
			Object.Value9=Object[1].YPos
			Object.Value9-=0x1200000
			Object.Value10=Object[1].YPos
			Object.Value10-=0x200000
			Object.Value20=Object[+1].YPos
			Object.Value20+=0x280000
			Object.XPos=16
			Object.XPos*=Screen.XSize
			Object.XPos/=320
			Object.XPos<<=16
			Object.XPos+=Object[1].XPos
			Object.YPos=Object.Value9
			Object.Animation=1
			ResetObjectEntity(26,TypeName[MusicEvent],0,0,0)
			Object[26].Priority=PRIORITY_ACTIVE
			CheckStageFolder("Zone06")
			if CheckResult==1
				Object[1].Type=TypeName[EggmanDrill]
				Object[+1].Type=TypeName[EggmanDrill]
			else
				Object[1].Type=TypeName[BlankObject]
				Object[+1].Type=TypeName[BlankObject]
			endif
			Object.Value14=6
			Object.Value12=1
			Object.Value15=-0x120000
			Object.Value16=0x160000
			CallFunction(Eggman_Function140)
			Object.Value17=0
			Object.Value3=8
			Object.Priority=PRIORITY_ACTIVE
			Object.State=1
		endif
		break
	case 1
		Object.Value0++
		if Object.Value0==60
			Object.Value0=0
			Object.YVelocity=0xC000
			Object.Value19=2
			Object.State=2
		endif
		break
	case 2
		Object.YPos+=Object.YVelocity
		if Object.YPos>=Object.Value10
			Object.YPos=Object.Value10
			Object.Value14=7
			Object.Value12=0
			Object.Value19=1
			if Object[0].XPos>Object.XPos
				Object.Direction=FLIP_X
			endif
			Object.State=4
		endif
		CallFunction(Eggman_Function140)
		CallFunction(Eggman_Function141)
		break
	case 3
		Object.YPos+=Object.YVelocity
		if Object.YPos<=Object.Value9
			Object.YPos=Object.Value9
			Object.YVelocity=0x10000
			if Object[0].XPos>Object.Value6
				Object.XPos=Object.Value7
				Object.Direction=FLIP_X
			else
				Object.XPos=Object.Value8
				Object.Direction=FLIP_NONE
			endif
			Object.State=2
		endif
		CallFunction(Eggman_Function140)
		CallFunction(Eggman_Function141)
		break
	case 4
		Object.Value0++
		if Object.Value0==100
			Object.Value0=0
			Object.Value19=2
			if Object.Direction==FLIP_NONE
				Object.XVelocity=-0x20000
				Object.State=6
			else
				Object.XVelocity=0x20000
				Object.State=7
			endif
		endif
		if Object.Value0>40
			if Object.Rotation<128
				Object.Rotation+=4
			endif
			TempValue0=128
			TempValue0-=Object.Rotation
			TempValue0<<=9
			TempValue1=Object.Rotation
			TempValue1<<=9
			Object.Value15=-18
			Object.Value16=22
			Object.Value15*=TempValue0
			Object.Value16*=TempValue0
			Object.Value17=0
			Object.Value17*=TempValue0
			TempValue2=-6
			TempValue3=34
			TempValue2*=TempValue1
			TempValue3*=TempValue1
			TempValue4=4
			TempValue4*=TempValue1
			Object.Value15+=TempValue2
			Object.Value16+=TempValue3
			Object.Value17+=TempValue4
		endif
		CallFunction(Eggman_Function140)
		break
	case 5
		Object.Value0++
		if Object.Value0==100
			Object.Value0=0
			Object.Value19=2
			Object.YVelocity=-0xC000
			Object.Value14=6
			Object.State=3
		endif
		if Object.Value0>40
			if Object.Rotation>0
				Object.Rotation-=4
			endif
			TempValue0=128
			TempValue0-=Object.Rotation
			TempValue0<<=9
			TempValue1=Object.Rotation
			TempValue1<<=9
			Object.Value15=-18
			Object.Value16=22
			Object.Value15*=TempValue0
			Object.Value16*=TempValue0
			Object.Value17=0
			Object.Value17*=TempValue0
			TempValue2=-6
			TempValue3=34
			TempValue2*=TempValue1
			TempValue3*=TempValue1
			TempValue4=4
			TempValue4*=TempValue1
			Object.Value15+=TempValue2
			Object.Value16+=TempValue3
			Object.Value17+=TempValue4
		endif
		CallFunction(Eggman_Function140)
		break
	case 6
		Object.XPos+=Object.XVelocity
		if Object.XPos<=Object.Value7
			Object.XPos=Object.Value7
			Object.Value12=1
			Object.Value19=1
			Object.State=5
		endif
		CallFunction(Eggman_Function140)
		break
	case 7
		Object.XPos+=Object.XVelocity
		if Object.XPos>=Object.Value8
			Object.XPos=Object.Value8
			Object.Value12=1
			Object.Value19=1
			Object.State=5
		endif
		CallFunction(Eggman_Function140)
		break
	case 8
		Object.Value0++
		if Object.Value0==60
			if Object.Direction==FLIP_NONE
				Object[1].XVelocity=-0x10000
			else
				Object[1].XVelocity=0x10000
			endif
			Object[1].YVelocity=-0x20000
			Object[1].State=1
		endif
		if Object.Value0==120
			if Object.Direction==FLIP_NONE
				Object[+1].XVelocity=0x10000
			else
				Object[+1].XVelocity=-0x10000
			endif
			Object[+1].YVelocity=-0x20000
			Object[+1].State=1
		endif
		if Object.Value0==180
			Object.Value0=0
			Object.Animation=5
			Object.Value5=0
			Object.YVelocity=0
			Object.State=9
			ResetObjectEntity(26,TypeName[MusicEvent],1,0,0)
			Object[26].Priority=PRIORITY_ACTIVE
			TempValue0=TileLayer[0].XSize
			TempValue0<<=7
			Stage.NewXBoundary2=TempValue0
		endif
		break
	case 9
		Object.YPos+=Object.YVelocity
		Object.YVelocity+=0x1800
		Object.Value0++
		if Object.Value0==16
			Object.YVelocity=0
			Object.Value0=0
			Object.AnimationTimer=0
			Object.State++
		endif
		break
	case 10
		if Object.Value0<24
			Object.YPos+=Object.YVelocity
			Object.YVelocity-=0x800
			Object.Value0++
		else
			Object.Value0=0
			Object.YVelocity=0
			Object.Value1=Object.YPos
			Object.State++
		endif
		break
	case 11
		CallFunction(Eggman_Function139)
		if Object.Value0<8
			Object.Value0++
		else
			Object.Value0=0
			Object.Animation=6
			Object.Value12=1
			Object.AnimationTimer=0
			Object.Direction=FLIP_X
			Object.Priority=PRIORITY_ACTIVE
			TempValue0=TileLayer[0].XSize
			TempValue0<<=7
			Stage.NewXBoundary2=TempValue0
			Object.State++
		endif
		break
	case 12
		Object.XPos+=0x40000
		Object.Value1-=0x4000
		CallFunction(Eggman_Function139)
		if Object.OutOfBounds==1
			ResetObjectEntity(Object.EntityNo,TypeName[BlankObject],0,0,0)
		endif
		break

	endswitch
	if Object.Value3!=0
		if Object.Value4>0
			Object.Value4--
			GetBit(TempValue0,Object.Value4,0)
			if TempValue0==1
				SetPaletteEntry(0,192,0xE0E0E0)
			else
				SetPaletteEntry(0,192,0)
			endif
		endif
		foreach TypeGroup[256],PlayerObjectPos
			if Object.Value4<32
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_HURT)
				TempValue0=CheckResult
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_DYING)
				TempValue0|=CheckResult
				CheckEqual(Object[PlayerObjectPos].Animation,ANI_DROWNING)
				TempValue0|=CheckResult
				if TempValue0!=0
					if Object.Animation!=2
						Object.Animation=2
						Object.AnimationTimer=0
					endif
				endif
				PlayerObjectCollision(C_TOUCH,Object.EntityNo,-24,-24,24,24,PlayerObjectPos,Object[PlayerObjectPos].Value40,Object[PlayerObjectPos].Value38,Object[PlayerObjectPos].Value41,Object[PlayerObjectPos].Value39)
				if CheckResult==1
					CallFunction(PlayerObject_Function43)
					if CheckResult==1
						Object.Value3--
						if Object.Value3==0
							player.score+=1000
							Object.Value0=0
							Object.Animation=4
							Object.Value12=0
							Object.AnimationTimer=0
							Object.Value5=1
							Object.Value1=Object.YPos
							Object.State=8
							Object[1].ObjectInteractions=0
							Object[+1].ObjectInteractions=0
							SetPaletteEntry(0,192,0)
						else
							Object.Animation=3
							Object.AnimationTimer=0
							Object.Value4=64
							PlaySfx(SFXName[BossHit],0)
						endif
					endif
				endif
			endif
		floop
	endif
	if Object.State!=12
		foreach TypeGroup[256],PlayerObjectPos
			TempValue0=Object[PlayerObjectPos].CollisionRight
			TempValue0<<=16
			TempValue0+=Object[PlayerObjectPos].XPos
			TempValue1=Stage.XBoundary2
			TempValue1<<=16
			if TempValue0>TempValue1
				Object[PlayerObjectPos].XVelocity=0
				Object[PlayerObjectPos].Speed=0
				Object[PlayerObjectPos].XPos=TempValue1
				TempValue0=Object[PlayerObjectPos].CollisionRight
				TempValue0<<=16
				Object[PlayerObjectPos].XPos-=TempValue0
			endif
		floop
	endif
	if Object.Value5==1
		TempValue0=oscillation
		TempValue0&=7
		if TempValue0==0
			Rand(TempValue0,48)
			TempValue0-=24
			TempValue0<<=16
			TempValue0+=Object.XPos
			Rand(TempValue1,48)
			TempValue1-=24
			TempValue1<<=16
			TempValue1+=Object.YPos
			CreateTempObject(TypeName[Explosion],0,TempValue0,TempValue1)
			Object[TempObjectPos].DrawOrder=5
			PlaySfx(SFXName[Explosion],0)
		endif
	endif
endsub


sub ObjectDraw
	DrawSpriteFX(6,FX_FLIP,Object.XPos,Object.YPos)
	if Object.Value14==7
		DrawSpriteFX(7,FX_FLIP,Object.XPos,Object.YPos)
	endif
	switch Object.Animation
	case 1
		TempValue0=Object.AnimationTimer
		TempValue0>>=3
		Object.AnimationTimer++
		Object.AnimationTimer&=15
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 2
		TempValue0=Object.AnimationTimer
		TempValue0&=15
		TempValue0>>=3
		TempValue0+=2
		Object.AnimationTimer++
		if Object.AnimationTimer==50
			Object.AnimationTimer=0
			if Object[0].Animation!=ANI_DYING
				Object.Animation=1
			endif
		endif
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 3
		TempValue0=Object.AnimationTimer
		TempValue0&=1
		TempValue0+=2
		Object.AnimationTimer++
		if Object.AnimationTimer==50
			Object.AnimationTimer=0
			Object.Animation=1
		endif
		DrawSpriteFX(4,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 4
		TempValue0=Object.AnimationTimer
		TempValue0>>=5
		TempValue0+=4
		TempValue0%=5
		Object.AnimationTimer++
		Object.AnimationTimer&=63
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 5
		DrawSpriteFX(5,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 6
		TempValue0=Object.AnimationTimer
		TempValue0>>=3
		Object.AnimationTimer++
		Object.AnimationTimer&=15
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		TempValue0=Object.AnimationTimer
		TempValue0>>=2
		TempValue0&=1
		if TempValue0==1
			DrawSpriteFX(11,FX_FLIP,Object.XPos,Object.YPos)
		endif
		break

	endswitch
	switch Object.Value12
	case 0
		DrawSpriteFX(8,FX_FLIP,Object.XPos,Object.YPos)
		break
	case 1
		GetArrayValue(TempValue0,Object.Value13,Eggman_array46)
		Object.Value13++
		Object.Value13&=3
		DrawSpriteFX(TempValue0,FX_FLIP,Object.XPos,Object.YPos)
		break

	endswitch
endsub


sub ObjectStartup
	CheckStageFolder("Zone06")
	if CheckResult==1
		LoadSpriteSheet("MCZ/Objects.gif")
		SpriteFrame(-26,-24,44,16,34,48)
		SpriteFrame(-26,-24,44,16,79,48)
		SpriteFrame(-26,-24,44,16,34,65)
		SpriteFrame(-26,-24,44,16,79,65)
		SpriteFrame(-26,-24,44,16,34,82)
		SpriteFrame(-26,-24,44,16,79,82)
		SpriteFrame(-38,-37,70,58,74,197)
		SpriteFrame(-34,0,17,16,5,234)
		SpriteFrame(-8,18,24,8,207,152)
		SpriteFrame(-8,18,24,16,190,165)
		SpriteFrame(-8,18,24,32,176,132)
		SpriteFrame(3,-28,11,8,76,132)
		if options.vsMode==1
			foreach TypeName[Eggman],ArrayPos0
				Object[ArrayPos0].Type=TypeName[BlankObject]
			floop
		endif
	else
		LoadSpriteSheet("MBZ/Objects.gif")
		SpriteFrame(-26,-24,44,16,1,5)
		SpriteFrame(-26,-24,44,16,62,5)
		SpriteFrame(-26,-24,44,16,1,26)
		SpriteFrame(-26,-24,44,16,62,26)
		SpriteFrame(-26,-24,44,16,1,47)
		SpriteFrame(-26,-24,44,16,62,47)
		SpriteFrame(-38,-37,70,58,182,197)
		SpriteFrame(-34,0,17,16,182,180)
		SpriteFrame(-8,18,24,8,388,227)
		SpriteFrame(-8,18,24,16,388,210)
		SpriteFrame(-8,18,24,32,388,177)
		SpriteFrame(3,-28,11,8,45,88)
	endif
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
