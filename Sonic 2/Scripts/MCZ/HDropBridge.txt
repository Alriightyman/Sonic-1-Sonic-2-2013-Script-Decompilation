//--------------------Sonic 1 / Sonic 2 H Drop Bridge Script--------------------//
//--------Scripted by Christian Whitehead 'The Taxman' & Simon Thomley 'Stealth'--------//
//-----------------Unpacked By Rubberduckycooly's Script Unpacker-----------------------//

//-------Aliases-------//
#alias 53: TYPE_HDROPBRIDGE

// Function declarations
#function HDropBridge_Function128
#function HDropBridge_Function129



function HDropBridge_Function128
	TempValue0=Object.XPos
	TempValue1=0
	TempValue0-=0x380000
	while TempValue1<8
		DrawSpriteXY(0,TempValue0,Object.YPos)
		TempValue0+=0x100000
		TempValue1++
	loop
endfunction


function HDropBridge_Function129
	CreateTempObject(TypeName[HDropBridge],0,Object.XPos,Object.YPos)
	Object[TempObjectPos].DrawOrder=4
	Object[TempObjectPos].Value1=0
	Object[TempObjectPos].Value2=256
	Object[TempObjectPos].Value3=Object[TempObjectPos].XPos
	Object[TempObjectPos].Value3-=0x380000
	Object[TempObjectPos].Value4=Object[TempObjectPos].XPos
	Object[TempObjectPos].Value4+=0x380000
endfunction


sub ObjectMain
	switch Object.State
	case 0
		if Object[-1].PropertyValue==1
			Object.State++
			PlaySfx(SFXName[FlappingDoor],0)
			if Object.Priority!=PRIORITY_XBOUNDS_DESTROY
				Object.Priority=PRIORITY_ACTIVE
			endif
		endif
		foreach TypeGroup[256],PlayerObjectPos
			PlayerObjectCollision(C_BOX,Object.EntityNo,-64,-8,64,8,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
		floop
		break
	case 1
		if Object.Value1<128
			Object.Value1+=8
			Object.Value2-=8
		else
			Object.State++
		endif
	case 2
		TempValue6=Object.XPos
		TempValue7=Object.YPos
		TempValue0=0
		TempValue1=0
		while TempValue0<4
			Cos(Object.XPos,Object.Value1)
			Object.XPos*=TempValue1
			Object.XPos+=Object.Value3
			Sin(Object.YPos,Object.Value1)
			Object.YPos*=TempValue1
			Object.YPos+=TempValue7
			foreach TypeGroup[256],PlayerObjectPos
				PlayerObjectCollision(C_BOX,Object.EntityNo,-8,-8,8,8,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			floop
			TempValue0++
			TempValue1+=0x800
		loop
		TempValue0=0
		TempValue1=0
		while TempValue0<4
			Cos(Object.XPos,Object.Value2)
			Object.XPos*=TempValue1
			Object.XPos+=Object.Value4
			Sin(Object.YPos,Object.Value2)
			Object.YPos*=TempValue1
			Object.YPos+=TempValue7
			foreach TypeGroup[256],PlayerObjectPos
				PlayerObjectCollision(C_BOX,Object.EntityNo,-8,-8,8,8,PlayerObjectPos,0x10000,0x10000,0x10000,0x10000)
			floop
			TempValue0++
			TempValue1+=0x800
		loop
		Object.XPos=TempValue6
		Object.YPos=TempValue7
		break
	endswitch
	if Object.OutOfBounds==1
		if Object.Priority!=PRIORITY_XBOUNDS_DESTROY
			Object.Value1=0
			Object.Value2=256
			Object.State=0
		endif
	endif
endsub


sub ObjectDraw
	TempValue0=0
	TempValue1=0
	while TempValue0<4
		Cos(TempValue2,Object.Value1)
		TempValue2*=TempValue1
		TempValue2+=Object.Value3
		Sin(TempValue3,Object.Value1)
		TempValue3*=TempValue1
		TempValue3+=Object.YPos
		DrawSpriteXY(0,TempValue2,TempValue3)
		TempValue0++
		TempValue1+=0x800
	loop
	TempValue0=0
	TempValue1=0
	while TempValue0<4
		Cos(TempValue2,Object.Value2)
		TempValue2*=TempValue1
		TempValue2+=Object.Value4
		Sin(TempValue3,Object.Value2)
		TempValue3*=TempValue1
		TempValue3+=Object.YPos
		DrawSpriteXY(0,TempValue2,TempValue3)
		TempValue0++
		TempValue1+=0x800
	loop
endsub


sub ObjectStartup
	LoadSpriteSheet("MCZ/Objects.gif")
	SpriteFrame(-8,-8,16,16,135,131)
	foreach TypeName[HDropBridge],ArrayPos0
		Object[ArrayPos0].DrawOrder=4
		Object[ArrayPos0].Value1=0
		Object[ArrayPos0].Value2=256
		Object[ArrayPos0].Value3=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value3-=0x380000
		Object[ArrayPos0].Value4=Object[ArrayPos0].XPos
		Object[ArrayPos0].Value4+=0x380000
	floop
	SetArrayValue(53,DebugMode_staticVar25,DebugMode_array12)
	SetArrayValue(128,DebugMode_staticVar25,DebugMode_array13)
	SetArrayValue(129,DebugMode_staticVar25,DebugMode_array11)
	DebugMode_staticVar25++
endsub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0,SingleIcon,-16,-16,32,32,1,143)
endsub
